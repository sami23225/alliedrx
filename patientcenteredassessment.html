<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ALLIEDRx -- Chapter 4: Patient-Centered Assessment Simulator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* === ALLIEDRx BRANDING EXACT MATCH === */
        :root {
            --color-primary: #af4bef; /* Purple - main brand color */
            --color-primary-soft: #d492ff; /* Light purple */
            --color-accent: #8380f0; /* Blue-purple accent */
            --color-success: #00b894; /* Green for correct/success */
            --color-warning: #fdcb6e;
            --color-error: #e17055; /* Red/Orange for errors */
            --color-bg: #f7f5fb; /* Light background */
            --color-text: #2b2b2b; /* Dark text */
            --color-muted: #6c6880; /* Muted text */
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --shadow-soft: 0 18px 45px rgba(23, 10, 61, 0.18);
            --shadow-medium: 0 12px 30px rgba(23, 10, 61, 0.12);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            padding: 24px;
            background: radial-gradient(
                circle at top left,
                #ffffff 0,
                #f1ecff 40%,
                var(--color-bg) 100%
            );
            color: var(--color-text);
            -webkit-text-size-adjust: 100%;
        }

        @media (max-width: 600px) {
            body {
                padding: 12px;
            }
        }

        /* === ANIMATIONS === */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes checkmarkPop {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* === MAIN PAGE CONTAINER === */
        .page {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 28px 30px 32px;
            display: flex;
            flex-direction: column;
            gap: 32px;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.6s ease-out;
        }

        @media (max-width: 900px) {
            .page {
                padding: 22px;
                gap: 28px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
            }
            .page {
                border-radius: 0;
                box-shadow: none;
                padding: 18px 14px 22px;
                gap: 24px;
            }
        }

        /* === ALLIEDRx HEADER/BRANDING === */
        .brand-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 14px;
            margin-bottom: 8px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeInUp 0.5s ease-out;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 40px;
            width: auto;
            max-width: 100%;
            filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.2));
        }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--color-muted);
            white-space: normal;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(175, 75, 239, 0.08);
            font-size: 0.76rem;
            color: var(--color-primary);
            white-space: normal;
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-success);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        .badge-mode {
            padding: 5px 10px;
            border-radius: 999px;
            background: rgba(12, 10, 24, 0.06);
            border: 1px solid rgba(12, 10, 24, 0.08);
            font-size: 0.74rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--color-muted);
            white-space: nowrap;
        }

        @media (max-width: 480px) {
            .brand-row {
                flex-direction: column;
                align-items: flex-start;
            }
            .badge-mode {
                margin-top: 6px;
            }
        }

        /* === MODULE HEADER === */
        .module-header {
            animation: fadeInUp 0.5s ease-out 0.1s both;
        }

        h1 {
            font-size: clamp(2rem, 3vw, 2.4rem);
            line-height: 1.05;
            color: var(--color-primary);
            margin-bottom: 6px;
        }

        .module-subtitle {
            font-size: 1.1rem;
            color: var(--color-muted);
            max-width: 800px;
            margin-bottom: 6px;
        }

        .module-description {
            font-size: 0.98rem;
            color: var(--color-muted);
            max-width: 800px;
            line-height: 1.6;
        }

        /* === PROGRESS TRACKER === */
        .progress-tracker {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 8px 0 20px;
            animation: fadeInUp 0.5s ease-out 0.2s both;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--color-muted);
        }

        .progress-step.active {
            color: var(--color-primary);
            font-weight: 600;
        }

        .progress-step.completed {
            color: var(--color-success);
        }

        .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-muted);
        }

        .progress-step.active .step-icon {
            background: var(--color-primary);
            color: white;
        }

        .progress-step.completed .step-icon {
            background: var(--color-success);
            color: white;
        }

        .step-divider {
            flex: 1;
            height: 2px;
            background: rgba(12, 10, 24, 0.1);
            margin: 0 8px;
        }

        /* === PROGRESS SUMMARY === */
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 16px;
            padding: 16px;
            background: rgba(175, 75, 239, 0.03);
            border-radius: var(--radius-sm);
            animation: fadeInUp 0.5s ease-out 0.3s both;
        }

        @media (max-width: 480px) {
            .progress-summary {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        .progress-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .progress-number {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--color-primary);
        }

        .progress-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
        }

        /* === ACTIVITY GRID === */
        .activity-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
            margin-bottom: 24px;
            animation: fadeInUp 0.5s ease-out 0.3s both;
        }

        /* === ACTIVITY CARDS === */
        .activity-card {
            background: rgba(175, 75, 239, 0.03);
            border-radius: var(--radius-md);
            border: 1px solid rgba(175, 75, 239, 0.1);
            padding: 28px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
        }

        .activity-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .activity-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .activity-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--color-text);
        }

        .activity-description {
            font-size: 1rem;
            color: var(--color-muted);
            line-height: 1.6;
            margin-bottom: 8px;
        }

        /* === CLINICAL TIP STYLES === */
        .clinical-tip {
            margin: 20px 0;
            padding: 16px 20px;
            background: rgba(175, 75, 239, 0.05);
            border-left: 4px solid var(--color-primary);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .tip-label {
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* === ACTIVITY 1: ROLE-PLAY SIMULATION === */
        .roleplay-container {
            display: flex;
            flex-direction: column;
            gap: 28px;
        }

        .roleplay-scenario {
            background: white;
            border-radius: var(--radius-md);
            padding: 24px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .patient-info {
            font-weight: 700;
            color: var(--color-primary);
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .patient-demographics {
            font-size: 1rem;
            color: var(--color-muted);
            margin-bottom: 12px;
        }

        .patient-statement {
            color: var(--color-text);
            margin-bottom: 16px;
            line-height: 1.6;
            font-size: 1rem;
            padding: 20px;
            background: rgba(175, 75, 239, 0.05);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--color-accent);
            font-style: italic;
        }

        .patient-statement strong {
            color: var(--color-primary);
        }

        .roleplay-instruction {
            font-size: 1rem;
            color: var(--color-muted);
            margin-bottom: 16px;
            padding: 16px;
            background: rgba(175, 75, 239, 0.05);
            border-radius: var(--radius-sm);
            line-height: 1.5;
        }

        .roleplay-instruction strong {
            color: var(--color-primary);
        }

        .response-options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin: 24px 0;
        }

        @media (max-width: 768px) {
            .response-options-grid {
                grid-template-columns: 1fr;
            }
        }

        .response-option {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px solid rgba(12, 10, 24, 0.08);
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .response-option:hover {
            transform: translateY(-2px);
            border-color: var(--color-primary-soft);
            box-shadow: var(--shadow-medium);
        }

        .response-option.selected {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .response-option.correct {
            border-color: var(--color-success);
            background: rgba(0, 184, 148, 0.05);
        }

        .response-option.incorrect {
            border-color: var(--color-error);
            background: rgba(225, 112, 85, 0.05);
        }

        .response-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .response-indicator {
            width: 24px;
            height: 24px;
            border: 2px solid var(--color-muted);
            border-radius: 4px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
        }

        .response-option.selected .response-indicator {
            background: var(--color-primary);
            border-color: var(--color-primary);
        }

        .response-option.correct .response-indicator {
            background: var(--color-success);
            border-color: var(--color-success);
        }

        .response-option.incorrect .response-indicator {
            background: var(--color-error);
            border-color: var(--color-error);
        }

        .response-text {
            font-size: 1rem;
            font-weight: 500;
            color: var(--color-text);
            line-height: 1.5;
        }

        /* === FEEDBACK SECTION - ALWAYS VISIBLE === */
        .feedback-details {
            margin-top: 24px;
            padding: 20px;
            background: rgba(175, 75, 239, 0.03);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--color-accent);
            display: block;
            animation: fadeIn 0.5s ease;
            min-height: 100px;
        }

        .feedback-title {
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 12px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feedback-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .feedback-item {
            margin-bottom: 12px;
            padding-left: 24px;
            position: relative;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .feedback-item.correct:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--color-success);
            font-weight: bold;
        }

        .feedback-item.incorrect:before {
            content: "‚úó";
            position: absolute;
            left: 0;
            color: var(--color-error);
            font-weight: bold;
        }

        .feedback-item.tip:before {
            content: "üí°";
            position: absolute;
            left: 0;
        }

        /* === ACTIVITY 2: DEFENSE MECHANISM MATCHING === */
        .defense-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 32px;
        }

        @media (max-width: 768px) {
            .defense-container {
                grid-template-columns: 1fr;
            }
        }

        .defense-column {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .defense-item {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px solid rgba(12, 10, 24, 0.08);
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            line-height: 1.5;
            font-weight: 500;
        }

        .defense-item:hover {
            transform: translateY(-2px);
            border-color: var(--color-primary-soft);
            box-shadow: var(--shadow-medium);
        }

        .defense-item.dragging {
            opacity: 0.7;
            transform: rotate(3deg);
        }

        .defense-item.matched {
            border-color: var(--color-success);
            background: rgba(0, 184, 148, 0.05);
        }

        .defense-item.incorrect-match {
            border-color: var(--color-error);
            background: rgba(225, 112, 85, 0.05);
        }

        .defense-category {
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .defense-drop-zones {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 32px;
        }

        @media (max-width: 768px) {
            .defense-drop-zones {
                grid-template-columns: 1fr;
            }
        }

        .defense-drop-zone {
            min-height: 120px;
            border: 3px dashed var(--color-primary-soft);
            border-radius: var(--radius-sm);
            padding: 20px;
            background: rgba(175, 75, 239, 0.03);
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: flex-start;
        }

        .defense-drop-zone.active {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.08);
        }

        /* === ACTIVITY 3: LIFESPAN COMMUNICATION === */
        .lifespan-sequence {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 24px;
        }

        .lifespan-step {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            border-left: 4px solid var(--color-primary);
            display: flex;
            align-items: flex-start;
            gap: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .lifespan-step:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-medium);
        }

        .lifespan-step.active {
            background: rgba(175, 75, 239, 0.05);
        }

        .lifespan-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            flex-shrink: 0;
            transition: background 0.3s ease;
        }

        .lifespan-content {
            flex: 1;
        }

        .lifespan-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .lifespan-description {
            font-size: 0.9rem;
            color: var(--color-muted);
            line-height: 1.6;
        }

        /* === ACTIVITY 4: ETHICAL DILEMMA SCENARIOS === */
        .ethical-container {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .ethical-scenario {
            background: white;
            border-radius: var(--radius-md);
            padding: 24px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .section-title {
            font-size: 1.2rem;
            color: var(--color-primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--color-primary-soft);
        }

        .ethical-instruction {
            font-size: 1rem;
            color: var(--color-muted);
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .ethical-options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        @media (max-width: 768px) {
            .ethical-options-grid {
                grid-template-columns: 1fr;
            }
        }

        .ethical-option {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px solid rgba(12, 10, 24, 0.08);
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .ethical-option:hover {
            transform: translateY(-2px);
            border-color: var(--color-primary-soft);
            box-shadow: var(--shadow-medium);
        }

        .ethical-option.selected {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .ethical-option.correct {
            border-color: var(--color-success);
            background: rgba(0, 184, 148, 0.05);
        }

        .ethical-option.incorrect {
            border-color: var(--color-error);
            background: rgba(225, 112, 85, 0.05);
        }

        .ethical-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .ethical-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--color-muted);
            border-radius: 4px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
        }

        .ethical-option.selected .ethical-checkbox {
            background: var(--color-primary);
            border-color: var(--color-primary);
        }

        .ethical-option.correct .ethical-checkbox {
            background: var(--color-success);
            border-color: var(--color-success);
        }

        .ethical-option.incorrect .ethical-checkbox {
            background: var(--color-error);
            border-color: var(--color-error);
        }

        .ethical-text {
            font-size: 1rem;
            font-weight: 500;
            color: var(--color-text);
            line-height: 1.5;
        }

        /* === ACTION BUTTONS === */
        .action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 32px;
            animation: fadeInUp 0.5s ease-out 0.4s both;
        }

        .btn {
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #9a3ed8;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(175, 75, 239, 0.3);
        }

        .btn-secondary {
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(12, 10, 24, 0.12);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* === ACTIVITY BUTTONS === */
        .activity-btn {
            padding: 12px 24px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            align-self: flex-start;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .activity-btn:hover {
            background: #9a3ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(175, 75, 239, 0.3);
        }

        /* === RESULTS PANEL === */
        .results-panel {
            background: rgba(12, 10, 24, 0.94);
            color: #e5e7eb;
            border-radius: var(--radius-md);
            padding: 32px;
            margin-top: 32px;
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .results-panel.show {
            display: block;
        }

        .results-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #ffffff;
        }

        .results-content {
            font-size: 1rem;
            line-height: 1.7;
        }

        .results-content strong {
            color: #ffffff;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 24px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--color-primary-soft);
        }

        .score-text {
            font-size: 1rem;
            color: #c4b5fd;
        }

        /* === CLINICAL INSIGHT CARD === */
        .clinical-insight {
            margin-top: 24px;
            border-radius: var(--radius-sm);
            border: 1px solid rgba(255, 255, 255, 0.16);
            background: rgba(15, 23, 42, 0.7);
            padding: 20px;
            font-size: 0.95rem;
            color: #e5e7eb;
            line-height: 1.6;
        }

        .clinical-insight strong {
            color: #fef3c7;
        }

        /* === FEEDBACK MESSAGES === */
        .feedback-message {
            padding: 16px 20px;
            border-radius: var(--radius-sm);
            margin-top: 16px;
            font-size: 1rem;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .feedback-correct {
            background: rgba(0, 184, 148, 0.1);
            border-left: 4px solid var(--color-success);
            color: var(--color-success);
            display: block;
        }

        .feedback-incorrect {
            background: rgba(225, 112, 85, 0.1);
            border-left: 4px solid var(--color-error);
            color: var(--color-error);
            display: block;
        }

        /* === RESPONSIVE ADJUSTMENTS === */
        @media (max-width: 768px) {
            .activity-grid {
                gap: 24px;
            }
            .activity-card {
                padding: 20px;
            }
            .action-buttons {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
            .response-options-grid {
                gap: 12px;
            }
            .defense-container {
                gap: 16px;
            }
            .defense-drop-zones {
                gap: 16px;
            }
            .ethical-options-grid {
                gap: 12px;
            }
        }

        @media (max-width: 480px) {
            .progress-tracker {
                flex-wrap: wrap;
                justify-content: center;
            }
            .step-divider {
                display: none;
            }
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://cdn.prod.website-files.com/64d0ccc1558d601cbfb09021/64e9d2f719b1e5258e5d57f5_IMG_1512-p-500.png"
                    alt="AlliedRx logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">Clinical Medical Assistant ‚Ä¢ Kinn's Chapter 4</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Interactive Module 3: Patient-Centered Assessment Simulator</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Campus & Online</span>
        </header>

        <!-- Module Header -->
        <section class="module-header">
            <h1 id="module-heading">Patient-Centered Assessment Simulator</h1>
            <p class="module-subtitle">Master therapeutic communication, recognize defense mechanisms, and apply ethical principles across the lifespan</p>
            <p class="module-description">
                This interactive module covers Objectives 5-9 and 15 from Chapter 4. You'll practice patient-centered interviewing, 
                recognize defense mechanisms, adapt communication across ages, and navigate ethical dilemmas.
            </p>
        </section>

        <!-- Clinical Tip -->
        <div class="clinical-tip">
            <div class="tip-label">üí° Clinical Insight</div>
            <p><strong>"Respond to emotion first, content second."</strong>‚ÄîWhen patients express strong emotions, validate their feelings before addressing medical facts. This builds trust and therapeutic rapport essential for accurate assessment.</p>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-step active">
                <span class="step-icon">1</span>
                <span>Role-Play Simulation</span>
            </div>
            <div class="step-divider"></div>
            <div class="progress-step">
                <span class="step-icon">2</span>
                <span>Defense Mechanisms</span>
            </div>
            <div class="step-divider"></div>
            <div class="progress-step">
                <span class="step-icon">3</span>
                <span>Lifespan Communication</span>
            </div>
            <div class="step-divider"></div>
            <div class="progress-step">
                <span class="step-icon">4</span>
                <span>Ethical Dilemmas</span>
            </div>
        </div>

        <!-- Progress Summary -->
        <div class="progress-summary">
            <div class="progress-item">
                <span class="progress-number" id="completedCount">0</span>
                <span class="progress-label">Activities Completed</span>
            </div>
            <div class="progress-item">
                <span class="progress-number" id="accuracyScore">0%</span>
                <span class="progress-label">Current Accuracy</span>
            </div>
            <div class="progress-item">
                <span class="progress-number" id="timeSpent">0 min</span>
                <span class="progress-label">Time Spent</span>
            </div>
        </div>

        <!-- Activity Grid -->
        <div class="activity-grid">
            <!-- ACTIVITY 1: ROLE-PLAY SIMULATION -->
            <section class="activity-card" aria-label="Role-Play Simulation Activity">
                <div class="activity-header">
                    <div class="activity-icon">üé≠</div>
                    <h2 class="activity-title">Therapeutic Communication Role-Play</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Read each patient statement and select the most therapeutic response. 
                    Focus on reflective listening, empathy, and validation techniques.
                </p>
                
                <div class="roleplay-container">
                    <!-- Scenario 1 -->
                    <div class="roleplay-scenario">
                        <div class="scenario-header">
                            <div>
                                <div class="patient-info">Scenario 1: Anxious New Patient</div>
                                <div class="patient-demographics">Sarah, 34, first OB/GYN visit in 5 years</div>
                            </div>
                        </div>
                        
                        <div class="patient-statement">
                            <strong>Patient says:</strong> "I'm so embarrassed to be here. I know I should have come years ago, but I was just... scared. What if you find something terrible?"
                        </div>
                        
                        <div class="roleplay-instruction">
                            <strong>Goal:</strong> Validate emotion while encouraging continued participation. Avoid minimizing or problem-solving too quickly.
                        </div>

                        <div class="response-options-grid">
                            <div class="response-option" data-scenario="1" data-answer="incorrect">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"Don't worry, everything will be fine. Most tests come back normal."</div>
                                </div>
                            </div>
                            
                            <div class="response-option" data-scenario="1" data-answer="correct">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"It sounds like coming here took a lot of courage. Many people feel nervous about medical visits, especially after a long time."</div>
                                </div>
                            </div>
                            
                            <div class="response-option" data-scenario="1" data-answer="incorrect">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"Let's just focus on the exam. What symptoms are you having?"</div>
                                </div>
                            </div>
                            
                            <div class="response-option" data-scenario="1" data-answer="incorrect">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"You really should have come sooner. Prevention is important."</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scenario 2 -->
                    <div class="roleplay-scenario">
                        <div class="scenario-header">
                            <div>
                                <div class="patient-info">Scenario 2: Frustrated Chronic Pain Patient</div>
                                <div class="patient-demographics">James, 58, chronic back pain, multiple previous treatments</div>
                            </div>
                        </div>
                        
                        <div class="patient-statement">
                            <strong>Patient says:</strong> "Nothing helps! I've tried physical therapy, medications, injections... I'm just tired of hurting all the time. Why can't anyone fix this?"
                        </div>
                        
                        <div class="roleplay-instruction">
                            <strong>Goal:</strong> Acknowledge frustration while maintaining therapeutic alliance. Avoid defensiveness or false reassurance.
                        </div>

                        <div class="response-options-grid">
                            <div class="response-option" data-scenario="2" data-answer="incorrect">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"We have some new treatments we can try. Let me tell you about them."</div>
                                </div>
                            </div>
                            
                            <div class="response-option" data-scenario="2" data-answer="incorrect">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"You need to be more patient. Chronic pain takes time to manage."</div>
                                </div>
                            </div>
                            
                            <div class="response-option" data-scenario="2" data-answer="correct">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"Living with constant pain is exhausting and frustrating. It sounds like you've tried many approaches without the relief you hoped for."</div>
                                </div>
                            </div>
                            
                            <div class="response-option" data-scenario="2" data-answer="incorrect">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"Maybe you didn't do the physical therapy exercises correctly."</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scenario 3 -->
                    <div class="roleplay-scenario">
                        <div class="scenario-header">
                            <div>
                                <div class="patient-info">Scenario 3: Vague Symptom Description</div>
                                <div class="patient-demographics">Maria, 42, describing digestive issues</div>
                            </div>
                        </div>
                        
                        <div class="patient-statement">
                            <strong>Patient says:</strong> "My stomach just doesn't feel right. It's hard to describe... sometimes it hurts, sometimes it's just uncomfortable. Food doesn't sit well."
                        </div>
                        
                        <div class="roleplay-instruction">
                            <strong>Goal:</strong> Use clarification techniques to gather specific information without frustrating the patient.
                        </div>

                        <div class="response-options-grid">
                            <div class="response-option" data-scenario="3" data-answer="incorrect">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"Is it sharp pain or dull pain? Be more specific."</div>
                                </div>
                            </div>
                            
                            <div class="response-option" data-scenario="3" data-answer="correct">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"It can be hard to describe stomach sensations. Could you tell me more about what you mean by 'doesn't feel right'?"</div>
                                </div>
                            </div>
                            
                            <div class="response-option" data-scenario="3" data-answer="incorrect">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"We'll need to run some tests to figure this out."</div>
                                </div>
                            </div>
                            
                            <div class="response-option" data-scenario="3" data-answer="incorrect">
                                <div class="response-header">
                                    <div class="response-indicator"></div>
                                    <div class="response-text">"Maybe it's just stress. Are you under a lot of pressure?"</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="activity-btn" id="checkRoleplayBtn">
                        ‚úì Check Therapeutic Responses
                    </button>
                </div>
                
                <div class="feedback-message" id="roleplayFeedback"></div>
            </section>

            <!-- ACTIVITY 2: DEFENSE MECHANISM MATCHING -->
            <section class="activity-card" aria-label="Defense Mechanism Activity">
                <div class="activity-header">
                    <div class="activity-icon">üõ°Ô∏è</div>
                    <h2 class="activity-title">Recognize Defense Mechanisms</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Match each defense mechanism with the corresponding patient statement. 
                    Understanding these helps you respond therapeutically instead of confronting.
                </p>
                
                <div class="defense-container">
                    <div class="defense-column">
                        <div class="defense-category">Defense Mechanisms</div>
                        <div class="defense-item" data-mechanism="denial" data-match="B" draggable="true">
                            Denial
                        </div>
                        <div class="defense-item" data-mechanism="projection" data-match="D" draggable="true">
                            Projection
                        </div>
                        <div class="defense-item" data-mechanism="rationalization" data-match="A" draggable="true">
                            Rationalization
                        </div>
                        <div class="defense-item" data-mechanism="displacement" data-match="C" draggable="true">
                            Displacement
                        </div>
                    </div>
                    
                    <div class="defense-column">
                        <div class="defense-category">Patient Statements</div>
                        <div class="defense-item" data-statement="rational" data-match="A" draggable="true">
                            "I only smoke when I'm stressed. It's not really a problem since I exercise."
                        </div>
                        <div class="defense-item" data-statement="deny" data-match="B" draggable="true">
                            "The lab must have mixed up my results. I don't have diabetes."
                        </div>
                        <div class="defense-item" data-statement="displace" data-match="C" draggable="true">
                            "This hospital is terrible! The food is cold and the nurses are slow!" (After bad diagnosis)
                        </div>
                        <div class="defense-item" data-statement="project" data-match="D" draggable="true">
                            "You don't seem to like me. I can tell you're annoyed with my questions."
                        </div>
                    </div>
                </div>
                
                <div class="defense-drop-zones">
                    <div class="defense-drop-zone" id="drop-mechanisms">
                        <div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">
                            Drag Defense Mechanisms Here
                        </div>
                    </div>
                    <div class="defense-drop-zone" id="drop-statements">
                        <div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">
                            Drag Patient Statements Here
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="activity-btn" id="checkDefenseBtn">
                        ‚úì Check Defense Mechanism Matches
                    </button>
                </div>
                
                <div class="feedback-message" id="defenseFeedback"></div>
                
                <div style="margin-top: 24px; padding: 20px; background: rgba(175, 75, 239, 0.05); border-radius: var(--radius-sm); font-size: 0.95rem;">
                    <strong>Clinical Tip:</strong> Never argue with defense mechanisms. Instead, acknowledge the underlying feeling: 
                    "It sounds like this diagnosis is difficult to accept" or "I can see you're feeling frustrated." 
                    This maintains therapeutic rapport while allowing the patient to process difficult information.
                </div>
            </section>

            <!-- ACTIVITY 3: LIFESPAN COMMUNICATION -->
            <section class="activity-card" aria-label="Lifespan Communication Activity">
                <div class="activity-header">
                    <div class="activity-icon">üë∂‚Üíüë¥</div>
                    <h2 class="activity-title">Lifespan Communication Adaptations</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Click communication techniques in order from most to least appropriate 
                    for each age group. Consider developmental stages and communication needs.
                </p>
                
                <div class="lifespan-sequence">
                    <div class="lifespan-step" data-step="1" data-order="3">
                        <div class="lifespan-number">?</div>
                        <div class="lifespan-content">
                            <div class="lifespan-title">Pediatric (4-year-old)</div>
                            <div class="lifespan-description">Use medical play, demonstrate with dolls, allow parent proximity</div>
                        </div>
                    </div>
                    
                    <div class="lifespan-step" data-step="2" data-order="4">
                        <div class="lifespan-number">?</div>
                        <div class="lifespan-content">
                            <div class="lifespan-title">Adolescent (15-year-old)</div>
                            <div class="lifespan-description">Offer private time without parents, use direct but respectful language</div>
                        </div>
                    </div>
                    
                    <div class="lifespan-step" data-step="3" data-order="1">
                        <div class="lifespan-number">?</div>
                        <div class="lifespan-content">
                            <div class="lifespan-title">Adult (45-year-old)</div>
                            <div class="lifespan-description">Respect autonomy, provide rationale for procedures, collaborative decision-making</div>
                        </div>
                    </div>
                    
                    <div class="lifespan-step" data-step="4" data-order="2">
                        <div class="lifespan-number">?</div>
                        <div class="lifespan-content">
                            <div class="lifespan-title">Geriatric (78-year-old)</div>
                            <div class="lifespan-description">Speak clearly, allow extra time, check for hearing/vision accommodations</div>
                        </div>
                    </div>
                    
                    <div class="lifespan-step" data-step="5" data-order="5">
                        <div class="lifespan-number">?</div>
                        <div class="lifespan-content">
                            <div class="lifespan-title">Young Adult (22-year-old)</div>
                            <div class="lifespan-description">Balance independence with guidance, explain insurance/billing clearly</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="activity-btn" id="checkLifespanBtn">
                        ‚úì Check Lifespan Communication Order
                    </button>
                </div>
                
                <div class="feedback-message" id="lifespanFeedback"></div>
                
                <div style="margin-top: 24px; padding: 20px; background: rgba(175, 75, 239, 0.05); border-radius: var(--radius-sm); font-size: 0.95rem;">
                    <strong>Clinical Tip:</strong> Always assess cognitive and sensory abilities regardless of age. 
                    For older adults, distinguish between normal aging changes and pathological conditions. 
                    For children, involve parents appropriately while communicating directly with the child at their level.
                </div>
            </section>

            <!-- ACTIVITY 4: ETHICAL DILEMMA SCENARIOS -->
            <section class="activity-card" aria-label="Ethical Dilemma Activity">
                <div class="activity-header">
                    <div class="activity-icon">‚öñÔ∏è</div>
                    <h2 class="activity-title">Ethical Dilemma Scenarios</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> For each ethical scenario, select the most appropriate action based on 
                    legal requirements, ethical principles, and patient-centered care.
                </p>
                
                <div class="ethical-container">
                    <!-- Scenario 1 -->
                    <div class="ethical-scenario">
                        <h3 class="section-title">Scenario 1: Mandatory Reporting</h3>
                        <div class="ethical-instruction">
                            During a sports physical, a 16-year-old confides that his coach has been "too handsy" during 
                            practice and has touched him inappropriately. He asks you not to tell anyone because the coach 
                            is popular and "no one will believe me."
                        </div>

                        <div class="ethical-options-grid">
                            <div class="ethical-option" data-scenario="1" data-answer="incorrect">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Respect his confidentiality since he's a minor and asked you not to tell</div>
                                </div>
                            </div>
                            
                            <div class="ethical-option" data-scenario="1" data-answer="correct">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Explain mandatory reporting requirements and report to child protective services</div>
                                </div>
                            </div>
                            
                            <div class="ethical-option" data-scenario="1" data-answer="incorrect">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Tell him to discuss it with his parents first before taking any action</div>
                                </div>
                            </div>
                            
                            <div class="ethical-option" data-scenario="1" data-answer="incorrect">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Document in chart but take no immediate action unless he agrees</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scenario 2 -->
                    <div class="ethical-scenario">
                        <h3 class="section-title">Scenario 2: Capacity Assessment</h3>
                        <div class="ethical-instruction">
                            An 82-year-old patient with mild dementia refuses a clearly necessary medication. 
                            Her daughter insists you "just give it to her anyway" because "she doesn't know what's good for her."
                        </div>

                        <div class="ethical-options-grid">
                            <div class="ethical-option" data-scenario="2" data-answer="incorrect">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Follow the daughter's instructions since she has power of attorney</div>
                                </div>
                            </div>
                            
                            <div class="ethical-option" data-scenario="2" data-answer="correct">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Assess patient's decision-making capacity before determining next steps</div>
                                </div>
                            </div>
                            
                            <div class="ethical-option" data-scenario="2" data-answer="incorrect">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Give the medication covertly in food or drink</div>
                                </div>
                            </div>
                            
                            <div class="ethical-option" data-scenario="2" data-answer="incorrect">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Refuse to provide care since the patient is refusing treatment</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scenario 3 -->
                    <div class="ethical-scenario">
                        <h3 class="section-title">Scenario 3: Cultural Competence</h3>
                        <div class="ethical-instruction">
                            A patient from a different cultural background refuses a blood transfusion due to religious beliefs, 
                            even though it's medically necessary. Family members are pressuring you to override the refusal.
                        </div>

                        <div class="ethical-options-grid">
                            <div class="ethical-option" data-scenario="3" data-answer="incorrect">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Honor the family's wishes since they understand the cultural context</div>
                                </div>
                            </div>
                            
                            <div class="ethical-option" data-scenario="3" data-answer="incorrect">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Proceed with transfusion since it's medically necessary to save life</div>
                                </div>
                            </div>
                            
                            <div class="ethical-option" data-scenario="3" data-answer="correct">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Have detailed discussion about risks/benefits, explore alternatives, document informed refusal</div>
                                </div>
                            </div>
                            
                            <div class="ethical-option" data-scenario="3" data-answer="incorrect">
                                <div class="ethical-header">
                                    <div class="ethical-checkbox"></div>
                                    <div class="ethical-text">Transfer care to a provider from the same cultural background</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="activity-btn" id="checkEthicalBtn">
                        ‚úì Check Ethical Decisions
                    </button>
                </div>
                
                <div class="feedback-message" id="ethicalFeedback"></div>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="resetBtn">
                <span>‚Üª</span>
                Reset All Activities
            </button>
            <button class="btn btn-primary" id="checkBtn">
                <span>‚úì</span>
                Check All Answers
            </button>
            <button class="btn btn-primary" id="viewResultsBtn" style="display: none;">
                <span>üìä</span>
                View Final Results
            </button>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="resultsPanel">
            <div class="results-header">
                <div class="activity-icon" style="background: var(--color-success);">‚úì</div>
                <h3 class="results-title">Module 3 Complete!</h3>
            </div>
            <div class="results-content">
                <p>Excellent work! You've completed the <strong>Patient-Centered Assessment Simulator</strong> module.</p>
                
                <div class="score-display">
                    <div class="score-value" id="scoreValue">0%</div>
                    <div class="score-text" id="scoreText">Your overall score</div>
                </div>
                
                <p><strong>What you've mastered:</strong></p>
                <ul style="margin-left: 20px; margin-top: 8px; margin-bottom: 16px;">
                    <li>‚úì Therapeutic communication techniques (reflective listening, validation)</li>
                    <li>‚úì Defense mechanism recognition and therapeutic response</li>
                    <li>‚úì Lifespan-appropriate communication adaptations</li>
                    <li>‚úì Ethical decision-making in patient assessment</li>
                    <li>‚úì Mandatory reporting and capacity assessment</li>
                </ul>
                
                <div class="clinical-insight">
                    <strong>Clinical Insight:</strong> Patient-centered assessment requires balancing technical skills with 
                    interpersonal artistry. Remember the "3 A's": <strong>A</strong>ttend (full attention), 
                    <strong>A</strong>cknowledge (validate feelings), <strong>A</strong>sk (open-ended questions). 
                    Cultural humility means recognizing your own biases while respectfully learning about patients' beliefs. 
                    Document not just what patients say, but how they say it‚Äîaffect, tone, and nonverbal cues provide crucial clinical information.
                </div>
            </div>
        </div>
    </main>

    <script>
        // === STATE MANAGEMENT ===
        let moduleState = {
            roleplay: { completed: false, score: 0, total: 3 },
            defenseMechanisms: { completed: false, score: 0, total: 4 },
            lifespan: { completed: false, score: 0, total: 5 },
            ethical: { completed: false, score: 0, total: 3 },
            startTime: new Date(),
            activitiesCompleted: 0
        };

        // === ACTIVITY 1: ROLEPLAY FUNCTIONS ===
        function initializeRoleplay() {
            // Roleplay option click events
            document.querySelectorAll('.response-option').forEach(option => {
                option.addEventListener('click', function() {
                    const scenario = this.dataset.scenario;
                    
                    // Remove selection from other options in same scenario
                    document.querySelectorAll(`.response-option[data-scenario="${scenario}"]`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Select this one
                    this.classList.add('selected');
                });
            });
            
            // Check roleplay button
            document.getElementById('checkRoleplayBtn').addEventListener('click', checkRoleplayResponses);
        }
        
        function checkRoleplayResponses() {
            let score = 0;
            let totalScenarios = 3;
            
            // Check each scenario
            for (let i = 1; i <= totalScenarios; i++) {
                const selectedOption = document.querySelector(`.response-option[data-scenario="${i}"].selected`);
                const correctOption = document.querySelector(`.response-option[data-scenario="${i}"][data-answer="correct"]`);
                
                if (selectedOption && selectedOption.dataset.answer === 'correct') {
                    selectedOption.classList.add('correct');
                    score++;
                } else if (selectedOption) {
                    selectedOption.classList.add('incorrect');
                    // Show correct answer
                    correctOption.classList.add('correct');
                } else {
                    // If nothing selected, show correct answer
                    correctOption.classList.add('correct');
                }
                
                // Disable further clicks
                document.querySelectorAll(`.response-option[data-scenario="${i}"]`).forEach(opt => {
                    opt.style.pointerEvents = 'none';
                });
            }
            
            // Update module state
            moduleState.roleplay.score = score;
            moduleState.roleplay.completed = true;
            
            // Provide feedback
            let feedback = '';
            if (score === totalScenarios) {
                feedback = '‚úì Perfect! All therapeutic responses correct. You demonstrated strong reflective listening, empathy, and validation skills.';
            } else if (score >= 2) {
                feedback = `‚úì Good! ${score}/${totalScenarios} correct. Remember: Validate emotion before content, avoid minimizing, and use open-ended clarification.`;
            } else {
                feedback = `‚úó Needs review. ${score}/${totalScenarios} correct. Key principle: Therapeutic communication focuses on the patient\'s emotional experience, not just medical facts.`;
            }
            
            showFeedback('roleplayFeedback', feedback, score >= 2 ? 'correct' : 'incorrect');
            updateProgress();
        }

        // === ACTIVITY 2: DEFENSE MECHANISM FUNCTIONS ===
        function initializeDefenseMechanisms() {
            let draggedItem = null;
            let matches = [];
            
            // Defense item drag events
            document.querySelectorAll('.defense-item').forEach(item => {
                item.addEventListener('dragstart', function(e) {
                    draggedItem = this;
                    this.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', this.id || this.textContent);
                    
                    // Add active class to drop zones
                    document.querySelectorAll('.defense-drop-zone').forEach(zone => {
                        zone.classList.add('active');
                    });
                });
                
                item.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    draggedItem = null;
                    
                    // Remove active class from drop zones
                    document.querySelectorAll('.defense-drop-zone').forEach(zone => {
                        zone.classList.remove('active');
                    });
                });
            });
            
            // Drop zone events
            document.querySelectorAll('.defense-drop-zone').forEach(zone => {
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                });
                
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    
                    if (draggedItem) {
                        // Create clone
                        const itemClone = draggedItem.cloneNode(true);
                        itemClone.classList.remove('dragging');
                        itemClone.draggable = true; // Allow re-dragging
                        itemClone.style.cursor = 'grab';
                        itemClone.style.margin = '5px';
                        
                        // Add new drag event to clone
                        itemClone.addEventListener('dragstart', function(e) {
                            this.classList.add('dragging');
                            e.dataTransfer.setData('text/plain', this.id || this.textContent);
                            
                            document.querySelectorAll('.defense-drop-zone').forEach(z => {
                                z.classList.add('active');
                            });
                        });
                        
                        itemClone.addEventListener('dragend', function() {
                            this.classList.remove('dragging');
                            
                            document.querySelectorAll('.defense-drop-zone').forEach(z => {
                                z.classList.remove('active');
                            });
                        });
                        
                        this.appendChild(itemClone);
                    }
                });
            });
            
            // Check defense button
            document.getElementById('checkDefenseBtn').addEventListener('click', checkDefenseMatches);
        }
        
        function checkDefenseMatches() {
            const correctMatches = {
                'denial': 'B',
                'projection': 'D',
                'rationalization': 'A',
                'displacement': 'C'
            };
            
            // Get all items in drop zones
            const mechanismZone = document.getElementById('drop-mechanisms');
            const statementZone = document.getElementById('drop-statements');
            
            const mechanismItems = Array.from(mechanismZone.querySelectorAll('.defense-item'));
            const statementItems = Array.from(statementZone.querySelectorAll('.defense-item'));
            
            let score = 0;
            let matchedPairs = [];
            
            // Reset visual feedback
            document.querySelectorAll('.defense-item').forEach(item => {
                item.classList.remove('matched', 'incorrect-match');
            });
            
            // Try to match items
            mechanismItems.forEach(mechanismItem => {
                const mechanismType = mechanismItem.dataset.mechanism;
                const correctMatch = correctMatches[mechanismType];
                
                // Find matching statement
                const matchingStatement = statementItems.find(statement => 
                    statement.dataset.statement && statement.dataset.match === correctMatch
                );
                
                if (matchingStatement) {
                    mechanismItem.classList.add('matched');
                    matchingStatement.classList.add('matched');
                    score++;
                    matchedPairs.push(mechanismType);
                    
                    // Remove from arrays to prevent double matching
                    const statementIndex = statementItems.indexOf(matchingStatement);
                    if (statementIndex > -1) {
                        statementItems.splice(statementIndex, 1);
                    }
                } else {
                    mechanismItem.classList.add('incorrect-match');
                }
            });
            
            // Mark unmatched statements as incorrect
            statementItems.forEach(item => {
                item.classList.add('incorrect-match');
            });
            
            // Update module state
            moduleState.defenseMechanisms.score = score;
            moduleState.defenseMechanisms.completed = true;
            
            // Provide feedback
            let feedback = '';
            if (score === 4) {
                feedback = `‚úì Perfect! All 4 defense mechanisms correctly matched. You recognize: Denial = refusing reality, Projection = attributing own feelings to others, Rationalization = making excuses, Displacement = redirecting emotions.`;
            } else if (score >= 2) {
                feedback = `‚úì Good work! ${score}/4 mechanisms correctly matched. Review unmatched items marked in red.`;
            } else {
                feedback = `‚úó Needs review. ${score}/4 mechanisms correct. Study defense mechanisms: They protect from anxiety but can hinder therapeutic communication.`;
            }
            
            showFeedback('defenseFeedback', feedback, score >= 2 ? 'correct' : 'incorrect');
            updateProgress();
        }

        // === ACTIVITY 3: LIFESPAN FUNCTIONS ===
        function initializeLifespanCommunication() {
            let clickOrder = [];
            let currentClick = 1;
            const maxSteps = 5;
            const correctOrder = [3, 4, 1, 2, 5]; // Correct developmental order
            
            // Lifespan step click events
            document.querySelectorAll('.lifespan-step').forEach(step => {
                step.addEventListener('click', function() {
                    // If already clicked, skip
                    if (this.classList.contains('active')) return;
                    
                    // Mark as active in current order
                    const stepNumber = parseInt(this.dataset.step);
                    clickOrder.push(stepNumber);
                    
                    // Update display
                    const numberSpan = this.querySelector('.lifespan-number');
                    numberSpan.textContent = currentClick;
                    this.classList.add('active');
                    
                    currentClick++;
                    
                    // Check if all steps are clicked
                    if (clickOrder.length === maxSteps) {
                        checkLifespanSequence(clickOrder, correctOrder);
                    }
                });
            });
            
            // Check lifespan button
            document.getElementById('checkLifespanBtn').addEventListener('click', function() {
                if (clickOrder.length < maxSteps) {
                    showFeedback('lifespanFeedback', 
                        `Please click all ${maxSteps} age groups in developmental order first!`, 
                        'incorrect');
                    return;
                }
                checkLifespanSequence(clickOrder, correctOrder);
            });
        }
        
        function checkLifespanSequence(clickOrder, correctOrder) {
            let correctCount = 0;
            
            // Compare sequences
            for (let i = 0; i < clickOrder.length; i++) {
                if (clickOrder[i] === correctOrder[i]) {
                    correctCount++;
                }
            }
            
            // Calculate score
            moduleState.lifespan.score = correctCount;
            moduleState.lifespan.completed = true;
            
            // Visual feedback
            document.querySelectorAll('.lifespan-step').forEach((step, index) => {
                const stepNumber = parseInt(step.dataset.step);
                const numberSpan = step.querySelector('.lifespan-number');
                
                if (stepNumber === correctOrder[index]) {
                    numberSpan.style.background = 'var(--color-success)';
                } else {
                    numberSpan.style.background = 'var(--color-error)';
                    const correctIndex = correctOrder.indexOf(stepNumber);
                    if (correctIndex !== -1) {
                        numberSpan.title = `Should be developmental stage ${correctIndex + 1}`;
                    }
                }
            });
            
            // Show feedback
            const percentage = Math.round((correctCount / maxSteps) * 100);
            let feedback = '';
            
            if (percentage === 100) {
                feedback = `‚úì Perfect! All ${correctCount}/${maxSteps} correctly ordered by developmental stage. Communication adapts to cognitive, emotional, and social development across lifespan.`;
            } else if (percentage >= 70) {
                feedback = `‚úì Good! ${correctCount}/${maxSteps} correct (${percentage}%). Review age groups marked in red.`;
            } else {
                feedback = `‚úó Needs review. ${correctCount}/${maxSteps} correct (${percentage}%). Developmental order: 1. Adult autonomy, 2. Geriatric accommodations, 3. Pediatric play, 4. Adolescent privacy, 5. Young adult guidance.`;
            }
            
            showFeedback('lifespanFeedback', feedback, 
                percentage >= 70 ? 'correct' : 'incorrect');
            
            updateProgress();
        }

        // === ACTIVITY 4: ETHICAL FUNCTIONS ===
        function initializeEthicalScenarios() {
            // Ethical option click events
            document.querySelectorAll('.ethical-option').forEach(option => {
                option.addEventListener('click', function() {
                    const scenario = this.dataset.scenario;
                    
                    // Remove selection from other options in same scenario
                    document.querySelectorAll(`.ethical-option[data-scenario="${scenario}"]`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Select this one
                    this.classList.add('selected');
                });
            });
            
            // Check ethical button
            document.getElementById('checkEthicalBtn').addEventListener('click', checkEthicalScenarios);
        }
        
        function checkEthicalScenarios() {
            let score = 0;
            let totalScenarios = 3;
            
            // Check each scenario
            for (let i = 1; i <= totalScenarios; i++) {
                const selectedOption = document.querySelector(`.ethical-option[data-scenario="${i}"].selected`);
                const correctOption = document.querySelector(`.ethical-option[data-scenario="${i}"][data-answer="correct"]`);
                
                if (selectedOption && selectedOption.dataset.answer === 'correct') {
                    selectedOption.classList.add('correct');
                    score++;
                } else if (selectedOption) {
                    selectedOption.classList.add('incorrect');
                    // Show correct answer
                    correctOption.classList.add('correct');
                } else {
                    // If nothing selected, show correct answer
                    correctOption.classList.add('correct');
                }
                
                // Disable further clicks
                document.querySelectorAll(`.ethical-option[data-scenario="${i}"]`).forEach(opt => {
                    opt.style.pointerEvents = 'none';
                });
            }
            
            // Update module state
            moduleState.ethical.score = score;
            moduleState.ethical.completed = true;
            
            // Provide feedback
            let feedback = '';
            if (score === totalScenarios) {
                feedback = '‚úì Perfect! All ethical decisions correct. You balanced legal requirements, ethical principles, and patient-centered care appropriately.';
            } else if (score >= 2) {
                feedback = `‚úì Good! ${score}/${totalScenarios} correct. Remember: Mandatory reporting overrides confidentiality for minors, assess capacity before overriding autonomy, respect cultural beliefs while ensuring informed decisions.`;
            } else {
                feedback = `‚úó Needs review. ${score}/${totalScenarios} correct. Key principles: Safety first (mandatory reporting), autonomy requires capacity, cultural respect doesn\'t override informed consent.`;
            }
            
            showFeedback('ethicalFeedback', feedback, score >= 2 ? 'correct' : 'incorrect');
            updateProgress();
        }

        // === INITIALIZE MODULE ===
        document.addEventListener('DOMContentLoaded', function() {
            initializeRoleplay();
            initializeDefenseMechanisms();
            initializeLifespanCommunication();
            initializeEthicalScenarios();
            setupEventListeners();
            updateProgress();
            startTimer();
        });

        // === HELPER FUNCTIONS ===
        function setupEventListeners() {
            // Reset button
            document.getElementById('resetBtn').addEventListener('click', resetAllActivities);
            
            // Check all answers button
            document.getElementById('checkBtn').addEventListener('click', checkAllAnswers);
            
            // View results button
            document.getElementById('viewResultsBtn').addEventListener('click', showFinalResults);
        }

        function showFeedback(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'feedback-message';
            element.classList.add(`feedback-${type}`);
            element.style.display = 'block';
            
            if (type === 'incorrect') {
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            }
        }

        function updateProgress() {
            // Calculate completed activities
            let completedCount = 0;
            if (moduleState.roleplay.completed) completedCount++;
            if (moduleState.defenseMechanisms.completed) completedCount++;
            if (moduleState.lifespan.completed) completedCount++;
            if (moduleState.ethical.completed) completedCount++;
            
            document.getElementById('completedCount').textContent = completedCount;
            
            // Calculate accuracy
            let totalScore = 0;
            let totalPossible = 0;
            
            Object.values(moduleState).forEach(activity => {
                if (activity.score !== undefined && activity.total) {
                    totalScore += activity.score;
                    totalPossible += activity.total;
                }
            });
            
            const accuracy = totalPossible > 0 ? Math.round((totalScore / totalPossible) * 100) : 0;
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            
            // Update progress tracker
            if (completedCount >= 4) {
                document.querySelectorAll('.progress-step').forEach(step => {
                    step.classList.remove('active');
                    step.classList.add('completed');
                });
                
                // Show "View Results" button
                document.getElementById('checkBtn').style.display = 'none';
                document.getElementById('viewResultsBtn').style.display = 'flex';
            } else if (completedCount >= 1) {
                document.querySelectorAll('.progress-step').forEach((step, index) => {
                    step.classList.remove('active', 'completed');
                    if (index < completedCount) {
                        step.classList.add('completed');
                    }
                    if (index === completedCount) {
                        step.classList.add('active');
                    }
                });
            }
            
            // Update module state
            moduleState.activitiesCompleted = completedCount;
        }

        function startTimer() {
            const timeElement = document.getElementById('timeSpent');
            
            setInterval(() => {
                const now = new Date();
                const diffMs = now - moduleState.startTime;
                const diffMins = Math.floor(diffMs / 60000);
                timeElement.textContent = `${diffMins} min`;
            }, 60000);
        }

        function checkAllAnswers() {
            // Trigger check for each activity if not already checked
            if (!moduleState.roleplay.completed) {
                checkRoleplayResponses();
            }
            
            if (!moduleState.defenseMechanisms.completed) {
                checkDefenseMatches();
            }
            
            if (!moduleState.lifespan.completed) {
                showFeedback('lifespanFeedback', 
                    'Complete the lifespan communication ordering activity first!', 
                    'incorrect');
            }
            
            if (!moduleState.ethical.completed) {
                checkEthicalScenarios();
            }
            
            updateProgress();
            
            // If all activities completed, show results
            if (moduleState.activitiesCompleted >= 4) {
                showFinalResults();
            }
        }

        function showFinalResults() {
            // Calculate final score
            let totalScore = 0;
            let totalPossible = 0;
            
            Object.values(moduleState).forEach(activity => {
                if (activity.score !== undefined && activity.total) {
                    totalScore += activity.score;
                    totalPossible += activity.total;
                }
            });
            
            const finalScore = totalPossible > 0 ? Math.round((totalScore / totalPossible) * 100) : 0;
            
            // Animate score counter
            const scoreElement = document.getElementById('scoreValue');
            animateCounter(scoreElement, 0, finalScore, 1500);
            
            // Set score text
            const scoreText = document.getElementById('scoreText');
            let performance = '';
            
            if (finalScore >= 90) performance = 'Outstanding!';
            else if (finalScore >= 80) performance = 'Excellent!';
            else if (finalScore >= 70) performance = 'Good!';
            else performance = 'Keep practicing!';
            
            scoreText.textContent = `${performance} Your overall score`;
            
            // Show results panel
            document.getElementById('resultsPanel').classList.add('show');
            
            // Scroll to results
            setTimeout(() => {
                document.getElementById('resultsPanel').scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest'
                });
            }, 100);
        }

        function animateCounter(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const value = Math.floor(progress * (end - start) + start);
                element.textContent = `${value}%`;
                
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function resetAllActivities() {
            if (!confirm("Are you sure you want to reset all activities? All progress will be lost.")) return;
            
            // Reset module state
            moduleState = {
                roleplay: { completed: false, score: 0, total: 3 },
                defenseMechanisms: { completed: false, score: 0, total: 4 },
                lifespan: { completed: false, score: 0, total: 5 },
                ethical: { completed: false, score: 0, total: 3 },
                startTime: new Date(),
                activitiesCompleted: 0
            };
            
            // Reset activity 1
            document.querySelectorAll('.response-option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
                option.style.pointerEvents = 'auto';
            });
            
            // Reset activity 2
            document.querySelectorAll('.defense-item').forEach(item => {
                item.classList.remove('matched', 'incorrect-match', 'dragging');
                item.draggable = true;
                item.style.cursor = 'grab';
                item.style.margin = '0';
            });
            
            // Clear drop zones for activity 2
            document.getElementById('drop-mechanisms').innerHTML = 
                '<div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">Drag Defense Mechanisms Here</div>';
            document.getElementById('drop-statements').innerHTML = 
                '<div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">Drag Patient Statements Here</div>';
            
            // Reset activity 3
            document.querySelectorAll('.lifespan-step').forEach(step => {
                step.classList.remove('active');
                const numberSpan = step.querySelector('.lifespan-number');
                numberSpan.textContent = '?';
                numberSpan.style.background = 'var(--color-primary)';
                numberSpan.title = '';
            });
            
            // Reset activity 4
            document.querySelectorAll('.ethical-option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
                option.style.pointerEvents = 'auto';
            });
            
            // Clear feedback messages
            document.querySelectorAll('.feedback-message').forEach(feedback => {
                feedback.textContent = '';
                feedback.className = 'feedback-message';
                feedback.style.display = 'none';
            });
            
            // Hide results panel
            document.getElementById('resultsPanel').classList.remove('show');
            
            // Reset buttons
            document.getElementById('checkBtn').style.display = 'flex';
            document.getElementById('viewResultsBtn').style.display = 'none';
            
            // Reset progress tracker
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('completed');
                if (index === 0) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
            
            // Update progress display
            updateProgress();
            
            // Show reset confirmation
            showFeedback('roleplayFeedback', '‚úì All activities have been reset. Ready to start again!', 'correct');
        }
    </script>
</body>
</html>
