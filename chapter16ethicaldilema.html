<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>AlliedRx -- Module 16.3: Ethical Dilemmas & Patient Support in Urology</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            --color-primary: #af4bef;
            --color-primary-soft: #d492ff;
            --color-accent: #8380f0;
            --color-success: #00b894;
            --color-error: #e17055;
            --color-warning: #fdcb6e;
            --color-bg: #f7f5fb;
            --color-text: #2b2b2b;
            --color-muted: #6c6880;
            --color-dark: #0c0a18;
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --shadow-soft: 0 18px 45px rgba(23, 10, 61, 0.18);
            --shadow-hover: 0 25px 50px rgba(175, 75, 239, 0.15);
            --shadow-card: 0 12px 30px rgba(15, 23, 42, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            padding: 24px;
            background: radial-gradient(
                circle at top left,
                #ffffff 0,
                #f1ecff 40%,
                var(--color-bg) 100%
            );
            color: var(--color-text);
            -webkit-text-size-adjust: 100%;
            line-height: 1.5;
        }

        @media (max-width: 600px) { body { padding: 12px; } }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes checkmarkPop {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(175, 75, 239, 0.5); }
            50% { box-shadow: 0 0 20px rgba(175, 75, 239, 0.8); }
        }

        .page {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 28px 30px 32px;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out;
        }

        @media (max-width: 900px) { .page { padding: 22px; } }
        @media (max-width: 480px) {
            body { padding: 0; }
            .page { border-radius: 0; box-shadow: none; padding: 18px 14px 22px; }
        }

        /* Header */
        .brand-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 14px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 40px;
            width: auto;
            max-width: 100%;
            filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
        }

        .brand-logo:hover { transform: scale(1.05); }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--color-muted);
            white-space: normal;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(175, 75, 239, 0.08);
            font-size: 0.76rem;
            color: var(--color-primary);
            white-space: normal;
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-success);
            flex-shrink: 0;
        }

        .badge-mode {
            padding: 5px 10px;
            border-radius: 999px;
            background: rgba(12, 10, 24, 0.06);
            border: 1px solid rgba(12, 10, 24, 0.08);
            font-size: 0.74rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--color-muted);
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .badge-mode:hover {
            background: rgba(175, 75, 239, 0.1);
            border-color: var(--color-primary-soft);
            color: var(--color-primary);
        }

        @media (max-width: 480px) {
            .brand-row { flex-direction: column; align-items: flex-start; }
            .badge-mode { margin-top: 6px; }
        }

        h1 {
            font-size: clamp(1.8rem, 3vw, 2.2rem);
            line-height: 1.1;
            color: var(--color-primary);
            margin-bottom: 6px;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        .module-subtitle {
            font-size: 0.98rem;
            color: var(--color-muted);
            max-width: 600px;
            margin-bottom: 24px;
            animation: fadeInUp 0.6s ease-out 0.4s both;
        }

        /* Progress Tracker - 2 Steps Only */
        .progress-tracker {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            padding: 0 20px;
            max-width: 400px;
        }

        .progress-tracker::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: rgba(12, 10, 24, 0.08);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(12, 10, 24, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-muted);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
            transform: scale(1.1);
        }

        .progress-step.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
            font-weight: 500;
        }

        .progress-step.active .step-label {
            color: var(--color-primary);
            font-weight: 600;
        }

        /* Progress Summary */
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease-out 0.5s both;
        }

        .summary-card {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-md);
            padding: 16px;
            border: 1px solid rgba(12, 10, 24, 0.06);
            text-align: center;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-card);
            border-color: var(--color-primary-soft);
        }

        .summary-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--color-primary);
            display: block;
            line-height: 1;
            margin-bottom: 4px;
        }

        .summary-label {
            font-size: 0.8rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Activity Grid - Single Column */
        .activity-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .activity-card {
            background: white;
            border-radius: var(--radius-md);
            border: 1px solid rgba(12, 10, 24, 0.08);
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--color-primary-soft);
        }

        .activity-card:hover::before { opacity: 1; }

        .activity-card.completed { border-color: var(--color-success); }
        .activity-card.completed::before {
            background: var(--color-success);
            opacity: 1;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .activity-number {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--color-primary);
            background: rgba(175, 75, 239, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
        }

        .activity-status {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 12px;
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-muted);
        }

        .activity-card.completed .activity-status {
            background: rgba(0, 184, 148, 0.1);
            color: var(--color-success);
        }

        .activity-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 12px;
        }

        .activity-description {
            font-size: 0.95rem;
            color: var(--color-muted);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        /* Activity 1: Ethics Scenario */
        .scenario-container {
            margin-bottom: 30px;
        }

        .scenario-box {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid var(--color-primary);
        }

        .scenario-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scenario-content {
            font-size: 0.95rem;
            color: var(--color-text);
            line-height: 1.6;
        }

        .ethics-question {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-dark);
            margin: 20px 0 15px;
            padding: 10px 15px;
            background: rgba(175, 75, 239, 0.05);
            border-radius: var(--radius-sm);
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-item {
            background: white;
            border: 2px solid rgba(12, 10, 24, 0.1);
            border-radius: var(--radius-sm);
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option-item:hover {
            border-color: var(--color-primary-soft);
            background: rgba(175, 75, 239, 0.05);
            transform: translateX(5px);
        }

        .option-item.selected {
            border-color: var(--color-success);
            background: rgba(0, 184, 148, 0.08);
        }

        .option-item.wrong {
            border-color: var(--color-error);
            background: rgba(225, 112, 85, 0.08);
            animation: shake 0.5s ease;
        }

        .option-radio {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(12, 10, 24, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .option-item.selected .option-radio {
            border-color: var(--color-success);
            background: var(--color-success);
        }

        .option-item.selected .option-radio::after {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
        }

        .option-text {
            flex: 1;
            font-size: 0.9rem;
            color: var(--color-text);
        }

        .scenario-btn {
            padding: 10px 24px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .scenario-btn:hover {
            background: #9a3bd6;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(175, 75, 239, 0.3);
        }

        .scenario-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Activity 1 Feedback */
        .feedback-ethics {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            margin-top: 25px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .feedback-ethics.show { display: block; }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(12, 10, 24, 0.08);
        }

        .feedback-icon {
            font-size: 1.4rem;
        }

        .feedback-icon.correct { color: var(--color-success); }
        .feedback-icon.incorrect { color: var(--color-error); }

        .feedback-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-text);
        }

        .feedback-detail {
            font-size: 0.9rem;
            color: var(--color-text);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .feedback-detail strong {
            color: var(--color-primary);
            font-weight: 600;
        }

        .feedback-section {
            background: white;
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-bottom: 15px;
            border-left: 3px solid var(--color-accent);
        }

        .section-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .section-content {
            font-size: 0.85rem;
            color: var(--color-text);
            line-height: 1.6;
        }

        .hipaa-reference {
            background: rgba(131, 128, 240, 0.08);
            border-left: 3px solid var(--color-accent);
        }

        /* Activity 2: Patient Support Planner */
        .scenario-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .scenario-tab {
            padding: 10px 20px;
            background: rgba(12, 10, 24, 0.03);
            border: 2px solid rgba(12, 10, 24, 0.1);
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-muted);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scenario-tab:hover {
            border-color: var(--color-primary-soft);
            color: var(--color-primary);
        }

        .scenario-tab.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        .patient-scenario {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            animation: fadeIn 0.5s ease;
        }

        .patient-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .patient-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-primary);
        }

        .patient-demographics {
            font-size: 0.8rem;
            color: var(--color-muted);
            background: rgba(12, 10, 24, 0.05);
            padding: 4px 10px;
            border-radius: 20px;
        }

        .patient-content {
            font-size: 0.95rem;
            color: var(--color-text);
            line-height: 1.6;
        }

        .patient-content strong {
            color: var(--color-primary);
            font-weight: 600;
        }

        /* Support Categories */
        .support-categories {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .support-categories { grid-template-columns: 1fr; }
        }

        .support-category {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px dashed rgba(12, 10, 24, 0.15);
            min-height: 250px;
            transition: all 0.3s ease;
        }

        .support-category.hover {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .support-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(12, 10, 24, 0.1);
        }

        .support-dropzone {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 180px;
        }

        .support-dropzone.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-muted);
            font-size: 0.85rem;
            font-style: italic;
        }

        .support-dropzone.empty::after {
            content: 'DRAG RESOURCES HERE';
            opacity: 0.6;
        }

        /* Resource Items */
        .resources-container {
            margin-bottom: 30px;
        }

        .resources-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-muted);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .resource-items {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .resource-item {
            background: rgba(175, 75, 239, 0.1);
            border: 2px solid rgba(175, 75, 239, 0.2);
            border-radius: var(--radius-sm);
            padding: 12px 16px;
            font-size: 0.85rem;
            color: var(--color-text);
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
            max-width: 300px;
        }

        .resource-item:hover {
            background: rgba(175, 75, 239, 0.15);
            border-color: var(--color-primary);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(175, 75, 239, 0.1);
        }

        .resource-item.dragging {
            opacity: 0.6;
            transform: scale(0.95);
        }

        .resource-item.placed {
            background: rgba(0, 184, 148, 0.1);
            border-color: var(--color-success);
            cursor: default;
        }

        /* Activity 2 Feedback */
        .support-feedback {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            margin-top: 25px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .support-feedback.show { display: block; }

        .comprehensive-note {
            background: rgba(131, 128, 240, 0.08);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid var(--color-accent);
        }

        .comprehensive-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-accent);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comprehensive-content {
            font-size: 0.85rem;
            color: var(--color-text);
            line-height: 1.6;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #9a3bd6;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(175, 75, 239, 0.3);
        }

        .btn-secondary {
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(12, 10, 24, 0.1);
            transform: translateY(-2px);
        }

        .btn-icon {
            font-size: 1.1em;
        }

        /* Results Panel */
        .results-panel {
            background: var(--color-dark);
            color: white;
            border-radius: var(--radius-md);
            padding: 30px;
            margin-top: 30px;
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .results-panel.show { display: block; }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
        }

        .score-display {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--color-primary-soft);
            text-align: center;
            margin: 20px 0;
        }

        .clinical-insights {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-top: 20px;
        }

        .insights-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-primary-soft);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insights-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .insights-list li {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            font-size: 0.9rem;
            color: #e5e7eb;
        }

        .insight-dot {
            width: 6px;
            height: 6px;
            margin-top: 6px;
            border-radius: 999px;
            background: var(--color-accent);
            flex-shrink: 0;
        }

        /* Legal Warning */
        .legal-warning {
            background: rgba(225, 112, 85, 0.1);
            border: 2px solid var(--color-error);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin: 20px 0;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .warning-icon {
            font-size: 1.5rem;
            color: var(--color-error);
            flex-shrink: 0;
        }

        .warning-content { flex: 1; }

        .warning-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--color-error);
            margin-bottom: 5px;
        }

        .warning-text {
            font-size: 0.85rem;
            color: var(--color-text);
        }

        /* Documentation Box */
        .documentation-box {
            background: rgba(0, 184, 148, 0.08);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--color-success);
        }

        .documentation-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-success);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .documentation-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .documentation-list li {
            font-size: 0.85rem;
            color: var(--color-text);
            margin-bottom: 6px;
            padding-left: 20px;
            position: relative;
        }

        .documentation-list li:before {
            content: '‚Ä¢';
            position: absolute;
            left: 0;
            color: var(--color-success);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://cdn.prod.website-files.com/64d0ccc1558d601cbfb09021/64e9d2f719b1e5258e5d57f5_IMG_1512-p-500.png"
                    alt="AlliedRx logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">Clinical Medical Assistant ‚Ä¢ Week 8</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Chapter 16: Urology & Male Reproduction</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Campus & Online</span>
        </header>

        <h1 id="module-heading">Ethical Dilemmas & Patient Support in Urology</h1>
        <p class="module-subtitle">
            Navigate complex HIPAA scenarios and develop comprehensive patient support plans for urology patients.
            Learn to balance legal compliance with compassionate care in sensitive situations.
        </p>

        <!-- Progress Tracker - 2 Steps -->
        <div class="progress-tracker">
            <div class="progress-step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">Ethics Scenarios</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Support Planning</div>
            </div>
        </div>

        <!-- Progress Summary -->
        <div class="progress-summary">
            <div class="summary-card">
                <span class="summary-number" id="completed-count">0</span>
                <span class="summary-label">Activities Completed</span>
            </div>
            <div class="summary-card">
                <span class="summary-number" id="accuracy-rate">0%</span>
                <span class="summary-label">Current Accuracy</span>
            </div>
            <div class="summary-card">
                <span class="summary-number" id="time-spent">0:00</span>
                <span class="summary-label">Time Spent</span>
            </div>
        </div>

        <!-- Activity Grid -->
        <div class="activity-grid">
            <!-- Activity 1: Urology Ethics Scenario Response -->
            <section class="activity-card" id="activity-1" data-activity="1">
                <div class="activity-header">
                    <span class="activity-number">Activity 1</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">Urology Ethics Scenario Response</h3>
                <p class="activity-description">
                    Navigate complex HIPAA and ethical dilemmas in urology practice. Select the most appropriate
                    response for each scenario based on legal requirements and best practices for patient care.
                </p>

                <!-- Scenario 1 -->
                <div class="scenario-container" id="scenario-1">
                    <div class="scenario-box">
                        <div class="scenario-title">
                            <span>üîí</span>
                            Scenario 1: STI Partner Notification
                        </div>
                        <div class="scenario-content">
                            A 24-year-old male patient tests positive for chlamydia. He asks you to call his partner
                            and tell them about the diagnosis because he's too embarrassed. He provides the partner's
                            name and phone number.
                        </div>
                        <div class="ethics-question">
                            What is the MOST appropriate response?
                        </div>
                        <div class="options-grid">
                            <div class="option-item" data-scenario="1" data-option="a">
                                <div class="option-radio"></div>
                                <div class="option-text">
                                    Call the partner immediately to notify them of the exposure risk, as this is a public health concern.
                                </div>
                            </div>
                            <div class="option-item" data-scenario="1" data-option="b">
                                <div class="option-radio"></div>
                                <div class="option-text">
                                    Explain that you cannot contact the partner directly, but offer to help the patient notify them or provide anonymous partner notification services.
                                </div>
                            </div>
                            <div class="option-item" data-scenario="1" data-option="c">
                                <div class="option-radio"></div>
                                <div class="option-text">
                                    Contact the partner but do not reveal the patient's identity or specific diagnosis, only recommend they get tested.
                                </div>
                            </div>
                            <div class="option-item" data-scenario="1" data-option="d">
                                <div class="option-radio"></div>
                                <div class="option-text">
                                    Refer the matter to the physician and let them decide whether to make the notification.
                                </div>
                            </div>
                        </div>
                        <button class="scenario-btn" data-scenario="1">
                            Submit Response
                        </button>
                    </div>

                    <!-- Feedback 1 -->
                    <div class="feedback-ethics" id="feedback-1">
                        <div class="feedback-header">
                            <span class="feedback-icon correct">‚úì</span>
                            <div class="feedback-title">Scenario Analysis Complete</div>
                        </div>
                        
                        <div class="feedback-detail">
                            <strong>Correct Response:</strong> Explain that you cannot contact the partner directly, but offer to help the patient notify them or provide anonymous partner notification services.
                        </div>
                        
                        <div class="feedback-section">
                            <div class="section-title">Clinical Rationale</div>
                            <div class="section-content">
                                ‚Ä¢ Patient confidentiality must be maintained unless there is explicit written consent
                                ‚Ä¢ Many health departments offer anonymous partner notification services
                                ‚Ä¢ The patient retains control over their personal health information
                                ‚Ä¢ Provides support while maintaining legal compliance
                            </div>
                        </div>
                        
                        <div class="feedback-section hipaa-reference">
                            <div class="section-title">HIPAA Regulation</div>
                            <div class="section-content">
                                ‚Ä¢ HIPAA Privacy Rule ¬ß164.512(b): Permits disclosure without authorization for public health activities, but this is typically done through formal health department channels, not direct provider contact
                                ‚Ä¢ Partner notification is encouraged for STI control but must balance patient confidentiality
                                ‚Ä¢ State laws vary; most require patient consent for provider-initiated contact
                            </div>
                        </div>
                        
                        <div class="feedback-section">
                            <div class="section-title">Documentation Note</div>
                            <div class="section-content">
                                Chart: "Patient counseled on STI results and importance of partner notification. Offered assistance with health department notification services. Patient declined/received [specify] resources. Discussed confidentiality protections."
                            </div>
                        </div>
                        
                        <div class="legal-warning">
                            <div class="warning-icon">‚öñÔ∏è</div>
                            <div class="warning-content">
                                <div class="warning-title">Legal Risk</div>
                                <div class="warning-text">
                                    Directly contacting a patient's partner without explicit written consent violates HIPAA and could result in disciplinary action, fines, or legal liability for breach of confidentiality.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scenario 2 -->
                <div class="scenario-container" id="scenario-2" style="display: none;">
                    <div class="scenario-box">
                        <div class="scenario-title">
                            <span>üë®‚Äçüë©‚Äçüëß</span>
                            Scenario 2: Family Inquiry
                        </div>
                        <div class="scenario-content">
                            The daughter of a 68-year-old male patient calls your urology clinic. Her father was recently diagnosed with prostate cancer. She demands to know his test results and treatment plan, saying, "I'm his daughter and I need to know what's going on with my father's health."
                        </div>
                        <div class="ethics-question">
                            What is the MOST appropriate response?
                        </div>
                        <div class="options-grid">
                            <div class="option-item" data-scenario="2" data-option="a">
                                <div class="option-radio"></div>
                                <div class="option-text">
                                    Provide a general overview of prostate cancer treatment options without disclosing specific test results.
                                </div>
                            </div>
                            <div class="option-item" data-scenario="2" data-option="b">
                                <div class="option-radio"></div>
                                <div class="option-text">
                                    Explain that you cannot disclose any protected health information without the patient's written authorization, but offer to take a message for the patient.
                                </div>
                            </div>
                            <div class="option-item" data-scenario="2" data-option="c">
                                <div class="option-radio"></div>
                                <div class="option-text">
                                    Ask the daughter to have her father call the clinic so he can authorize the release of information to her.
                                </div>
                            </div>
                            <div class="option-item" data-scenario="2" data-option="d">
                                <div class="option-radio"></div>
                                <div class="option-text">
                                    Transfer the call to the physician who can make a professional judgment about what information to share.
                                </div>
                            </div>
                        </div>
                        <button class="scenario-btn" data-scenario="2">
                            Submit Response
                        </button>
                    </div>

                    <!-- Feedback 2 -->
                    <div class="feedback-ethics" id="feedback-2">
                        <div class="feedback-header">
                            <span class="feedback-icon correct">‚úì</span>
                            <div class="feedback-title">Scenario Analysis Complete</div>
                        </div>
                        
                        <div class="feedback-detail">
                            <strong>Correct Response:</strong> Explain that you cannot disclose any protected health information without the patient's written authorization, but offer to take a message for the patient.
                        </div>
                        
                        <div class="feedback-section">
                            <div class="section-title">Why This Is Correct</div>
                            <div class="section-content">
                                ‚Ä¢ Family relationship does not override patient confidentiality
                                ‚Ä¢ Patient autonomy is paramount in healthcare decisions
                                ‚Ä¢ Protects patient's right to control their health information
                                ‚Ä¢ Maintains professional boundaries while being helpful
                            </div>
                        </div>
                        
                        <div class="feedback-section hipaa-reference">
                            <div class="section-title">HIPAA Regulation</div>
                            <div class="section-content">
                                ‚Ä¢ HIPAA Privacy Rule ¬ß164.502: Requires written authorization for disclosure of PHI to family members, unless the patient is incapacitated or there is a serious threat to health/safety
                                ‚Ä¢ No "family exception" for competent adult patients
                                ‚Ä¢ Verbal permission may be acceptable in some circumstances but written is preferred
                            </div>
                        </div>
                        
                        <div class="feedback-section">
                            <div class="section-title">Pro Tip</div>
                            <div class="section-content">
                                Use empathetic but firm language: "I understand you're concerned about your father's health. We take patient confidentiality very seriously. I'd be happy to take a message for him to call you back, or I can provide general educational materials about prostate cancer."
                            </div>
                        </div>
                        
                        <div class="documentation-box">
                            <div class="documentation-title">
                                <span>üìã</span>
                                Documentation Requirements
                            </div>
                            <ul class="documentation-list">
                                <li>Date, time, and name of caller</li>
                                <li>Relationship to patient stated by caller</li>
                                <li>Information requested</li>
                                <li>Action taken: Explained confidentiality policy, declined to disclose PHI</li>
                                <li>Message taken/forwarded to patient</li>
                                <li>Educational materials offered (if applicable)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                    <button class="btn btn-secondary" id="prev-scenario" disabled>
                        <span class="btn-icon">‚Üê</span>
                        Previous Scenario
                    </button>
                    <button class="btn btn-secondary" id="next-scenario">
                        Next Scenario
                        <span class="btn-icon">‚Üí</span>
                    </button>
                </div>
            </section>

            <!-- Activity 2: Patient Support & Education Planner -->
            <section class="activity-card" id="activity-2" data-activity="2">
                <div class="activity-header">
                    <span class="activity-number">Activity 2</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">Patient Support & Education Planner</h3>
                <p class="activity-description">
                    Develop comprehensive support plans for urology patients. Drag resources to appropriate support
                    categories based on patient needs. Consider physical, emotional, and educational dimensions of care.
                </p>

                <!-- Scenario Selector -->
                <div class="scenario-selector">
                    <div class="scenario-tab active" data-scenario="bph">
                        BPH Diagnosis
                    </div>
                    <div class="scenario-tab" data-scenario="sti">
                        STI Diagnosis
                    </div>
                </div>

                <!-- Patient Scenario - BPH -->
                <div class="patient-scenario" id="bph-scenario">
                    <div class="patient-header">
                        <div class="patient-title">Patient Scenario: BPH Diagnosis</div>
                        <div class="patient-demographics">65-year-old male ‚Ä¢ New BPH diagnosis ‚Ä¢ Medicare</div>
                    </div>
                    <div class="patient-content">
                        Mr. Johnson is a 65-year-old retired teacher diagnosed with benign prostatic hyperplasia (BPH).
                        He experiences frequent urination, nocturia (3-4x/night), and weak urine stream. He is anxious
                        about potential surgery and confused about medication options. His wife passed away last year,
                        and he lives alone. He mentions difficulty getting to appointments due to limited transportation.
                        <strong>Goal:</strong> Develop a comprehensive support plan addressing his physical symptoms,
                        emotional concerns, and educational needs.
                    </div>
                </div>

                <!-- Patient Scenario - STI (Hidden Initially) -->
                <div class="patient-scenario" id="sti-scenario" style="display: none;">
                    <div class="patient-header">
                        <div class="patient-title">Patient Scenario: STI Diagnosis</div>
                        <div class="patient-demographics">22-year-old male ‚Ä¢ First STI diagnosis ‚Ä¢ Uninsured</div>
                    </div>
                    <div class="patient-content">
                        Marcus is a 22-year-old college student diagnosed with his first sexually transmitted infection
                        (gonorrhea). He expresses shame and embarrassment, saying "I feel dirty." He's worried about
                        telling his partner and about potential long-term effects on fertility. He has no health
                        insurance and is concerned about treatment costs. He asks multiple times if this will go on his
                        "permanent record."
                        <strong>Goal:</strong> Create a supportive care plan addressing immediate medical needs,
                        emotional distress, and practical barriers to care.
                    </div>
                </div>

                <!-- Support Categories -->
                <div class="support-categories">
                    <div class="support-category" data-category="physical" id="physical-category">
                        <div class="support-title">Physical Support</div>
                        <div class="support-dropzone empty" id="physical-dropzone"></div>
                    </div>
                    <div class="support-category" data-category="emotional" id="emotional-category">
                        <div class="support-title">Emotional Support</div>
                        <div class="support-dropzone empty" id="emotional-dropzone"></div>
                    </div>
                    <div class="support-category" data-category="educational" id="educational-category">
                        <div class="support-title">Educational Materials</div>
                        <div class="support-dropzone empty" id="educational-dropzone"></div>
                    </div>
                </div>

                <!-- Resources -->
                <div class="resources-container">
                    <div class="resources-title">Available Resources (Drag to Categories Above)</div>
                    <div class="resource-items" id="resource-items">
                        <!-- Resources will be loaded here by JavaScript -->
                    </div>
                </div>

                <!-- Check Button -->
                <div style="text-align: center; margin: 25px 0;">
                    <button class="btn btn-primary" id="check-support">
                        <span class="btn-icon">‚úì</span>
                        Check Support Plan
                    </button>
                </div>

                <!-- Feedback -->
                <div class="support-feedback" id="support-feedback">
                    <div class="feedback-header">
                        <span class="feedback-icon correct">‚úì</span>
                        <div class="feedback-title">Support Plan Analysis</div>
                    </div>
                    
                    <div class="feedback-detail">
                        <strong>Comprehensive Patient Support Planning:</strong> Effective urology care addresses physical, emotional, and educational needs simultaneously. Your plan demonstrates understanding of holistic patient care.
                    </div>
                    
                    <div class="feedback-section">
                        <div class="section-title">Key Assessment Points</div>
                        <div class="section-content">
                            ‚Ä¢ <strong>Physical Support:</strong> Addresses immediate symptoms and practical barriers (transportation, medication access)
                            <br>‚Ä¢ <strong>Emotional Support:</strong> Recognizes anxiety, fear, and psychosocial impacts of diagnosis
                            <br>‚Ä¢ <strong>Educational Materials:</strong> Provides age-appropriate, literacy-level appropriate information
                            <br>‚Ä¢ <strong>Cultural Considerations:</strong> Respects patient's background, values, and communication preferences
                        </div>
                    </div>
                    
                    <div class="comprehensive-note">
                        <div class="comprehensive-title">
                            <span>üí°</span>
                            Comprehensive Care Note
                        </div>
                        <div class="comprehensive-content">
                            Remember: Many resources serve multiple purposes. A support group referral provides BOTH emotional support AND education. Transportation assistance addresses BOTH physical access AND reduces anxiety about appointment attendance. Always consider how resources can meet multiple patient needs simultaneously.
                        </div>
                    </div>
                    
                    <div class="documentation-box">
                        <div class="documentation-title">
                            <span>üìã</span>
                            Support Plan Documentation
                        </div>
                        <ul class="documentation-list">
                            <li>Document all resources provided to patient</li>
                            <li>Note patient's preferences and acceptance/decline of services</li>
                            <li>Record follow-up dates for resource coordination</li>
                            <li>Include cultural/language considerations addressed</li>
                            <li>Document patient's understanding of support options</li>
                            <li>Note any barriers to accessing recommended resources</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="reset-all-btn">
                <span class="btn-icon">‚Üª</span>
                Reset All Activities
            </button>
            <button class="btn btn-secondary" id="check-answers-btn">
                <span class="btn-icon">‚úì</span>
                Check All Answers
            </button>
            <button class="btn btn-primary" id="view-results-btn">
                <span class="btn-icon">üìä</span>
                View Final Results
            </button>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="results-panel">
            <div class="results-header">
                <h2 class="results-title">Ethical Decision Making Results</h2>
                <div class="score-display" id="final-score">0%</div>
            </div>
            
            <div class="clinical-insights">
                <h3 class="insights-title">
                    <span>ü©∫</span> Clinical Proficiency Insights
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>HIPAA in Urology:</strong> Urology involves particularly sensitive health information. Always err on the side of patient confidentiality. When in doubt, consult the Privacy Officer before disclosing any PHI.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>STI Confidentiality:</strong> State laws vary on partner notification. Know your state's regulations and your facility's policies. Document all counseling and resources offered.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Family Dynamics:</strong> Never assume family members have access to patient information. Competent adult patients control their own health information, regardless of family relationships.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Comprehensive Support:</strong> Urology conditions often have physical, emotional, and sexual health impacts. Address all dimensions for holistic care.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Documentation Standards:</strong> Document not only what you did, but what you offered. "Patient declined transportation assistance" is as important as "patient accepted."</span>
                    </li>
                </ul>
            </div>
            
            <div class="clinical-insights" style="margin-top: 20px;">
                <h3 class="insights-title">
                    <span>‚öñÔ∏è</span> Legal & Ethical Standards
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Minimum Necessary Rule:</strong> Disclose only the minimum necessary PHI to accomplish the purpose. Even with authorization, don't share more than needed.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Adolescent Confidentiality:</strong> Most states allow minors to consent to STI testing/treatment without parental knowledge. Know your state's minor consent laws.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Cultural Competence:</strong> Urology conditions may have cultural/religious implications. Respect patient values while providing evidence-based care.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Resource Coordination:</strong> Document all referrals and follow-up. Failure to coordinate care can be considered negligent.</span>
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State Management
            const state = {
                activities: {
                    1: { completed: false, correct: 0, total: 2, score: 0, currentScenario: 1 },
                    2: { completed: false, correct: 0, total: 9, score: 0, currentScenario: 'bph' }
                },
                startedAt: new Date(),
                timeSpent: 0,
                scenarioAnswers: {
                    1: null,
                    2: null
                },
                scenarioSubmitted: {
                    1: false,
                    2: false
                },
                correctAnswers: {
                    1: 'b', // STI partner notification
                    2: 'b'  // Family inquiry
                },
                // Resource categorization (BPH scenario)
                resourceCategories: {
                    bph: {
                        physical: [
                            'Transportation assistance program referral',
                            'Medication organizer dispenser',
                            'Incontinence supply samples',
                            'Sleep hygiene resources for nocturia'
                        ],
                        emotional: [
                            'BPH support group referral',
                            'Counseling services information',
                            'Retirement community social activities',
                            'Grief counseling referral (recent widow)'
                        ],
                        educational: [
                            'BPH treatment options chart',
                            'Medication side effects guide',
                            'Bladder training instructions',
                            'Surgical procedure videos'
                        ]
                    },
                    sti: {
                        physical: [
                            'Low-cost clinic referral',
                            'Medication assistance program',
                            'Comfort items for symptoms',
                            'Follow-up testing schedule'
                        ],
                        emotional: [
                            'STI counseling referral',
                            'Young adult support group',
                            'Relationship counseling resources',
                            'Confidentiality assurance materials'
                        ],
                        educational: [
                            'STI fact sheets',
                            'Partner communication guide',
                            'Prevention strategies',
                            'Fertility information'
                        ]
                    }
                }
            };

            // DOM Elements
            const progressSteps = document.querySelectorAll('.progress-step');
            const activityCards = document.querySelectorAll('.activity-card');
            const completedCount = document.getElementById('completed-count');
            const accuracyRate = document.getElementById('accuracy-rate');
            const timeSpent = document.getElementById('time-spent');
            const resetBtn = document.getElementById('reset-all-btn');
            const checkBtn = document.getElementById('check-answers-btn');
            const resultsBtn = document.getElementById('view-results-btn');
            const resultsPanel = document.getElementById('results-panel');
            const finalScore = document.getElementById('final-score');
            const resourceItems = document.getElementById('resource-items');

            // Timer for time spent
            function updateTimer() {
                const now = new Date();
                const diff = Math.floor((now - state.startedAt) / 1000);
                state.timeSpent = diff;
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                timeSpent.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            setInterval(updateTimer, 1000);

            // Update Progress Summary
            function updateProgressSummary() {
                let completed = 0;
                let totalCorrect = 0;
                let totalItems = 0;
                
                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) completed++;
                    totalCorrect += activity.correct;
                    totalItems += activity.total;
                });
                
                completedCount.textContent = completed;
                const accuracy = totalItems > 0 ? Math.round((totalCorrect / totalItems) * 100) : 0;
                accuracyRate.textContent = `${accuracy}%`;
                
                // Update progress steps
                progressSteps.forEach((step, index) => {
                    if (index < completed) {
                        step.classList.add('completed');
                        step.classList.remove('active');
                    } else if (index === completed) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });
            }

            // Activity 1: Ethics Scenarios - COMPLETELY FIXED VERSION
            function initActivity1() {
                const scenarioContainers = document.querySelectorAll('.scenario-container');
                const submitBtns = document.querySelectorAll('.scenario-btn');
                const prevBtn = document.getElementById('prev-scenario');
                const nextBtn = document.getElementById('next-scenario');
                const status = document.querySelector('#activity-1 .activity-status');

                // Show first scenario
                showScenario(1);

                // Option selection - REINITIALIZE on each scenario show
                function initializeOptionSelection() {
                    const optionItems = document.querySelectorAll(`#scenario-${state.activities[1].currentScenario} .option-item`);
                    
                    optionItems.forEach(item => {
                        // Remove any existing listeners first
                        item.removeEventListener('click', handleOptionClick);
                        item.addEventListener('click', handleOptionClick);
                    });
                }

                function handleOptionClick() {
                    if (state.activities[1].completed) return;
                    
                    const scenario = this.dataset.scenario;
                    const option = this.dataset.option;
                    
                    // Clear other selections in this scenario
                    document.querySelectorAll(`#scenario-${scenario} .option-item`).forEach(opt => {
                        opt.classList.remove('selected', 'wrong');
                    });
                    
                    // Select this option
                    this.classList.add('selected');
                    state.scenarioAnswers[scenario] = option;
                    
                    // Enable submit button for this scenario
                    const submitBtn = document.querySelector(`#scenario-${scenario} .scenario-btn`);
                    if (submitBtn) submitBtn.disabled = false;
                }

                // Submit response - FIXED LOGIC
                submitBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const scenario = this.dataset.scenario;
                        const selectedOption = state.scenarioAnswers[scenario];
                        
                        if (!selectedOption) {
                            alert('Please select an answer before submitting.');
                            return;
                        }
                        
                        const correctOption = state.correctAnswers[scenario];
                        const isCorrect = selectedOption === correctOption;
                        
                        // Get feedback element
                        const feedback = document.getElementById(`feedback-${scenario}`);
                        const feedbackIcon = feedback.querySelector('.feedback-icon');
                        const feedbackTitle = feedback.querySelector('.feedback-title');
                        
                        if (isCorrect) {
                            feedbackIcon.className = 'feedback-icon correct';
                            feedbackIcon.textContent = '‚úì';
                            feedbackTitle.textContent = 'Correct Response';
                            
                            // Only count correct once
                            if (!state.scenarioSubmitted[scenario]) {
                                state.activities[1].correct++;
                                state.scenarioSubmitted[scenario] = true;
                            }
                        } else {
                            feedbackIcon.className = 'feedback-icon incorrect';
                            feedbackIcon.textContent = '‚úó';
                            feedbackTitle.textContent = 'Incorrect Response';
                            
                            // Mark wrong option
                            document.querySelector(`#scenario-${scenario} .option-item[data-option="${selectedOption}"]`).classList.add('wrong');
                            state.scenarioSubmitted[scenario] = true;
                        }
                        
                        // Show feedback immediately
                        feedback.style.display = 'block';
                        feedback.classList.add('show');
                        this.disabled = true;
                        
                        // Update activity completion
                        updateActivity1Completion();
                    });
                });

                // Function to update Activity 1 completion status
                function updateActivity1Completion() {
                    // Check if all scenarios have been submitted
                    const allSubmitted = Object.values(state.scenarioSubmitted).every(submitted => submitted === true);
                    
                    if (allSubmitted && !state.activities[1].completed) {
                        state.activities[1].completed = true;
                        state.activities[1].score = Math.round((state.activities[1].correct / 2) * 100);
                        status.textContent = 'Completed';
                        status.style.color = '#00b894';
                        document.querySelector('#activity-1').classList.add('completed');
                        updateProgressSummary();
                    }
                }

                // Scenario navigation - FIXED to show/hide feedback properly
                prevBtn.addEventListener('click', function() {
                    if (state.activities[1].currentScenario > 1) {
                        state.activities[1].currentScenario--;
                        showScenario(state.activities[1].currentScenario);
                    }
                });

                nextBtn.addEventListener('click', function() {
                    if (state.activities[1].currentScenario < 2) {
                        state.activities[1].currentScenario++;
                        showScenario(state.activities[1].currentScenario);
                    }
                });

                function showScenario(num) {
                    // Hide all scenarios and their feedback
                    scenarioContainers.forEach(container => {
                        container.style.display = 'none';
                    });
                    
                    // Show selected scenario
                    const currentScenario = document.getElementById(`scenario-${num}`);
                    currentScenario.style.display = 'block';
                    
                    // Initialize option selection for this scenario
                    initializeOptionSelection();
                    
                    // Check if scenario was already answered
                    const submitBtn = currentScenario.querySelector('.scenario-btn');
                    if (state.scenarioAnswers[num]) {
                        // Show the selected option
                        const selectedOption = document.querySelector(`#scenario-${num} .option-item[data-option="${state.scenarioAnswers[num]}"]`);
                        if (selectedOption) {
                            selectedOption.classList.add('selected');
                            if (state.scenarioSubmitted[num]) {
                                selectedOption.classList.add(state.scenarioAnswers[num] === state.correctAnswers[num] ? 'selected' : 'wrong');
                                submitBtn.disabled = true;
                            }
                        }
                    } else {
                        submitBtn.disabled = true;
                    }
                    
                    // Show feedback if it was already submitted
                    const feedback = document.getElementById(`feedback-${num}`);
                    if (state.scenarioSubmitted[num]) {
                        feedback.style.display = 'block';
                        feedback.classList.add('show');
                    } else {
                        feedback.style.display = 'none';
                        feedback.classList.remove('show');
                    }
                    
                    // Update navigation buttons
                    prevBtn.disabled = num === 1;
                    nextBtn.disabled = num === 2;
                    
                    // Update button text
                    if (num === 2) {
                        nextBtn.textContent = 'Finish Activity';
                    } else {
                        nextBtn.textContent = 'Next Scenario ‚Üí';
                    }
                }
            }

            // Activity 2: Patient Support Planner
            function initActivity2() {
                const scenarioTabs = document.querySelectorAll('.scenario-tab');
                const patientScenarios = document.querySelectorAll('.patient-scenario');
                const supportCategories = document.querySelectorAll('.support-category');
                const checkSupportBtn = document.getElementById('check-support');
                const supportFeedback = document.getElementById('support-feedback');
                const status = document.querySelector('#activity-2 .activity-status');
                
                let currentScenario = 'bph';
                let placedResources = {
                    bph: { physical: [], emotional: [], educational: [] },
                    sti: { physical: [], emotional: [], educational: [] }
                };
                
                // Load initial resources (BPH)
                loadResources('bph');
                
                // Scenario tab switching
                scenarioTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const scenario = this.dataset.scenario;
                        
                        // Update tabs
                        scenarioTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Update scenarios
                        patientScenarios.forEach(s => s.style.display = 'none');
                        document.getElementById(`${scenario}-scenario`).style.display = 'block';
                        
                        // Clear dropzones
                        clearDropzones();
                        
                        // Load new resources
                        loadResources(scenario);
                        
                        // Restore any placed resources for this scenario
                        restorePlacedResources(scenario);
                        
                        currentScenario = scenario;
                        state.activities[2].currentScenario = scenario;
                        
                        // Hide feedback
                        supportFeedback.classList.remove('show');
                    });
                });
                
                // Setup drag and drop
                function setupDragAndDrop() {
                    const resourceItems = document.querySelectorAll('.resource-item:not(.placed)');
                    
                    resourceItems.forEach(item => {
                        item.addEventListener('dragstart', function(e) {
                            e.dataTransfer.setData('text/plain', JSON.stringify({
                                text: this.textContent,
                                id: this.dataset.id
                            }));
                            this.classList.add('dragging');
                        });
                        
                        item.addEventListener('dragend', function() {
                            this.classList.remove('dragging');
                        });
                    });
                    
                    supportCategories.forEach(category => {
                        category.addEventListener('dragover', function(e) {
                            e.preventDefault();
                            this.classList.add('hover');
                        });
                        
                        category.addEventListener('dragleave', function() {
                            this.classList.remove('hover');
                        });
                        
                        category.addEventListener('drop', function(e) {
                            e.preventDefault();
                            this.classList.remove('hover');
                            
                            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                            const categoryType = this.dataset.category;
                            const dropzone = this.querySelector('.support-dropzone');
                            
                            // Check if resource already placed in this category
                            if (!placedResources[currentScenario][categoryType].includes(data.id)) {
                                // Create placed resource
                                const div = document.createElement('div');
                                div.className = 'resource-item placed';
                                div.textContent = data.text;
                                div.dataset.id = data.id;
                                
                                dropzone.appendChild(div);
                                dropzone.classList.remove('empty');
                                
                                // Add to placed resources
                                placedResources[currentScenario][categoryType].push(data.id);
                                
                                // Hide original resource
                                const originalItem = document.querySelector(`.resource-item[data-id="${data.id}"]:not(.placed)`);
                                if (originalItem) {
                                    originalItem.style.display = 'none';
                                }
                            }
                        });
                    });
                }
                
                function loadResources(scenario) {
                    resourceItems.innerHTML = '';
                    let allResources = [];
                    let idCounter = 1;
                    
                    // Combine all resources for this scenario
                    Object.values(state.resourceCategories[scenario]).forEach(category => {
                        category.forEach(resource => {
                            allResources.push({
                                text: resource,
                                id: `resource-${idCounter++}`
                            });
                        });
                    });
                    
                    // Randomize order
                    allResources = shuffleArray(allResources);
                    
                    // Create resource items
                    allResources.forEach(resource => {
                        const div = document.createElement('div');
                        div.className = 'resource-item';
                        div.textContent = resource.text;
                        div.dataset.id = resource.id;
                        div.draggable = true;
                        resourceItems.appendChild(div);
                    });
                    
                    // Setup drag and drop after resources are loaded
                    setTimeout(setupDragAndDrop, 100);
                }
                
                function clearDropzones() {
                    document.querySelectorAll('.support-dropzone').forEach(dropzone => {
                        dropzone.innerHTML = '';
                        dropzone.classList.add('empty');
                    });
                    
                    // Show all resource items
                    document.querySelectorAll('.resource-item').forEach(item => {
                        item.style.display = '';
                        item.classList.remove('placed');
                    });
                }
                
                function restorePlacedResources(scenario) {
                    // Clear current placements
                    placedResources[scenario] = { physical: [], emotional: [], educational: [] };
                }
                
                function shuffleArray(array) {
                    const shuffled = [...array];
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    return shuffled;
                }
                
                // Check support plan
                checkSupportBtn.addEventListener('click', function() {
                    if (state.activities[2].completed) return;
                    
                    // Calculate score based on correct categorizations
                    let correct = 0;
                    const scenario = currentScenario;
                    const correctCategories = state.resourceCategories[scenario];
                    
                    Object.keys(placedResources[scenario]).forEach(category => {
                        placedResources[scenario][category].forEach(resourceId => {
                            // Find the resource text
                            const resourceItem = document.querySelector(`.resource-item[data-id="${resourceId}"]`);
                            if (resourceItem) {
                                const resourceText = resourceItem.textContent;
                                // Check if this resource belongs in this category
                                if (correctCategories[category].includes(resourceText)) {
                                    correct++;
                                }
                            }
                        });
                    });
                    
                    state.activities[2].completed = true;
                    state.activities[2].correct = correct;
                    state.activities[2].score = Math.round((correct / 12) * 100);
                    
                    status.textContent = 'Completed';
                    status.style.color = '#00b894';
                    document.querySelector('#activity-2').classList.add('completed');
                    supportFeedback.classList.add('show');
                    
                    updateProgressSummary();
                });
            }

            // Reset All Activities
            function resetAllActivities() {
                // Reset state
                state.activities[1] = { completed: false, correct: 0, total: 2, score: 0, currentScenario: 1 };
                state.activities[2] = { completed: false, correct: 0, total: 9, score: 0, currentScenario: 'bph' };
                state.scenarioAnswers = { 1: null, 2: null };
                state.scenarioSubmitted = { 1: false, 2: false };
                state.startedAt = new Date();
                
                // Reset Activity 1 UI
                document.querySelectorAll('.option-item').forEach(item => {
                    item.classList.remove('selected', 'wrong');
                });
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.disabled = false;
                });
                document.querySelectorAll('.feedback-ethics').forEach(feedback => {
                    feedback.style.display = 'none';
                    feedback.classList.remove('show');
                });
                document.querySelector('#scenario-1').style.display = 'block';
                document.querySelector('#scenario-2').style.display = 'none';
                document.getElementById('prev-scenario').disabled = true;
                document.getElementById('next-scenario').disabled = false;
                document.getElementById('next-scenario').textContent = 'Next Scenario ‚Üí';
                
                // Reset Activity 2 UI
                document.querySelectorAll('.scenario-tab').forEach((tab, index) => {
                    tab.classList.toggle('active', index === 0);
                });
                document.querySelectorAll('.patient-scenario').forEach((scenario, index) => {
                    scenario.style.display = index === 0 ? 'block' : 'none';
                });
                document.querySelectorAll('.support-dropzone').forEach(dropzone => {
                    dropzone.innerHTML = '';
                    dropzone.classList.add('empty');
                });
                document.querySelectorAll('.resource-item').forEach(item => {
                    item.style.display = '';
                    item.classList.remove('placed');
                });
                document.getElementById('support-feedback').classList.remove('show');
                
                // Reset activity status
                activityCards.forEach(card => {
                    card.classList.remove('completed');
                    const status = card.querySelector('.activity-status');
                    status.textContent = 'Not Started';
                    status.style.color = '';
                });
                
                // Reset results
                resultsPanel.classList.remove('show');
                
                // Reload resources
                initActivity2();
                
                // Update progress
                updateProgressSummary();
            }

            // Check All Answers
            function checkAllAnswers() {
                // Complete Activity 1 if not already
                if (!state.activities[1].completed) {
                    // Simulate answering both scenarios correctly
                    state.scenarioAnswers[1] = 'b';
                    state.scenarioAnswers[2] = 'b';
                    state.scenarioSubmitted[1] = true;
                    state.scenarioSubmitted[2] = true;
                    state.activities[1].completed = true;
                    state.activities[1].correct = 2;
                    state.activities[1].score = 100;
                    
                    document.querySelector('#activity-1 .activity-status').textContent = 'Completed';
                    document.querySelector('#activity-1 .activity-status').style.color = '#00b894';
                    document.querySelector('#activity-1').classList.add('completed');
                    
                    // Show all feedback and select correct options
                    document.querySelectorAll('.feedback-ethics').forEach(feedback => {
                        feedback.style.display = 'block';
                        feedback.classList.add('show');
                    });
                    
                    // Select correct options visually
                    document.querySelectorAll('.option-item[data-option="b"]').forEach(item => {
                        item.classList.add('selected');
                    });
                    
                    // Disable buttons
                    document.querySelectorAll('.scenario-btn').forEach(btn => {
                        btn.disabled = true;
                    });
                }
                
                // Complete Activity 2 if not already
                if (!state.activities[2].completed) {
                    // Calculate a reasonable score
                    state.activities[2].completed = true;
                    state.activities[2].correct = 8; // Assume 8/12 correct
                    state.activities[2].score = Math.round((8 / 12) * 100);
                    
                    document.querySelector('#activity-2 .activity-status').textContent = 'Completed';
                    document.querySelector('#activity-2 .activity-status').style.color = '#00b894';
                    document.querySelector('#activity-2').classList.add('completed');
                    document.getElementById('support-feedback').classList.add('show');
                }
                
                updateProgressSummary();
            }

            // View Final Results
            function viewFinalResults() {
                let totalScore = 0;
                let activityCount = 0;
                
                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) {
                        totalScore += activity.score;
                        activityCount++;
                    }
                });
                
                const averageScore = activityCount > 0 ? Math.round(totalScore / activityCount) : 0;
                finalScore.textContent = `${averageScore}%`;
                resultsPanel.classList.add('show');
                
                // Scroll to results
                resultsPanel.scrollIntoView({ behavior: 'smooth' });
            }

            // Initialize activities
            initActivity1();
            initActivity2();

            // Event listeners
            resetBtn.addEventListener('click', resetAllActivities);
            checkBtn.addEventListener('click', checkAllAnswers);
            resultsBtn.addEventListener('click', viewFinalResults);

            // Initial progress update
            updateProgressSummary();
        });
    </script>
</body>
</html>
