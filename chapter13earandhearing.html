<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlliedRx ‚Äì Chapter 13: Ear & Hearing Assessment Lab</title>
    <style>
        /* ===== CSS VARIABLES - BRANDING ===== */
        :root {
            --color-primary: #af4bef;
            --color-primary-soft: #d492ff;
            --color-accent: #8380f0;
            --color-success: #00b894;
            --color-error: #e17055;
            --color-bg: #f7f5fb;
            --color-text: #2b2b2b;
            --color-muted: #6c6880;
            --color-card: #ffffff;
            --color-panel: #2b2b2b;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.12);
            --radius: 12px;
            --radius-sm: 8px;
        }

        /* ===== BASE STYLES ===== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes checkmarkPop {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes scoreCount {
            from { width: 0%; }
            to { width: var(--target-width); }
        }

        /* ===== PAGE CONTAINER ===== */
        .page {
            animation: fadeInUp 0.6s ease-out;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 30px;
        }

        /* ===== HEADER / BRANDING ===== */
        .brand-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: white;
            border-bottom: 1px solid #eee;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .brand-logo {
            height: 40px;
            filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.2));
        }

        .course-title {
            font-size: clamp(1.1rem, 2vw, 1.4rem);
            font-weight: 700;
            color: var(--color-primary);
        }

        .badge {
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 3px 8px rgba(175, 75, 239, 0.3);
        }

        .module-title {
            padding: 25px 30px;
            background: linear-gradient(135deg, var(--color-primary-soft), var(--color-accent));
            color: white;
        }

        .module-title h1 {
            font-size: clamp(1.5rem, 3vw, 2rem);
            margin-bottom: 8px;
        }

        .module-title p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* ===== PROGRESS TRACKER ===== */
        .progress-tracker {
            display: flex;
            padding: 20px 30px;
            background: var(--color-bg);
            border-bottom: 1px solid #eee;
        }

        .step {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 60%;
            right: -40%;
            height: 3px;
            background: #ddd;
            z-index: 1;
        }

        .step.active:not(:last-child)::after {
            background: var(--color-primary);
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #ddd;
            color: var(--color-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
        }

        .step.active .step-circle {
            background: var(--color-primary);
            color: white;
            animation: pulse 1.5s infinite;
        }

        .step.completed .step-circle {
            background: var(--color-success);
            color: white;
        }

        .step-label {
            font-size: 0.9rem;
            color: var(--color-muted);
            text-align: center;
        }

        .step.active .step-label {
            color: var(--color-primary);
            font-weight: 600;
        }

        /* ===== PROGRESS SUMMARY ===== */
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px 30px;
            background: white;
            border-bottom: 1px solid #eee;
        }

        .summary-card {
            background: var(--color-bg);
            padding: 15px;
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .summary-card h3 {
            font-size: 0.9rem;
            color: var(--color-muted);
            margin-bottom: 8px;
        }

        .summary-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-primary);
        }

        /* ===== ACTIVITY GRID ===== */
        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            padding: 30px;
        }

        @media (max-width: 768px) {
            .activity-grid {
                grid-template-columns: 1fr;
            }
        }

        .activity-card {
            background: var(--color-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeIn 0.5s ease-out;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .activity-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--color-primary-soft), var(--color-accent));
            color: white;
        }

        .activity-header h2 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .activity-header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .activity-content {
            padding: 25px;
        }

        /* ===== HEARING LOSS DIAGNOSIS SCENARIOS ===== */
        .scenario-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .scenario {
            background: var(--color-bg);
            border-radius: var(--radius-sm);
            padding: 20px;
            border-left: 4px solid var(--color-accent);
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .patient-info {
            font-weight: 600;
            color: var(--color-primary);
            font-size: 1.1rem;
        }

        .symptoms {
            color: var(--color-text);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .symptoms strong {
            color: var(--color-muted);
        }

        .classification-section {
            margin: 25px 0;
        }

        .classification-instruction {
            font-size: 0.95rem;
            color: var(--color-muted);
            margin-bottom: 15px;
            font-style: italic;
        }

        .hearing-loss-types {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .type-column {
            flex: 1;
            background: var(--color-bg);
            border-radius: var(--radius-sm);
            padding: 20px;
            min-height: 120px;
            border: 2px dashed #ddd;
            transition: border-color 0.3s ease;
        }

        .type-column.active-drop {
            border-color: var(--color-primary);
            background-color: rgba(175, 75, 239, 0.05);
        }

        .type-title {
            text-align: center;
            font-weight: 700;
            color: var(--color-muted);
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .symptom-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .symptom-tag {
            background: white;
            border: 2px solid var(--color-accent);
            color: var(--color-text);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: grab;
            transition: all 0.2s ease;
            user-select: none;
        }

        .symptom-tag:hover {
            background: var(--color-accent);
            color: white;
            transform: translateY(-2px);
        }

        .symptom-tag.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .symptom-tag.placed {
            background: var(--color-success);
            color: white;
            border-color: var(--color-success);
            cursor: default;
        }

        .disorder-matching {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid #eee;
        }

        .disorder-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .disorder-option {
            background: white;
            border: 2px solid #ddd;
            border-radius: var(--radius-sm);
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .disorder-option:hover {
            border-color: var(--color-accent);
            transform: translateY(-2px);
        }

        .disorder-option.selected {
            background: var(--color-success);
            color: white;
            border-color: var(--color-success);
        }

        /* ===== COMMON EAR DISORDERS ACTIVITY ===== */
        .disorders-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .matching-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            align-items: start;
            padding: 20px;
            background: var(--color-bg);
            border-radius: var(--radius-sm);
        }

        @media (max-width: 900px) {
            .matching-row {
                grid-template-columns: 1fr;
            }
        }

        .matching-cell {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            min-height: 120px;
            border: 2px dashed #ddd;
            transition: all 0.2s ease;
        }

        .matching-cell.active-drop {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .matching-cell.correct {
            border-color: var(--color-success);
            background: rgba(0, 184, 148, 0.05);
        }

        .cell-title {
            font-weight: 700;
            color: var(--color-muted);
            margin-bottom: 15px;
            text-align: center;
            font-size: 0.95rem;
        }

        .disorder-option, .description-option, .treatment-option {
            background: white;
            border: 2px solid var(--color-accent);
            border-radius: var(--radius-sm);
            padding: 12px;
            margin-bottom: 10px;
            cursor: grab;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            text-align: center;
        }

        .disorder-option:hover, .description-option:hover, .treatment-option:hover {
            background: var(--color-accent);
            color: white;
            transform: translateY(-2px);
        }

        .option-placed {
            background: var(--color-success);
            color: white;
            border-color: var(--color-success);
            cursor: default;
        }

        /* ===== AUDIOMETER SIMULATION ===== */
        .audiometer-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .audiometer-display {
            background: var(--color-panel);
            border-radius: var(--radius-sm);
            padding: 20px;
            color: white;
            font-family: 'Courier New', monospace;
        }

        .frequency-slider, .volume-slider {
            margin: 20px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--color-muted);
        }

        .slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, var(--color-primary-soft), var(--color-accent));
            border-radius: 4px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .wave-visualization {
            height: 100px;
            background: rgba(0,0,0,0.2);
            border-radius: var(--radius-sm);
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .wave {
            position: absolute;
            bottom: 50%;
            width: 100%;
            height: 40px;
            background: rgba(175, 75, 239, 0.3);
            border-radius: 50%;
            animation: wavePulse 1s infinite ease-in-out;
        }

        @keyframes wavePulse {
            0%, 100% { transform: scaleY(1); opacity: 0.7; }
            50% { transform: scaleY(1.3); opacity: 1; }
        }

        .test-ear {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .ear-button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--color-bg);
            border: 3px solid var(--color-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ear-button.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
            animation: pulse 1.5s infinite;
        }

        /* ===== PROCEDURE SEQUENCING ===== */
        .procedure-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .step-option {
            background: white;
            border: 2px solid #ddd;
            border-radius: var(--radius-sm);
            padding: 18px;
            cursor: grab;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .step-option:hover {
            border-color: var(--color-accent);
            transform: translateX(5px);
        }

        .step-number {
            background: var(--color-primary-soft);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-sequence {
            background: var(--color-bg);
            border-radius: var(--radius-sm);
            padding: 25px;
            min-height: 200px;
            border: 2px dashed #ddd;
            margin-top: 20px;
        }

        .step-sequence.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-muted);
            font-style: italic;
        }

        .step-placed {
            background: white;
            border: 2px solid var(--color-success);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: fadeInUp 0.3s ease-out;
        }

        /* ===== FEEDBACK MESSAGES ===== */
        .feedback-message {
            padding: 15px;
            border-radius: var(--radius-sm);
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: fadeIn 0.3s ease-out;
        }

        .feedback-correct {
            background: rgba(0, 184, 148, 0.1);
            border-left: 4px solid var(--color-success);
        }

        .feedback-incorrect {
            background: rgba(225, 112, 85, 0.1);
            border-left: 4px solid var(--color-error);
        }

        .feedback-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        /* ===== ACTION BUTTONS ===== */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 30px;
            background: var(--color-bg);
            border-top: 1px solid #eee;
        }

        .action-button {
            padding: 15px 30px;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reset-button {
            background: white;
            color: var(--color-error);
            border: 2px solid var(--color-error);
        }

        .reset-button:hover {
            background: var(--color-error);
            color: white;
        }

        .check-button {
            background: var(--color-primary);
            color: white;
        }

        .check-button:hover {
            background: var(--color-accent);
            transform: translateY(-3px);
        }

        .results-button {
            background: var(--color-success);
            color: white;
        }

        .results-button:hover {
            background: #00a085;
            transform: translateY(-3px);
        }

        /* ===== RESULTS PANEL ===== */
        .results-panel {
            background: var(--color-panel);
            color: white;
            padding: 40px;
            border-radius: var(--radius);
            margin-top: 30px;
            animation: fadeInUp 0.6s ease-out;
            display: none;
        }

        .results-panel.show {
            display: block;
        }

        .results-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .results-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: white;
        }

        .score-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            position: relative;
        }

        .score-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--color-success) var(--score-percent, 0%), #333 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scoreCount 1.5s ease-out forwards;
            --target-width: 75%;
        }

        .score-inner {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: var(--color-panel);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
        }

        .score-label {
            color: var(--color-muted);
            font-size: 0.9rem;
        }

        .clinical-insights {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: 25px;
            margin-top: 30px;
        }

        .insight-title {
            color: var(--color-primary-soft);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .insight-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .insight-item:last-child {
            border-bottom: none;
        }

        .insight-icon {
            color: var(--color-success);
            font-size: 1.2rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* ===== UTILITY CLASSES ===== */
        .hidden {
            display: none !important;
        }

        .completed-badge {
            background: var(--color-success);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="page">
        <!-- HEADER / BRANDING -->
        <div class="brand-row">
            <div class="logo-container">
                <img src="https://cdn.prod.website-files.com/64d0ccc1558d601cbfb09021/64e9d2f719b1e5258e5d57f5_IMG_1512-p-500.png" 
                     alt="AlliedRx Logo" class="brand-logo">
                <div class="course-title">Clinical Medical Assistant Course</div>
            </div>
            <div class="badge">Campus & Online</div>
        </div>

        <!-- MODULE TITLE -->
        <div class="module-title">
            <h1>Chapter 13: Ear & Hearing Assessment Lab</h1>
            <p>Master ear anatomy, hearing loss classification, and common ENT procedures</p>
        </div>

        <!-- PROGRESS TRACKER -->
        <div class="progress-tracker">
            <div class="step active" id="step1">
                <div class="step-circle">1</div>
                <div class="step-label">Hearing Loss Diagnosis</div>
            </div>
            <div class="step" id="step2">
                <div class="step-circle">2</div>
                <div class="step-label">Common Ear Disorders</div>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">3</div>
                <div class="step-label">Clinical Procedures</div>
            </div>
        </div>

        <!-- PROGRESS SUMMARY -->
        <div class="progress-summary">
            <div class="summary-card">
                <h3>Completed Activities</h3>
                <div class="value"><span id="completed-count">0</span>/4</div>
            </div>
            <div class="summary-card">
                <h3>Current Accuracy</h3>
                <div class="value"><span id="accuracy-rate">0</span>%</div>
            </div>
            <div class="summary-card">
                <h3>Time Spent</h3>
                <div class="value"><span id="time-spent">0</span> min</div>
            </div>
        </div>

        <!-- ACTIVITY GRID -->
        <div class="activity-grid">
            <!-- ACTIVITY 1: HEARING LOSS DIAGNOSIS SCENARIOS -->
            <div class="activity-card" id="activity1">
                <div class="activity-header">
                    <h2>Activity 1: Hearing Loss Diagnosis Scenarios</h2>
                    <p>Review patient cases and classify their hearing loss type</p>
                </div>
                <div class="activity-content">
                    <div class="scenario-container">
                        <!-- SCENARIO 1 -->
                        <div class="scenario" data-scenario="1">
                            <div class="scenario-header">
                                <div class="patient-info">Patient 1: Sarah, 4 years old</div>
                                <div class="completed-badge hidden">‚úì Diagnosed</div>
                            </div>
                            <div class="symptoms">
                                <strong>Presenting Symptoms:</strong> Fever (38.5¬∞C), right ear pain, pulling at right ear, irritable, decreased appetite.<br>
                                <strong>History:</strong> Recent upper respiratory infection (cold) 5 days ago.<br>
                                <strong>Otoscopic Findings:</strong> Tympanic membrane bulging, erythematous (red), diminished light reflex.
                            </div>
                            
                            <div class="classification-section">
                                <div class="classification-instruction">Drag the patient's primary symptoms to the correct hearing loss type:</div>
                                <div class="symptom-tags">
                                    <div class="symptom-tag" data-symptom="acute-pain-fever" data-scenario="1">Acute pain & fever</div>
                                    <div class="symptom-tag" data-symptom="recent-uri" data-scenario="1">Recent URI</div>
                                    <div class="symptom-tag" data-symptom="bulging-tm" data-scenario="1">Bulging TM</div>
                                </div>
                                
                                <div class="hearing-loss-types">
                                    <div class="type-column" data-type="conductive" data-scenario="1">
                                        <div class="type-title">Conductive Hearing Loss</div>
                                        <div class="drop-zone" data-scenario="1" data-type="conductive"></div>
                                    </div>
                                    <div class="type-column" data-type="sensorineural" data-scenario="1">
                                        <div class="type-title">Sensorineural Hearing Loss</div>
                                        <div class="drop-zone" data-scenario="1" data-type="sensorineural"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="disorder-matching">
                                <div class="classification-instruction">Based on your classification, select the most likely disorder:</div>
                                <div class="disorder-options">
                                    <div class="disorder-option" data-disorder="otitis-media" data-scenario="1">Otitis Media</div>
                                    <div class="disorder-option" data-disorder="menieres" data-scenario="1">Meniere's Disease</div>
                                    <div class="disorder-option" data-disorder="cerumen" data-scenario="1">Impacted Cerumen</div>
                                    <div class="disorder-option" data-disorder="presbycusis" data-scenario="1">Presbycusis</div>
                                </div>
                            </div>
                            
                            <div class="feedback-message hidden"></div>
                        </div>

                        <!-- SCENARIO 2 -->
                        <div class="scenario hidden" data-scenario="2">
                            <div class="scenario-header">
                                <div class="patient-info">Patient 2: Mr. Chen, 72 years old</div>
                                <div class="completed-badge hidden">‚úì Diagnosed</div>
                            </div>
                            <div class="symptoms">
                                <strong>Presenting Symptoms:</strong> Gradual hearing loss over 5 years, difficulty understanding speech (especially in noise), "people seem to mumble".<br>
                                <strong>History:</strong> Bilateral tinnitus (ringing) for 2 years, no ear pain, no vertigo.<br>
                                <strong>Otoscopic Findings:</strong> Tympanic membranes normal, ear canals clear.
                            </div>
                            
                            <div class="classification-section">
                                <div class="classification-instruction">Drag the patient's primary symptoms to the correct hearing loss type:</div>
                                <div class="symptom-tags">
                                    <div class="symptom-tag" data-symptom="gradual-loss" data-scenario="2">Gradual hearing loss</div>
                                    <div class="symptom-tag" data-symptom="speech-understanding" data-scenario="2">Difficulty understanding speech</div>
                                    <div class="symptom-tag" data-symptom="tinnitus" data-scenario="2">Tinnitus</div>
                                </div>
                                
                                <div class="hearing-loss-types">
                                    <div class="type-column" data-type="conductive" data-scenario="2">
                                        <div class="type-title">Conductive Hearing Loss</div>
                                        <div class="drop-zone" data-scenario="2" data-type="conductive"></div>
                                    </div>
                                    <div class="type-column" data-type="sensorineural" data-scenario="2">
                                        <div class="type-title">Sensorineural Hearing Loss</div>
                                        <div class="drop-zone" data-scenario="2" data-type="sensorineural"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="disorder-matching">
                                <div class="classification-instruction">Based on your classification, select the most likely disorder:</div>
                                <div class="disorder-options">
                                    <div class="disorder-option" data-disorder="otitis-media" data-scenario="2">Otitis Media</div>
                                    <div class="disorder-option" data-disorder="menieres" data-scenario="2">Meniere's Disease</div>
                                    <div class="disorder-option" data-disorder="cerumen" data-scenario="2">Impacted Cerumen</div>
                                    <div class="disorder-option" data-disorder="presbycusis" data-scenario="2">Presbycusis</div>
                                </div>
                            </div>
                            
                            <div class="feedback-message hidden"></div>
                        </div>
                    </div>
                    
                    <div class="scenario-navigation" style="text-align: center; margin-top: 20px;">
                        <button class="action-button" id="prev-scenario" style="padding: 10px 20px; margin-right: 10px;">‚Üê Previous Case</button>
                        <button class="action-button" id="next-scenario" style="padding: 10px 20px; background: var(--color-accent);">Next Case ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- ACTIVITY 2: COMMON EAR DISORDERS -->
            <div class="activity-card" id="activity2">
                <div class="activity-header">
                    <h2>Activity 2: Common Ear Disorders</h2>
                    <p>Match each disorder with its description and treatment</p>
                </div>
                <div class="activity-content">
                    <div class="disorders-container">
                        <div class="matching-row">
                            <div class="matching-cell" data-type="disorder">
                                <div class="cell-title">Ear Disorders</div>
                                <div class="disorder-option" data-disorder="otitis-media">Otitis Media</div>
                                <div class="disorder-option" data-disorder="menieres">Meniere's Disease</div>
                                <div class="disorder-option" data-disorder="cerumen">Impacted Cerumen</div>
                                <div class="disorder-option" data-disorder="tinnitus">Tinnitus</div>
                            </div>
                            <div class="matching-cell" data-type="description">
                                <div class="cell-title">Descriptions</div>
                                <div class="description-option" data-description="fluid-buildup">Fluid buildup behind TM after URI</div>
                                <div class="description-option" data-description="vertigo-hearing">Vertigo + hearing fluctuations</div>
                                <div class="description-option" data-description="earwax-blockage">Earwax blocking ear canal</div>
                                <div class="description-option" data-description="ringing-ears">Ringing without external sound</div>
                            </div>
                            <div class="matching-cell" data-type="treatment">
                                <div class="cell-title">Treatments</div>
                                <div class="treatment-option" data-treatment="antibiotics">Antibiotics, myringotomy</div>
                                <div class="treatment-option" data-treatment="diet-meds">Low-salt diet, diuretics</div>
                                <div class="treatment-option" data-treatment="irrigation">Cerumenolytic drops, irrigation</div>
                                <div class="treatment-option" data-treatment="masking">Sound therapy, counseling</div>
                            </div>
                        </div>
                        <div class="feedback-message hidden"></div>
                    </div>
                </div>
            </div>

            <!-- ACTIVITY 3: AUDIOMETER SIMULATION -->
            <div class="activity-card" id="activity3">
                <div class="activity-header">
                    <h2>Activity 3: Audiometer Simulation</h2>
                    <p>Practice conducting a basic hearing screening test</p>
                </div>
                <div class="activity-content">
                    <div class="audiometer-container">
                        <div class="audiometer-display">
                            <div style="margin-bottom: 15px;">
                                <strong>Audiometer Settings:</strong><br>
                                Frequency: <span id="frequency-display">1000</span> Hz<br>
                                Volume: <span id="volume-display">25</span> dB HL
                            </div>
                            
                            <div class="frequency-slider">
                                <div class="slider-label">
                                    <span>Frequency (Hz)</span>
                                    <span id="frequency-value">1000</span>
                                </div>
                                <input type="range" min="250" max="8000" value="1000" step="250" class="slider" id="frequency-slider">
                            </div>
                            
                            <div class="volume-slider">
                                <div class="slider-label">
                                    <span>Volume (dB HL)</span>
                                    <span id="volume-value">25</span>
                                </div>
                                <input type="range" min="0" max="100" value="25" class="slider" id="volume-slider">
                            </div>
                            
                            <div class="wave-visualization">
                                <div class="wave" id="sound-wave"></div>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button class="action-button" id="play-tone" style="background: var(--color-primary);">Play Tone</button>
                            <button class="action-button" id="stop-tone" style="background: var(--color-error); margin-left: 15px;">Stop Tone</button>
                        </div>
                        
                        <div class="test-ear">
                            <div class="ear-button" data-ear="right">R<br>Right Ear</div>
                            <div class="ear-button" data-ear="left">L<br>Left Ear</div>
                        </div>
                        
                        <div class="feedback-message hidden"></div>
                    </div>
                </div>
            </div>

            <!-- ACTIVITY 4: PROCEDURE SEQUENCING -->
            <div class="activity-card" id="activity4">
                <div class="activity-header">
                    <h2>Activity 4: Ear Irrigation Procedure</h2>
                    <p>Place the steps in correct clinical order</p>
                </div>
                <div class="activity-content">
                    <div class="procedure-container">
                        <div class="step-option" data-step="1">
                            <div class="step-number">1</div>
                            <div>Verify no contraindications (TM perforation, ear surgery)</div>
                        </div>
                        <div class="step-option" data-step="2">
                            <div class="step-number">2</div>
                            <div>Explain procedure to patient and obtain consent</div>
                        </div>
                        <div class="step-option" data-step="3">
                            <div class="step-number">3</div>
                            <div>Position patient sitting with head tilted toward affected ear</div>
                        </div>
                        <div class="step-option" data-step="4">
                            <div class="step-number">4</div>
                            <div>Place waterproof drape and emesis basin under ear</div>
                        </div>
                        <div class="step-option" data-step="5">
                            <div class="step-number">5</div>
                            <div>Fill irrigating syringe with body-temperature solution</div>
                        </div>
                        <div class="step-option" data-step="6">
                            <div class="step-number">6</div>
                            <div>Gently pull pinna up and back (adults) or down and back (children)</div>
                        </div>
                        <div class="step-option" data-step="7">
                            <div class="step-number">7</div>
                            <div>Direct stream toward roof of ear canal (not directly at TM)</div>
                        </div>
                        <div class="step-option" data-step="8">
                            <div class="step-number">8</div>
                            <div>Inspect canal and TM with otoscope post-procedure</div>
                        </div>
                        <div class="step-option" data-step="9">
                            <div class="step-number">9</div>
                            <div>Document procedure including patient tolerance and findings</div>
                        </div>
                        
                        <div class="step-sequence empty" id="procedure-sequence">
                            Drag steps here in correct order...
                        </div>
                        <div class="feedback-message hidden"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACTION BUTTONS -->
        <div class="action-buttons">
            <button class="action-button reset-button" id="reset-all">
                <span>‚Üª</span> Reset All Activities
            </button>
            <button class="action-button check-button" id="check-answers">
                <span>‚úì</span> Check All Answers
            </button>
            <button class="action-button results-button" id="view-results">
                <span>üìä</span> View Final Results
            </button>
        </div>

        <!-- RESULTS PANEL -->
        <div class="results-panel" id="results-panel">
            <div class="results-header">
                <h2>Ear & Hearing Assessment Complete!</h2>
                <p>Review your performance and clinical insights below</p>
            </div>
            
            <div class="score-container">
                <div class="score-circle" id="score-circle">
                    <div class="score-inner">
                        <div class="score-value" id="final-score">0%</div>
                        <div class="score-label">Overall Score</div>
                    </div>
                </div>
            </div>
            
            <div class="clinical-insights">
                <h3 class="insight-title">Clinical Insights & Pro Tips</h3>
                <div class="insight-list">
                    <div class="insight-item">
                        <div class="insight-icon">‚úì</div>
                        <div><strong>Otitis Media Diagnosis:</strong> Most common in children due to shorter, more horizontal Eustachian tubes. Always check for fever and recent URI history.</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon">‚úì</div>
                        <div><strong>Presbycusis Management:</strong> Age-related sensorineural loss typically affects high frequencies first. Recommend hearing aids and communication strategies.</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon">‚úì</div>
                        <div><strong>Ear Irrigation Safety:</strong> Never irrigate if TM perforation is suspected. Use body-temperature solution to avoid caloric stimulation and vertigo.</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon">‚úì</div>
                        <div><strong>Audiogram Documentation:</strong> Remember: Right ear = red = O, Left ear = blue = X. Normal hearing threshold is 0-25 dB HL.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== STATE MANAGEMENT =====
        const moduleState = {
            activities: {
                'activity1': { completed: false, score: 0, maxScore: 4 },
                'activity2': { completed: false, score: 0, maxScore: 4 },
                'activity3': { completed: false, score: 0, maxScore: 3 },
                'activity4': { completed: false, score: 0, maxScore: 9 }
            },
            currentScenario: 1,
            totalScenarios: 2,
            startTime: Date.now(),
            answers: {
                scenario1: { type: null, disorder: null },
                scenario2: { type: null, disorder: null }
            },
            correctMatches: {
                otitisMedia: { description: 'fluid-buildup', treatment: 'antibiotics' },
                menieres: { description: 'vertigo-hearing', treatment: 'diet-meds' },
                cerumen: { description: 'earwax-blockage', treatment: 'irrigation' },
                tinnitus: { description: 'ringing-ears', treatment: 'masking' }
            },
            procedureOrder: [1, 2, 3, 4, 5, 6, 7, 8, 9]
        };

        // ===== DOM ELEMENTS =====
        const completedCountEl = document.getElementById('completed-count');
        const accuracyRateEl = document.getElementById('accuracy-rate');
        const timeSpentEl = document.getElementById('time-spent');
        const resultsPanel = document.getElementById('results-panel');
        const finalScoreEl = document.getElementById('final-score');
        const scoreCircle = document.getElementById('score-circle');

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
            initializeEventListeners();
            updateProgress();
            startTimer();
        });

        // ===== TIMER FUNCTION =====
        function startTimer() {
            setInterval(() => {
                const minutes = Math.floor((Date.now() - moduleState.startTime) / 60000);
                timeSpentEl.textContent = minutes;
            }, 60000);
        }

        // ===== PROGRESS UPDATES =====
        function updateProgress() {
            let completed = 0;
            let totalScore = 0;
            let maxTotal = 0;

            Object.values(moduleState.activities).forEach(activity => {
                if (activity.completed) completed++;
                totalScore += activity.score;
                maxTotal += activity.maxScore;
            });

            completedCountEl.textContent = completed;
            const accuracy = maxTotal > 0 ? Math.round((totalScore / maxTotal) * 100) : 0;
            accuracyRateEl.textContent = accuracy;

            // Update step tracker
            document.querySelectorAll('.step').forEach((step, index) => {
                if (index < completed) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (index === completed) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        // ===== DRAG AND DROP FUNCTIONALITY =====
        function initializeDragAndDrop() {
            // Symptom tags for scenarios
            document.querySelectorAll('.symptom-tag').forEach(tag => {
                tag.addEventListener('dragstart', handleDragStart);
                tag.addEventListener('dragend', handleDragEnd);
            });

            // Hearing loss type columns
            document.querySelectorAll('.type-column').forEach(column => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleDropSymptom);
            });

            // Disorder matching cells
            document.querySelectorAll('.matching-cell').forEach(cell => {
                cell.addEventListener('dragover', handleDragOver);
                cell.addEventListener('drop', handleDropMatch);
            });

            // Procedure steps
            document.querySelectorAll('.step-option').forEach(step => {
                step.addEventListener('dragstart', handleDragStart);
                step.addEventListener('dragend', handleDragEnd);
            });

            document.getElementById('procedure-sequence').addEventListener('dragover', handleDragOver);
            document.getElementById('procedure-sequence').addEventListener('drop', handleDropStep);
        }

        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', e.target.dataset.step || e.target.dataset.symptom || '');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedElement = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('active-drop');
        }

        // Symptom dropping for scenarios
        function handleDropSymptom(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('active-drop');
            
            const scenario = e.currentTarget.dataset.scenario;
            const type = e.currentTarget.dataset.type;
            const symptom = draggedElement.dataset.symptom;
            
            if (draggedElement && draggedElement.classList.contains('symptom-tag')) {
                // Clear any existing symptom in this drop zone
                const dropZone = e.currentTarget.querySelector('.drop-zone');
                dropZone.innerHTML = '';
                
                // Clone and place the symptom
                const placedSymptom = draggedElement.cloneNode(true);
                placedSymptom.classList.add('placed');
                placedSymptom.draggable = false;
                dropZone.appendChild(placedSymptom);
                
                // Store the answer
                if (!moduleState.answers[`scenario${scenario}`].type) {
                    moduleState.answers[`scenario${scenario}`].type = type;
                }
                
                // Check if all symptoms placed for this scenario
                checkScenarioCompletion(scenario);
            }
        }

        // Matching game dropping
        function handleDropMatch(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('active-drop');
            
            const cellType = e.currentTarget.dataset.type;
            const draggedType = draggedElement.classList.contains('disorder-option') ? 'disorder' :
                              draggedElement.classList.contains('description-option') ? 'description' : 'treatment';
            
            if (cellType === draggedType) {
                // Clear any existing item in this cell
                e.currentTarget.innerHTML = `<div class="cell-title">${e.currentTarget.querySelector('.cell-title').textContent}</div>`;
                
                // Clone and place
                const placedItem = draggedElement.cloneNode(true);
                placedItem.classList.add('option-placed');
                placedItem.draggable = false;
                e.currentTarget.appendChild(placedItem);
                
                // Check matches
                checkMatchingGame();
            }
        }

        // Procedure step dropping
        function handleDropStep(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('active-drop');
            
            if (draggedElement && draggedElement.classList.contains('step-option')) {
                const stepNum = parseInt(draggedElement.dataset.step);
                const sequence = document.getElementById('procedure-sequence');
                
                if (sequence.classList.contains('empty')) {
                    sequence.classList.remove('empty');
                    sequence.innerHTML = '';
                }
                
                // Check if step already placed
                if (!document.querySelector(`.step-placed[data-step="${stepNum}"]`)) {
                    const stepClone = draggedElement.cloneNode(true);
                    stepClone.classList.remove('step-option');
                    stepClone.classList.add('step-placed');
                    stepClone.draggable = false;
                    sequence.appendChild(stepClone);
                    
                    // Check procedure completion
                    checkProcedureCompletion();
                }
            }
        }

        // ===== SCENARIO MANAGEMENT =====
        function showScenario(num) {
            document.querySelectorAll('.scenario').forEach(scenario => {
                scenario.classList.add('hidden');
            });
            document.querySelector(`.scenario[data-scenario="${num}"]`).classList.remove('hidden');
            moduleState.currentScenario = num;
            
            // Update navigation buttons
            document.getElementById('prev-scenario').disabled = num === 1;
            document.getElementById('next-scenario').disabled = num === moduleState.totalScenarios;
        }

        document.getElementById('next-scenario').addEventListener('click', () => {
            if (moduleState.currentScenario < moduleState.totalScenarios) {
                showScenario(moduleState.currentScenario + 1);
            }
        });

        document.getElementById('prev-scenario').addEventListener('click', () => {
            if (moduleState.currentScenario > 1) {
                showScenario(moduleState.currentScenario - 1);
            }
        });

        // ===== SCENARIO COMPLETION CHECK =====
        function checkScenarioCompletion(scenarioNum) {
            const scenarioEl = document.querySelector(`.scenario[data-scenario="${scenarioNum}"]`);
            const typeColumns = scenarioEl.querySelectorAll('.type-column');
            const disorderOptions = scenarioEl.querySelectorAll('.disorder-option');
            
            let symptomsPlaced = 0;
            typeColumns.forEach(col => {
                if (col.querySelector('.placed')) symptomsPlaced++;
            });
            
            let disorderSelected = false;
            disorderOptions.forEach(opt => {
                if (opt.classList.contains('selected')) disorderSelected = true;
            });
            
            if (symptomsPlaced > 0 && disorderSelected) {
                // Mark scenario as completed
                const badge = scenarioEl.querySelector('.completed-badge');
                badge.classList.remove('hidden');
                
                // Calculate score
                let score = 0;
                const correctType = scenarioNum === 1 ? 'conductive' : 'sensorineural';
                const correctDisorder = scenarioNum === 1 ? 'otitis-media' : 'presbycusis';
                
                if (moduleState.answers[`scenario${scenarioNum}`].type === correctType) score += 2;
                if (moduleState.answers[`scenario${scenarioNum}`].disorder === correctDisorder) score += 2;
                
                // Update activity score
                moduleState.activities.activity1.score = Math.max(moduleState.activities.activity1.score, score);
                moduleState.activities.activity1.completed = true;
                
                // Show feedback
                showFeedback(scenarioEl.querySelector('.feedback-message'), 
                           score === 4, 
                           score === 4 ? 
                           '‚úì Correct diagnosis! This is a classic presentation.' : 
                           'Partially correct. Review the symptom patterns.');
                
                updateProgress();
            }
        }

        // Disorder option selection
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('disorder-option')) {
                const scenario = e.target.dataset.scenario;
                const disorder = e.target.dataset.disorder;
                
                // Clear other selections in this scenario
                document.querySelectorAll(`.disorder-option[data-scenario="${scenario}"]`).forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // Select this one
                e.target.classList.add('selected');
                moduleState.answers[`scenario${scenario}`].disorder = disorder;
                
                // Check completion
                checkScenarioCompletion(scenario);
            }
        });

        // ===== MATCHING GAME CHECK =====
        function checkMatchingGame() {
            const placedItems = document.querySelectorAll('.option-placed');
            if (placedItems.length === 12) { // All items placed (4 disorders √ó 3 columns)
                let correctCount = 0;
                
                // Check each disorder match
                for (const disorder in moduleState.correctMatches) {
                    const disorderEl = document.querySelector(`.option-placed[data-disorder="${disorder}"]`);
                    const descriptionEl = document.querySelector(`.option-placed[data-description="${moduleState.correctMatches[disorder].description}"]`);
                    const treatmentEl = document.querySelector(`.option-placed[data-treatment="${moduleState.correctMatches[disorder].treatment}"]`);
                    
                    if (disorderEl && descriptionEl && treatmentEl) {
                        // Check if they're in the same row (simplified check)
                        correctCount++;
                        
                        // Visual feedback
                        [disorderEl, descriptionEl, treatmentEl].forEach(el => {
                            el.parentElement.classList.add('correct');
                        });
                    }
                }
                
                // Update score
                moduleState.activities.activity2.score = correctCount;
                moduleState.activities.activity2.completed = true;
                
                // Show feedback
                const feedbackEl = document.querySelector('#activity2 .feedback-message');
                showFeedback(feedbackEl, 
                           correctCount === 4, 
                           correctCount === 4 ? 
                           '‚úì Perfect! All disorders matched correctly.' : 
                           `${correctCount}/4 correct. Review the disorder characteristics.`);
                
                updateProgress();
            }
        }

        // ===== PROCEDURE COMPLETION CHECK =====
        function checkProcedureCompletion() {
            const placedSteps = document.querySelectorAll('.step-placed');
            if (placedSteps.length === 9) {
                let correctCount = 0;
                
                placedSteps.forEach((step, index) => {
                    const stepNum = parseInt(step.dataset.step);
                    if (stepNum === moduleState.procedureOrder[index]) {
                        correctCount++;
                        step.style.borderColor = 'var(--color-success)';
                    } else {
                        step.style.borderColor = 'var(--color-error)';
                    }
                });
                
                // Update score
                moduleState.activities.activity4.score = correctCount;
                moduleState.activities.activity4.completed = true;
                
                // Show feedback
                const feedbackEl = document.querySelector('#activity4 .feedback-message');
                showFeedback(feedbackEl, 
                           correctCount === 9, 
                           correctCount === 9 ? 
                           '‚úì Perfect sequence! Follow this order for safe ear irrigation.' : 
                           `${correctCount}/9 correct. Review the procedural steps.`);
                
                updateProgress();
            }
        }

        // ===== AUDIOMETER SIMULATION =====
        let audioContext = null;
        let oscillator = null;
        let gainNode = null;
        let currentFrequency = 1000;
        let currentVolume = 25;

        document.getElementById('frequency-slider').addEventListener('input', function(e) {
            currentFrequency = parseInt(e.target.value);
            document.getElementById('frequency-value').textContent = currentFrequency;
            document.getElementById('frequency-display').textContent = currentFrequency;
            
            // Update wave animation
            const wave = document.getElementById('sound-wave');
            wave.style.animationDuration = `${1000/currentFrequency}s`;
        });

        document.getElementById('volume-slider').addEventListener('input', function(e) {
            currentVolume = parseInt(e.target.value);
            document.getElementById('volume-value').textContent = currentVolume;
            document.getElementById('volume-display').textContent = currentVolume;
            
            if (gainNode) {
                gainNode.gain.value = currentVolume / 100;
            }
        });

        document.getElementById('play-tone').addEventListener('click', function() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            if (oscillator) {
                oscillator.stop();
            }
            
            oscillator = audioContext.createOscillator();
            gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.value = currentFrequency;
            gainNode.gain.value = currentVolume / 100;
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start();
            
            // Mark activity as completed
            moduleState.activities.activity3.completed = true;
            moduleState.activities.activity3.score = 3;
            
            // Show feedback
            const feedbackEl = document.querySelector('#activity3 .feedback-message');
            showFeedback(feedbackEl, true, '‚úì Tone playing at ' + currentFrequency + ' Hz, ' + currentVolume + ' dB HL');
            
            updateProgress();
        });

        document.getElementById('stop-tone').addEventListener('click', function() {
            if (oscillator) {
                oscillator.stop();
                oscillator = null;
            }
        });

        // Ear selection
        document.querySelectorAll('.ear-button').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.ear-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
            });
        });

        // ===== FEEDBACK FUNCTION =====
        function showFeedback(element, isCorrect, message) {
            element.innerHTML = '';
            element.classList.remove('hidden', 'feedback-correct', 'feedback-incorrect');
            
            const icon = document.createElement('div');
            icon.className = 'feedback-icon';
            icon.textContent = isCorrect ? '‚úì' : '‚úó';
            
            const text = document.createElement('div');
            text.textContent = message;
            
            element.appendChild(icon);
            element.appendChild(text);
            element.classList.add(isCorrect ? 'feedback-correct' : 'feedback-incorrect');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                element.classList.add('hidden');
            }, 5000);
        }

        // ===== ACTION BUTTONS =====
        document.getElementById('reset-all').addEventListener('click', function() {
            if (confirm('Reset all activities? This will clear all your progress.')) {
                // Reset state
                Object.keys(moduleState.activities).forEach(key => {
                    moduleState.activities[key] = { completed: false, score: 0, maxScore: moduleState.activities[key].maxScore };
                });
                
                moduleState.answers = {
                    scenario1: { type: null, disorder: null },
                    scenario2: { type: null, disorder: null }
                };
                
                moduleState.currentScenario = 1;
                
                // Reset UI
                document.querySelectorAll('.symptom-tag, .disorder-option, .description-option, .treatment-option, .step-option').forEach(el => {
                    el.classList.remove('placed', 'selected', 'option-placed');
                    if (el.draggable === false) el.draggable = true;
                });
                
                document.querySelectorAll('.drop-zone').forEach(zone => {
                    zone.innerHTML = '';
                });
                
                document.querySelectorAll('.matching-cell').forEach(cell => {
                    cell.classList.remove('correct');
                    const title = cell.querySelector('.cell-title').textContent;
                    cell.innerHTML = `<div class="cell-title">${title}</div>`;
                    if (cell.dataset.type === 'disorder') {
                        cell.innerHTML += `
                            <div class="disorder-option" data-disorder="otitis-media">Otitis Media</div>
                            <div class="disorder-option" data-disorder="menieres">Meniere's Disease</div>
                            <div class="disorder-option" data-disorder="cerumen">Impacted Cerumen</div>
                            <div class="disorder-option" data-disorder="tinnitus">Tinnitus</div>
                        `;
                    } else if (cell.dataset.type === 'description') {
                        cell.innerHTML += `
                            <div class="description-option" data-description="fluid-buildup">Fluid buildup behind TM after URI</div>
                            <div class="description-option" data-description="vertigo-hearing">Vertigo + hearing fluctuations</div>
                            <div class="description-option" data-description="earwax-blockage">Earwax blocking ear canal</div>
                            <div class="description-option" data-description="ringing-ears">Ringing without external sound</div>
                        `;
                    } else if (cell.dataset.type === 'treatment') {
                        cell.innerHTML += `
                            <div class="treatment-option" data-treatment="antibiotics">Antibiotics, myringotomy</div>
                            <div class="treatment-option" data-treatment="diet-meds">Low-salt diet, diuretics</div>
                            <div class="treatment-option" data-treatment="irrigation">Cerumenolytic drops, irrigation</div>
                            <div class="treatment-option" data-treatment="masking">Sound therapy, counseling</div>
                        `;
                    }
                });
                
                const procedureSequence = document.getElementById('procedure-sequence');
                procedureSequence.innerHTML = 'Drag steps here in correct order...';
                procedureSequence.classList.add('empty');
                
                document.querySelectorAll('.completed-badge').forEach(badge => {
                    badge.classList.add('hidden');
                });
                
                document.querySelectorAll('.feedback-message').forEach(msg => {
                    msg.classList.add('hidden');
                });
                
                showScenario(1);
                updateProgress();
                initializeDragAndDrop();
                
                if (oscillator) {
                    oscillator.stop();
                    oscillator = null;
                }
            }
        });

        document.getElementById('check-answers').addEventListener('click', function() {
            // Force check all activities
            checkScenarioCompletion(1);
            checkScenarioCompletion(2);
            checkMatchingGame();
            checkProcedureCompletion();
            
            alert('All answers checked! Review the feedback for each activity.');
        });

        document.getElementById('view-results').addEventListener('click', function() {
            // Calculate final score
            let totalScore = 0;
            let maxTotal = 0;
            
            Object.values(moduleState.activities).forEach(activity => {
                totalScore += activity.score;
                maxTotal += activity.maxScore;
            });
            
            const finalScore = maxTotal > 0 ? Math.round((totalScore / maxTotal) * 100) : 0;
            
            // Update results display
            finalScoreEl.textContent = finalScore + '%';
            scoreCircle.style.setProperty('--score-percent', finalScore + '%');
            
            // Show results panel
            resultsPanel.classList.add('show');
            resultsPanel.scrollIntoView({ behavior: 'smooth' });
        });

        // ===== EVENT LISTENER INITIALIZATION =====
        function initializeEventListeners() {
            // Reinitialize drag and drop for dynamically added elements
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('disorder-option')) {
                    const scenario = e.target.dataset.scenario;
                    if (scenario) {
                        const disorder = e.target.dataset.disorder;
                        moduleState.answers[`scenario${scenario}`].disorder = disorder;
                        checkScenarioCompletion(scenario);
                    }
                }
            });
        }
    </script>
</body>
</html>
