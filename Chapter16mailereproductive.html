<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AlliedRx -- Module 16.2: Male Reproductive Health & STI Prevention</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --color-primary: #af4bef;
            --color-primary-soft: #d492ff;
            --color-accent: #8380f0;
            --color-success: #00b894;
            --color-error: #e17055;
            --color-warning: #fdcb6e;
            --color-bg: #f7f5fb;
            --color-text: #2b2b2b;
            --color-muted: #6c6880;
            --color-dark: #0c0a18;
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --shadow-soft: 0 18px 45px rgba(23, 10, 61, 0.18);
            --shadow-hover: 0 25px 50px rgba(175, 75, 239, 0.15);
            --shadow-card: 0 12px 30px rgba(15, 23, 42, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            padding: 24px;
            background: radial-gradient(
                circle at top left,
                #ffffff 0,
                #f1ecff 40%,
                var(--color-bg) 100%
            );
            color: var(--color-text);
            -webkit-text-size-adjust: 100%;
            line-height: 1.5;
        }

        @media (max-width: 600px) {
            body { padding: 12px; }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes checkmarkPop {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .page {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 28px 30px 32px;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out;
        }

        @media (max-width: 900px) {
            .page { padding: 22px; }
        }

        @media (max-width: 480px) {
            body { padding: 0; }
            .page {
                border-radius: 0;
                box-shadow: none;
                padding: 18px 14px 22px;
            }
        }

        /* Header */
        .brand-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 14px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 40px;
            width: auto;
            max-width: 100%;
            filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
        }

        .brand-logo:hover { transform: scale(1.05); }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--color-muted);
            white-space: normal;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(175, 75, 239, 0.08);
            font-size: 0.76rem;
            color: var(--color-primary);
            white-space: normal;
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-success);
            flex-shrink: 0;
        }

        .badge-mode {
            padding: 5px 10px;
            border-radius: 999px;
            background: rgba(12, 10, 24, 0.06);
            border: 1px solid rgba(12, 10, 24, 0.08);
            font-size: 0.74rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--color-muted);
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .badge-mode:hover {
            background: rgba(175, 75, 239, 0.1);
            border-color: var(--color-primary-soft);
            color: var(--color-primary);
        }

        @media (max-width: 480px) {
            .brand-row { flex-direction: column; align-items: flex-start; }
            .badge-mode { margin-top: 6px; }
        }

        h1 {
            font-size: clamp(1.8rem, 3vw, 2.2rem);
            line-height: 1.1;
            color: var(--color-primary);
            margin-bottom: 6px;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        .module-subtitle {
            font-size: 0.98rem;
            color: var(--color-muted);
            max-width: 600px;
            margin-bottom: 24px;
            animation: fadeInUp 0.6s ease-out 0.4s both;
        }

        /* Progress Tracker - 2 STEPS ONLY */
        .progress-tracker {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            padding: 0 20px;
            max-width: 400px;
        }

        .progress-tracker::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 60px;
            right: 60px;
            height: 3px;
            background: rgba(12, 10, 24, 0.08);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(12, 10, 24, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-muted);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
            transform: scale(1.1);
        }

        .progress-step.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
            font-weight: 500;
        }

        .progress-step.active .step-label {
            color: var(--color-primary);
            font-weight: 600;
        }

        /* Progress Summary */
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease-out 0.5s both;
        }

        .summary-card {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-md);
            padding: 16px;
            border: 1px solid rgba(12, 10, 24, 0.06);
            text-align: center;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-card);
            border-color: var(--color-primary-soft);
        }

        .summary-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--color-primary);
            display: block;
            line-height: 1;
            margin-bottom: 4px;
        }

        .summary-label {
            font-size: 0.8rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Activity Grid - SINGLE COLUMN for 2 activities */
        .activity-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .activity-card {
            background: white;
            border-radius: var(--radius-md);
            border: 1px solid rgba(12, 10, 24, 0.08);
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--color-primary-soft);
        }

        .activity-card:hover::before { opacity: 1; }

        .activity-card.completed { border-color: var(--color-success); }
        .activity-card.completed::before {
            background: var(--color-success);
            opacity: 1;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .activity-number {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--color-primary);
            background: rgba(175, 75, 239, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
        }

        .activity-status {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 12px;
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-muted);
        }

        .activity-card.completed .activity-status {
            background: rgba(0, 184, 148, 0.1);
            color: var(--color-success);
        }

        .activity-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .activity-description {
            font-size: 0.9rem;
            color: var(--color-muted);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* Activity 1: STI Identification & Triage - IMPROVED */
        .case-container {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            position: relative;
            min-height: 180px;
        }

        .case-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .case-description {
            font-size: 0.9rem;
            color: var(--color-text);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .case-instruction {
            font-size: 0.85rem;
            color: var(--color-muted);
            padding: 10px;
            background: rgba(175, 75, 239, 0.05);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--color-primary);
            margin-bottom: 15px;
        }

        .diagnosis-area {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 2px dashed rgba(12, 10, 24, 0.1);
            min-height: 80px;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .diagnosis-area.hover {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .diagnosis-area.empty::after {
            content: 'DRAG DIAGNOSIS HERE';
            color: var(--color-muted);
            text-align: center;
            font-size: 0.9rem;
            display: block;
            padding: 20px;
        }

        .sti-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .sti-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 480px) {
            .sti-grid { grid-template-columns: 1fr; }
        }

        .sti-card {
            background: rgba(12, 10, 24, 0.03);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 2px solid transparent;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
        }

        .sti-card:hover {
            background: rgba(175, 75, 239, 0.08);
            border-color: var(--color-primary-soft);
            transform: translateY(-2px);
        }

        .sti-card.dragging {
            opacity: 0.7;
            transform: scale(0.98);
        }

        .sti-card.placed {
            cursor: default;
        }

        .sti-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 5px;
        }

        .sti-symptoms {
            font-size: 0.8rem;
            color: var(--color-text);
            line-height: 1.4;
        }

        /* Triage Categories - IMPROVED */
        .triage-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            .triage-categories { grid-template-columns: 1fr; }
        }

        .triage-category {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 2px dashed rgba(12, 10, 24, 0.1);
            min-height: 180px;
            transition: all 0.3s ease;
        }

        .triage-category.hover {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .triage-category.urgent {
            border-color: rgba(225, 112, 85, 0.3);
        }

        .triage-category.routine {
            border-color: rgba(253, 203, 110, 0.3);
        }

        .triage-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 10px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(12, 10, 24, 0.08);
        }

        .triage-description {
            font-size: 0.8rem;
            color: var(--color-muted);
            margin-bottom: 10px;
            text-align: center;
        }

        .triage-instruction {
            font-size: 0.75rem;
            color: var(--color-muted);
            font-style: italic;
            text-align: center;
            margin-bottom: 15px;
        }

        .triage-content {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            min-height: 40px;
        }

        .triage-content.empty::after {
            content: 'Drag STI cards here to triage';
            color: var(--color-muted);
            font-size: 0.8rem;
            text-align: center;
            width: 100%;
            padding: 10px;
        }

        /* Activity 2: Testicular Self-Exam Education - RANDOMIZED */
        .tse-steps-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tse-step-item {
            background: rgba(12, 10, 24, 0.03);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 2px solid rgba(12, 10, 24, 0.1);
            cursor: grab;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            user-select: none;
        }

        .tse-step-item:hover {
            background: rgba(175, 75, 239, 0.08);
            border-color: var(--color-primary-soft);
            transform: translateY(-2px);
        }

        .tse-step-item.dragging {
            opacity: 0.7;
            transform: scale(0.98);
        }

        .tse-step-item.placed {
            background: rgba(0, 184, 148, 0.1);
            border-color: var(--color-success);
            cursor: default;
        }

        .tse-step-letter {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(12, 10, 24, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-text);
            flex-shrink: 0;
        }

        .tse-step-item.placed .tse-step-letter {
            background: var(--color-success);
            color: white;
        }

        .tse-step-text {
            font-size: 0.9rem;
            color: var(--color-text);
            flex: 1;
        }

        .tse-dropzone {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px dashed rgba(12, 10, 24, 0.1);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .tse-dropzone.hover {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .tse-dropzone.empty::after {
            content: 'Drag TSE steps here in correct order (A-F)';
            color: var(--color-muted);
            text-align: center;
            font-size: 0.9rem;
            margin: auto;
        }

        /* Findings Reveal */
        .findings-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            .findings-container { grid-template-columns: 1fr; }
        }

        .finding-card {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .finding-card:hover {
            background: rgba(175, 75, 239, 0.08);
            border-color: var(--color-primary-soft);
            transform: translateY(-2px);
        }

        .finding-card.revealed {
            background: rgba(0, 184, 148, 0.1);
            border-color: var(--color-success);
        }

        .finding-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 8px;
        }

        .finding-content {
            font-size: 0.85rem;
            color: var(--color-text);
            line-height: 1.4;
            display: none;
        }

        .finding-card.revealed .finding-content {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Patient Education Script - RANDOMIZED */
        .script-container {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .script-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .script-instruction {
            font-size: 0.85rem;
            color: var(--color-muted);
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(175, 75, 239, 0.05);
            border-radius: var(--radius-sm);
        }

        .script-builder {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .script-part {
            background: rgba(175, 75, 239, 0.08);
            border-radius: var(--radius-sm);
            padding: 12px;
            border: 1px solid rgba(175, 75, 239, 0.2);
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .script-part:hover {
            background: rgba(175, 75, 239, 0.15);
            transform: translateX(5px);
        }

        .script-part.dragging {
            opacity: 0.7;
            transform: scale(0.98);
        }

        .script-part.placed {
            cursor: default;
        }

        .script-letter {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: rgba(12, 10, 24, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--color-text);
            flex-shrink: 0;
        }

        .script-part.placed .script-letter {
            background: var(--color-success);
            color: white;
        }

        .script-dropzone {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px dashed rgba(12, 10, 24, 0.1);
            min-height: 150px;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .script-dropzone.hover {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .script-dropzone.empty::after {
            content: 'Drag script parts here to build effective patient communication (1-6)';
            color: var(--color-muted);
            text-align: center;
            font-size: 0.9rem;
            margin: auto;
            display: block;
        }

        /* Feedback */
        .feedback-container {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            margin-top: 20px;
            display: none;
        }

        .feedback-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .feedback-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feedback-icon {
            font-size: 1.2rem;
        }

        .feedback-icon.correct { color: var(--color-success); }
        .feedback-icon.incorrect { color: var(--color-error); }

        .feedback-content {
            font-size: 0.85rem;
            color: var(--color-text);
            line-height: 1.5;
        }

        .feedback-content strong { color: var(--color-primary); }

        /* Safety Warning */
        .safety-warning {
            background: rgba(225, 112, 85, 0.1);
            border: 2px solid var(--color-error);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-top: 15px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: pulse 2s infinite;
        }

        .warning-icon {
            font-size: 1.5rem;
            color: var(--color-error);
            flex-shrink: 0;
        }

        .warning-content { flex: 1; }

        .warning-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--color-error);
            margin-bottom: 5px;
        }

        .warning-text {
            font-size: 0.85rem;
            color: var(--color-text);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #9a3bd6;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(175, 75, 239, 0.3);
        }

        .btn-secondary {
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(12, 10, 24, 0.1);
            transform: translateY(-2px);
        }

        .btn-icon { font-size: 1.1em; }

        /* Results Panel */
        .results-panel {
            background: var(--color-dark);
            color: white;
            border-radius: var(--radius-md);
            padding: 30px;
            margin-top: 30px;
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .results-panel.show { display: block; }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
        }

        .score-display {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--color-primary-soft);
            text-align: center;
            margin: 20px 0;
        }

        .clinical-insights {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-top: 20px;
        }

        .insights-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-primary-soft);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insights-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .insights-list li {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            font-size: 0.9rem;
            color: #e5e7eb;
        }

        .insight-dot {
            width: 6px;
            height: 6px;
            margin-top: 6px;
            border-radius: 999px;
            background: var(--color-accent);
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://cdn.prod.website-files.com/64d0ccc1558d601cbfb09021/64e9d2f719b1e5258e5d57f5_IMG_1512-p-500.png"
                    alt="AlliedRx logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">Clinical Medical Assistant ‚Ä¢ Week 8</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Chapter 16: Urology & Male Reproduction</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Campus & Online</span>
        </header>

        <h1 id="module-heading">Male Reproductive Health & STI Prevention</h1>
        <p class="module-subtitle">
            Develop skills in STI recognition, triage prioritization, and testicular self-exam education 
            to support male reproductive health and early detection.
        </p>

        <!-- Progress Tracker - 2 Steps Only -->
        <div class="progress-tracker">
            <div class="progress-step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">STI Identification</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">TSE Education</div>
            </div>
        </div>

        <!-- Progress Summary -->
        <div class="progress-summary">
            <div class="summary-card">
                <span class="summary-number" id="completed-count">0</span>
                <span class="summary-label">Activities Completed</span>
            </div>
            <div class="summary-card">
                <span class="summary-number" id="accuracy-rate">0%</span>
                <span class="summary-label">Current Accuracy</span>
            </div>
            <div class="summary-card">
                <span class="summary-number" id="time-spent">0:00</span>
                <span class="summary-label">Time Spent</span>
            </div>
        </div>

        <!-- Activity Grid - Single Column -->
        <div class="activity-grid">
            <!-- Activity 1: STI Identification & Triage - IMPROVED -->
            <section class="activity-card" id="activity-1" data-activity="1">
                <div class="activity-header">
                    <span class="activity-number">Activity 1</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">STI Identification & Triage</h3>
                <p class="activity-description">
                    Match STI symptoms to correct diagnoses and prioritize cases by urgency. 
                    Practice differential diagnosis and clinical decision-making in urology.
                </p>

                <!-- Patient Case with CLEAR Drop Area -->
                <div class="case-container">
                    <div class="case-title">
                        <span>üìã</span> Patient Case: 24-year-old male with penile discharge
                    </div>
                    <div class="case-description">
                        Patient presents with 3-day history of purulent penile discharge, dysuria, and mild fever (100.2¬∞F). 
                        Reports unprotected sexual contact 5 days ago. No significant PMH. Allergies: NKDA.
                    </div>
                    
                    <div class="case-instruction">
                        <strong>STEP 1:</strong> Drag the most likely STI diagnosis to the drop area below:
                    </div>
                    
                    <div class="diagnosis-area empty" id="diagnosis-area"></div>
                </div>

                <!-- STI Cards -->
                <div class="sti-grid">
                    <div class="sti-card draggable" data-sti="gonorrhea" draggable="true">
                        <div class="sti-name">Gonorrhea</div>
                        <div class="sti-symptoms">Purulent discharge, dysuria, possible fever. Incubation: 2-7 days.</div>
                    </div>
                    <div class="sti-card draggable" data-sti="chlamydia" draggable="true">
                        <div class="sti-name">Chlamydia</div>
                        <div class="sti-symptoms">Clear/mucoid discharge, dysuria, often asymptomatic.</div>
                    </div>
                    <div class="sti-card draggable" data-sti="syphilis" draggable="true">
                        <div class="sti-name">Syphilis</div>
                        <div class="sti-symptoms">Chancre (painless ulcer), rash, systemic symptoms.</div>
                    </div>
                    <div class="sti-card draggable" data-sti="hpv" draggable="true">
                        <div class="sti-name">HPV</div>
                        <div class="sti-symptoms">Genital warts, often asymptomatic, cancer risk.</div>
                    </div>
                    <div class="sti-card draggable" data-sti="herpes" draggable="true">
                        <div class="sti-name">Herpes</div>
                        <div class="sti-symptoms">Painful vesicles/ulcers, flu-like symptoms, recurrence.</div>
                    </div>
                    <div class="sti-card draggable" data-sti="hiv" draggable="true">
                        <div class="sti-name">HIV Acute</div>
                        <div class="sti-symptoms">Flu-like illness, fever, rash, lymphadenopathy.</div>
                    </div>
                </div>

                <!-- Triage Categories with CLEAR Instructions -->
                <div class="case-instruction">
                    <strong>STEP 2:</strong> Now triage the urgency level. Drag STI cards to the appropriate category:
                </div>

                <div class="triage-categories">
                    <div class="triage-category urgent" data-category="urgent" id="urgent-category">
                        <div class="triage-title">üö® URGENT CARE NEEDED</div>
                        <div class="triage-description">Requires same-day evaluation & treatment</div>
                        <div class="triage-instruction">(Examples: Gonorrhea with fever, severe pain, systemic symptoms)</div>
                        <div class="triage-content empty"></div>
                    </div>
                    <div class="triage-category routine" data-category="routine" id="routine-category">
                        <div class="triage-title">üìÖ ROUTINE FOLLOW-UP</div>
                        <div class="triage-description">Schedule within 1-2 weeks</div>
                        <div class="triage-instruction">(Examples: Asymptomatic screening, HPV warts, routine follow-up)</div>
                        <div class="triage-content empty"></div>
                    </div>
                </div>

                <!-- Safety Warning -->
                <div class="safety-warning" id="sti-warning" style="display: none;">
                    <div class="warning-icon">‚ö†Ô∏è</div>
                    <div class="warning-content">
                        <div class="warning-title">Untreated STI Risk!</div>
                        <div class="warning-text">
                            Gonorrhea and chlamydia can lead to epididymitis, infertility, and systemic spread if untreated. 
                            Always treat sexual partners and report certain STIs to public health as required by law.
                        </div>
                    </div>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-1">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        STI Triage Complete!
                    </div>
                    <div class="feedback-content">
                        <strong>Correct Diagnosis:</strong> Gonorrhea (purulent discharge + fever + 5-day incubation)<br>
                        <strong>Correct Triage:</strong> URGENT (requires same-day treatment)<br><br>
                        <strong>Clinical Rationale:</strong><br>
                        ‚Ä¢ Purulent discharge + fever suggests gonorrhea (possible disseminated infection risk)<br>
                        ‚Ä¢ Requires NAAT testing and ceftriaxone treatment same-day<br>
                        ‚Ä¢ Partner notification and treatment within 14 days required<br>
                        ‚Ä¢ Report to public health: Gonorrhea is nationally notifiable<br><br>
                        <strong>Other STI Triage Examples:</strong><br>
                        ‚Ä¢ <strong>Urgent:</strong> Gonorrhea with fever, severe epididymitis, suspected disseminated infection<br>
                        ‚Ä¢ <strong>Routine:</strong> Asymptomatic chlamydia, HPV warts, routine screening<br>
                        ‚Ä¢ <strong>HIV exposure:</strong> Requires PEP consideration within 72 hours<br><br>
                        <strong>Pro Tip:</strong> Always test for chlamydia concurrently (40% co-infection rate). 
                        Consider HIV/syphilis screening with any new STI diagnosis.
                    </div>
                </div>
            </section>

            <!-- Activity 2: Testicular Self-Exam Education Simulation - RANDOMIZED -->
            <section class="activity-card" id="activity-2" data-activity="2">
                <div class="activity-header">
                    <span class="activity-number">Activity 2</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">Testicular Self-Exam Education Simulation</h3>
                <p class="activity-description">
                    Arrange TSE steps in correct order, identify normal vs abnormal findings, 
                    and build effective patient education scripts for male health counseling.
                </p>

                <div class="case-instruction">
                    <strong>STEP 1:</strong> Arrange the TSE steps in correct order (A-F). Drag steps to the drop area:
                </div>

                <!-- TSE Steps Dropzone -->
                <div class="tse-dropzone empty" id="tse-dropzone"></div>

                <!-- TSE Step Items - RANDOM ORDER -->
                <div class="tse-steps-container" id="tse-steps">
                    <!-- Steps will be randomized by JavaScript -->
                </div>

                <!-- Findings Reveal -->
                <div class="case-instruction" style="margin-top: 20px;">
                    <strong>STEP 2:</strong> Click to reveal normal vs abnormal findings:
                </div>

                <div class="findings-container">
                    <div class="finding-card" data-finding="normal">
                        <div class="finding-title">Click to Reveal: Normal Findings</div>
                        <div class="finding-content">
                            ‚Ä¢ Slight size difference between testicles (normal)<br>
                            ‚Ä¢ Smooth, firm, egg-shaped texture<br>
                            ‚Ä¢ Epididymis feels like a small rope at the back<br>
                            ‚Ä¢ Testicle moves freely in scrotum<br>
                            ‚Ä¢ No pain with gentle pressure<br>
                            <strong>Teaching Point:</strong> Normal asymmetry is common
                        </div>
                    </div>
                    <div class="finding-card" data-finding="abnormal">
                        <div class="finding-title">Click to Reveal: Abnormal Findings</div>
                        <div class="finding-content">
                            ‚Ä¢ Hard, painless lump on testicle (suspicious for cancer)<br>
                            ‚Ä¢ Sudden swelling or heaviness (possible hydrocele)<br>
                            ‚Ä¢ Painful swelling (possible epididymitis or torsion)<br>
                            ‚Ä¢ Change in size, shape, or consistency<br>
                            ‚Ä¢ Veins that feel like "bag of worms" (varicocele)<br>
                            <strong>Action Required:</strong> Any new lump requires medical evaluation
                        </div>
                    </div>
                </div>

                <!-- Patient Education Script Builder - RANDOMIZED -->
                <div class="script-container">
                    <div class="script-title">
                        <span>üó£Ô∏è</span> Patient Education Script Builder
                    </div>
                    
                    <div class="script-instruction">
                        <strong>STEP 3:</strong> Build an effective counseling script for a 19-year-old male patient. 
                        Drag script parts into logical order (1-6):
                    </div>
                    
                    <div class="script-builder" id="script-builder">
                        <!-- Script parts will be randomized by JavaScript -->
                    </div>
                    
                    <div class="script-dropzone empty" id="script-dropzone"></div>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-2">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        TSE Education Complete!
                    </div>
                    <div class="feedback-content">
                        <strong>Correct TSE Sequence:</strong><br>
                        1. Perform exam during or after warm shower when scrotal skin is relaxed (A)<br>
                        2. Examine one testicle at a time using both hands (B)<br>
                        3. Roll testicle gently between thumb and fingers feeling for lumps (C)<br>
                        4. Feel for epididymis (cord-like structure at back) - this is normal (D)<br>
                        5. Compare size, weight, and texture between testicles (E)<br>
                        6. Report any changes, lumps, swelling, or pain to healthcare provider (F)<br><br>
                        
                        <strong>Patient Education Best Practices:</strong><br>
                        ‚Ä¢ <strong>Age-appropriate:</strong> Start education at age 15, reinforce at 18+<br>
                        ‚Ä¢ <strong>Health literacy:</strong> Use simple terms, demonstrate with model<br>
                        ‚Ä¢ <strong>Cultural sensitivity:</strong> Consider privacy, use gender-concordant provider if preferred<br>
                        ‚Ä¢ <strong>Frequency:</strong> Recommend monthly self-exams<br>
                        ‚Ä¢ <strong>Documentation:</strong> Chart education provided, patient understanding, any findings<br><br>
                        
                        <strong>Correct Script Order:</strong><br>
                        1. "Let's talk about testicular self-exams. They're important for early detection."<br>
                        2. "The best time is after a warm shower when the skin is relaxed."<br>
                        3. "Use both hands to gently roll each testicle, feeling for any hard lumps."<br>
                        4. "It's normal for one testicle to be slightly larger or hang lower."<br>
                        5. "If you find anything new, different, or painful, schedule an appointment."<br>
                        6. "Most lumps aren't cancer, but all need evaluation. Early detection saves lives."<br><br>
                        
                        <strong>Pro Tip:</strong> Use the "Check Your Equipment" campaign analogy: "Just like you check your car, check your body monthly."
                    </div>
                </div>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="reset-all-btn">
                <span class="btn-icon">‚Üª</span>
                Reset All Activities
            </button>
            <button class="btn btn-secondary" id="check-answers-btn">
                <span class="btn-icon">‚úì</span>
                Check All Answers
            </button>
            <button class="btn btn-primary" id="view-results-btn">
                <span class="btn-icon">üìä</span>
                View Final Results
            </button>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="results-panel">
            <div class="results-header">
                <h2 class="results-title">Male Reproductive Health Results</h2>
                <div class="score-display" id="final-score">0%</div>
            </div>
            
            <div class="clinical-insights">
                <h3 class="insights-title">
                    <span>ü©∫</span> Clinical Proficiency Insights
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>STI Triage Priority:</strong> Gonorrhea/chlamydia with fever = urgent. 
                        Syphilis chancre = routine follow-up. HIV exposure = immediate PEP consideration within 72 hours.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Co-infection Rates:</strong> 40% gonorrhea/chlamydia co-infection. 
                        Always test for both. Consider HIV/syphilis screening with any new STI diagnosis.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>TSE Education Timing:</strong> Best after warm shower when scrotum relaxed. 
                        Teach from age 15, reinforce at 18. Most testicular cancers occur age 15-35.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Normal vs Abnormal:</strong> Normal: slight asymmetry, smooth texture, 
                        epididymis palpable. Abnormal: hard painless lump, sudden swelling, change in size/texture.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Documentation Standards:</strong> Chart STI exposure date, symptoms onset, 
                        treatment given, partner notification, public health reporting. Document TSE education provided 
                        and patient understanding.</span>
                    </li>
                </ul>
            </div>
            
            <div class="clinical-insights" style="margin-top: 20px;">
                <h3 class="insights-title">
                    <span>üìã</span> Legal, Ethical & Communication Standards
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>HIPAA in Sensitive Cases:</strong> STI diagnoses are protected health information. 
                        Share only with providers involved in care. Partner notification can be anonymous through health department.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Mandatory Reporting:</strong> Gonorrhea, syphilis, chlamydia (in some states), 
                        and HIV are reportable to public health within 24-72 hours depending on jurisdiction.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Cultural Competence:</strong> Consider religious/cultural beliefs about sexuality. 
                        Use non-judgmental language. Provide resources in patient's preferred language.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Patient Education Documentation:</strong> Must include: education provided, 
                        materials given, patient questions, comprehension assessment, and follow-up plan.</span>
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State Management
            const state = {
                activities: {
                    1: { completed: false, correct: 0, total: 7, score: 0 },
                    2: { completed: false, correct: 0, total: 8, score: 0 }
                },
                startedAt: new Date(),
                timeSpent: 0
            };

            // DOM Elements
            const progressSteps = document.querySelectorAll('.progress-step');
            const activityCards = document.querySelectorAll('.activity-card');
            const completedCount = document.getElementById('completed-count');
            const accuracyRate = document.getElementById('accuracy-rate');
            const timeSpent = document.getElementById('time-spent');
            const resetBtn = document.getElementById('reset-all-btn');
            const checkBtn = document.getElementById('check-answers-btn');
            const resultsBtn = document.getElementById('view-results-btn');
            const resultsPanel = document.getElementById('results-panel');
            const finalScore = document.getElementById('final-score');
            const stiWarning = document.getElementById('sti-warning');

            // Timer for time spent
            function updateTimer() {
                const now = new Date();
                const diff = Math.floor((now - state.startedAt) / 1000);
                state.timeSpent = diff;
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                timeSpent.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            setInterval(updateTimer, 1000);

            // Update Progress Summary
            function updateProgressSummary() {
                let completed = 0;
                let totalCorrect = 0;
                let totalItems = 0;

                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) completed++;
                    totalCorrect += activity.correct;
                    totalItems += activity.total;
                });

                completedCount.textContent = completed;
                const accuracy = totalItems > 0 ? Math.round((totalCorrect / totalItems) * 100) : 0;
                accuracyRate.textContent = `${accuracy}%`;

                // Update progress steps
                progressSteps.forEach((step, index) => {
                    if (index < completed) {
                        step.classList.add('completed');
                        step.classList.remove('active');
                    } else if (index === completed) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });
            }

            // Activity 1: STI Identification & Triage - IMPROVED
            function initActivity1() {
                const stiCards = document.querySelectorAll('#activity-1 .sti-card');
                const diagnosisArea = document.getElementById('diagnosis-area');
                const urgentCategory = document.getElementById('urgent-category');
                const routineCategory = document.getElementById('routine-category');
                const urgentContent = urgentCategory.querySelector('.triage-content');
                const routineContent = routineCategory.querySelector('.triage-content');
                const feedback = document.getElementById('feedback-1');
                const status = document.querySelector('#activity-1 .activity-status');

                const correctDiagnosis = 'gonorrhea';
                const urgentSTIs = ['gonorrhea', 'hiv']; // STIs that require urgent care
                const routineSTIs = ['chlamydia', 'syphilis', 'hpv', 'herpes']; // STIs for routine follow-up
                
                let diagnosisPlaced = false;
                let triageCount = 0;
                const totalSTIs = 6;

                // Setup drag and drop for STI cards
                stiCards.forEach(card => {
                    card.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', JSON.stringify({
                            sti: this.dataset.sti,
                            html: this.innerHTML,
                            text: this.textContent
                        }));
                        this.classList.add('dragging');
                    });

                    card.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });

                // Diagnosis Area
                diagnosisArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('hover');
                });

                diagnosisArea.addEventListener('dragleave', function() {
                    this.classList.remove('hover');
                });

                diagnosisArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('hover');
                    
                    if (diagnosisPlaced) return;
                    
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    const isCorrect = data.sti === correctDiagnosis;
                    
                    // Add diagnosis to area
                    const diagnosisDiv = document.createElement('div');
                    diagnosisDiv.className = 'sti-card placed';
                    diagnosisDiv.innerHTML = data.html;
                    diagnosisDiv.style.background = isCorrect ? 
                        'rgba(0, 184, 148, 0.1)' : 'rgba(225, 112, 85, 0.1)';
                    diagnosisDiv.style.border = isCorrect ? 
                        '2px solid var(--color-success)' : '2px solid var(--color-error)';
                    
                    this.innerHTML = '';
                    this.appendChild(diagnosisDiv);
                    this.classList.remove('empty');
                    
                    // Hide the dragged card
                    const draggedCard = document.querySelector(`#activity-1 .sti-card[data-sti="${data.sti}"]`);
                    if (draggedCard) draggedCard.style.display = 'none';
                    
                    diagnosisPlaced = true;
                    state.activities[1].correct += isCorrect ? 1 : 0;
                    
                    // Update instruction
                    document.querySelector('#activity-1 .case-instruction').innerHTML = 
                        '<strong>‚úì STEP 1 COMPLETE</strong> Now triage ALL STIs by urgency (drag remaining cards):';
                    
                    // Enable triage categories for ALL cards
                    enableTriage();
                });

                // Enable triage for all STI cards
                function enableTriage() {
                    // Remove empty class from triage areas
                    urgentContent.classList.remove('empty');
                    routineContent.classList.remove('empty');
                    
                    // Setup triage categories
                    [urgentCategory, routineCategory].forEach(category => {
                        category.addEventListener('dragover', function(e) {
                            e.preventDefault();
                            this.classList.add('hover');
                        });

                        category.addEventListener('dragleave', function() {
                            this.classList.remove('hover');
                        });

                        category.addEventListener('drop', function(e) {
                            e.preventDefault();
                            this.classList.remove('hover');
                            
                            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                            const targetCategory = this.dataset.category;
                            
                            // Check if this STI is already placed somewhere
                            const allTriageAreas = document.querySelectorAll('.triage-content');
                            let alreadyPlaced = false;
                            allTriageAreas.forEach(area => {
                                if (area.textContent.includes(data.text)) {
                                    alreadyPlaced = true;
                                }
                            });
                            
                            if (alreadyPlaced) return;
                            
                            // Determine if placement is correct
                            const isUrgentCorrect = urgentSTIs.includes(data.sti);
                            const isRoutineCorrect = routineSTIs.includes(data.sti);
                            const isCorrect = (targetCategory === 'urgent' && isUrgentCorrect) || 
                                            (targetCategory === 'routine' && isRoutineCorrect);
                            
                            // Add STI to triage category
                            const stiDiv = document.createElement('div');
                            stiDiv.className = 'sti-card placed';
                            stiDiv.innerHTML = data.html;
                            stiDiv.style.background = isCorrect ? 
                                (targetCategory === 'urgent' ? 'rgba(225, 112, 85, 0.1)' : 'rgba(253, 203, 110, 0.1)') : 
                                'rgba(225, 112, 85, 0.2)';
                            stiDiv.style.border = isCorrect ? 
                                (targetCategory === 'urgent' ? '2px solid var(--color-error)' : '2px solid var(--color-warning)') : 
                                '2px solid var(--color-error)';
                            stiDiv.style.margin = '5px 0';
                            stiDiv.style.padding = '10px';
                            
                            this.querySelector('.triage-content').appendChild(stiDiv);
                            
                            // Hide the dragged card
                            const draggedCard = document.querySelector(`#activity-1 .sti-card[data-sti="${data.sti}"]`);
                            if (draggedCard) draggedCard.style.display = 'none';
                            
                            triageCount++;
                            state.activities[1].correct += isCorrect ? 1 : 0;
                            
                            // Check completion
                            if (triageCount === totalSTIs - 1) { // -1 because diagnosis already placed
                                state.activities[1].completed = true;
                                state.activities[1].score = Math.round((state.activities[1].correct / 7) * 100);
                                
                                status.textContent = 'Completed';
                                status.style.color = '#00b894';
                                document.querySelector('#activity-1').classList.add('completed');
                                feedback.classList.add('show');
                                
                                if (state.activities[1].correct < 6) {
                                    stiWarning.style.display = 'flex';
                                }
                                
                                updateProgressSummary();
                            }
                        });
                    });
                }
            }

            // Activity 2: Testicular Self-Exam Education - RANDOMIZED
            function initActivity2() {
                const tseStepsContainer = document.getElementById('tse-steps');
                const tseDropzone = document.getElementById('tse-dropzone');
                const scriptBuilder = document.getElementById('script-builder');
                const scriptDropzone = document.getElementById('script-dropzone');
                const findingCards = document.querySelectorAll('#activity-2 .finding-card');
                const feedback = document.getElementById('feedback-2');
                const status = document.querySelector('#activity-2 .activity-status');

                // Correct orders
                const correctTSEOrder = [
                    { step: '1', letter: '?', text: 'Perform exam during or after warm shower when scrotal skin is relaxed' },
                    { step: '2', letter: '?', text: 'Examine one testicle at a time using both hands' },
                    { step: '3', letter: '?', text: 'Roll testicle gently between thumb and fingers feeling for lumps' },
                    { step: '4', letter: '?', text: 'Feel for epididymis (cord-like structure at back) - this is normal' },
                    { step: '5', letter: '?', text: 'Compare size, weight, and texture between testicles' },
                    { step: '6', letter: '>', text: 'Report any changes, lumps, swelling, or pain to healthcare provider' }
                ];

                const correctScriptOrder = [
                    { part: '1', text: '"Let\'s talk about testicular self-exams. They\'re important for early detection."' },
                    { part: '2', text: '"The best time is after a warm shower when the skin is relaxed."' },
                    { part: '3', text: '"Use both hands to gently roll each testicle, feeling for any hard lumps."' },
                    { part: '4', text: '"It\'s normal for one testicle to be slightly larger or hang lower."' },
                    { part: '5', text: '"If you find anything new, different, or painful, schedule an appointment."' },
                    { part: '6', text: '"Most lumps aren\'t cancer, but all need evaluation. Early detection saves lives."' }
                ];

                // Randomize TSE steps
                const shuffledTSESteps = [...correctTSEOrder].sort(() => Math.random() - 0.5);
                
                // Create TSE step elements with randomized order
                shuffledTSESteps.forEach(step => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = 'tse-step-item draggable';
                    stepDiv.dataset.step = step.step;
                    stepDiv.dataset.letter = step.letter;
                    stepDiv.draggable = true;
                    stepDiv.innerHTML = `
                        <div class="tse-step-letter">${step.letter}</div>
                        <div class="tse-step-text">${step.text}</div>
                    `;
                    tseStepsContainer.appendChild(stepDiv);
                });

                // Randomize script parts
                const shuffledScriptParts = [...correctScriptOrder].sort(() => Math.random() - 0.5);
                
                // Create script part elements with randomized order
                shuffledScriptParts.forEach(part => {
                    const partDiv = document.createElement('div');
                    partDiv.className = 'script-part draggable';
                    partDiv.dataset.part = part.part;
                    partDiv.draggable = true;
                    partDiv.innerHTML = `
                        <div class="script-letter">${part.part}</div>
                        <div>${part.text}</div>
                    `;
                    scriptBuilder.appendChild(partDiv);
                });

                let placedTSESteps = [];
                let placedScriptParts = [];
                let findingsRevealed = 0;

                // TSE Steps Drag and Drop
                document.querySelectorAll('#activity-2 .tse-step-item').forEach(step => {
                    step.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', JSON.stringify({
                            step: this.dataset.step,
                            letter: this.dataset.letter,
                            html: this.innerHTML
                        }));
                        this.classList.add('dragging');
                    });

                    step.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });

                tseDropzone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('hover');
                    this.classList.remove('empty');
                });

                tseDropzone.addEventListener('dragleave', function() {
                    this.classList.remove('hover');
                });

                tseDropzone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('hover');
                    
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    
                    if (!placedTSESteps.includes(data.step)) {
                        placedTSESteps.push(data.step);
                        
                        const stepDiv = document.createElement('div');
                        stepDiv.className = 'tse-step-item placed';
                        stepDiv.innerHTML = data.html;
                        this.appendChild(stepDiv);
                        
                        // Hide original step
                        const originalStep = document.querySelector(`#activity-2 .tse-step-item[data-step="${data.step}"]`);
                        if (originalStep) originalStep.style.display = 'none';
                        
                        // Check TSE completion
                        if (placedTSESteps.length === 6) {
                            // Check if order is correct
                            const correctOrder = ['1', '2', '3', '4', '5', '6'];
                            const isCorrect = JSON.stringify(placedTSESteps) === JSON.stringify(correctOrder);
                            state.activities[2].correct += isCorrect ? 6 : 3;
                            checkActivity2Completion();
                        }
                    }
                });

                // Findings Reveal
                findingCards.forEach(card => {
                    card.addEventListener('click', function() {
                        if (this.classList.contains('revealed')) return;
                        
                        this.classList.add('revealed');
                        findingsRevealed++;
                        state.activities[2].correct += 1;
                        
                        if (findingsRevealed === 2) {
                            checkActivity2Completion();
                        }
                    });
                });

                // Script Builder Drag and Drop
                document.querySelectorAll('#activity-2 .script-part').forEach(part => {
                    part.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', JSON.stringify({
                            part: this.dataset.part,
                            html: this.innerHTML
                        }));
                        this.classList.add('dragging');
                    });

                    part.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });

                scriptDropzone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('hover');
                    this.classList.remove('empty');
                });

                scriptDropzone.addEventListener('dragleave', function() {
                    this.classList.remove('hover');
                });

                scriptDropzone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('hover');
                    
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    
                    if (!placedScriptParts.includes(data.part)) {
                        placedScriptParts.push(data.part);
                        
                        const partDiv = document.createElement('div');
                        partDiv.className = 'script-part placed';
                        partDiv.innerHTML = data.html;
                        this.appendChild(partDiv);
                        
                        // Hide original part
                        const originalPart = document.querySelector(`#activity-2 .script-part[data-part="${data.part}"]`);
                        if (originalPart) originalPart.style.display = 'none';
                        
                        // Check script completion
                        if (placedScriptParts.length === 6) {
                            // Check if order is correct
                            const correctOrder = ['1', '2', '3', '4', '5', '6'];
                            const isCorrect = JSON.stringify(placedScriptParts) === JSON.stringify(correctOrder);
                            state.activities[2].correct += isCorrect ? 6 : 3;
                            checkActivity2Completion();
                        }
                    }
                });

                function checkActivity2Completion() {
                    if (placedTSESteps.length === 6 && findingsRevealed === 2 && placedScriptParts.length === 6) {
                        state.activities[2].completed = true;
                        state.activities[2].score = Math.round((state.activities[2].correct / 8) * 100);
                        
                        status.textContent = 'Completed';
                        status.style.color = '#00b894';
                        document.querySelector('#activity-2').classList.add('completed');
                        feedback.classList.add('show');
                        
                        updateProgressSummary();
                    }
                }
            }

            // Reset All Activities
            function resetAllActivities() {
                // Reset state
                state.activities = {
                    1: { completed: false, correct: 0, total: 7, score: 0 },
                    2: { completed: false, correct: 0, total: 8, score: 0 }
                };

                // Reset UI
                activityCards.forEach(card => {
                    card.classList.remove('completed');
                    const status = card.querySelector('.activity-status');
                    status.textContent = 'Not Started';
                    status.style.color = '';
                    const feedback = card.querySelector('.feedback-container');
                    feedback.classList.remove('show');
                });

                // Reset Activity 1
                const diagnosisArea = document.getElementById('diagnosis-area');
                diagnosisArea.innerHTML = '';
                diagnosisArea.classList.add('empty');
                diagnosisArea.classList.remove('hover');
                
                document.querySelectorAll('#activity-1 .sti-card').forEach(card => {
                    card.style.display = '';
                });
                
                document.querySelectorAll('#activity-1 .triage-content').forEach(content => {
                    content.innerHTML = '';
                    content.classList.add('empty');
                });
                
                document.querySelector('#activity-1 .case-instruction').innerHTML = 
                    '<strong>STEP 1:</strong> Drag the most likely STI diagnosis to the drop area below:';
                
                stiWarning.style.display = 'none';

                // Reset Activity 2
                const tseDropzone = document.getElementById('tse-dropzone');
                tseDropzone.innerHTML = '';
                tseDropzone.classList.add('empty');
                
                // Recreate TSE steps with new random order
                const tseStepsContainer = document.getElementById('tse-steps');
                tseStepsContainer.innerHTML = '';
                
                const correctTSEOrder = [
                    { step: '1', letter: 'A', text: 'Perform exam during or after warm shower when scrotal skin is relaxed' },
                    { step: '2', letter: 'B', text: 'Examine one testicle at a time using both hands' },
                    { step: '3', letter: 'C', text: 'Roll testicle gently between thumb and fingers feeling for lumps' },
                    { step: '4', letter: 'D', text: 'Feel for epididymis (cord-like structure at back) - this is normal' },
                    { step: '5', letter: 'E', text: 'Compare size, weight, and texture between testicles' },
                    { step: '6', letter: 'F', text: 'Report any changes, lumps, swelling, or pain to healthcare provider' }
                ];
                
                const shuffledTSESteps = [...correctTSEOrder].sort(() => Math.random() - 0.5);
                shuffledTSESteps.forEach(step => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = 'tse-step-item draggable';
                    stepDiv.dataset.step = step.step;
                    stepDiv.dataset.letter = step.letter;
                    stepDiv.draggable = true;
                    stepDiv.innerHTML = `
                        <div class="tse-step-letter">${step.letter}</div>
                        <div class="tse-step-text">${step.text}</div>
                    `;
                    tseStepsContainer.appendChild(stepDiv);
                });
                
                document.querySelectorAll('#activity-2 .finding-card').forEach(card => {
                    card.classList.remove('revealed');
                });
                
                const scriptDropzone = document.getElementById('script-dropzone');
                scriptDropzone.innerHTML = '';
                scriptDropzone.classList.add('empty');
                
                // Recreate script parts with new random order
                const scriptBuilder = document.getElementById('script-builder');
                scriptBuilder.innerHTML = '';
                
                const correctScriptOrder = [
                    { part: '1', text: '"Let\'s talk about testicular self-exams. They\'re important for early detection."' },
                    { part: '2', text: '"The best time is after a warm shower when the skin is relaxed."' },
                    { part: '3', text: '"Use both hands to gently roll each testicle, feeling for any hard lumps."' },
                    { part: '4', text: '"It\'s normal for one testicle to be slightly larger or hang lower."' },
                    { part: '5', text: '"If you find anything new, different, or painful, schedule an appointment."' },
                    { part: '6', text: '"Most lumps aren\'t cancer, but all need evaluation. Early detection saves lives."' }
                ];
                
                const shuffledScriptParts = [...correctScriptOrder].sort(() => Math.random() - 0.5);
                shuffledScriptParts.forEach(part => {
                    const partDiv = document.createElement('div');
                    partDiv.className = 'script-part draggable';
                    partDiv.dataset.part = part.part;
                    partDiv.draggable = true;
                    partDiv.innerHTML = `
                        <div class="script-letter">${part.part}</div>
                        <div>${part.text}</div>
                    `;
                    scriptBuilder.appendChild(partDiv);
                });
                
                // Reinitialize drag and drop for Activity 2
                setTimeout(() => {
                    initActivity2Components();
                }, 100);

                // Reset results
                resultsPanel.classList.remove('show');

                updateProgressSummary();
            }

            // Reinitialize Activity 2 components after reset
            function initActivity2Components() {
                const tseSteps = document.querySelectorAll('#activity-2 .tse-step-item');
                const tseDropzone = document.getElementById('tse-dropzone');
                const scriptParts = document.querySelectorAll('#activity-2 .script-part');
                const scriptDropzone = document.getElementById('script-dropzone');
                const findingCards = document.querySelectorAll('#activity-2 .finding-card');
                
                let placedTSESteps = [];
                let placedScriptParts = [];
                let findingsRevealed = 0;

                // TSE Steps
                tseSteps.forEach(step => {
                    step.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', JSON.stringify({
                            step: this.dataset.step,
                            letter: this.dataset.letter,
                            html: this.innerHTML
                        }));
                        this.classList.add('dragging');
                    });

                    step.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });

                tseDropzone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('hover');
                    this.classList.remove('empty');
                });

                tseDropzone.addEventListener('dragleave', function() {
                    this.classList.remove('hover');
                });

                tseDropzone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('hover');
                    
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    
                    if (!placedTSESteps.includes(data.step)) {
                        placedTSESteps.push(data.step);
                        
                        const stepDiv = document.createElement('div');
                        stepDiv.className = 'tse-step-item placed';
                        stepDiv.innerHTML = data.html;
                        this.appendChild(stepDiv);
                        
                        const originalStep = document.querySelector(`#activity-2 .tse-step-item[data-step="${data.step}"]`);
                        if (originalStep) originalStep.style.display = 'none';
                        
                        if (placedTSESteps.length === 6) {
                            const correctOrder = ['1', '2', '3', '4', '5', '6'];
                            const isCorrect = JSON.stringify(placedTSESteps) === JSON.stringify(correctOrder);
                            state.activities[2].correct += isCorrect ? 6 : 3;
                            checkActivity2CompletionAfterReset();
                        }
                    }
                });

                // Findings
                findingCards.forEach(card => {
                    card.addEventListener('click', function() {
                        if (this.classList.contains('revealed')) return;
                        
                        this.classList.add('revealed');
                        findingsRevealed++;
                        state.activities[2].correct += 1;
                        
                        if (findingsRevealed === 2) {
                            checkActivity2CompletionAfterReset();
                        }
                    });
                });

                // Script Parts
                scriptParts.forEach(part => {
                    part.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', JSON.stringify({
                            part: this.dataset.part,
                            html: this.innerHTML
                        }));
                        this.classList.add('dragging');
                    });

                    part.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });

                scriptDropzone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('hover');
                    this.classList.remove('empty');
                });

                scriptDropzone.addEventListener('dragleave', function() {
                    this.classList.remove('hover');
                });

                scriptDropzone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('hover');
                    
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    
                    if (!placedScriptParts.includes(data.part)) {
                        placedScriptParts.push(data.part);
                        
                        const partDiv = document.createElement('div');
                        partDiv.className = 'script-part placed';
                        partDiv.innerHTML = data.html;
                        this.appendChild(partDiv);
                        
                        const originalPart = document.querySelector(`#activity-2 .script-part[data-part="${data.part}"]`);
                        if (originalPart) originalPart.style.display = 'none';
                        
                        if (placedScriptParts.length === 6) {
                            const correctOrder = ['1', '2', '3', '4', '5', '6'];
                            const isCorrect = JSON.stringify(placedScriptParts) === JSON.stringify(correctOrder);
                            state.activities[2].correct += isCorrect ? 6 : 3;
                            checkActivity2CompletionAfterReset();
                        }
                    }
                });

                function checkActivity2CompletionAfterReset() {
                    if (placedTSESteps.length === 6 && findingsRevealed === 2 && placedScriptParts.length === 6) {
                        state.activities[2].completed = true;
                        state.activities[2].score = Math.round((state.activities[2].correct / 8) * 100);
                        
                        const status = document.querySelector('#activity-2 .activity-status');
                        status.textContent = 'Completed';
                        status.style.color = '#00b894';
                        document.querySelector('#activity-2').classList.add('completed');
                        document.getElementById('feedback-2').classList.add('show');
                        
                        updateProgressSummary();
                    }
                }
            }

            // Check All Answers
            function checkAllAnswers() {
                // Activity 1
                if (!state.activities[1].completed) {
                    const feedback = document.getElementById('feedback-1');
                    const status = document.querySelector('#activity-1 .activity-status');
                    
                    // Simulate correct answers
                    state.activities[1].completed = true;
                    state.activities[1].correct = 7;
                    state.activities[1].score = 100;
                    
                    status.textContent = 'Completed';
                    status.style.color = '#00b894';
                    document.querySelector('#activity-1').classList.add('completed');
                    feedback.classList.add('show');
                }

                // Activity 2
                if (!state.activities[2].completed) {
                    const feedback = document.getElementById('feedback-2');
                    const status = document.querySelector('#activity-2 .activity-status');
                    
                    // Simulate correct answers
                    state.activities[2].completed = true;
                    state.activities[2].correct = 8;
                    state.activities[2].score = 100;
                    
                    status.textContent = 'Completed';
                    status.style.color = '#00b894';
                    document.querySelector('#activity-2').classList.add('completed');
                    feedback.classList.add('show');
                }

                updateProgressSummary();
            }

            // View Final Results
            function viewFinalResults() {
                let totalScore = 0;
                let activityCount = 0;
                
                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) {
                        totalScore += activity.score;
                        activityCount++;
                    }
                });

                const averageScore = activityCount > 0 ? Math.round(totalScore / activityCount) : 0;
                finalScore.textContent = `${averageScore}%`;
                resultsPanel.classList.add('show');
                resultsPanel.scrollIntoView({ behavior: 'smooth' });
            }

            // Initialize activities
            initActivity1();
            initActivity2();

            // Event listeners
            resetBtn.addEventListener('click', resetAllActivities);
            checkBtn.addEventListener('click', checkAllAnswers);
            resultsBtn.addEventListener('click', viewFinalResults);

            // Initial progress update
            updateProgressSummary();
        });
    </script>
</body>
</html>
