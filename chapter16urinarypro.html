<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AlliedRx - Chapter 16: Urinary System Disorders & Diagnostic Pathways</title>
    <style>
        /* === CSS VARIABLES (EXACT BRANDING) === */
        :root {
            --color-primary: #af4bef; /* Purple - main brand color */
            --color-primary-soft: #d492ff; /* Light purple */
            --color-accent: #8380f0; /* Blue-purple accent */
            --color-success: #00b894; /* Green for correct/success */
            --color-error: #e17055; /* Red/Orange for errors */
            --color-warning: #fdcb6e; /* Yellow for warnings */
            --color-info: #0984e3; /* Blue for info */
            --color-bg: #f7f5fb; /* Light background */
            --color-text: #2b2b2b; /* Dark text */
            --color-muted: #6c6880; /* Muted text */
            --color-dark: #0c0a18; /* Dark background */
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --shadow-soft: 0 18px 45px rgba(23, 10, 61, 0.18);
            --shadow-hover: 0 25px 50px rgba(175, 75, 239, 0.15);
            --shadow-card: 0 12px 30px rgba(15, 23, 42, 0.1);
        }

        /* === REQUIRED ANIMATIONS === */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes checkmarkPop {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* === BASE STYLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top left, #ffffff 0, #f1ecff 40%, var(--color-bg) 100%);
            color: var(--color-text);
            line-height: 1.5;
            padding: 24px;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
        }

        @media (max-width: 600px) {
            body {
                padding: 12px;
            }
        }

        .page {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 28px 30px 32px;
            animation: fadeInUp 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }

        @media (max-width: 900px) {
            .page {
                padding: 22px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
            }
            .page {
                border-radius: 0;
                box-shadow: none;
                padding: 18px 14px 22px;
            }
        }

        /* === HEADER (EXACT TEMPLATE) === */
        .brand-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 14px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 40px;
            width: auto;
            max-width: 100%;
            filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
        }

        .brand-logo:hover {
            transform: scale(1.05);
        }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--color-muted);
            white-space: normal;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(175, 75, 239, 0.08);
            font-size: 0.76rem;
            color: var(--color-primary);
            white-space: normal;
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-success);
            flex-shrink: 0;
        }

        .badge-mode {
            padding: 5px 10px;
            border-radius: 999px;
            background: rgba(12, 10, 24, 0.06);
            border: 1px solid rgba(12, 10, 24, 0.08);
            font-size: 0.74rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--color-muted);
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .badge-mode:hover {
            background: rgba(175, 75, 239, 0.1);
            border-color: var(--color-primary-soft);
            color: var(--color-primary);
        }

        @media (max-width: 480px) {
            .brand-row {
                flex-direction: column;
                align-items: flex-start;
            }
            .badge-mode {
                margin-top: 6px;
            }
        }

        h1 {
            font-size: clamp(1.8rem, 3vw, 2.2rem);
            line-height: 1.1;
            color: var(--color-primary);
            margin-bottom: 6px;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        .module-subtitle {
            font-size: 0.98rem;
            color: var(--color-muted);
            max-width: 600px;
            margin-bottom: 24px;
            animation: fadeInUp 0.6s ease-out 0.4s both;
        }

        /* === PROGRESS TRACKER (2-STEP ONLY) === */
        .progress-tracker {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            padding: 0 20px;
            max-width: 500px;
        }

        .progress-tracker::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: rgba(12, 10, 24, 0.08);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(12, 10, 24, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-muted);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
            transform: scale(1.1);
        }

        .progress-step.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
            font-weight: 500;
        }

        .progress-step.active .step-label {
            color: var(--color-primary);
            font-weight: 600;
        }

        /* === PROGRESS SUMMARY === */
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease-out 0.5s both;
        }

        .summary-card {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-md);
            padding: 16px;
            border: 1px solid rgba(12, 10, 24, 0.06);
            text-align: center;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-card);
            border-color: var(--color-primary-soft);
        }

        .summary-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--color-primary);
            display: block;
            line-height: 1;
            margin-bottom: 4px;
        }

        .summary-label {
            font-size: 0.8rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* === ACTIVITY GRID (SINGLE COLUMN FOR 2 ACTIVITIES) === */
        .activity-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* === ACTIVITY CARD STRUCTURE (EXACT TEMPLATE) === */
        .activity-card {
            background: white;
            border-radius: var(--radius-md);
            border: 1px solid rgba(12, 10, 24, 0.08);
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--color-primary-soft);
        }

        .activity-card:hover::before {
            opacity: 1;
        }

        .activity-card.completed {
            border-color: var(--color-success);
        }

        .activity-card.completed::before {
            background: var(--color-success);
            opacity: 1;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .activity-number {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--color-primary);
            background: rgba(175, 75, 239, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
        }

        .activity-status {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 12px;
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-muted);
        }

        .activity-card.completed .activity-status {
            background: rgba(0, 184, 148, 0.1);
            color: var(--color-success);
        }

        .activity-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .activity-description {
            font-size: 0.9rem;
            color: var(--color-muted);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* === ACTIVITY 1: URINARY DISORDER SORTING GAME === */
        .sorting-game-container {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .game-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .game-icon {
            font-size: 1.2rem;
        }

        .game-instructions {
            font-size: 0.9rem;
            color: var(--color-text);
            margin-bottom: 20px;
            line-height: 1.5;
            padding: 10px;
            background: rgba(175, 75, 239, 0.05);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--color-primary);
        }

        /* Disorder Columns */
        .disorder-columns {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 1024px) {
            .disorder-columns {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .disorder-columns {
                grid-template-columns: 1fr;
            }
        }

        .disorder-column {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 2px dashed rgba(12, 10, 24, 0.1);
            min-height: 300px;
            transition: all 0.3s ease;
        }

        .disorder-column.hover {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .disorder-column.filled {
            border: 2px solid var(--color-primary-soft);
            background: rgba(175, 75, 239, 0.08);
        }

        .column-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(12, 10, 24, 0.1);
        }

        .disorder-name {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 5px;
        }

        .disorder-subtitle {
            font-size: 0.75rem;
            color: var(--color-muted);
        }

        .column-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* Symptom Cards */
        .symptom-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .symptom-card {
            background: rgba(12, 10, 24, 0.05);
            border-radius: var(--radius-sm);
            padding: 12px 15px;
            font-size: 0.85rem;
            cursor: grab;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            user-select: none;
            min-width: 150px;
            text-align: center;
        }

        .symptom-card:hover {
            background: rgba(175, 75, 239, 0.1);
            border-color: var(--color-primary-soft);
            transform: translateY(-2px);
        }

        .symptom-card.dragging {
            opacity: 0.7;
            transform: scale(0.95);
        }

        .symptom-card.used {
            opacity: 0.5;
            cursor: default;
            text-decoration: line-through;
        }

        /* Disorder Cards */
        .disorder-card {
            background: rgba(12, 10, 24, 0.03);
            border-radius: var(--radius-sm);
            padding: 10px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .disorder-card.correct {
            background: rgba(0, 184, 148, 0.1);
            border-color: var(--color-success);
        }

        .disorder-card.incorrect {
            background: rgba(225, 112, 85, 0.1);
            border-color: var(--color-error);
            animation: shake 0.5s ease;
        }

        /* === ACTIVITY 2: DIAGNOSTIC PROCEDURE MATCHING === */
        .diagnostic-matching-container {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .matching-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .matching-grid {
                grid-template-columns: 1fr;
            }
        }

        .matching-card {
            background: rgba(12, 10, 24, 0.03);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 2px dashed rgba(12, 10, 24, 0.1);
            min-height: 120px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .matching-card.hover {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .matching-card.matched {
            border: 2px solid var(--color-success);
            background: rgba(0, 184, 148, 0.1);
        }

        .matching-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 10px;
            text-align: center;
        }

        .matching-content {
            font-size: 0.85rem;
            color: var(--color-text);
            text-align: center;
            line-height: 1.4;
        }

        /* Procedure Items */
        .procedure-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .procedure-item {
            background: rgba(12, 10, 24, 0.05);
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.85rem;
            cursor: grab;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            user-select: none;
        }

        .procedure-item:hover {
            background: rgba(175, 75, 239, 0.1);
            border-color: var(--color-primary-soft);
            transform: translateY(-2px);
        }

        .procedure-item.dragging {
            opacity: 0.7;
            transform: scale(0.95);
        }

        .procedure-item.used {
            opacity: 0.5;
            cursor: default;
            text-decoration: line-through;
        }

        /* Clinical Case */
        .clinical-case {
            background: rgba(0, 184, 148, 0.08);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid var(--color-success);
        }

        .case-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-success);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .case-text {
            font-size: 0.85rem;
            color: var(--color-text);
            line-height: 1.5;
        }

        /* === FEEDBACK CONTAINER === */
        .feedback-container {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            margin-top: 20px;
            display: none;
        }

        .feedback-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .feedback-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feedback-icon {
            font-size: 1.2rem;
        }

        .feedback-icon.correct {
            color: var(--color-success);
        }

        .feedback-icon.incorrect {
            color: var(--color-error);
        }

        .feedback-content {
            font-size: 0.85rem;
            color: var(--color-text);
            line-height: 1.5;
        }

        .feedback-content strong {
            color: var(--color-primary);
        }

        /* === ACTION BUTTONS === */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #9a3bd6;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(175, 75, 239, 0.3);
        }

        .btn-secondary {
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(12, 10, 24, 0.1);
            transform: translateY(-2px);
        }

        .btn-icon {
            font-size: 1.1em;
        }

        /* === RESULTS PANEL === */
        .results-panel {
            background: var(--color-dark);
            color: white;
            border-radius: var(--radius-md);
            padding: 30px;
            margin-top: 30px;
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .results-panel.show {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
        }

        .score-display {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--color-primary-soft);
            text-align: center;
            margin: 20px 0;
        }

        .clinical-insights {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-top: 20px;
        }

        .insights-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-primary-soft);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insights-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .insights-list li {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            font-size: 0.9rem;
            color: #e5e7eb;
        }

        .insight-dot {
            width: 6px;
            height: 6px;
            margin-top: 6px;
            border-radius: 999px;
            background: var(--color-accent);
            flex-shrink: 0;
        }

        /* === ACCESSIBILITY === */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- HEADER WITH WEEK/CHAPTER (EXACT TEMPLATE) -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://cdn.prod.website-files.com/64d0ccc1558d601cbfb09021/64e9d2f719b1e5258e5d57f5_IMG_1512-p-500.png"
                    alt="AlliedRx logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">Clinical Medical Assistant â€¢ Week 8</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Chapter 16: Urology & Male Reproduction</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Campus & Online</span>
        </header>

        <h1 id="module-heading">Urinary System Disorders & Diagnostic Pathways</h1>
        <p class="module-subtitle">
            Identify and categorize urologic disorders by symptoms and match clinical presentations 
            with appropriate diagnostic procedures and treatment approaches.
        </p>

        <!-- PROGRESS TRACKER (2-STEP ONLY) -->
        <div class="progress-tracker">
            <div class="progress-step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">Disorder Sorting</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Diagnostic Matching</div>
            </div>
        </div>

        <!-- PROGRESS SUMMARY -->
        <div class="progress-summary">
            <div class="summary-card">
                <span class="summary-number" id="completed-count">0</span>
                <span class="summary-label">Activities Completed</span>
            </div>
            <div class="summary-card">
                <span class="summary-number" id="accuracy-rate">0%</span>
                <span class="summary-label">Current Accuracy</span>
            </div>
            <div class="summary-card">
                <span class="summary-number" id="time-spent">0:00</span>
                <span class="summary-label">Time Spent</span>
            </div>
        </div>

        <!-- ACTIVITY GRID (2 ACTIVITIES) -->
        <div class="activity-grid">
            <!-- ACTIVITY 1: URINARY DISORDER SORTING GAME -->
            <section class="activity-card" id="activity-1" data-activity="1" aria-label="Activity 1: Urinary Disorder Sorting Game">
                <div class="activity-header">
                    <span class="activity-number">Activity 1</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">
                    <span class="activity-icon">ðŸŽ¯</span>
                    Urinary Disorder Symptom Sorting
                </h3>
                <p class="activity-description">
                    Drag symptoms to their correct urologic disorder categories. Learn to differentiate 
                    between UTIs, kidney stones, BPH, and renal failure based on clinical presentation.
                </p>

                <div class="sorting-game-container">
                    <div class="game-title">
                        <span class="game-icon">ðŸ”„</span>
                        Sort Symptoms to Correct Disorders
                    </div>
                    
                    <div class="game-instructions">
                        <strong>Instructions:</strong> Drag each symptom card to the disorder column where it most commonly belongs. 
                        Some symptoms may appear in multiple disorders, but place them where they are <em>most characteristic</em>.
                    </div>

                    <!-- Disorder Columns -->
                    <div class="disorder-columns">
                        <div class="disorder-column" id="column-uti" data-disorder="uti">
                            <div class="column-header">
                                <div class="disorder-name">UTI/Cystitis</div>
                                <div class="disorder-subtitle">Urinary Tract Infection</div>
                            </div>
                            <div class="column-content" id="uti-content"></div>
                        </div>
                        
                        <div class="disorder-column" id="column-stones" data-disorder="stones">
                            <div class="column-header">
                                <div class="disorder-name">Nephrolithiasis</div>
                                <div class="disorder-subtitle">Kidney Stones</div>
                            </div>
                            <div class="column-content" id="stones-content"></div>
                        </div>
                        
                        <div class="disorder-column" id="column-bph" data-disorder="bph">
                            <div class="column-header">
                                <div class="disorder-name">BPH</div>
                                <div class="disorder-subtitle">Benign Prostatic Hyperplasia</div>
                            </div>
                            <div class="column-content" id="bph-content"></div>
                        </div>
                        
                        <div class="disorder-column" id="column-renal" data-disorder="renal">
                            <div class="column-header">
                                <div class="disorder-name">Renal Failure</div>
                                <div class="disorder-subtitle">Acute/Chronic Kidney Disease</div>
                            </div>
                            <div class="column-content" id="renal-content"></div>
                        </div>
                    </div>

                    <!-- Symptom Cards -->
                    <div class="symptom-bank" id="symptom-bank">
                        <div class="symptom-card draggable" data-disorders="uti" draggable="true">Dysuria (painful urination)</div>
                        <div class="symptom-card draggable" data-disorders="uti" draggable="true">Urinary frequency & urgency</div>
                        <div class="symptom-card draggable" data-disorders="uti,stones" draggable="true">Hematuria (blood in urine)</div>
                        <div class="symptom-card draggable" data-disorders="uti" draggable="true">Cloudy or foul-smelling urine</div>
                        <div class="symptom-card draggable" data-disorders="uti" draggable="true">Suprapubic pain or pressure</div>
                        
                        <div class="symptom-card draggable" data-disorders="stones" draggable="true">Severe flank pain radiating to groin</div>
                        <div class="symptom-card draggable" data-disorders="stones" draggable="true">"Worst pain of my life" description</div>
                        <div class="symptom-card draggable" data-disorders="stones" draggable="true">Nausea and vomiting with pain</div>
                        <div class="symptom-card draggable" data-disorders="stones" draggable="true">Pain that comes in waves (colic)</div>
                        <div class="symptom-card draggable" data-disorders="stones" draggable="true">Restlessness, cannot find comfortable position</div>
                        
                        <div class="symptom-card draggable" data-disorders="bph" draggable="true">Hesitancy (difficulty starting stream)</div>
                        <div class="symptom-card draggable" data-disorders="bph" draggable="true">Weak urinary stream</div>
                        <div class="symptom-card draggable" data-disorders="bph" draggable="true">Nocturia (waking to urinate >2x/night)</div>
                        <div class="symptom-card draggable" data-disorders="bph" draggable="true">Incomplete bladder emptying</div>
                        <div class="symptom-card draggable" data-disorders="bph" draggable="true">Dribbling after urination</div>
                        
                        <div class="symptom-card draggable" data-disorders="renal" draggable="true">Fatigue and weakness</div>
                        <div class="symptom-card draggable" data-disorders="renal" draggable="true">Nausea and decreased appetite</div>
                        <div class="symptom-card draggable" data-disorders="renal" draggable="true">Peripheral edema (swelling in legs)</div>
                        <div class="symptom-card draggable" data-disorders="renal" draggable="true">Decreased urine output (oliguria)</div>
                        <div class="symptom-card draggable" data-disorders="renal" draggable="true">Confusion or altered mental status</div>
                    </div>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-1">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">âœ“</span>
                        Symptom Sorting Complete!
                    </div>
                    <div class="feedback-content">
                        <strong>Key Symptom Patterns for Urologic Disorders:</strong><br><br>
                        
                        1. <strong>UTI/Cystitis (Lower Urinary Tract Infection):</strong><br>
                        â€¢ <em>Classic Triad:</em> Dysuria, frequency, urgency<br>
                        â€¢ <em>Additional:</em> Suprapubic pain, cloudy/foul urine, hematuria (may be microscopic)<br>
                        â€¢ <em>Differentiating:</em> No fever, no flank pain (if fever/CVA tenderness â†’ pyelonephritis)<br>
                        â€¢ <em>Risk Factors:</em> Female anatomy, sexual activity, diaphragm/spermicide use, diabetes<br><br>
                        
                        2. <strong>Nephrolithiasis (Kidney Stones):</strong><br>
                        â€¢ <em>Classic:</em> "Worst pain of life" - severe, colicky flank pain radiating to groin<br>
                        â€¢ <em>Associated:</em> Nausea/vomiting, restlessness, hematuria (gross or microscopic)<br>
                        â€¢ <em>Stone Locations:</em> Renal colic (kidneyâ†’ureter), ureteral colic (stone moving)<br>
                        â€¢ <em>Types:</em> Calcium oxalate (80%), struvite (infection stones), uric acid, cystine<br><br>
                        
                        3. <strong>BPH (Benign Prostatic Hyperplasia):</strong><br>
                        â€¢ <em>Voiding Symptoms:</em> Hesitancy, weak stream, straining, incomplete emptying<br>
                        â€¢ <em>Storage Symptoms:</em> Frequency, urgency, nocturia<br>
                        â€¢ <em>Complications:</em> Urinary retention, UTIs, bladder stones, renal damage<br>
                        â€¢ <em>Evaluation:</em> IPSS questionnaire, DRE, PSA, uroflowmetry, post-void residual<br><br>
                        
                        4. <strong>Renal Failure (Acute/Chronic):</strong><br>
                        â€¢ <em>Systemic Symptoms:</em> Fatigue, nausea, pruritus (itching), metallic taste<br>
                        â€¢ <em>Fluid/Electrolyte:</em> Edema, hypertension, hyperkalemia, metabolic acidosis<br>
                        â€¢ <em>Urinary:</em> Oliguria (acute) or polyuria (chronic), proteinuria, casts<br>
                        â€¢ <em>Causes:</em> Prerenal (hypovolemia), intrarenal (glomerular/tubular), postrenal (obstruction)<br><br>
                        
                        <strong>Critical Differentiation:</strong> Always assess for fever (infection), pain characteristics 
                        (colicky vs constant), and systemic symptoms. A patient with dysuria + fever + flank pain = 
                        pyelonephritis (upper UTI), not simple cystitis.
                    </div>
                </div>
            </section>

            <!-- ACTIVITY 2: DIAGNOSTIC PROCEDURE MATCHING -->
            <section class="activity-card" id="activity-2" data-activity="2" aria-label="Activity 2: Diagnostic Procedure Matching">
                <div class="activity-header">
                    <span class="activity-number">Activity 2</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">
                    <span class="activity-icon">ðŸ”¬</span>
                    Diagnostic Procedure Matching
                </h3>
                <p class="activity-description">
                    Match clinical presentations with appropriate diagnostic tests and procedures. 
                    Understand when to use imaging, lab tests, and specialized urologic evaluations.
                </p>

                <div class="diagnostic-matching-container">
                    <div class="game-title">
                        <span class="game-icon">ðŸ©º</span>
                        Match Cases with Diagnostic Approaches
                    </div>

                    <!-- Matching Grid -->
                    <div class="matching-grid">
                        <!-- Case 1 -->
                        <div class="matching-card" id="case-1" data-case="uti-case">
                            <div class="matching-title">Case 1: Suspected UTI</div>
                            <div class="matching-content">
                                25-year-old female with dysuria, frequency, urgency for 2 days. 
                                No fever or flank pain. Sexually active, uses spermicide.
                            </div>
                        </div>
                        
                        <div class="matching-card" id="procedure-1" data-procedure="ua-culture">
                            <div class="matching-title">Drop Diagnostic Procedure Here</div>
                            <div class="matching-content" id="case-1-content"></div>
                        </div>
                        
                        <!-- Case 2 -->
                        <div class="matching-card" id="case-2" data-case="stones-case">
                            <div class="matching-title">Case 2: Possible Kidney Stone</div>
                            <div class="matching-content">
                                45-year-old male with sudden onset severe right flank pain radiating to groin. 
                                Nausea, vomiting, gross hematuria. Previous stone history.
                            </div>
                        </div>
                        
                        <div class="matching-card" id="procedure-2" data-procedure="ct-kub">
                            <div class="matching-title">Drop Diagnostic Procedure Here</div>
                            <div class="matching-content" id="case-2-content"></div>
                        </div>
                        
                        <!-- Case 3 -->
                        <div class="matching-card" id="case-3" data-case="bph-case">
                            <div class="matching-title">Case 3: BPH Evaluation</div>
                            <div class="matching-content">
                                68-year-old male with 6-month history of hesitancy, weak stream, nocturia x3. 
                                No dysuria or fever. Wants evaluation for "enlarged prostate."
                            </div>
                        </div>
                        
                        <div class="matching-card" id="procedure-3" data-procedure="psa-dre">
                            <div class="matching-title">Drop Diagnostic Procedure Here</div>
                            <div class="matching-content" id="case-3-content"></div>
                        </div>
                        
                        <!-- Case 4 -->
                        <div class="matching-card" id="case-4" data-case="renal-case">
                            <div class="matching-title">Case 4: Renal Function Assessment</div>
                            <div class="matching-content">
                                72-year-old with diabetes, HTN. Fatigue, edema, decreased urine output. 
                                Routine labs show elevated creatinine. Needs kidney function evaluation.
                            </div>
                        </div>
                        
                        <div class="matching-card" id="procedure-4" data-procedure="renal-function">
                            <div class="matching-title">Drop Diagnostic Procedure Here</div>
                            <div class="matching-content" id="case-4-content"></div>
                        </div>
                    </div>

                    <!-- Procedure Items -->
                    <div class="procedure-bank" id="procedure-bank">
                        <div class="procedure-item draggable" data-procedure="ua-culture" draggable="true">
                            Urinalysis & Culture/Sensitivity
                        </div>
                        <div class="procedure-item draggable" data-procedure="ct-kub" draggable="true">
                            Non-contrast CT Scan (Kidney-Ureter-Bladder)
                        </div>
                        <div class="procedure-item draggable" data-procedure="psa-dre" draggable="true">
                            PSA Test & Digital Rectal Exam (DRE)
                        </div>
                        <div class="procedure-item draggable" data-procedure="renal-function" draggable="true">
                            Renal Function Panel (BUN, Creatinine, GFR)
                        </div>
                        <div class="procedure-item draggable" data-procedure="ua-culture" draggable="true">
                            Urine Dipstick & Microscopic Analysis
                        </div>
                        <div class="procedure-item draggable" data-procedure="ct-kub" draggable="true">
                            Renal Ultrasound Â± KUB X-ray
                        </div>
                        <div class="procedure-item draggable" data-procedure="psa-dre" draggable="true">
                            Uroflowmetry & Post-void Residual
                        </div>
                        <div class="procedure-item draggable" data-procedure="renal-function" draggable="true">
                            Urine Protein/Creatinine Ratio
                        </div>
                    </div>

                    <!-- Clinical Case -->
                    <div class="clinical-case">
                        <div class="case-title">
                            <span>ðŸ’¡</span>
                            Diagnostic Decision Making
                        </div>
                        <div class="case-text">
                            <strong>Considerations:</strong> Age, gender, and risk factors change diagnostic approach. 
                            A young female with UTI symptoms may only need urinalysis, while an older male 
                            needs prostate evaluation. Always consider radiation exposure (CT vs ultrasound), 
                            cost, and test characteristics (sensitivity/specificity).
                        </div>
                    </div>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-2">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">âœ“</span>
                        Diagnostic Matching Complete!
                    </div>
                    <div class="feedback-content">
                        <strong>Optimal Diagnostic Pathways:</strong><br><br>
                        
                        1. <strong>Suspected UTI (Case 1):</strong><br>
                        â€¢ <em>First-line:</em> Urinalysis with dipstick (leukocyte esterase, nitrites, blood)<br>
                        â€¢ <em>Confirmatory:</em> Microscopic analysis (WBCs, bacteria, RBCs)<br>
                        â€¢ <em>Gold Standard:</em> Culture & Sensitivity (identifies organism, guides antibiotics)<br>
                        â€¢ <em>When to Culture:</em> All men, pregnant women, recurrent UTIs, treatment failures<br>
                        â€¢ <em>Additional:</em> Consider STD testing if sexually active with new partner<br><br>
                        
                        2. <strong>Possible Kidney Stone (Case 2):</strong><br>
                        â€¢ <em>Gold Standard:</em> Non-contrast CT KUB (95% sensitive, identifies size/location)<br>
                        â€¢ <em>Alternatives:</em> Ultrasound (no radiation, good for pregnant patients/children)<br>
                        â€¢ <em>Basic:</em> KUB X-ray (misses 15% of stones, especially uric acid)<br>
                        â€¢ <em>Lab:</em> Urinalysis (hematuria), serum calcium/urate, 24-hour urine for metabolic workup<br>
                        â€¢ <em>Emergency:</em> CT also evaluates for alternative diagnoses (appendicitis, AAA)<br><br>
                        
                        3. <strong>BPH Evaluation (Case 3):</strong><br>
                        â€¢ <em>Essential:</em> Digital Rectal Exam (assess size, symmetry, nodules)<br>
                        â€¢ <em>Laboratory:</em> PSA (prostate-specific antigen) - age-specific ranges<br>
                        â€¢ <em>Functional:</em> Uroflowmetry (measures flow rate), post-void residual (ultrasound)<br>
                        â€¢ <em>Symptom Score:</em> IPSS (International Prostate Symptom Score) questionnaire<br>
                        â€¢ <em>Advanced:</em> Cystoscopy if considering surgery or hematuria present<br><br>
                        
                        4. <strong>Renal Function Assessment (Case 4):</strong><br>
                        â€¢ <em>Basic Panel:</em> BUN, creatinine, electrolytes, GFR estimation<br>
                        â€¢ <em>Urine Studies:</em> Urinalysis, urine protein/creatinine ratio, microscopy for casts<br>
                        â€¢ <em>Imaging:</em> Renal ultrasound (size, echogenicity, hydronephrosis, cysts)<br>
                        â€¢ <em>Additional:</em> HbA1c (diabetes control), lipid panel, urine albumin excretion<br>
                        â€¢ <em>Staging:</em> CKD stages based on GFR: Stage 1 (â‰¥90), 2 (60-89), 3 (30-59), 4 (15-29), 5 (<15)<br><br>
                        
                        <strong>Test Characteristics to Remember:</strong><br>
                        â€¢ <em>Sensitivity:</em> CT for stones (95%), ultrasound (77%), KUB (85%)<br>
                        â€¢ <em>Specificity:</em> PSA for cancer (moderate, elevated in BPH/prostatitis too)<br>
                        â€¢ <em>Radiation:</strong> CT â‰ˆ 300 chest X-rays, ultrasound = none<br>
                        â€¢ <em>Cost:</em> Ultrasound < CT, but CT provides more definitive diagnosis
                    </div>
                </div>
            </section>
        </div>

        <!-- ACTION BUTTONS -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="reset-all-btn">
                <span class="btn-icon">â†»</span>
                Reset All Activities
            </button>
            <button class="btn btn-secondary" id="check-answers-btn">
                <span class="btn-icon">âœ“</span>
                Check All Answers
            </button>
            <button class="btn btn-primary" id="view-results-btn">
                <span class="btn-icon">ðŸ“Š</span>
                View Final Results
            </button>
        </div>

        <!-- RESULTS PANEL -->
        <div class="results-panel" id="results-panel">
            <div class="results-header">
                <h2 class="results-title">Urology Diagnostics Mastery Results</h2>
                <div class="score-display" id="final-score">0%</div>
            </div>
            
            <div class="clinical-insights">
                <h3 class="insights-title">
                    <span>ðŸ©º</span> Clinical Proficiency Insights
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Symptom Pattern Recognition:</strong> UTIs present with dysuria/frequency/urgency; kidney stones with colicky flank pain; BPH with obstructive voiding symptoms; renal failure with systemic symptoms (fatigue, edema, nausea). Always ask about symptom onset, duration, and aggravating/alleviating factors.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Diagnostic Test Selection:</strong> Choose tests based on pretest probability. For suspected stones in young patients, consider ultrasound first. For high suspicion in adults, CT is gold standard. For renal function, GFR is more accurate than creatinine alone (affected by age, muscle mass).</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Age & Gender Considerations:</strong> UTIs in men always require investigation (possibly prostate related). BPH symptoms start around age 50, peak 60-70. PSA interpretation varies by age (normal <2.5 at 40, <4 at 50-70). Renal function declines naturally with age (GFR decreases 1 mL/min/year after 40).</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Risk Factor Assessment:</strong> For stones: family history, dehydration, high oxalate diet, gout. For UTIs: female anatomy, sexual activity, spermicides, diabetes, incontinence. For renal failure: diabetes, hypertension, NSAID use, contrast exposure, heart failure.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Follow-up & Monitoring:</strong> Document planned follow-up for all abnormal results. Stone patients need metabolic workup. BPH patients need annual DRE/PSA if not treating. Renal impairment requires regular monitoring (q3-6 months based on stage).</span>
                    </li>
                </ul>
            </div>
            
            <div class="clinical-insights" style="margin-top: 20px;">
                <h3 class="insights-title">
                    <span>ðŸ“‹</span> Documentation & Patient Safety
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Test Result Documentation:</strong> Always document: test ordered, reason, results with reference ranges, interpretation, follow-up plan, patient notification. For abnormal results, document discussion with provider and patient instructions given.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Contrast Safety Protocols:</strong> Before CT with contrast, screen for: renal impairment (check creatinine/GFR), diabetes (especially on metformin), allergies (iodine/shellfish), thyroid disorders. Document screening completed and any precautions taken.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Urine Collection Standards:</strong> Clean-catch midstream technique. Document collection method, time, transport (â‰¤1 hour room temp or refrigerated). For cultures, document antibiotic use prior to collection. Catheterized specimens require documentation of medical necessity.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Patient Education Documentation:</strong> For UTI: increased fluids, void after intercourse, proper wiping. For stones: fluid goals (2L urine/day), dietary modifications based on stone type. For BPH: timed voiding, double voiding, medication adherence. Document teaching provided and patient understanding.</span>
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // === STATE MANAGEMENT ===
            const state = {
                activities: {
                    1: { completed: false, correct: 0, total: 20, score: 0 }, // 20 symptoms to sort
                    2: { completed: false, correct: 0, total: 8, score: 0 }   // 4 cases Ã— 2 procedures each
                },
                startedAt: new Date(),
                timeSpent: 0,
                // Correct symptom assignments (primary disorder for each symptom)
                correctAssignments: {
                    'Dysuria (painful urination)': 'uti',
                    'Urinary frequency & urgency': 'uti',
                    'Hematuria (blood in urine)': 'uti', // Most characteristic of UTI
                    'Cloudy or foul-smelling urine': 'uti',
                    'Suprapubic pain or pressure': 'uti',
                    'Severe flank pain radiating to groin': 'stones',
                    '"Worst pain of my life" description': 'stones',
                    'Nausea and vomiting with pain': 'stones',
                    'Pain that comes in waves (colic)': 'stones',
                    'Restlessness, cannot find comfortable position': 'stones',
                    'Hesitancy (difficulty starting stream)': 'bph',
                    'Weak urinary stream': 'bph',
                    'Nocturia (waking to urinate >2x/night)': 'bph',
                    'Incomplete bladder emptying': 'bph',
                    'Dribbling after urination': 'bph',
                    'Fatigue and weakness': 'renal',
                    'Nausea and decreased appetite': 'renal',
                    'Peripheral edema (swelling in legs)': 'renal',
                    'Decreased urine output (oliguria)': 'renal',
                    'Confusion or altered mental status': 'renal'
                },
                // Correct procedure matches for each case
                correctProcedures: {
                    'uti-case': ['ua-culture', 'Urinalysis & Culture/Sensitivity'],
                    'stones-case': ['ct-kub', 'Non-contrast CT Scan (Kidney-Ureter-Bladder)'],
                    'bph-case': ['psa-dre', 'PSA Test & Digital Rectal Exam (DRE)'],
                    'renal-case': ['renal-function', 'Renal Function Panel (BUN, Creatinine, GFR)']
                }
            };

            // === DOM ELEMENTS ===
            const progressSteps = document.querySelectorAll('.progress-step');
            const activityCards = document.querySelectorAll('.activity-card');
            const completedCount = document.getElementById('completed-count');
            const accuracyRate = document.getElementById('accuracy-rate');
            const timeSpent = document.getElementById('time-spent');
            const resetBtn = document.getElementById('reset-all-btn');
            const checkBtn = document.getElementById('check-answers-btn');
            const resultsBtn = document.getElementById('view-results-btn');
            const resultsPanel = document.getElementById('results-panel');
            const finalScore = document.getElementById('final-score');

            // === TIMER FUNCTION ===
            function updateTimer() {
                const now = new Date();
                const diff = Math.floor((now - state.startedAt) / 1000);
                state.timeSpent = diff;
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                timeSpent.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            setInterval(updateTimer, 1000);

            // === UPDATE PROGRESS SUMMARY ===
            function updateProgressSummary() {
                let completed = 0;
                let totalCorrect = 0;
                let totalItems = 0;

                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) completed++;
                    totalCorrect += activity.correct;
                    totalItems += activity.total;
                });

                completedCount.textContent = completed;
                const accuracy = totalItems > 0 ? Math.round((totalCorrect / totalItems) * 100) : 0;
                accuracyRate.textContent = `${accuracy}%`;

                // Update progress steps
                progressSteps.forEach((step, index) => {
                    if (index < completed) {
                        step.classList.add('completed');
                        step.classList.remove('active');
                    } else if (index === completed) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });
            }

            // === ACTIVITY 1: URINARY DISORDER SORTING ===
            function initActivity1() {
                const symptomCards = document.querySelectorAll('#symptom-bank .symptom-card');
                const disorderColumns = document.querySelectorAll('.disorder-column');
                const feedback = document.getElementById('feedback-1');
                const status = document.querySelector('#activity-1 .activity-status');
                
                let placedSymptoms = 0;
                let correctPlacements = 0;

                // Setup drag and drop
                symptomCards.forEach(card => {
                    card.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', JSON.stringify({
                            text: this.textContent,
                            disorders: this.dataset.disorders
                        }));
                        this.classList.add('dragging');
                    });

                    card.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });

                // Setup drop zones
                disorderColumns.forEach(column => {
                    column.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        this.classList.add('hover');
                    });

                    column.addEventListener('dragleave', function() {
                        this.classList.remove('hover');
                    });

                    column.addEventListener('drop', function(e) {
                        e.preventDefault();
                        this.classList.remove('hover');
                        
                        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                        const targetDisorder = this.dataset.disorder;
                        
                        // Check if symptom already placed in this column
                        const existingCards = Array.from(this.querySelectorAll('.disorder-card'));
                        const alreadyPlaced = existingCards.some(card => card.textContent === data.text);
                        
                        if (!alreadyPlaced) {
                            // Check if placement is correct
                            const isCorrect = state.correctAssignments[data.text] === targetDisorder;
                            
                            // Create disorder card
                            const cardDiv = document.createElement('div');
                            cardDiv.className = `disorder-card ${isCorrect ? 'correct' : 'incorrect'}`;
                            cardDiv.textContent = data.text;
                            
                            this.querySelector('.column-content').appendChild(cardDiv);
                            this.classList.add('filled');
                            
                            // Mark original card as used
                            const originalCard = Array.from(symptomCards)
                                .find(card => card.textContent === data.text && !card.classList.contains('used'));
                            
                            if (originalCard) {
                                originalCard.classList.add('used');
                                originalCard.style.cursor = 'default';
                                originalCard.draggable = false;
                                placedSymptoms++;
                                if (isCorrect) correctPlacements++;
                            }
                            
                            // Update activity state
                            state.activities[1].correct = correctPlacements;
                            
                            // Check completion
                            if (placedSymptoms === 20) {
                                state.activities[1].completed = true;
                                state.activities[1].score = Math.round((correctPlacements / 20) * 100);
                                status.textContent = 'Completed';
                                status.style.color = '#00b894';
                                document.querySelector('#activity-1').classList.add('completed');
                                feedback.classList.add('show');
                                updateProgressSummary();
                            }
                        }
                    });
                });
            }

            // === ACTIVITY 2: DIAGNOSTIC PROCEDURE MATCHING ===
            function initActivity2() {
                const procedureItems = document.querySelectorAll('#procedure-bank .procedure-item');
                const procedureCards = document.querySelectorAll('.matching-card[data-procedure]');
                const feedback = document.getElementById('feedback-2');
                const status = document.querySelector('#activity-2 .activity-status');
                
                let placedProcedures = 0;
                let correctMatches = 0;

                // Setup drag and drop
                procedureItems.forEach(item => {
                    item.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', JSON.stringify({
                            text: this.textContent,
                            procedure: this.dataset.procedure
                        }));
                        this.classList.add('dragging');
                    });

                    item.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });

                // Setup drop zones (procedure cards)
                procedureCards.forEach(card => {
                    card.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        this.classList.add('hover');
                    });

                    card.addEventListener('dragleave', function() {
                        this.classList.remove('hover');
                    });

                    card.addEventListener('drop', function(e) {
                        e.preventDefault();
                        this.classList.remove('hover');
                        
                        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                        
                        // Check if card already has content
                        if (this.querySelector('.matching-content').children.length === 0) {
                            // Get the corresponding case
                            const caseId = this.id.replace('procedure', 'case');
                            const caseCard = document.getElementById(caseId);
                            const caseType = caseCard ? caseCard.dataset.case : null;
                            
                            // Check if procedure matches case
                            const isCorrect = caseType && 
                                state.correctProcedures[caseType] && 
                                state.correctProcedures[caseType][0] === data.procedure;
                            
                            // Add procedure to card
                            const procedureDiv = document.createElement('div');
                            procedureDiv.textContent = data.text;
                            procedureDiv.style.padding = '10px';
                            procedureDiv.style.background = isCorrect ? 
                                'rgba(0, 184, 148, 0.1)' : 'rgba(225, 112, 85, 0.1)';
                            procedureDiv.style.borderRadius = '6px';
                            procedureDiv.style.border = isCorrect ? 
                                '2px solid var(--color-success)' : '2px solid var(--color-error)';
                            
                            this.querySelector('.matching-content').innerHTML = '';
                            this.querySelector('.matching-content').appendChild(procedureDiv);
                            this.classList.add('matched');
                            
                            // Mark original item as used
                            const originalItem = Array.from(procedureItems)
                                .find(item => item.textContent === data.text && !item.classList.contains('used'));
                            
                            if (originalItem) {
                                originalItem.classList.add('used');
                                originalItem.style.cursor = 'default';
                                originalItem.draggable = false;
                                placedProcedures++;
                                if (isCorrect) correctMatches++;
                            }
                            
                            // Update activity state
                            state.activities[2].correct = correctMatches;
                            
                            // Check completion
                            if (placedProcedures === 4) { // One procedure per case
                                state.activities[2].completed = true;
                                state.activities[2].score = Math.round((correctMatches / 4) * 100);
                                status.textContent = 'Completed';
                                status.style.color = '#00b894';
                                document.querySelector('#activity-2').classList.add('completed');
                                feedback.classList.add('show');
                                updateProgressSummary();
                            }
                        }
                    });
                });
            }

            // === RESET ALL ACTIVITIES ===
            function resetAllActivities() {
                // Reset state
                Object.keys(state.activities).forEach(key => {
                    state.activities[key] = {
                        completed: false,
                        correct: 0,
                        total: parseInt(key) === 1 ? 20 : 8,
                        score: 0
                    };
                });

                // Reset UI
                activityCards.forEach(card => {
                    card.classList.remove('completed');
                    const status = card.querySelector('.activity-status');
                    status.textContent = 'Not Started';
                    status.style.color = '';
                    const feedback = card.querySelector('.feedback-container');
                    feedback.classList.remove('show');
                });

                // Reset Activity 1
                document.querySelectorAll('#symptom-bank .symptom-card').forEach(card => {
                    card.classList.remove('used', 'dragging');
                    card.style.cursor = 'grab';
                    card.draggable = true;
                });
                
                document.querySelectorAll('.disorder-column').forEach(column => {
                    column.classList.remove('filled', 'hover');
                    column.querySelector('.column-content').innerHTML = '';
                });

                // Reset Activity 2
                document.querySelectorAll('#procedure-bank .procedure-item').forEach(item => {
                    item.classList.remove('used', 'dragging');
                    item.style.cursor = 'grab';
                    item.draggable = true;
                });
                
                document.querySelectorAll('.matching-card[data-procedure]').forEach(card => {
                    card.classList.remove('matched', 'hover');
                    card.querySelector('.matching-content').innerHTML = 'Drop Diagnostic Procedure Here';
                });

                // Reset results
                resultsPanel.classList.remove('show');

                // Update progress
                updateProgressSummary();
            }

            // === CHECK ALL ANSWERS ===
            function checkAllAnswers() {
                // Force complete Activity 1 with perfect score
                if (!state.activities[1].completed) {
                    const feedback = document.getElementById('feedback-1');
                    const status = document.querySelector('#activity-1 .activity-status');
                    
                    state.activities[1].completed = true;
                    state.activities[1].correct = 20;
                    state.activities[1].score = 100;
                    
                    status.textContent = 'Completed';
                    status.style.color = '#00b894';
                    document.querySelector('#activity-1').classList.add('completed');
                    feedback.classList.add('show');
                    
                    // Place all symptoms correctly
                    Object.keys(state.correctAssignments).forEach(symptomText => {
                        const disorder = state.correctAssignments[symptomText];
                        const column = document.getElementById(`column-${disorder}`);
                        const cardDiv = document.createElement('div');
                        cardDiv.className = 'disorder-card correct';
                        cardDiv.textContent = symptomText;
                        column.querySelector('.column-content').appendChild(cardDiv);
                        column.classList.add('filled');
                    });
                    
                    // Mark all symptoms as used
                    document.querySelectorAll('#symptom-bank .symptom-card').forEach(card => {
                        card.classList.add('used');
                        card.style.cursor = 'default';
                        card.draggable = false;
                    });
                }

                // Force complete Activity 2 with perfect score
                if (!state.activities[2].completed) {
                    const feedback = document.getElementById('feedback-2');
                    const status = document.querySelector('#activity-2 .activity-status');
                    
                    state.activities[2].completed = true;
                    state.activities[2].correct = 4;
                    state.activities[2].score = 100;
                    
                    status.textContent = 'Completed';
                    status.style.color = '#00b894';
                    document.querySelector('#activity-2').classList.add('completed');
                    feedback.classList.add('show');
                    
                    // Place correct procedures for each case
                    Object.keys(state.correctProcedures).forEach(caseType => {
                        const [procedureKey, procedureText] = state.correctProcedures[caseType];
                        const procedureCard = document.getElementById(`procedure-${caseType.split('-')[1]}`);
                        
                        const procedureDiv = document.createElement('div');
                        procedureDiv.textContent = procedureText;
                        procedureDiv.style.padding = '10px';
                        procedureDiv.style.background = 'rgba(0, 184, 148, 0.1)';
                        procedureDiv.style.borderRadius = '6px';
                        procedureDiv.style.border = '2px solid var(--color-success)';
                        
                        procedureCard.querySelector('.matching-content').innerHTML = '';
                        procedureCard.querySelector('.matching-content').appendChild(procedureDiv);
                        procedureCard.classList.add('matched');
                    });
                    
                    // Mark all procedures as used
                    document.querySelectorAll('#procedure-bank .procedure-item').forEach(item => {
                        item.classList.add('used');
                        item.style.cursor = 'default';
                        item.draggable = false;
                    });
                }

                updateProgressSummary();
            }

            // === VIEW FINAL RESULTS ===
            function viewFinalResults() {
                let totalScore = 0;
                let activityCount = 0;
                
                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) {
                        totalScore += activity.score;
                        activityCount++;
                    }
                });
                
                const averageScore = activityCount > 0 ? Math.round(totalScore / activityCount) : 0;
                finalScore.textContent = `${averageScore}%`;
                resultsPanel.classList.add('show');
                
                // Scroll to results
                resultsPanel.scrollIntoView({ behavior: 'smooth' });
            }

            // === INITIALIZE MODULE ===
            initActivity1();
            initActivity2();
            updateProgressSummary();

            // === EVENT LISTENERS ===
            resetBtn.addEventListener('click', resetAllActivities);
            checkBtn.addEventListener('click', checkAllAnswers);
            resultsBtn.addEventListener('click', viewFinalResults);
        });
    </script>
</body>
</html>
