<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ALLIEDRx -- Chapter 13: Nose, Throat & Sensory Loss Clinic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* === ALLIEDRx BRANDING EXACT MATCH === */
        :root {
            --color-primary: #af4bef; /* Purple - main brand color */
            --color-primary-soft: #d492ff; /* Light purple */
            --color-accent: #8380f0; /* Blue-purple accent */
            --color-success: #00b894; /* Green for correct/success */
            --color-warning: #fdcb6e;
            --color-error: #e17055; /* Red/Orange for errors */
            --color-bg: #f7f5fb; /* Light background */
            --color-text: #2b2b2b; /* Dark text */
            --color-muted: #6c6880; /* Muted text */
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --shadow-soft: 0 18px 45px rgba(23, 10, 61, 0.18);
            --shadow-medium: 0 12px 30px rgba(23, 10, 61, 0.12);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            padding: 24px;
            background: radial-gradient(
                circle at top left,
                #ffffff 0,
                #f1ecff 40%,
                var(--color-bg) 100%
            );
            color: var(--color-text);
            -webkit-text-size-adjust: 100%;
        }

        @media (max-width: 600px) {
            body {
                padding: 12px;
            }
        }

        /* === ANIMATIONS === */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes checkmarkPop {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* === MAIN PAGE CONTAINER === */
        .page {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 28px 30px 32px;
            display: flex;
            flex-direction: column;
            gap: 32px;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.6s ease-out;
        }

        @media (max-width: 900px) {
            .page {
                padding: 22px;
                gap: 28px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
            }
            .page {
                border-radius: 0;
                box-shadow: none;
                padding: 18px 14px 22px;
                gap: 24px;
            }
        }

        /* === ALLIEDRx HEADER/BRANDING === */
        .brand-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 14px;
            margin-bottom: 8px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeInUp 0.5s ease-out;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 40px;
            width: auto;
            max-width: 100%;
            filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.2));
        }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--color-muted);
            white-space: normal;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(175, 75, 239, 0.08);
            font-size: 0.76rem;
            color: var(--color-primary);
            white-space: normal;
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-success);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        .badge-mode {
            padding: 5px 10px;
            border-radius: 999px;
            background: rgba(12, 10, 24, 0.06);
            border: 1px solid rgba(12, 10, 24, 0.08);
            font-size: 0.74rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--color-muted);
            white-space: nowrap;
        }

        @media (max-width: 480px) {
            .brand-row {
                flex-direction: column;
                align-items: flex-start;
            }
            .badge-mode {
                margin-top: 6px;
            }
        }

        /* === MODULE HEADER === */
        .module-header {
            animation: fadeInUp 0.5s ease-out 0.1s both;
        }

        h1 {
            font-size: clamp(2rem, 3vw, 2.4rem);
            line-height: 1.05;
            color: var(--color-primary);
            margin-bottom: 6px;
        }

        .module-subtitle {
            font-size: 1.1rem;
            color: var(--color-muted);
            max-width: 800px;
            margin-bottom: 6px;
        }

        .module-description {
            font-size: 0.98rem;
            color: var(--color-muted);
            max-width: 800px;
            line-height: 1.6;
        }

        /* === PROGRESS TRACKER === */
        .progress-tracker {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 8px 0 20px;
            animation: fadeInUp 0.5s ease-out 0.2s both;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--color-muted);
        }

        .progress-step.active {
            color: var(--color-primary);
            font-weight: 600;
        }

        .progress-step.completed {
            color: var(--color-success);
        }

        .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-muted);
        }

        .progress-step.active .step-icon {
            background: var(--color-primary);
            color: white;
        }

        .progress-step.completed .step-icon {
            background: var(--color-success);
            color: white;
        }

        .step-divider {
            flex: 1;
            height: 2px;
            background: rgba(12, 10, 24, 0.1);
            margin: 0 8px;
        }

        /* === PROGRESS SUMMARY === */
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 16px;
            padding: 16px;
            background: rgba(175, 75, 239, 0.03);
            border-radius: var(--radius-sm);
            animation: fadeInUp 0.5s ease-out 0.3s both;
        }

        @media (max-width: 480px) {
            .progress-summary {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        .progress-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .progress-number {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--color-primary);
        }

        .progress-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
        }

        /* === ACTIVITY GRID === */
        .activity-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
            margin-bottom: 24px;
            animation: fadeInUp 0.5s ease-out 0.3s both;
        }

        /* === ACTIVITY CARDS === */
        .activity-card {
            background: rgba(175, 75, 239, 0.03);
            border-radius: var(--radius-md);
            border: 1px solid rgba(175, 75, 239, 0.1);
            padding: 28px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
        }

        .activity-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .activity-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .activity-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--color-text);
        }

        .activity-description {
            font-size: 1rem;
            color: var(--color-muted);
            line-height: 1.6;
            margin-bottom: 8px;
        }

        /* === ACTIVITY 1: THROAT CULTURE SCENARIO === */
        .scenario-container {
            display: flex;
            flex-direction: column;
            gap: 28px;
        }

        .scenario {
            background: white;
            border-radius: var(--radius-md);
            padding: 24px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .patient-info {
            font-weight: 700;
            color: var(--color-primary);
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .patient-demographics {
            font-size: 1rem;
            color: var(--color-muted);
            margin-bottom: 12px;
        }

        .symptoms {
            color: var(--color-text);
            margin-bottom: 16px;
            line-height: 1.6;
            font-size: 1rem;
        }

        .symptoms strong {
            color: var(--color-muted);
        }

        .swabbing-instruction {
            font-size: 1rem;
            color: var(--color-muted);
            margin-bottom: 16px;
            font-style: italic;
            padding: 16px;
            background: rgba(175, 75, 239, 0.05);
            border-radius: var(--radius-sm);
            line-height: 1.5;
        }

        .throat-area-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 24px 0;
        }

        @media (max-width: 768px) {
            .throat-area-grid {
                grid-template-columns: 1fr;
            }
        }

        .throat-area {
            background: white;
            border-radius: var(--radius-sm);
            padding: 24px;
            border: 3px dashed #ddd;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 140px;
            justify-content: center;
            cursor: pointer;
        }

        .throat-area:hover {
            border-color: var(--color-primary-soft);
            background-color: rgba(175, 75, 239, 0.03);
        }

        .throat-area.correct-drop {
            border-color: var(--color-success);
            background-color: rgba(0, 184, 148, 0.05);
        }

        .throat-area.incorrect-drop {
            border-color: var(--color-error);
            background-color: rgba(225, 112, 85, 0.05);
        }

        .area-title {
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .area-instruction {
            font-size: 0.95rem;
            color: var(--color-text);
            line-height: 1.4;
        }

        .swab-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 24px 0;
            justify-content: center;
        }

        .swab-tag {
            background: white;
            border: 3px solid var(--color-accent);
            color: var(--color-text);
            padding: 12px 20px;
            border-radius: 24px;
            font-size: 1rem;
            cursor: grab;
            transition: all 0.2s ease;
            user-select: none;
            font-weight: 600;
        }

        .swab-tag:hover {
            background: var(--color-accent);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(131, 128, 240, 0.3);
        }

        .swab-tag.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .swab-tag.placed {
            background: var(--color-success);
            color: white;
            border-color: var(--color-success);
            cursor: default;
        }

        /* === ACTIVITY 2: SENSORY LOSS COMMUNICATION === */
        .communication-container {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .communication-section {
            background: white;
            border-radius: var(--radius-md);
            padding: 24px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .section-title {
            font-size: 1.2rem;
            color: var(--color-primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--color-primary-soft);
        }

        .sensory-types-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        @media (max-width: 768px) {
            .sensory-types-grid {
                grid-template-columns: 1fr;
            }
        }

        .sensory-type {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            border: 2px solid rgba(12, 10, 24, 0.08);
            display: flex;
            flex-direction: column;
            gap: 16px;
            transition: all 0.3s ease;
        }

        .sensory-type:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .sensory-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sensory-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .sensory-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-text);
        }

        .sensory-description {
            font-size: 0.95rem;
            color: var(--color-muted);
            line-height: 1.5;
        }

        .strategies-container {
            margin-top: 24px;
        }

        .strategies-title {
            font-size: 1.1rem;
            color: var(--color-primary);
            margin-bottom: 16px;
        }

        .communication-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        @media (max-width: 768px) {
            .communication-cards {
                grid-template-columns: 1fr;
            }
        }

        .communication-card {
            background: white;
            border-radius: var(--radius-sm);
            padding: 16px;
            border: 2px solid rgba(12, 10, 24, 0.08);
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            line-height: 1.5;
            font-weight: 500;
        }

        .communication-card:hover {
            transform: translateY(-2px);
            border-color: var(--color-primary-soft);
            box-shadow: var(--shadow-medium);
        }

        .communication-card.dragging {
            opacity: 0.7;
            transform: rotate(3deg);
        }

        .communication-card.correct {
            border-color: var(--color-success);
            background: rgba(0, 184, 148, 0.05);
        }

        .communication-card.incorrect {
            border-color: var(--color-error);
            background: rgba(225, 112, 85, 0.05);
        }

        .drop-zones-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 32px;
        }

        @media (max-width: 768px) {
            .drop-zones-container {
                grid-template-columns: 1fr;
            }
        }

        .drop-zone {
            min-height: 120px;
            border: 3px dashed var(--color-primary-soft);
            border-radius: var(--radius-sm);
            padding: 20px;
            background: rgba(175, 75, 239, 0.03);
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: flex-start;
        }

        .drop-zone.active {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.08);
        }

        /* === ACTIVITY 3: ADA/HIPAA SCENARIOS === */
        .legal-scenario {
            background: white;
            border-radius: var(--radius-md);
            padding: 24px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            margin-bottom: 24px;
        }

        .legal-question {
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 20px;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .legal-options {
            display: grid;
            gap: 16px;
        }

        .legal-option {
            background: white;
            padding: 18px;
            border-radius: var(--radius-sm);
            border: 2px solid rgba(12, 10, 24, 0.08);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
            gap: 16px;
            font-size: 1rem;
        }

        .legal-option:hover {
            border-color: var(--color-accent);
            transform: translateY(-2px);
        }

        .legal-option.selected {
            background: rgba(175, 75, 239, 0.05);
            border-color: var(--color-primary);
        }

        .legal-option.correct {
            background: rgba(0, 184, 148, 0.05);
            border-color: var(--color-success);
        }

        .legal-option.incorrect {
            background: rgba(225, 112, 85, 0.05);
            border-color: var(--color-error);
        }

        .option-indicator {
            width: 24px;
            height: 24px;
            border: 2px solid var(--color-muted);
            border-radius: 4px;
            flex-shrink: 0;
            margin-top: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .legal-option.selected .option-indicator {
            background: var(--color-primary);
            border-color: var(--color-primary);
        }

        .legal-option.correct .option-indicator {
            background: var(--color-success);
            border-color: var(--color-success);
        }

        .legal-option.incorrect .option-indicator {
            background: var(--color-error);
            border-color: var(--color-error);
        }

        .option-text {
            flex: 1;
            line-height: 1.5;
        }

        /* === ACTIVITY 4: PROCEDURE SEQUENCE === */
        .procedure-steps {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 24px;
        }

        .procedure-step {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            border-left: 4px solid var(--color-primary);
            display: flex;
            align-items: flex-start;
            gap: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .procedure-step:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-medium);
        }

        .procedure-step.active {
            background: rgba(175, 75, 239, 0.05);
        }

        .procedure-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            flex-shrink: 0;
            transition: background 0.3s ease;
        }

        .procedure-content {
            flex: 1;
        }

        .procedure-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .procedure-description {
            font-size: 0.9rem;
            color: var(--color-muted);
            line-height: 1.6;
        }

        /* === ACTION BUTTONS === */
        .action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 32px;
            animation: fadeInUp 0.5s ease-out 0.4s both;
        }

        .btn {
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #9a3ed8;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(175, 75, 239, 0.3);
        }

        .btn-secondary {
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(12, 10, 24, 0.12);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* === RESULTS PANEL === */
        .results-panel {
            background: rgba(12, 10, 24, 0.94);
            color: #e5e7eb;
            border-radius: var(--radius-md);
            padding: 32px;
            margin-top: 32px;
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .results-panel.show {
            display: block;
        }

        .results-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #ffffff;
        }

        .results-content {
            font-size: 1rem;
            line-height: 1.7;
        }

        .results-content strong {
            color: #ffffff;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 24px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--color-primary-soft);
        }

        .score-text {
            font-size: 1rem;
            color: #c4b5fd;
        }

        /* === CLINICAL INSIGHT CARD === */
        .clinical-insight {
            margin-top: 24px;
            border-radius: var(--radius-sm);
            border: 1px solid rgba(255, 255, 255, 0.16);
            background: rgba(15, 23, 42, 0.7);
            padding: 20px;
            font-size: 0.95rem;
            color: #e5e7eb;
            line-height: 1.6;
        }

        .clinical-insight strong {
            color: #fef3c7;
        }

        /* === FEEDBACK MESSAGES === */
        .feedback-message {
            padding: 16px 20px;
            border-radius: var(--radius-sm);
            margin-top: 16px;
            font-size: 1rem;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .feedback-correct {
            background: rgba(0, 184, 148, 0.1);
            border-left: 4px solid var(--color-success);
            color: var(--color-success);
            display: block;
        }

        .feedback-incorrect {
            background: rgba(225, 112, 85, 0.1);
            border-left: 4px solid var(--color-error);
            color: var(--color-error);
            display: block;
        }

        /* === ACTIVITY BUTTONS === */
        .activity-btn {
            padding: 12px 24px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            align-self: flex-start;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .activity-btn:hover {
            background: #9a3ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(175, 75, 239, 0.3);
        }

        /* === RESPONSIVE ADJUSTMENTS === */
        @media (max-width: 768px) {
            .activity-grid {
                gap: 24px;
            }
            .activity-card {
                padding: 20px;
            }
            .action-buttons {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
            .throat-area-grid {
                gap: 16px;
            }
            .swab-tags {
                gap: 10px;
            }
            .communication-cards {
                gap: 12px;
            }
        }

        @media (max-width: 480px) {
            .progress-tracker {
                flex-wrap: wrap;
                justify-content: center;
            }
            .step-divider {
                display: none;
            }
            .sensory-types-grid {
                gap: 16px;
            }
            .drop-zones-container {
                gap: 16px;
            }
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://cdn.prod.website-files.com/64d0ccc1558d601cbfb09021/64e9d2f719b1e5258e5d57f5_IMG_1512-p-500.png"
                    alt="AlliedRx logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">Clinical Medical Assistant ‚Ä¢ Kinn's Chapter 13</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Interactive Module 4: Nose, Throat & Sensory Loss Clinic</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Campus & Online</span>
        </header>

        <!-- Module Header -->
        <section class="module-header">
            <h1 id="module-heading">Nose, Throat & Sensory Loss Clinic</h1>
            <p class="module-subtitle">Master nose/throat examination, patient education for sensory loss, and ADA/HIPAA compliance</p>
            <p class="module-description">
                This interactive module covers Objectives 13-15 from Chapter 13. You'll learn throat culture techniques, 
                sensory loss communication strategies, and legal/ethical compliance requirements.
            </p>
        </section>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-step active">
                <span class="step-icon">1</span>
                <span>Throat Culture</span>
            </div>
            <div class="step-divider"></div>
            <div class="progress-step">
                <span class="step-icon">2</span>
                <span>Sensory Communication</span>
            </div>
            <div class="step-divider"></div>
            <div class="progress-step">
                <span class="step-icon">3</span>
                <span>ADA/HIPAA Compliance</span>
            </div>
            <div class="step-divider"></div>
            <div class="progress-step">
                <span class="step-icon">4</span>
                <span>Procedure Sequence</span>
            </div>
        </div>

        <!-- Progress Summary -->
        <div class="progress-summary">
            <div class="progress-item">
                <span class="progress-number" id="completedCount">0</span>
                <span class="progress-label">Activities Completed</span>
            </div>
            <div class="progress-item">
                <span class="progress-number" id="accuracyScore">0%</span>
                <span class="progress-label">Current Accuracy</span>
            </div>
            <div class="progress-item">
                <span class="progress-number" id="timeSpent">0 min</span>
                <span class="progress-label">Time Spent</span>
            </div>
        </div>

        <!-- Activity Grid -->
        <div class="activity-grid">
            <!-- ACTIVITY 1: THROAT CULTURE SCENARIO -->
            <section class="activity-card" aria-label="Throat Culture Scenario Activity">
                <div class="activity-header">
                    <div class="activity-icon">ü¶†</div>
                    <h2 class="activity-title">Throat Culture Collection Scenario</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Review the patient case and drag swab tags to the correct throat 
                    areas for proper culture collection. Avoid contaminating areas.
                </p>
                
                <div class="scenario-container">
                    <div class="scenario">
                        <div class="scenario-header">
                            <div>
                                <div class="patient-info">Patient: Jamie, 8 years old</div>
                                <div class="patient-demographics">Pediatric patient with sore throat symptoms</div>
                            </div>
                        </div>
                        <div class="symptoms">
                            <strong>Presenting Symptoms:</strong> Sore throat x 3 days, painful swallowing, fever 38.2¬∞C, 
                            anterior cervical lymphadenopathy (swollen neck glands).<br>
                            <strong>History:</strong> No penicillin allergy, no recent antibiotic use.<br>
                            <strong>Throat Appearance:</strong> Tonsils 3+ enlarged, erythematous, exudate present.
                        </div>
                        
                        <div class="swabbing-instruction">
                            <strong>Pro Tip:</strong> For accurate throat culture, swab BOTH tonsillar pillars and 
                            posterior pharynx. Avoid the tongue, cheeks, and uvula to prevent contamination.
                        </div>
                        
                        <div class="throat-area-grid">
                            <div class="throat-area" data-area="left-tonsil" id="area-left-tonsil">
                                <div class="area-title">Left Tonsillar Pillar</div>
                                <div class="area-instruction">Swab area thoroughly</div>
                            </div>
                            <div class="throat-area" data-area="right-tonsil" id="area-right-tonsil">
                                <div class="area-title">Right Tonsillar Pillar</div>
                                <div class="area-instruction">Swab area thoroughly</div>
                            </div>
                            <div class="throat-area" data-area="posterior-pharynx" id="area-posterior">
                                <div class="area-title">Posterior Pharynx</div>
                                <div class="area-instruction">Back of throat wall</div>
                            </div>
                            <div class="throat-area" data-area="uvula" id="area-uvula">
                                <div class="area-title">Uvula</div>
                                <div class="area-instruction">DO NOT SWAB (contaminant)</div>
                            </div>
                        </div>
                        
                        <div class="swab-tags">
                            <div class="swab-tag" data-tag="culture-swab" id="tag-culture" draggable="true">
                                Culture Swab
                            </div>
                            <div class="swab-tag" data-tag="sterile-tip" id="tag-sterile" draggable="true">
                                Sterile Tip
                            </div>
                            <div class="swab-tag" data-tag="transport-medium" id="tag-transport" draggable="true">
                                Transport Medium
                            </div>
                        </div>
                        
                        <div style="margin-top: 24px;">
                            <button class="activity-btn" id="checkSwabbingBtn">
                                ‚úì Check Swabbing Technique
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="feedback-message" id="swabbingFeedback"></div>
            </section>

            <!-- ACTIVITY 2: SENSORY LOSS COMMUNICATION -->
            <section class="activity-card" aria-label="Sensory Loss Communication Activity">
                <div class="activity-header">
                    <div class="activity-icon">üëÅÔ∏èüëÇ</div>
                    <h2 class="activity-title">Sensory Loss Communication Strategies</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Match communication strategies to the appropriate sensory loss type. 
                    Drag strategies to the correct drop zone.
                </p>
                
                <div class="communication-container">
                    <div class="communication-section">
                        <h3 class="section-title">Sensory Loss Types</h3>
                        <div class="sensory-types-grid">
                            <!-- Vision Loss -->
                            <div class="sensory-type">
                                <div class="sensory-header">
                                    <div class="sensory-icon">üëÅÔ∏è</div>
                                    <div class="sensory-title">Vision Impairment</div>
                                </div>
                                <div class="sensory-description">
                                    Patients with low vision, macular degeneration, or blindness
                                </div>
                            </div>
                            
                            <!-- Hearing Loss -->
                            <div class="sensory-type">
                                <div class="sensory-header">
                                    <div class="sensory-icon">üëÇ</div>
                                    <div class="sensory-title">Hearing Impairment</div>
                                </div>
                                <div class="sensory-description">
                                    Patients with hearing loss, presbycusis, or deafness
                                </div>
                            </div>
                        </div>

                        <div class="drop-zones-container">
                            <div class="drop-zone" id="drop-vision">
                                <div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">
                                    Drop Vision Strategies Here
                                </div>
                            </div>
                            <div class="drop-zone" id="drop-hearing">
                                <div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">
                                    Drop Hearing Strategies Here
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="communication-section">
                        <h3 class="section-title">Communication Strategy Cards</h3>
                        <div class="strategies-container">
                            <div class="communication-cards">
                                <div class="communication-card" data-strategy="vision" id="card-large-print" draggable="true">
                                    Provide large-print materials & ensure good lighting
                                </div>
                                <div class="communication-card" data-strategy="hearing" id="card-face-patient" draggable="true">
                                    Face patient directly & speak clearly (not loudly)
                                </div>
                                <div class="communication-card" data-strategy="vision" id="card-verbal-description" draggable="true">
                                    Give verbal descriptions of procedures & surroundings
                                </div>
                                <div class="communication-card" data-strategy="hearing" id="card-reduce-noise" draggable="true">
                                    Reduce background noise & use written notes if needed
                                </div>
                                <div class="communication-card" data-strategy="hearing" id="card-assistive-listening" draggable="true">
                                    Offer assistive listening devices or amplifier
                                </div>
                                <div class="communication-card" data-strategy="vision" id="card-contrast-colors" draggable="true">
                                    Use high contrast colors for important information
                                </div>
                                <div class="communication-card" data-strategy="both" id="card-teach-back" draggable="true">
                                    Use teach-back method to confirm understanding
                                </div>
                                <div class="communication-card" data-strategy="both" id="card-extra-time" draggable="true">
                                    Allow extra time for processing information
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="activity-btn" id="checkCommunicationBtn">
                        ‚úì Check Communication Matches
                    </button>
                </div>
                
                <div class="feedback-message" id="communicationFeedback"></div>
            </section>

            <!-- ACTIVITY 3: ADA/HIPAA SCENARIOS -->
            <section class="activity-card" aria-label="ADA/HIPAA Scenarios Activity">
                <div class="activity-header">
                    <div class="activity-icon">‚öñÔ∏è</div>
                    <h2 class="activity-title">ADA/HIPAA Compliance Scenarios</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Select the correct legal/ethical response for each scenario 
                    involving patients with sensory loss and privacy requirements.
                </p>
                
                <div class="scenario-container">
                    <!-- Scenario 1 -->
                    <div class="legal-scenario">
                        <div class="legal-question">
                            1. A patient who is deaf and uses American Sign Language (ASL) comes for a 
                            diabetes education appointment. What is the appropriate ADA accommodation?
                        </div>
                        <div class="legal-options">
                            <div class="legal-option" data-scenario="1" data-answer="incorrect">
                                <div class="option-indicator"></div>
                                <div class="option-text">Have a bilingual staff member try to communicate</div>
                            </div>
                            <div class="legal-option" data-scenario="1" data-answer="correct">
                                <div class="option-indicator"></div>
                                <div class="option-text">Schedule a qualified sign language interpreter</div>
                            </div>
                            <div class="legal-option" data-scenario="1" data-answer="incorrect">
                                <div class="option-indicator"></div>
                                <div class="option-text">Write notes back and forth during the appointment</div>
                            </div>
                            <div class="legal-option" data-scenario="1" data-answer="incorrect">
                                <div class="option-indicator"></div>
                                <div class="option-text">Ask a family member to interpret if available</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scenario 2 -->
                    <div class="legal-scenario">
                        <div class="legal-question">
                            2. A family member calls asking about their elderly mother's recent 
                            hearing test results. The mother has moderate dementia. What is the HIPAA-compliant response?
                        </div>
                        <div class="legal-options">
                            <div class="legal-option" data-scenario="2" data-answer="incorrect">
                                <div class="option-indicator"></div>
                                <div class="option-text">Provide results since they're immediate family</div>
                            </div>
                            <div class="legal-option" data-scenario="2" data-answer="incorrect">
                                <div class="option-indicator"></div>
                                <div class="option-text">Ask them to get written permission from the patient</div>
                            </div>
                            <div class="legal-option" data-scenario="2" data-answer="correct">
                                <div class="option-indicator"></div>
                                <div class="option-text">"I cannot disclose protected health information without proper authorization"</div>
                            </div>
                            <div class="legal-option" data-scenario="2" data-answer="incorrect">
                                <div class="option-indicator"></div>
                                <div class="option-text">Provide general information but not specific results</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scenario 3 -->
                    <div class="legal-scenario">
                        <div class="legal-question">
                            3. A patient with low vision requests that their medical information be provided 
                            in an accessible format. What ADA requirement applies?
                        </div>
                        <div class="legal-options">
                            <div class="legal-option" data-scenario="3" data-answer="correct">
                                <div class="option-indicator"></div>
                                <div class="option-text">Provide information in large print, braille, or audio format</div>
                            </div>
                            <div class="legal-option" data-scenario="3" data-answer="incorrect">
                                <div class="option-indicator"></div>
                                <div class="option-text">Read the information aloud to the patient</div>
                            </div>
                            <div class="legal-option" data-scenario="3" data-answer="incorrect">
                                <div class="option-indicator"></div>
                                <div class="option-text">Ask a family member to read it to them</div>
                            </div>
                            <div class="legal-option" data-scenario="3" data-answer="incorrect">
                                <div class="option-indicator"></div>
                                <div class="option-text">Provide standard print and offer a magnifying glass</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="activity-btn" id="checkLegalBtn">
                        ‚úì Check Legal Responses
                    </button>
                </div>
                
                <div class="feedback-message" id="legalFeedback"></div>
            </section>

            <!-- ACTIVITY 4: NOSE/THROAT EXAM PROCEDURE -->
            <section class="activity-card" aria-label="Nose/Throat Exam Procedure Activity">
                <div class="activity-header">
                    <div class="activity-icon">üîÑ</div>
                    <h2 class="activity-title">Nose & Throat Exam Procedure Sequence</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Click on each step in the correct order for a comprehensive 
                    nose and throat examination. Follow proper clinical sequence.
                </p>
                
                <div class="procedure-steps">
                    <div class="procedure-step" data-step="1" data-order="1">
                        <div class="procedure-number">?</div>
                        <div class="procedure-content">
                            <div class="procedure-title">Patient History & Consent</div>
                            <div class="procedure-description">Review symptoms, medical history, obtain consent for exam</div>
                        </div>
                    </div>
                    
                    <div class="procedure-step" data-step="2" data-order="5">
                        <div class="procedure-number">?</div>
                        <div class="procedure-content">
                            <div class="procedure-title">External Nose Inspection</div>
                            <div class="procedure-description">Observe symmetry, skin condition, any deformities</div>
                        </div>
                    </div>
                    
                    <div class="procedure-step" data-step="3" data-order="2">
                        <div class="procedure-number">?</div>
                        <div class="procedure-content">
                            <div class="procedure-title">Prepare Equipment & Positioning</div>
                            <div class="procedure-description">Gather otoscope/nasoscope, tongue depressors, position patient</div>
                        </div>
                    </div>
                    
                    <div class="procedure-step" data-step="4" data-order="6">
                        <div class="procedure-number">?</div>
                        <div class="procedure-content">
                            <div class="procedure-title">Nasal Cavity Examination</div>
                            <div class="procedure-description">Use nasoscope to inspect turbinates, septum, mucosa</div>
                        </div>
                    </div>
                    
                    <div class="procedure-step" data-step="5" data-order="3">
                        <div class="procedure-number">?</div>
                        <div class="procedure-content">
                            <div class="procedure-title">Hand Hygiene & PPE</div>
                            <div class="procedure-description">Wash hands, don gloves, mask if respiratory symptoms present</div>
                        </div>
                    </div>
                    
                    <div class="procedure-step" data-step="6" data-order="7">
                        <div class="procedure-number">?</div>
                        <div class="procedure-content">
                            <div class="procedure-title">Throat Examination</div>
                            <div class="procedure-description">Inspect tonsils, pharynx, uvula using tongue depressor</div>
                        </div>
                    </div>
                    
                    <div class="procedure-step" data-step="7" data-order="8">
                        <div class="procedure-number">?</div>
                        <div class="procedure-content">
                            <div class="procedure-title">Documentation & Patient Education</div>
                            <div class="procedure-description">Record findings, discuss results, provide follow-up instructions</div>
                        </div>
                    </div>
                    
                    <div class="procedure-step" data-step="8" data-order="4">
                        <div class="procedure-number">?</div>
                        <div class="procedure-content">
                            <div class="procedure-title">Palpation of Sinuses & Lymph Nodes</div>
                            <div class="procedure-description">Gently palpate frontal/maxillary sinuses, cervical lymph nodes</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="activity-btn" id="checkProcedureBtn">
                        ‚úì Check Procedure Sequence
                    </button>
                </div>
                
                <div class="feedback-message" id="procedureFeedback"></div>
                
                <div style="margin-top: 24px; padding: 20px; background: rgba(175, 75, 239, 0.05); border-radius: var(--radius-sm); font-size: 0.95rem;">
                    <strong>Clinical Tip:</strong> Always use proper lighting for throat exams. For nasal examination, 
                    use vasoconstrictor spray if mucosa is swollen. Document tonsil size using grading scale (1+ to 4+).
                </div>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="resetBtn">
                <span>‚Üª</span>
                Reset All Activities
            </button>
            <button class="btn btn-primary" id="checkBtn">
                <span>‚úì</span>
                Check All Answers
            </button>
            <button class="btn btn-primary" id="viewResultsBtn" style="display: none;">
                <span>üìä</span>
                View Final Results
            </button>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="resultsPanel">
            <div class="results-header">
                <div class="activity-icon" style="background: var(--color-success);">‚úì</div>
                <h3 class="results-title">Module 4 Complete!</h3>
            </div>
            <div class="results-content">
                <p>Excellent work! You've completed the <strong>Nose, Throat & Sensory Loss Clinic</strong> module.</p>
                
                <div class="score-display">
                    <div class="score-value" id="scoreValue">0%</div>
                    <div class="score-text" id="scoreText">Your overall score</div>
                </div>
                
                <p><strong>What you've mastered:</strong></p>
                <ul style="margin-left: 20px; margin-top: 8px; margin-bottom: 16px;">
                    <li>‚úì Throat culture collection technique & proper swabbing</li>
                    <li>‚úì Sensory loss communication strategies (vision & hearing)</li>
                    <li>‚úì ADA compliance for patients with disabilities</li>
                    <li>‚úì HIPAA privacy requirements & ethical responses</li>
                    <li>‚úì Comprehensive nose/throat examination sequence</li>
                </ul>
                
                <div class="clinical-insight">
                    <strong>Clinical Insight:</strong> When working with patients with sensory loss, always ask about 
                    their preferred communication method. Document accommodations provided. For throat cultures, 
                    rapid strep tests have high specificity but lower sensitivity - culture remains gold standard 
                    for Group A Strep diagnosis.
                </div>
            </div>
        </div>
    </main>

    <script>
        // === STATE MANAGEMENT ===
        let moduleState = {
            throatCulture: { completed: false, score: 0, total: 3 },
            communication: { completed: false, score: 0, total: 8 },
            legalScenarios: { completed: false, score: 0, total: 3 },
            procedures: { completed: false, score: 0, total: 8 },
            startTime: new Date(),
            activitiesCompleted: 0
        };

        // === FIXED: ACTIVITY 1: THROAT CULTURE FUNCTIONS ===
        function initializeThroatCultureActivity() {
            let draggedTag = null;
            
            // FIXED: Add draggable="true" and proper drag events
            document.querySelectorAll('.swab-tag').forEach(tag => {
                tag.addEventListener('dragstart', function(e) {
                    draggedTag = this;
                    this.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', this.id);
                    
                    setTimeout(() => {
                        this.style.opacity = '0.4';
                    }, 0);
                });
                
                tag.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    this.style.opacity = '1';
                    draggedTag = null;
                });
            });
            
            // FIXED: Throat area drop events
            document.querySelectorAll('.throat-area').forEach(area => {
                area.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderColor = 'var(--color-primary)';
                    this.style.backgroundColor = 'rgba(175, 75, 239, 0.05)';
                });
                
                area.addEventListener('dragleave', function() {
                    this.style.borderColor = '#ddd';
                    this.style.backgroundColor = 'white';
                });
                
                area.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ddd';
                    this.style.backgroundColor = 'white';
                    
                    if (draggedTag) {
                        // Create clone
                        const tagClone = draggedTag.cloneNode(true);
                        tagClone.classList.remove('dragging');
                        tagClone.classList.add('placed');
                        tagClone.draggable = false;
                        tagClone.style.cursor = 'default';
                        tagClone.style.opacity = '1';
                        tagClone.style.margin = '10px';
                        tagClone.style.width = '80%';
                        
                        // Clear area and add clone
                        this.innerHTML = `
                            <div class="area-title">${this.dataset.area === 'uvula' ? 'Uvula' : 
                                this.dataset.area === 'left-tonsil' ? 'Left Tonsillar Pillar' :
                                this.dataset.area === 'right-tonsil' ? 'Right Tonsillar Pillar' :
                                'Posterior Pharynx'}</div>
                        `;
                        this.appendChild(tagClone);
                        
                        // Hide original (but keep for reset)
                        draggedTag.style.visibility = 'hidden';
                    }
                });
            });
            
            // FIXED: Check swabbing button
            document.getElementById('checkSwabbingBtn').addEventListener('click', checkSwabbingAnswers);
        }
        
        function checkSwabbingAnswers() {
            const correctAreas = ['left-tonsil', 'right-tonsil', 'posterior-pharynx'];
            const incorrectArea = 'uvula';
            
            let score = 0;
            let feedback = '';
            
            // Check each area
            correctAreas.forEach(areaId => {
                const area = document.getElementById(`area-${areaId}`);
                const hasTag = area.querySelector('.swab-tag') !== null;
                
                if (hasTag) {
                    area.classList.remove('incorrect-drop');
                    area.classList.add('correct-drop');
                    score++;
                } else {
                    area.classList.remove('correct-drop');
                    area.classList.add('incorrect-drop');
                }
            });
            
            // Check uvula (should NOT have tag)
            const uvulaArea = document.getElementById(`area-${incorrectArea}`);
            const uvulaHasTag = uvulaArea.querySelector('.swab-tag') !== null;
            
            if (!uvulaHasTag) {
                uvulaArea.classList.remove('incorrect-drop');
                uvulaArea.classList.add('correct-drop');
                score++;
            } else {
                uvulaArea.classList.remove('correct-drop');
                uvulaArea.classList.add('incorrect-drop');
            }
            
            // Update module state
            moduleState.throatCulture.score = Math.floor(score * 0.75); // 3 points max
            moduleState.throatCulture.completed = true;
            
            // Provide feedback
            if (score === 4) {
                feedback = '‚úì Perfect! All swabs placed correctly. Remember: swab both tonsillar pillars and posterior pharynx, avoid uvula.';
            } else if (score >= 2) {
                feedback = `‚úì Good effort! ${score}/4 correct. Review proper throat culture technique.`;
            } else {
                feedback = `‚úó Needs practice. ${score}/4 correct. Proper throat culture requires swabbing tonsillar pillars and posterior pharynx while avoiding contaminants.`;
            }
            
            showFeedback('swabbingFeedback', feedback, score >= 2 ? 'correct' : 'incorrect');
            updateProgress();
        }

        // === FIXED: ACTIVITY 2: COMMUNICATION FUNCTIONS ===
        function initializeCommunicationActivity() {
            let draggedCard = null;
            
            // FIXED: Communication card drag events
            document.querySelectorAll('.communication-card').forEach(card => {
                card.addEventListener('dragstart', function(e) {
                    draggedCard = this;
                    this.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', this.id);
                    
                    // Add active class to drop zones
                    document.querySelectorAll('.drop-zone').forEach(zone => {
                        zone.classList.add('active');
                    });
                });
                
                card.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    draggedCard = null;
                    
                    // Remove active class from drop zones
                    document.querySelectorAll('.drop-zone').forEach(zone => {
                        zone.classList.remove('active');
                    });
                });
            });
            
            // FIXED: Drop zone events
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                });
                
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    
                    if (draggedCard) {
                        // Create clone
                        const cardClone = draggedCard.cloneNode(true);
                        cardClone.classList.remove('dragging');
                        cardClone.draggable = true; // Allow re-dragging
                        cardClone.style.cursor = 'grab';
                        cardClone.style.margin = '5px';
                        
                        // Add new drag event to clone
                        cardClone.addEventListener('dragstart', function(e) {
                            this.classList.add('dragging');
                            e.dataTransfer.setData('text/plain', this.id);
                            
                            document.querySelectorAll('.drop-zone').forEach(z => {
                                z.classList.add('active');
                            });
                        });
                        
                        cardClone.addEventListener('dragend', function() {
                            this.classList.remove('dragging');
                            
                            document.querySelectorAll('.drop-zone').forEach(z => {
                                z.classList.remove('active');
                            });
                        });
                        
                        this.appendChild(cardClone);
                    }
                });
            });
            
            // FIXED: Check communication button
            document.getElementById('checkCommunicationBtn').addEventListener('click', checkCommunicationMatches);
        }
        
        function checkCommunicationMatches() {
            const correctMatches = {
                'drop-vision': ['card-large-print', 'card-verbal-description', 'card-contrast-colors'],
                'drop-hearing': ['card-face-patient', 'card-reduce-noise', 'card-assistive-listening'],
                'both': ['card-teach-back', 'card-extra-time']
            };
            
            let score = 0;
            let totalMatches = 0;
            
            // Check vision drop zone
            const visionZone = document.getElementById('drop-vision');
            const visionCards = Array.from(visionZone.querySelectorAll('.communication-card'))
                .map(card => card.id);
            
            correctMatches['drop-vision'].forEach(correctId => {
                if (visionCards.includes(correctId)) {
                    document.getElementById(correctId).classList.add('correct');
                    score++;
                }
                totalMatches++;
            });
            
            // Check hearing drop zone
            const hearingZone = document.getElementById('drop-hearing');
            const hearingCards = Array.from(hearingZone.querySelectorAll('.communication-card'))
                .map(card => card.id);
            
            correctMatches['drop-hearing'].forEach(correctId => {
                if (hearingCards.includes(correctId)) {
                    document.getElementById(correctId).classList.add('correct');
                    score++;
                }
                totalMatches++;
            });
            
            // Cards that can be in either zone
            const bothCards = visionCards.concat(hearingCards);
            correctMatches['both'].forEach(correctId => {
                if (bothCards.includes(correctId)) {
                    document.getElementById(correctId).classList.add('correct');
                    score++;
                }
                totalMatches++;
            });
            
            // Update module state
            moduleState.communication.score = Math.floor((score / totalMatches) * 8);
            moduleState.communication.completed = true;
            
            // Provide feedback
            const percentage = Math.round((score / totalMatches) * 100);
            let feedback = '';
            
            if (percentage >= 90) {
                feedback = `‚úì Excellent! ${score}/${totalMatches} strategies correctly matched. You understand sensory loss communication well.`;
            } else if (percentage >= 70) {
                feedback = `‚úì Good work! ${score}/${totalMatches} correct. Review strategies for patients with vision/hearing impairments.`;
            } else {
                feedback = `‚úó Needs review. ${score}/${totalMatches} correct. Remember: vision strategies focus on visual adaptations, hearing strategies focus on auditory adaptations.`;
            }
            
            showFeedback('communicationFeedback', feedback, percentage >= 70 ? 'correct' : 'incorrect');
            updateProgress();
        }

        // === ACTIVITY 3: LEGAL SCENARIOS FUNCTIONS ===
        function initializeLegalActivity() {
            // Legal option click events
            document.querySelectorAll('.legal-option').forEach(option => {
                option.addEventListener('click', function() {
                    const scenario = this.dataset.scenario;
                    
                    // Remove selection from other options in same scenario
                    document.querySelectorAll(`.legal-option[data-scenario="${scenario}"]`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Select this one
                    this.classList.add('selected');
                });
            });
            
            // Check legal button
            document.getElementById('checkLegalBtn').addEventListener('click', checkLegalAnswers);
        }
        
        function checkLegalAnswers() {
            let score = 0;
            let totalScenarios = 3;
            
            // Check each scenario
            for (let i = 1; i <= totalScenarios; i++) {
                const selectedOption = document.querySelector(`.legal-option[data-scenario="${i}"].selected`);
                
                if (selectedOption && selectedOption.dataset.answer === 'correct') {
                    selectedOption.classList.add('correct');
                    score++;
                } else if (selectedOption) {
                    selectedOption.classList.add('incorrect');
                    // Show correct answer
                    document.querySelector(`.legal-option[data-scenario="${i}"][data-answer="correct"]`)
                        .classList.add('correct');
                }
                
                // Disable further clicks
                document.querySelectorAll(`.legal-option[data-scenario="${i}"]`).forEach(opt => {
                    opt.style.pointerEvents = 'none';
                });
            }
            
            // Update module state
            moduleState.legalScenarios.score = score;
            moduleState.legalScenarios.completed = true;
            
            // Provide feedback
            let feedback = '';
            if (score === totalScenarios) {
                feedback = '‚úì Perfect! All legal/ethical responses correct. You understand ADA/HIPAA requirements.';
            } else if (score >= 2) {
                feedback = `‚úì Good! ${score}/${totalScenarios} correct. Review the scenarios marked in red.`;
            } else {
                feedback = `‚úó Needs review. ${score}/${totalScenarios} correct. Remember: ADA requires reasonable accommodations, HIPAA protects patient privacy.`;
            }
            
            showFeedback('legalFeedback', feedback, score >= 2 ? 'correct' : 'incorrect');
            updateProgress();
        }

        // === ACTIVITY 4: PROCEDURE FUNCTIONS ===
        function initializeProcedureActivity() {
            let clickOrder = [];
            let currentClick = 1;
            const maxSteps = 8;
            const correctOrder = [1, 3, 5, 8, 2, 4, 6, 7];
            
            // Procedure step click events
            document.querySelectorAll('.procedure-step').forEach(step => {
                step.addEventListener('click', function() {
                    // If already clicked, skip
                    if (this.classList.contains('active')) return;
                    
                    // Mark as active in current order
                    const stepNumber = parseInt(this.dataset.step);
                    clickOrder.push(stepNumber);
                    
                    // Update display
                    const numberSpan = this.querySelector('.procedure-number');
                    numberSpan.textContent = currentClick;
                    this.classList.add('active');
                    
                    currentClick++;
                    
                    // Check if all steps are clicked
                    if (clickOrder.length === maxSteps) {
                        checkProcedureSequence(clickOrder, correctOrder);
                    }
                });
            });
            
            // Check procedure button
            document.getElementById('checkProcedureBtn').addEventListener('click', function() {
                if (clickOrder.length < maxSteps) {
                    showFeedback('procedureFeedback', 
                        `Please click all ${maxSteps} steps in the correct order first!`, 
                        'incorrect');
                    return;
                }
                checkProcedureSequence(clickOrder, correctOrder);
            });
        }
        
        function checkProcedureSequence(clickOrder, correctOrder) {
            let correctCount = 0;
            
            // Compare sequences
            for (let i = 0; i < clickOrder.length; i++) {
                if (clickOrder[i] === correctOrder[i]) {
                    correctCount++;
                }
            }
            
            // Calculate score
            moduleState.procedures.score = correctCount;
            moduleState.procedures.completed = true;
            
            // Visual feedback
            document.querySelectorAll('.procedure-step').forEach((step, index) => {
                const stepNumber = parseInt(step.dataset.step);
                const numberSpan = step.querySelector('.procedure-number');
                
                if (stepNumber === correctOrder[index]) {
                    numberSpan.style.background = 'var(--color-success)';
                } else {
                    numberSpan.style.background = 'var(--color-error)';
                    const correctIndex = correctOrder.indexOf(stepNumber);
                    if (correctIndex !== -1) {
                        numberSpan.title = `Should be step ${correctIndex + 1}`;
                    }
                }
            });
            
            // Show feedback
            const percentage = Math.round((correctCount / 8) * 100);
            let feedback = '';
            
            if (percentage === 100) {
                feedback = `‚úì Perfect! All ${correctCount}/8 steps in correct order.`;
            } else if (percentage >= 75) {
                feedback = `‚úì Good! ${correctCount}/8 steps correct (${percentage}%). Review the steps marked in red.`;
            } else {
                feedback = `‚úó Needs review. ${correctCount}/8 steps correct (${percentage}%). Proper sequence: History ‚Üí Prep ‚Üí Hygiene ‚Üí Palpation ‚Üí External ‚Üí Nasal ‚Üí Throat ‚Üí Documentation.`;
            }
            
            showFeedback('procedureFeedback', feedback, 
                percentage >= 75 ? 'correct' : 'incorrect');
            
            updateProgress();
        }

        // === INITIALIZE MODULE ===
        document.addEventListener('DOMContentLoaded', function() {
            initializeThroatCultureActivity();
            initializeCommunicationActivity();
            initializeLegalActivity();
            initializeProcedureActivity();
            setupEventListeners();
            updateProgress();
            startTimer();
        });

        // === HELPER FUNCTIONS ===
        function setupEventListeners() {
            // Reset button
            document.getElementById('resetBtn').addEventListener('click', resetAllActivities);
            
            // Check all answers button
            document.getElementById('checkBtn').addEventListener('click', checkAllAnswers);
            
            // View results button
            document.getElementById('viewResultsBtn').addEventListener('click', showFinalResults);
        }

        function showFeedback(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'feedback-message';
            element.classList.add(`feedback-${type}`);
            element.style.display = 'block';
            
            if (type === 'incorrect') {
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            }
        }

        function updateProgress() {
            // Calculate completed activities
            let completedCount = 0;
            if (moduleState.throatCulture.completed) completedCount++;
            if (moduleState.communication.completed) completedCount++;
            if (moduleState.legalScenarios.completed) completedCount++;
            if (moduleState.procedures.completed) completedCount++;
            
            document.getElementById('completedCount').textContent = completedCount;
            
            // Calculate accuracy
            let totalScore = 0;
            let totalPossible = 0;
            
            Object.values(moduleState).forEach(activity => {
                if (activity.score !== undefined && activity.total) {
                    totalScore += activity.score;
                    totalPossible += activity.total;
                }
            });
            
            const accuracy = totalPossible > 0 ? Math.round((totalScore / totalPossible) * 100) : 0;
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            
            // Update progress tracker
            if (completedCount >= 4) {
                document.querySelectorAll('.progress-step').forEach(step => {
                    step.classList.remove('active');
                    step.classList.add('completed');
                });
                
                // Show "View Results" button
                document.getElementById('checkBtn').style.display = 'none';
                document.getElementById('viewResultsBtn').style.display = 'flex';
            } else if (completedCount >= 1) {
                document.querySelectorAll('.progress-step').forEach((step, index) => {
                    step.classList.remove('active', 'completed');
                    if (index < completedCount) {
                        step.classList.add('completed');
                    }
                    if (index === completedCount) {
                        step.classList.add('active');
                    }
                });
            }
            
            // Update module state
            moduleState.activitiesCompleted = completedCount;
        }

        function startTimer() {
            const timeElement = document.getElementById('timeSpent');
            
            setInterval(() => {
                const now = new Date();
                const diffMs = now - moduleState.startTime;
                const diffMins = Math.floor(diffMs / 60000);
                timeElement.textContent = `${diffMins} min`;
            }, 60000);
        }

        function checkAllAnswers() {
            // Trigger check for each activity if not already checked
            if (!moduleState.throatCulture.completed) {
                checkSwabbingAnswers();
            }
            
            if (!moduleState.communication.completed) {
                checkCommunicationMatches();
            }
            
            if (!moduleState.legalScenarios.completed) {
                checkLegalAnswers();
            }
            
            if (!moduleState.procedures.completed) {
                showFeedback('procedureFeedback', 
                    'Complete the procedure sequence activity first!', 
                    'incorrect');
            }
            
            updateProgress();
            
            // If all activities completed, show results
            if (moduleState.activitiesCompleted >= 4) {
                showFinalResults();
            }
        }

        function showFinalResults() {
            // Calculate final score
            let totalScore = 0;
            let totalPossible = 0;
            
            Object.values(moduleState).forEach(activity => {
                if (activity.score !== undefined && activity.total) {
                    totalScore += activity.score;
                    totalPossible += activity.total;
                }
            });
            
            const finalScore = totalPossible > 0 ? Math.round((totalScore / totalPossible) * 100) : 0;
            
            // Animate score counter
            const scoreElement = document.getElementById('scoreValue');
            animateCounter(scoreElement, 0, finalScore, 1500);
            
            // Set score text
            const scoreText = document.getElementById('scoreText');
            let performance = '';
            
            if (finalScore >= 90) performance = 'Outstanding!';
            else if (finalScore >= 80) performance = 'Excellent!';
            else if (finalScore >= 70) performance = 'Good!';
            else performance = 'Keep practicing!';
            
            scoreText.textContent = `${performance} Your overall score`;
            
            // Show results panel
            document.getElementById('resultsPanel').classList.add('show');
            
            // Scroll to results
            setTimeout(() => {
                document.getElementById('resultsPanel').scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest'
                });
            }, 100);
        }

        function animateCounter(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const value = Math.floor(progress * (end - start) + start);
                element.textContent = `${value}%`;
                
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function resetAllActivities() {
            // Reset module state
            moduleState = {
                throatCulture: { completed: false, score: 0, total: 3 },
                communication: { completed: false, score: 0, total: 8 },
                legalScenarios: { completed: false, score: 0, total: 3 },
                procedures: { completed: false, score: 0, total: 8 },
                startTime: new Date(),
                activitiesCompleted: 0
            };
            
            // Reset activity 1
            document.querySelectorAll('.swab-tag').forEach(tag => {
                tag.classList.remove('dragging', 'placed');
                tag.style.visibility = 'visible';
                tag.style.opacity = '1';
                tag.draggable = true;
                tag.style.cursor = 'grab';
                tag.style.width = 'auto';
                tag.style.margin = '0';
            });
            
            // Reset throat areas
            document.querySelectorAll('.throat-area').forEach(area => {
                const areaId = area.id.replace('area-', '');
                area.innerHTML = `
                    <div class="area-title">${areaId === 'uvula' ? 'Uvula' : 
                        areaId === 'left-tonsil' ? 'Left Tonsillar Pillar' :
                        areaId === 'right-tonsil' ? 'Right Tonsillar Pillar' :
                        'Posterior Pharynx'}</div>
                    <div class="area-instruction">
                        ${areaId === 'uvula' ? 'DO NOT SWAB (contaminant)' : 'Swab area thoroughly'}
                    </div>
                `;
                area.classList.remove('correct-drop', 'incorrect-drop');
                area.style.borderColor = '#ddd';
                area.style.backgroundColor = 'white';
            });
            
            // Reset activity 2
            document.querySelectorAll('.communication-card').forEach(card => {
                card.classList.remove('correct', 'incorrect', 'dragging');
                card.draggable = true;
                card.style.cursor = 'grab';
                card.style.margin = '0';
            });
            
            // Clear drop zones
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.innerHTML = '<div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">' + 
                    (zone.id === 'drop-vision' ? 'Drop Vision Strategies Here' : 'Drop Hearing Strategies Here') + 
                    '</div>';
            });
            
            // Reset activity 3
            document.querySelectorAll('.legal-option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
                option.style.pointerEvents = 'auto';
            });
            
            // Reset activity 4
            document.querySelectorAll('.procedure-step').forEach(step => {
                step.classList.remove('active');
                const numberSpan = step.querySelector('.procedure-number');
                numberSpan.textContent = '?';
                numberSpan.style.background = 'var(--color-primary)';
                numberSpan.title = '';
            });
            
            // Clear feedback messages
            document.querySelectorAll('.feedback-message').forEach(feedback => {
                feedback.textContent = '';
                feedback.className = 'feedback-message';
                feedback.style.display = 'none';
            });
            
            // Hide results panel
            document.getElementById('resultsPanel').classList.remove('show');
            
            // Reset buttons
            document.getElementById('checkBtn').style.display = 'flex';
            document.getElementById('viewResultsBtn').style.display = 'none';
            
            // Reset progress tracker
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('completed');
                if (index === 0) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
            
            // Update progress display
            updateProgress();
            
            // Show reset confirmation
            showFeedback('swabbingFeedback', '‚úì All activities have been reset. Ready to start again!', 'correct');
        }
    </script>
</body>
</html>
