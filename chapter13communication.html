<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ALLIEDRx -- Chapter 4: Communication Techniques Simulator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* === ALLIEDRx BRANDING EXACT MATCH === */
        :root {
            --color-primary: #af4bef; /* Purple - main brand color */
            --color-primary-soft: #d492ff; /* Light purple */
            --color-accent: #8380f0; /* Blue-purple accent */
            --color-success: #00b894; /* Green for correct/success */
            --color-warning: #fdcb6e;
            --color-error: #e17055; /* Red/Orange for errors */
            --color-bg: #f7f5fb; /* Light background */
            --color-text: #2b2b2b; /* Dark text */
            --color-muted: #6c6880; /* Muted text */
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --shadow-soft: 0 18px 45px rgba(23, 10, 61, 0.18);
            --shadow-medium: 0 12px 30px rgba(23, 10, 61, 0.12);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            padding: 24px;
            background: radial-gradient(
                circle at top left,
                #ffffff 0,
                #f1ecff 40%,
                var(--color-bg) 100%
            );
            color: var(--color-text);
            -webkit-text-size-adjust: 100%;
        }

        @media (max-width: 600px) {
            body {
                padding: 12px;
            }
        }

        /* === ANIMATIONS === */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes checkmarkPop {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* === MAIN PAGE CONTAINER === */
        .page {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 28px 30px 32px;
            display: flex;
            flex-direction: column;
            gap: 32px;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.6s ease-out;
        }

        @media (max-width: 900px) {
            .page {
                padding: 22px;
                gap: 28px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
            }
            .page {
                border-radius: 0;
                box-shadow: none;
                padding: 18px 14px 22px;
                gap: 24px;
            }
        }

        /* === ALLIEDRx HEADER/BRANDING === */
        .brand-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 14px;
            margin-bottom: 8px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeInUp 0.5s ease-out;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 40px;
            width: auto;
            max-width: 100%;
            filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.2));
        }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--color-muted);
            white-space: normal;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(175, 75, 239, 0.08);
            font-size: 0.76rem;
            color: var(--color-primary);
            white-space: normal;
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-success);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        .badge-mode {
            padding: 5px 10px;
            border-radius: 999px;
            background: rgba(12, 10, 24, 0.06);
            border: 1px solid rgba(12, 10, 24, 0.08);
            font-size: 0.74rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--color-muted);
            white-space: nowrap;
        }

        @media (max-width: 480px) {
            .brand-row {
                flex-direction: column;
                align-items: flex-start;
            }
            .badge-mode {
                margin-top: 6px;
            }
        }

        /* === MODULE HEADER === */
        .module-header {
            animation: fadeInUp 0.5s ease-out 0.1s both;
        }

        h1 {
            font-size: clamp(2rem, 3vw, 2.4rem);
            line-height: 1.05;
            color: var(--color-primary);
            margin-bottom: 6px;
        }

        .module-subtitle {
            font-size: 1.1rem;
            color: var(--color-muted);
            max-width: 800px;
            margin-bottom: 6px;
        }

        .module-description {
            font-size: 0.98rem;
            color: var(--color-muted);
            max-width: 800px;
            line-height: 1.6;
        }

        /* === PROGRESS TRACKER === */
        .progress-tracker {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 8px 0 20px;
            animation: fadeInUp 0.5s ease-out 0.2s both;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--color-muted);
        }

        .progress-step.active {
            color: var(--color-primary);
            font-weight: 600;
        }

        .progress-step.completed {
            color: var(--color-success);
        }

        .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-muted);
        }

        .progress-step.active .step-icon {
            background: var(--color-primary);
            color: white;
        }

        .progress-step.completed .step-icon {
            background: var(--color-success);
            color: white;
        }

        .step-divider {
            flex: 1;
            height: 2px;
            background: rgba(12, 10, 24, 0.1);
            margin: 0 8px;
        }

        /* === PROGRESS SUMMARY === */
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 16px;
            padding: 16px;
            background: rgba(175, 75, 239, 0.03);
            border-radius: var(--radius-sm);
            animation: fadeInUp 0.5s ease-out 0.3s both;
        }

        @media (max-width: 480px) {
            .progress-summary {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        .progress-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .progress-number {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--color-primary);
        }

        .progress-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
        }

        /* === ACTIVITY GRID === */
        .activity-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
            margin-bottom: 24px;
            animation: fadeInUp 0.5s ease-out 0.3s both;
        }

        /* === ACTIVITY CARDS === */
        .activity-card {
            background: rgba(175, 75, 239, 0.03);
            border-radius: var(--radius-md);
            border: 1px solid rgba(175, 75, 239, 0.1);
            padding: 28px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
        }

        .activity-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .activity-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .activity-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--color-text);
        }

        .activity-description {
            font-size: 1rem;
            color: var(--color-muted);
            line-height: 1.6;
            margin-bottom: 8px;
        }

        /* === CLINICAL TIP STYLES === */
        .clinical-tip {
            margin: 20px 0;
            padding: 16px 20px;
            background: rgba(175, 75, 239, 0.05);
            border-left: 4px solid var(--color-primary);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .tip-label {
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* === ACTIVITY 1: DRAG-AND-DROP COMMUNICATION TECHNIQUES === */
        .technique-scenario-container {
            display: flex;
            flex-direction: column;
            gap: 28px;
        }

        .scenario {
            background: white;
            border-radius: var(--radius-md);
            padding: 24px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .patient-info {
            font-weight: 700;
            color: var(--color-primary);
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .patient-demographics {
            font-size: 1rem;
            color: var(--color-muted);
            margin-bottom: 12px;
        }

        .scenario-text {
            color: var(--color-text);
            margin-bottom: 16px;
            line-height: 1.6;
            font-size: 1rem;
        }

        .scenario-text strong {
            color: var(--color-muted);
        }

        .technique-instruction {
            font-size: 1rem;
            color: var(--color-muted);
            margin-bottom: 16px;
            font-style: italic;
            padding: 16px;
            background: rgba(175, 75, 239, 0.05);
            border-radius: var(--radius-sm);
            line-height: 1.5;
        }

        .technique-match-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 24px 0;
        }

        @media (max-width: 768px) {
            .technique-match-grid {
                grid-template-columns: 1fr;
            }
        }

        .technique-drop-zone {
            background: white;
            border-radius: var(--radius-sm);
            padding: 24px;
            border: 3px dashed #ddd;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 140px;
            justify-content: center;
            cursor: pointer;
        }

        .technique-drop-zone:hover {
            border-color: var(--color-primary-soft);
            background-color: rgba(175, 75, 239, 0.03);
        }

        .technique-drop-zone.correct-drop {
            border-color: var(--color-success);
            background-color: rgba(0, 184, 148, 0.05);
        }

        .technique-drop-zone.incorrect-drop {
            border-color: var(--color-error);
            background-color: rgba(225, 112, 85, 0.05);
        }

        .zone-title {
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .zone-instruction {
            font-size: 0.95rem;
            color: var(--color-text);
            line-height: 1.4;
        }

        .technique-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 24px 0;
            justify-content: center;
        }

        .technique-tag {
            background: white;
            border: 3px solid var(--color-accent);
            color: var(--color-text);
            padding: 12px 20px;
            border-radius: 24px;
            font-size: 1rem;
            cursor: grab;
            transition: all 0.2s ease;
            user-select: none;
            font-weight: 600;
        }

        .technique-tag:hover {
            background: var(--color-accent);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(131, 128, 240, 0.3);
        }

        .technique-tag.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .technique-tag.placed {
            background: var(--color-success);
            color: white;
            border-color: var(--color-success);
            cursor: default;
        }

        /* === FEEDBACK SECTION - ALWAYS VISIBLE === */
        .feedback-details {
            margin-top: 24px;
            padding: 20px;
            background: rgba(175, 75, 239, 0.03);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--color-accent);
            display: block;
            animation: fadeIn 0.5s ease;
            min-height: 100px;
        }

        .feedback-title {
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 12px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feedback-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .feedback-item {
            margin-bottom: 12px;
            padding-left: 24px;
            position: relative;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .feedback-item.correct:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--color-success);
            font-weight: bold;
        }

        .feedback-item.incorrect:before {
            content: "‚úó";
            position: absolute;
            left: 0;
            color: var(--color-error);
            font-weight: bold;
        }

        .feedback-item.tip:before {
            content: "üí°";
            position: absolute;
            left: 0;
        }

        /* === ACTIVITY 2: NONVERBAL CUE IDENTIFICATION === */
        .nonverbal-container {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .nonverbal-scenario {
            background: white;
            border-radius: var(--radius-md);
            padding: 24px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .section-title {
            font-size: 1.2rem;
            color: var(--color-primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--color-primary-soft);
        }

        .cue-instruction {
            font-size: 1rem;
            color: var(--color-muted);
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .cue-options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        @media (max-width: 768px) {
            .cue-options-grid {
                grid-template-columns: 1fr;
            }
        }

        .cue-option {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px solid rgba(12, 10, 24, 0.08);
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .cue-option:hover {
            transform: translateY(-2px);
            border-color: var(--color-primary-soft);
            box-shadow: var(--shadow-medium);
        }

        .cue-option.selected {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.05);
        }

        .cue-option.correct {
            border-color: var(--color-success);
            background: rgba(0, 184, 148, 0.05);
        }

        .cue-option.incorrect {
            border-color: var(--color-error);
            background: rgba(225, 112, 85, 0.05);
        }

        .cue-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cue-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--color-muted);
            border-radius: 4px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
        }

        .cue-option.selected .cue-checkbox {
            background: var(--color-primary);
            border-color: var(--color-primary);
        }

        .cue-option.correct .cue-checkbox {
            background: var(--color-success);
            border-color: var(--color-success);
        }

        .cue-option.incorrect .cue-checkbox {
            background: var(--color-error);
            border-color: var(--color-error);
        }

        .cue-text {
            font-size: 1rem;
            font-weight: 500;
            color: var(--color-text);
            line-height: 1.5;
        }

        /* === ACTIVITY 3: INTERVIEW SEQUENCING === */
        .interview-sequence {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 24px;
        }

        .interview-step {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            border-left: 4px solid var(--color-primary);
            display: flex;
            align-items: flex-start;
            gap: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .interview-step:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-medium);
        }

        .interview-step.active {
            background: rgba(175, 75, 239, 0.05);
        }

        .interview-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            flex-shrink: 0;
            transition: background 0.3s ease;
        }

        .interview-content {
            flex: 1;
        }

        .interview-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .interview-description {
            font-size: 0.9rem;
            color: var(--color-muted);
            line-height: 1.6;
        }

        /* === ACTIVITY 4: BARRIER MATCHING === */
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 32px;
        }

        @media (max-width: 768px) {
            .matching-container {
                grid-template-columns: 1fr;
            }
        }

        .matching-column {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .match-item {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px solid rgba(12, 10, 24, 0.08);
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            line-height: 1.5;
            font-weight: 500;
        }

        .match-item:hover {
            transform: translateY(-2px);
            border-color: var(--color-primary-soft);
            box-shadow: var(--shadow-medium);
        }

        .match-item.dragging {
            opacity: 0.7;
            transform: rotate(3deg);
        }

        .match-item.matched {
            border-color: var(--color-success);
            background: rgba(0, 184, 148, 0.05);
        }

        .match-item.incorrect-match {
            border-color: var(--color-error);
            background: rgba(225, 112, 85, 0.05);
        }

        .match-category {
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .match-drop-zones {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 32px;
        }

        @media (max-width: 768px) {
            .match-drop-zones {
                grid-template-columns: 1fr;
            }
        }

        .match-drop-zone {
            min-height: 120px;
            border: 3px dashed var(--color-primary-soft);
            border-radius: var(--radius-sm);
            padding: 20px;
            background: rgba(175, 75, 239, 0.03);
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: flex-start;
        }

        .match-drop-zone.active {
            border-color: var(--color-primary);
            background: rgba(175, 75, 239, 0.08);
        }

        /* === ACTION BUTTONS === */
        .action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 32px;
            animation: fadeInUp 0.5s ease-out 0.4s both;
        }

        .btn {
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #9a3ed8;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(175, 75, 239, 0.3);
        }

        .btn-secondary {
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(12, 10, 24, 0.12);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* === ACTIVITY BUTTONS === */
        .activity-btn {
            padding: 12px 24px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            align-self: flex-start;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .activity-btn:hover {
            background: #9a3ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(175, 75, 239, 0.3);
        }

        /* === RESULTS PANEL === */
        .results-panel {
            background: rgba(12, 10, 24, 0.94);
            color: #e5e7eb;
            border-radius: var(--radius-md);
            padding: 32px;
            margin-top: 32px;
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .results-panel.show {
            display: block;
        }

        .results-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #ffffff;
        }

        .results-content {
            font-size: 1rem;
            line-height: 1.7;
        }

        .results-content strong {
            color: #ffffff;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 24px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--color-primary-soft);
        }

        .score-text {
            font-size: 1rem;
            color: #c4b5fd;
        }

        /* === CLINICAL INSIGHT CARD === */
        .clinical-insight {
            margin-top: 24px;
            border-radius: var(--radius-sm);
            border: 1px solid rgba(255, 255, 255, 0.16);
            background: rgba(15, 23, 42, 0.7);
            padding: 20px;
            font-size: 0.95rem;
            color: #e5e7eb;
            line-height: 1.6;
        }

        .clinical-insight strong {
            color: #fef3c7;
        }

        /* === FEEDBACK MESSAGES === */
        .feedback-message {
            padding: 16px 20px;
            border-radius: var(--radius-sm);
            margin-top: 16px;
            font-size: 1rem;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .feedback-correct {
            background: rgba(0, 184, 148, 0.1);
            border-left: 4px solid var(--color-success);
            color: var(--color-success);
            display: block;
        }

        .feedback-incorrect {
            background: rgba(225, 112, 85, 0.1);
            border-left: 4px solid var(--color-error);
            color: var(--color-error);
            display: block;
        }

        /* === RESPONSIVE ADJUSTMENTS === */
        @media (max-width: 768px) {
            .activity-grid {
                gap: 24px;
            }
            .activity-card {
                padding: 20px;
            }
            .action-buttons {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
            .technique-match-grid {
                gap: 16px;
            }
            .technique-tags {
                gap: 10px;
            }
            .cue-options-grid {
                gap: 12px;
            }
        }

        @media (max-width: 480px) {
            .progress-tracker {
                flex-wrap: wrap;
                justify-content: center;
            }
            .step-divider {
                display: none;
            }
            .matching-container {
                gap: 16px;
            }
            .match-drop-zones {
                gap: 16px;
            }
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://cdn.prod.website-files.com/64d0ccc1558d601cbfb09021/64e9d2f719b1e5258e5d57f5_IMG_1512-p-500.png"
                    alt="AlliedRx logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">Clinical Medical Assistant ‚Ä¢ Kinn's Chapter 4</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Interactive Module 1: Communication Techniques Simulator</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Campus & Online</span>
        </header>

        <!-- Module Header -->
        <section class="module-header">
            <h1 id="module-heading">Communication Techniques Simulator</h1>
            <p class="module-subtitle">Master therapeutic communication, patient interviewing, and nonverbal cue recognition</p>
            <p class="module-description">
                This interactive module covers Objectives 4-9 from Chapter 4. You'll practice communication techniques, 
                identify nonverbal cues, sequence patient interviews, and match barriers with therapeutic responses.
            </p>
        </section>

        <!-- Clinical Tip -->
        <div class="clinical-tip">
            <div class="tip-label">üí° Clinical Insight</div>
            <p><strong>Silence can be therapeutic</strong>‚Äîallowing patients time to process and respond shows respect for their pace and builds trust in the clinical relationship. Remember to balance silence with active listening cues.</p>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-step active">
                <span class="step-icon">1</span>
                <span>Technique Matching</span>
            </div>
            <div class="step-divider"></div>
            <div class="progress-step">
                <span class="step-icon">2</span>
                <span>Nonverbal Cues</span>
            </div>
            <div class="step-divider"></div>
            <div class="progress-step">
                <span class="step-icon">3</span>
                <span>Interview Sequence</span>
            </div>
            <div class="step-divider"></div>
            <div class="progress-step">
                <span class="step-icon">4</span>
                <span>Barrier Matching</span>
            </div>
        </div>

        <!-- Progress Summary -->
        <div class="progress-summary">
            <div class="progress-item">
                <span class="progress-number" id="completedCount">0</span>
                <span class="progress-label">Activities Completed</span>
            </div>
            <div class="progress-item">
                <span class="progress-number" id="accuracyScore">0%</span>
                <span class="progress-label">Current Accuracy</span>
            </div>
            <div class="progress-item">
                <span class="progress-number" id="timeSpent">0 min</span>
                <span class="progress-label">Time Spent</span>
            </div>
        </div>

        <!-- Activity Grid -->
        <div class="activity-grid">
            <!-- ACTIVITY 1: TECHNIQUE MATCHING -->
            <section class="activity-card" aria-label="Communication Technique Matching Activity">
                <div class="activity-header">
                    <div class="activity-icon">üó£Ô∏è</div>
                    <h2 class="activity-title">Match Communication Techniques to Scenarios</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Review each patient scenario and drag the communication technique tags 
                    to the scenario where they would be most effective.
                </p>
                
                <div class="technique-scenario-container">
                    <div class="scenario">
                        <div class="scenario-header">
                            <div>
                                <div class="patient-info">Activity 1: Therapeutic Communication</div>
                                <div class="patient-demographics">Match techniques to clinical situations</div>
                            </div>
                        </div>
                        
                        <div class="scenario-text">
                            <strong>Key Communication Techniques:</strong>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>Open-Ended Questions:</strong> Start with "What," "How," or "Tell me about..." to encourage detailed responses.</li>
                                <li><strong>Reflective Listening:</strong> Paraphrase or reflect the patient's words to show understanding.</li>
                                <li><strong>Clarification:</strong> Ask for specifics when information is vague or confusing.</li>
                                <li><strong>Summarization:</strong> Briefly recap key points to ensure mutual understanding.</li>
                            </ul>
                        </div>
                        
                        <div class="technique-instruction">
                            <strong>Pro Tip:</strong> Open-ended questions are best when gathering initial information. 
                            Reflective listening builds rapport. Clarification prevents misunderstandings. 
                            Summarization confirms understanding before moving on.
                        </div>
                        
                        <div class="technique-match-grid">
                            <div class="technique-drop-zone" data-scenario="anxious" id="zone-anxious">
                                <div class="zone-title">Anxious Patient</div>
                                <div class="zone-instruction">Patient says: "I'm just so worried about these test results..."</div>
                            </div>
                            <div class="technique-drop-zone" data-scenario="vague" id="zone-vague">
                                <div class="zone-title">Vague Symptoms</div>
                                <div class="zone-instruction">Patient says: "I haven't been feeling well lately."</div>
                            </div>
                            <div class="technique-drop-zone" data-scenario="confusing" id="zone-confusing">
                                <div class="zone-title">Confusing Information</div>
                                <div class="zone-instruction">Patient says: "The pain comes and goes, sometimes here, sometimes there..."</div>
                            </div>
                            <div class="technique-drop-zone" data-scenario="lengthy" id="zone-lengthy">
                                <div class="zone-title">Lengthy History</div>
                                <div class="zone-instruction">Patient has described multiple symptoms over the past 10 minutes.</div>
                            </div>
                        </div>
                        
                        <div class="technique-tags">
                            <div class="technique-tag" data-technique="reflective" id="tag-reflective" draggable="true">
                                Reflective Listening
                            </div>
                            <div class="technique-tag" data-technique="open-ended" id="tag-open-ended" draggable="true">
                                Open-Ended Question
                            </div>
                            <div class="technique-tag" data-technique="clarification" id="tag-clarification" draggable="true">
                                Clarification
                            </div>
                            <div class="technique-tag" data-technique="summarization" id="tag-summarization" draggable="true">
                                Summarization
                            </div>
                        </div>
                        
                        <div style="margin-top: 24px;">
                            <button class="activity-btn" id="checkTechniqueBtn">
                                ‚úì Check Technique Matches
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- FEEDBACK SECTION - ALWAYS VISIBLE -->
                <div class="feedback-details" id="techniqueFeedbackDetails">
                    <div class="feedback-title">
                        <span>üìã Communication Technique Feedback:</span>
                    </div>
                    <div style="color: var(--color-muted); font-style: italic; margin-bottom: 12px;">
                        Complete the matching activity above, then click "Check Technique Matches" to see detailed feedback here.
                    </div>
                    <ul class="feedback-list" id="techniqueFeedbackList">
                        <!-- Feedback will appear here after checking -->
                    </ul>
                </div>
                
                <div class="feedback-message" id="techniqueFeedback"></div>
            </section>

            <!-- ACTIVITY 2: NONVERBAL CUE IDENTIFICATION -->
            <section class="activity-card" aria-label="Nonverbal Cue Identification Activity">
                <div class="activity-header">
                    <div class="activity-icon">üëÅÔ∏èüëÇ</div>
                    <h2 class="activity-title">Identify Nonverbal Communication Cues</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Read the clinical scenario and select <strong>all</strong> the nonverbal 
                    communication cues present. Some are correct cues, others are distractors.
                </p>
                
                <div class="nonverbal-container">
                    <div class="nonverbal-scenario">
                        <h3 class="section-title">Clinical Scenario</h3>
                        <div class="cue-instruction">
                            <p><strong>Mr. Johnson, 65 years old</strong>, arrives 15 minutes late for his appointment. 
                            He avoids eye contact, sighs frequently, crosses his arms tightly, and taps his foot rapidly 
                            while sitting in the waiting room. When called back, he hesitates before standing up and 
                            shuffles slowly to the exam room.</p>
                        </div>

                        <div class="cue-options-grid">
                            <div class="cue-option" data-cue="eye-contact" data-correct="true">
                                <div class="cue-header">
                                    <div class="cue-checkbox"></div>
                                    <div class="cue-text">Avoids eye contact</div>
                                </div>
                            </div>
                            
                            <div class="cue-option" data-cue="crossed-arms" data-correct="true">
                                <div class="cue-header">
                                    <div class="cue-checkbox"></div>
                                    <div class="cue-text">Crossed arms (closed posture)</div>
                                </div>
                            </div>
                            
                            <div class="cue-option" data-cue="leaning-forward" data-correct="false">
                                <div class="cue-header">
                                    <div class="cue-checkbox"></div>
                                    <div class="cue-text">Leaning forward attentively</div>
                                </div>
                            </div>
                            
                            <div class="cue-option" data-cue="foot-tapping" data-correct="true">
                                <div class="cue-header">
                                    <div class="cue-checkbox"></div>
                                    <div class="cue-text">Foot tapping (restlessness)</div>
                                </div>
                            </div>
                            
                            <div class="cue-option" data-cue="frequent-sighing" data-correct="true">
                                <div class="cue-header">
                                    <div class="cue-checkbox"></div>
                                    <div class="cue-text">Frequent sighing</div>
                                </div>
                            </div>
                            
                            <div class="cue-option" data-cue="nodding-agreement" data-correct="false">
                                <div class="cue-header">
                                    <div class="cue-checkbox"></div>
                                    <div class="cue-text">Nodding in agreement</div>
                                </div>
                            </div>
                            
                            <div class="cue-option" data-cue="hesitation-stand" data-correct="true">
                                <div class="cue-header">
                                    <div class="cue-checkbox"></div>
                                    <div class="cue-text">Hesitation to stand up</div>
                                </div>
                            </div>
                            
                            <div class="cue-option" data-cue="frequent-smiling" data-correct="false">
                                <div class="cue-header">
                                    <div class="cue-checkbox"></div>
                                    <div class="cue-text">Smiling frequently</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 24px;">
                            <button class="activity-btn" id="checkCuesBtn">
                                ‚úì Check Nonverbal Cue Selection
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="feedback-message" id="cueFeedback"></div>
                
                <div style="margin-top: 24px; padding: 20px; background: rgba(175, 75, 239, 0.05); border-radius: var(--radius-sm); font-size: 0.95rem;">
                    <strong>Clinical Tip:</strong> Nonverbal cues often reveal more than words‚Äîpay attention to clusters of behaviors rather than single gestures. 
                    In this scenario, the cues suggest anxiety, resistance, or discomfort.
                </div>
            </section>

            <!-- ACTIVITY 3: INTERVIEW SEQUENCING -->
            <section class="activity-card" aria-label="Patient Interview Sequencing Activity">
                <div class="activity-header">
                    <div class="activity-icon">üîÑ</div>
                    <h2 class="activity-title">Patient Interview Sequence</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Click on each step in the correct therapeutic sequence for a 
                    patient-centered medical interview.
                </p>
                
                <div class="interview-sequence">
                    <div class="interview-step" data-step="1" data-order="1">
                        <div class="interview-number">?</div>
                        <div class="interview-content">
                            <div class="interview-title">Introduce Yourself & Explain Purpose</div>
                            <div class="interview-description">State your name, role, and explain the interview purpose to establish trust</div>
                        </div>
                    </div>
                    
                    <div class="interview-step" data-step="2" data-order="5">
                        <div class="interview-number">?</div>
                        <div class="interview-content">
                            <div class="interview-title">Summarize & Confirm Understanding</div>
                            <div class="interview-description">Briefly recap key points and ask if patient has questions or corrections</div>
                        </div>
                    </div>
                    
                    <div class="interview-step" data-step="3" data-order="2">
                        <div class="interview-number">?</div>
                        <div class="interview-content">
                            <div class="interview-title">Build Rapport with Open-Ended Questions</div>
                            <div class="interview-description">Start with "What brings you in today?" to encourage patient's narrative</div>
                        </div>
                    </div>
                    
                    <div class="interview-step" data-step="4" data-order="4">
                        <div class="interview-number">?</div>
                        <div class="interview-content">
                            <div class="interview-title">Gather Detailed History</div>
                            <div class="interview-description">Use specific questions about symptoms, duration, severity, and context</div>
                        </div>
                    </div>
                    
                    <div class="interview-step" data-step="5" data-order="3">
                        <div class="interview-number">?</div>
                        <div class="interview-content">
                            <div class="interview-title">Active Listening & Observation</div>
                            <div class="interview-description">Listen without interrupting, observe nonverbal cues, use minimal encouragers</div>
                        </div>
                    </div>
                    
                    <div class="interview-step" data-step="6" data-order="6">
                        <div class="interview-number">?</div>
                        <div class="interview-content">
                            <div class="interview-title">Discuss Plan & Next Steps</div>
                            <div class="interview-description">Explain what will happen next, tests needed, and follow-up expectations</div>
                        </div>
                    </div>
                    
                    <div class="interview-step" data-step="7" data-order="7">
                        <div class="interview-number">?</div>
                        <div class="interview-content">
                            <div class="interview-title">Provide Education & Resources</div>
                            <div class="interview-description">Offer relevant patient education materials and answer questions</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="activity-btn" id="checkSequenceBtn">
                        ‚úì Check Interview Sequence
                    </button>
                </div>
                
                <div class="feedback-message" id="sequenceFeedback"></div>
            </section>

            <!-- ACTIVITY 4: BARRIER MATCHING -->
            <section class="activity-card" aria-label="Communication Barrier Matching Activity">
                <div class="activity-header">
                    <div class="activity-icon">üöß</div>
                    <h2 class="activity-title">Match Barriers to Therapeutic Responses</h2>
                </div>
                <p class="activity-description">
                    <strong>Instructions:</strong> Match each communication barrier with its appropriate therapeutic response. 
                    Drag barrier cards to the correct response columns.
                </p>
                
                <div class="matching-container">
                    <div class="matching-column">
                        <div class="match-category">Communication Barriers</div>
                        <div class="match-item" data-barrier="jargon" data-match="B" draggable="true">
                            Patient uses medical jargon incorrectly
                        </div>
                        <div class="match-item" data-barrier="defensive" data-match="D" draggable="true">
                            Patient appears defensive and resistant
                        </div>
                        <div class="match-item" data-barrier="avoidant" data-match="A" draggable="true">
                            Patient avoids discussing sensitive topics
                        </div>
                        <div class="match-item" data-barrier="soft-speech" data-match="C" draggable="true">
                            Patient speaks very softly and mumbles
                        </div>
                    </div>
                    
                    <div class="matching-column">
                        <div class="match-category">Therapeutic Responses</div>
                        <div class="match-item" data-response="normalize" data-match="A" draggable="true">
                            Use open-ended questions and normalize the topic
                        </div>
                        <div class="match-item" data-response="clarify" data-match="B" draggable="true">
                            Clarify terms using simple, everyday language
                        </div>
                        <div class="match-item" data-response="repeat" data-match="C" draggable="true">
                            Lean forward and ask patient to repeat important points
                        </div>
                        <div class="match-item" data-response="acknowledge" data-match="D" draggable="true">
                            Acknowledge feelings and use reflective statements
                        </div>
                    </div>
                </div>
                
                <div class="match-drop-zones">
                    <div class="match-drop-zone" id="drop-barriers">
                        <div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">
                            Drag Barrier Cards Here
                        </div>
                    </div>
                    <div class="match-drop-zone" id="drop-responses">
                        <div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">
                            Drag Response Cards Here
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="activity-btn" id="checkBarriersBtn">
                        ‚úì Check Barrier Matches
                    </button>
                </div>
                
                <div class="feedback-message" id="barrierFeedback"></div>
                
                <div style="margin-top: 24px; padding: 20px; background: rgba(175, 75, 239, 0.05); border-radius: var(--radius-sm); font-size: 0.95rem;">
                    <strong>Clinical Tip:</strong> When patients use defense mechanisms (denial, projection), acknowledge their feelings without judgment before gently exploring further. Never argue with defensive patients‚Äîvalidate first, then redirect.
                </div>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="resetBtn">
                <span>‚Üª</span>
                Reset All Activities
            </button>
            <button class="btn btn-primary" id="checkBtn">
                <span>‚úì</span>
                Check All Answers
            </button>
            <button class="btn btn-primary" id="viewResultsBtn" style="display: none;">
                <span>üìä</span>
                View Final Results
            </button>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="resultsPanel">
            <div class="results-header">
                <div class="activity-icon" style="background: var(--color-success);">‚úì</div>
                <h3 class="results-title">Module 1 Complete!</h3>
            </div>
            <div class="results-content">
                <p>Excellent work! You've completed the <strong>Communication Techniques Simulator</strong> module.</p>
                
                <div class="score-display">
                    <div class="score-value" id="scoreValue">0%</div>
                    <div class="score-text" id="scoreText">Your overall score</div>
                </div>
                
                <p><strong>What you've mastered:</strong></p>
                <ul style="margin-left: 20px; margin-top: 8px; margin-bottom: 16px;">
                    <li>‚úì Matching communication techniques to clinical scenarios</li>
                    <li>‚úì Identifying nonverbal communication cues</li>
                    <li>‚úì Sequencing therapeutic patient interviews</li>
                    <li>‚úì Matching communication barriers with appropriate responses</li>
                    <li>‚úì Applying therapeutic communication principles</li>
                </ul>
                
                <div class="clinical-insight">
                    <strong>Clinical Insight:</strong> Remember that therapeutic communication is patient-centered, not provider-centered. 
                    Your goal is to understand the patient's perspective, not just gather information. Active listening, 
                    nonverbal awareness, and appropriate technique selection build trust and improve clinical outcomes. 
                    Document communication barriers and accommodations in the patient record.
                </div>
            </div>
        </div>
    </main>

    <script>
        // === STATE MANAGEMENT ===
        let moduleState = {
            techniqueMatching: { completed: false, score: 0, total: 4 },
            nonverbalCues: { completed: false, score: 0, total: 5 },
            interviewSequence: { completed: false, score: 0, total: 7 },
            barrierMatching: { completed: false, score: 0, total: 4 },
            startTime: new Date(),
            activitiesCompleted: 0
        };

        // === ACTIVITY 1: TECHNIQUE MATCHING FUNCTIONS ===
        function initializeTechniqueMatching() {
            let draggedTag = null;
            
            // Technique tag drag events
            document.querySelectorAll('.technique-tag').forEach(tag => {
                tag.addEventListener('dragstart', function(e) {
                    draggedTag = this;
                    this.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', this.id);
                    
                    setTimeout(() => {
                        this.style.opacity = '0.4';
                    }, 0);
                });
                
                tag.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    this.style.opacity = '1';
                    draggedTag = null;
                });
            });
            
            // Drop zone events
            document.querySelectorAll('.technique-drop-zone').forEach(zone => {
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderColor = 'var(--color-primary)';
                    this.style.backgroundColor = 'rgba(175, 75, 239, 0.05)';
                });
                
                zone.addEventListener('dragleave', function() {
                    this.style.borderColor = '#ddd';
                    this.style.backgroundColor = 'white';
                });
                
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ddd';
                    this.style.backgroundColor = 'white';
                    
                    if (draggedTag) {
                        // Clear zone and add clone
                        const zoneTitle = this.querySelector('.zone-title').textContent;
                        const zoneInstruction = this.querySelector('.zone-instruction').textContent;
                        
                        const tagClone = draggedTag.cloneNode(true);
                        tagClone.classList.remove('dragging');
                        tagClone.classList.add('placed');
                        tagClone.draggable = false;
                        tagClone.style.cursor = 'default';
                        tagClone.style.opacity = '1';
                        tagClone.style.margin = '10px 0';
                        tagClone.style.width = '80%';
                        
                        this.innerHTML = `
                            <div class="zone-title">${zoneTitle}</div>
                            <div class="zone-instruction">${zoneInstruction}</div>
                        `;
                        this.appendChild(tagClone);
                        
                        // Hide original
                        draggedTag.style.visibility = 'hidden';
                    }
                });
            });
            
            // Check technique button
            document.getElementById('checkTechniqueBtn').addEventListener('click', checkTechniqueMatches);
        }
        
        function checkTechniqueMatches() {
            const correctMatches = {
                'zone-anxious': 'reflective',
                'zone-vague': 'open-ended',
                'zone-confusing': 'clarification',
                'zone-lengthy': 'summarization'
            };
            
            let score = 0;
            let feedbackItems = [];
            
            // Clear previous feedback
            const feedbackList = document.getElementById('techniqueFeedbackList');
            feedbackList.innerHTML = '';
            
            // Check each zone
            for (const [zoneId, correctTechnique] of Object.entries(correctMatches)) {
                const zone = document.getElementById(zoneId);
                const zoneTag = zone.querySelector('.technique-tag');
                const zoneTitle = zone.querySelector('.zone-title').textContent;
                
                if (zoneTag && zoneTag.dataset.technique === correctTechnique) {
                    zone.classList.remove('incorrect-drop');
                    zone.classList.add('correct-drop');
                    score++;
                    
                    let techniqueName = '';
                    switch(correctTechnique) {
                        case 'reflective': techniqueName = 'Reflective Listening'; break;
                        case 'open-ended': techniqueName = 'Open-Ended Question'; break;
                        case 'clarification': techniqueName = 'Clarification'; break;
                        case 'summarization': techniqueName = 'Summarization'; break;
                    }
                    
                    const li = document.createElement('li');
                    li.className = 'feedback-item correct';
                    li.textContent = `${zoneTitle}: Correct! ${techniqueName} is the most appropriate technique here.`;
                    feedbackList.appendChild(li);
                } else {
                    zone.classList.remove('correct-drop');
                    zone.classList.add('incorrect-drop');
                    
                    let correctTechniqueName = '';
                    switch(correctTechnique) {
                        case 'reflective': correctTechniqueName = 'Reflective Listening'; break;
                        case 'open-ended': correctTechniqueName = 'Open-Ended Question'; break;
                        case 'clarification': correctTechniqueName = 'Clarification'; break;
                        case 'summarization': correctTechniqueName = 'Summarization'; break;
                    }
                    
                    const li = document.createElement('li');
                    li.className = 'feedback-item incorrect';
                    li.textContent = `${zoneTitle}: Should be matched with ${correctTechniqueName}.`;
                    feedbackList.appendChild(li);
                }
            }
            
            // Add clinical tips
            const tip1 = document.createElement('li');
            tip1.className = 'feedback-item tip';
            tip1.textContent = 'Clinical Tip: Open-ended questions encourage detailed responses. Reflective listening builds rapport. Clarification prevents misunderstandings. Summarization confirms understanding.';
            feedbackList.appendChild(tip1);
            
            if (score < 4) {
                const tip2 = document.createElement('li');
                tip2.className = 'feedback-item tip';
                tip2.textContent = 'Remember: Match the technique to the patient\'s emotional state and communication needs, not just the content of their words.';
                feedbackList.appendChild(tip2);
            } else {
                const tip3 = document.createElement('li');
                tip3.className = 'feedback-item tip';
                tip3.textContent = 'Excellent technique selection! This demonstrates strong therapeutic communication skills for building patient trust.';
                feedbackList.appendChild(tip3);
            }
            
            // Update module state
            moduleState.techniqueMatching.score = score;
            moduleState.techniqueMatching.completed = true;
            
            // Update feedback title
            const feedbackTitle = document.querySelector('#techniqueFeedbackDetails .feedback-title');
            feedbackTitle.innerHTML = `<span>üìã Communication Technique Feedback: ${score}/4 Correct</span>`;
            
            // Provide summary feedback
            let summaryFeedback = '';
            if (score === 4) {
                summaryFeedback = '‚úì Perfect! All communication techniques correctly matched to scenarios.';
            } else if (score >= 2) {
                summaryFeedback = `‚úì Good effort! ${score}/4 correct. Review the detailed feedback to improve your technique selection.`;
            } else {
                summaryFeedback = `‚úó Needs practice. ${score}/4 correct. Review therapeutic communication techniques in Chapter 4.`;
            }
            
            showFeedback('techniqueFeedback', summaryFeedback, score >= 2 ? 'correct' : 'incorrect');
            updateProgress();
        }

        // === ACTIVITY 2: NONVERBAL CUE FUNCTIONS ===
        function initializeNonverbalCues() {
            // Cue option click events
            document.querySelectorAll('.cue-option').forEach(option => {
                option.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
            
            // Check cues button
            document.getElementById('checkCuesBtn').addEventListener('click', checkCueSelection);
        }
        
        function checkCueSelection() {
            const selectedOptions = document.querySelectorAll('.cue-option.selected');
            let correctSelections = 0;
            let incorrectSelections = 0;
            const totalCorrectCues = 5; // There are 5 correct cues in the activity
            
            // Reset all visual feedback first
            document.querySelectorAll('.cue-option').forEach(option => {
                option.classList.remove('correct', 'incorrect');
            });
            
            // Check each selected option
            selectedOptions.forEach(option => {
                if (option.dataset.correct === 'true') {
                    option.classList.add('correct');
                    correctSelections++;
                } else {
                    option.classList.add('incorrect');
                    incorrectSelections++;
                }
            });
            
            // Show correct answers for unselected correct cues
            document.querySelectorAll('.cue-option[data-correct="true"]:not(.selected)').forEach(option => {
                option.classList.add('incorrect');
            });
            
            // Calculate score (correct selections minus incorrect selections, minimum 0)
            let rawScore = correctSelections - incorrectSelections;
            let score = Math.max(0, rawScore);
            
            // Update module state (max 5 points)
            moduleState.nonverbalCues.score = score;
            moduleState.nonverbalCues.completed = true;
            
            // Provide feedback
            let feedback = '';
            if (score === totalCorrectCues && incorrectSelections === 0) {
                feedback = `‚úì Perfect! All ${score} nonverbal cues correctly identified. You recognized anxiety indicators: avoidance, closed posture, restlessness, sighing, and hesitation.`;
            } else if (score >= 3) {
                feedback = `‚úì Good! ${score}/${totalCorrectCues} correct. You identified key cues but missed some or selected distractors.`;
            } else {
                feedback = `‚úó Needs review. ${score}/${totalCorrectCues} correct. Remember: Nonverbal cues include body language, facial expressions, tone, and pace‚Äînot just words.`;
            }
            
            showFeedback('cueFeedback', feedback, score >= 3 ? 'correct' : 'incorrect');
            updateProgress();
        }

        // === ACTIVITY 3: INTERVIEW SEQUENCE FUNCTIONS ===
        function initializeInterviewSequence() {
            let clickOrder = [];
            let currentClick = 1;
            const maxSteps = 7;
            const correctOrder = [1, 3, 5, 4, 2, 6, 7]; // Correct step order
            
            // Interview step click events
            document.querySelectorAll('.interview-step').forEach(step => {
                step.addEventListener('click', function() {
                    // If already clicked, skip
                    if (this.classList.contains('active')) return;
                    
                    // Mark as active in current order
                    const stepNumber = parseInt(this.dataset.step);
                    clickOrder.push(stepNumber);
                    
                    // Update display
                    const numberSpan = this.querySelector('.interview-number');
                    numberSpan.textContent = currentClick;
                    this.classList.add('active');
                    
                    currentClick++;
                    
                    // Check if all steps are clicked
                    if (clickOrder.length === maxSteps) {
                        checkInterviewSequence(clickOrder, correctOrder);
                    }
                });
            });
            
            // Check sequence button
            document.getElementById('checkSequenceBtn').addEventListener('click', function() {
                if (clickOrder.length < maxSteps) {
                    showFeedback('sequenceFeedback', 
                        `Please click all ${maxSteps} steps in the correct order first!`, 
                        'incorrect');
                    return;
                }
                checkInterviewSequence(clickOrder, correctOrder);
            });
        }
        
        function checkInterviewSequence(clickOrder, correctOrder) {
            let correctCount = 0;
            
            // Compare sequences
            for (let i = 0; i < clickOrder.length; i++) {
                if (clickOrder[i] === correctOrder[i]) {
                    correctCount++;
                }
            }
            
            // Calculate score
            moduleState.interviewSequence.score = correctCount;
            moduleState.interviewSequence.completed = true;
            
            // Visual feedback
            document.querySelectorAll('.interview-step').forEach((step, index) => {
                const stepNumber = parseInt(step.dataset.step);
                const numberSpan = step.querySelector('.interview-number');
                
                if (stepNumber === correctOrder[index]) {
                    numberSpan.style.background = 'var(--color-success)';
                } else {
                    numberSpan.style.background = 'var(--color-error)';
                    const correctIndex = correctOrder.indexOf(stepNumber);
                    if (correctIndex !== -1) {
                        numberSpan.title = `Should be step ${correctIndex + 1}`;
                    }
                }
            });
            
            // Show feedback
            const percentage = Math.round((correctCount / 7) * 100);
            let feedback = '';
            
            if (percentage === 100) {
                feedback = `‚úì Perfect! All ${correctCount}/7 steps in correct order. Therapeutic sequence: Introduction ‚Üí Rapport ‚Üí Active Listening ‚Üí History ‚Üí Summary ‚Üí Plan ‚Üí Education.`;
            } else if (percentage >= 70) {
                feedback = `‚úì Good! ${correctCount}/7 steps correct (${percentage}%). Review steps marked in red.`;
            } else {
                feedback = `‚úó Needs review. ${correctCount}/7 steps correct (${percentage}%). Correct sequence: 1. Introduction ‚Üí 2. Rapport ‚Üí 3. Active Listening ‚Üí 4. History ‚Üí 5. Summary ‚Üí 6. Plan ‚Üí 7. Education.`;
            }
            
            showFeedback('sequenceFeedback', feedback, 
                percentage >= 70 ? 'correct' : 'incorrect');
            
            updateProgress();
        }

        // === ACTIVITY 4: BARRIER MATCHING FUNCTIONS ===
        function initializeBarrierMatching() {
            let draggedItem = null;
            let matches = [];
            
            // Match item drag events
            document.querySelectorAll('.match-item').forEach(item => {
                item.addEventListener('dragstart', function(e) {
                    draggedItem = this;
                    this.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', this.id || this.textContent);
                    
                    // Add active class to drop zones
                    document.querySelectorAll('.match-drop-zone').forEach(zone => {
                        zone.classList.add('active');
                    });
                });
                
                item.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    draggedItem = null;
                    
                    // Remove active class from drop zones
                    document.querySelectorAll('.match-drop-zone').forEach(zone => {
                        zone.classList.remove('active');
                    });
                });
            });
            
            // Drop zone events
            document.querySelectorAll('.match-drop-zone').forEach(zone => {
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                });
                
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    
                    if (draggedItem) {
                        // Create clone
                        const itemClone = draggedItem.cloneNode(true);
                        itemClone.classList.remove('dragging');
                        itemClone.draggable = true; // Allow re-dragging
                        itemClone.style.cursor = 'grab';
                        itemClone.style.margin = '5px';
                        
                        // Add new drag event to clone
                        itemClone.addEventListener('dragstart', function(e) {
                            this.classList.add('dragging');
                            e.dataTransfer.setData('text/plain', this.id || this.textContent);
                            
                            document.querySelectorAll('.match-drop-zone').forEach(z => {
                                z.classList.add('active');
                            });
                        });
                        
                        itemClone.addEventListener('dragend', function() {
                            this.classList.remove('dragging');
                            
                            document.querySelectorAll('.match-drop-zone').forEach(z => {
                                z.classList.remove('active');
                            });
                        });
                        
                        this.appendChild(itemClone);
                    }
                });
            });
            
            // Check barriers button
            document.getElementById('checkBarriersBtn').addEventListener('click', checkBarrierMatches);
        }
        
        function checkBarrierMatches() {
            const correctMatches = {
                'jargon': 'clarify',
                'defensive': 'acknowledge',
                'avoidant': 'normalize',
                'soft-speech': 'repeat'
            };
            
            // Get all items in drop zones
            const barrierZone = document.getElementById('drop-barriers');
            const responseZone = document.getElementById('drop-responses');
            
            const barrierItems = Array.from(barrierZone.querySelectorAll('.match-item'));
            const responseItems = Array.from(responseZone.querySelectorAll('.match-item'));
            
            let score = 0;
            let matchedPairs = [];
            
            // Reset visual feedback
            document.querySelectorAll('.match-item').forEach(item => {
                item.classList.remove('matched', 'incorrect-match');
            });
            
            // Try to match items
            barrierItems.forEach(barrierItem => {
                const barrierType = barrierItem.dataset.barrier;
                const correctResponse = correctMatches[barrierType];
                
                // Find matching response
                const matchingResponse = responseItems.find(response => 
                    response.dataset.response === correctResponse
                );
                
                if (matchingResponse) {
                    barrierItem.classList.add('matched');
                    matchingResponse.classList.add('matched');
                    score++;
                    matchedPairs.push(barrierType);
                    
                    // Remove from arrays to prevent double matching
                    const responseIndex = responseItems.indexOf(matchingResponse);
                    if (responseIndex > -1) {
                        responseItems.splice(responseIndex, 1);
                    }
                } else {
                    barrierItem.classList.add('incorrect-match');
                }
            });
            
            // Mark unmatched responses as incorrect
            responseItems.forEach(item => {
                item.classList.add('incorrect-match');
            });
            
            // Update module state
            moduleState.barrierMatching.score = score;
            moduleState.barrierMatching.completed = true;
            
            // Provide feedback
            let feedback = '';
            if (score === 4) {
                feedback = `‚úì Perfect! All 4 barrier-response pairs correctly matched. You understand therapeutic responses to common communication challenges.`;
            } else if (score >= 2) {
                feedback = `‚úì Good work! ${score}/4 pairs correctly matched. Review unmatched items marked in red.`;
            } else {
                feedback = `‚úó Needs review. ${score}/4 pairs correct. Key principle: Match the therapeutic response to the specific barrier type.`;
            }
            
            showFeedback('barrierFeedback', feedback, score >= 2 ? 'correct' : 'incorrect');
            updateProgress();
        }

        // === INITIALIZE MODULE ===
        document.addEventListener('DOMContentLoaded', function() {
            initializeTechniqueMatching();
            initializeNonverbalCues();
            initializeInterviewSequence();
            initializeBarrierMatching();
            setupEventListeners();
            updateProgress();
            startTimer();
        });

        // === HELPER FUNCTIONS ===
        function setupEventListeners() {
            // Reset button
            document.getElementById('resetBtn').addEventListener('click', resetAllActivities);
            
            // Check all answers button
            document.getElementById('checkBtn').addEventListener('click', checkAllAnswers);
            
            // View results button
            document.getElementById('viewResultsBtn').addEventListener('click', showFinalResults);
        }

        function showFeedback(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'feedback-message';
            element.classList.add(`feedback-${type}`);
            element.style.display = 'block';
            
            if (type === 'incorrect') {
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            }
        }

        function updateProgress() {
            // Calculate completed activities
            let completedCount = 0;
            if (moduleState.techniqueMatching.completed) completedCount++;
            if (moduleState.nonverbalCues.completed) completedCount++;
            if (moduleState.interviewSequence.completed) completedCount++;
            if (moduleState.barrierMatching.completed) completedCount++;
            
            document.getElementById('completedCount').textContent = completedCount;
            
            // Calculate accuracy
            let totalScore = 0;
            let totalPossible = 0;
            
            Object.values(moduleState).forEach(activity => {
                if (activity.score !== undefined && activity.total) {
                    totalScore += activity.score;
                    totalPossible += activity.total;
                }
            });
            
            const accuracy = totalPossible > 0 ? Math.round((totalScore / totalPossible) * 100) : 0;
            document.getElementById('accuracyScore').textContent = `${accuracy}%`;
            
            // Update progress tracker
            if (completedCount >= 4) {
                document.querySelectorAll('.progress-step').forEach(step => {
                    step.classList.remove('active');
                    step.classList.add('completed');
                });
                
                // Show "View Results" button
                document.getElementById('checkBtn').style.display = 'none';
                document.getElementById('viewResultsBtn').style.display = 'flex';
            } else if (completedCount >= 1) {
                document.querySelectorAll('.progress-step').forEach((step, index) => {
                    step.classList.remove('active', 'completed');
                    if (index < completedCount) {
                        step.classList.add('completed');
                    }
                    if (index === completedCount) {
                        step.classList.add('active');
                    }
                });
            }
            
            // Update module state
            moduleState.activitiesCompleted = completedCount;
        }

        function startTimer() {
            const timeElement = document.getElementById('timeSpent');
            
            setInterval(() => {
                const now = new Date();
                const diffMs = now - moduleState.startTime;
                const diffMins = Math.floor(diffMs / 60000);
                timeElement.textContent = `${diffMins} min`;
            }, 60000);
        }

        function checkAllAnswers() {
            // Trigger check for each activity if not already checked
            if (!moduleState.techniqueMatching.completed) {
                checkTechniqueMatches();
            }
            
            if (!moduleState.nonverbalCues.completed) {
                checkCueSelection();
            }
            
            if (!moduleState.interviewSequence.completed) {
                showFeedback('sequenceFeedback', 
                    'Complete the interview sequence activity first!', 
                    'incorrect');
            }
            
            if (!moduleState.barrierMatching.completed) {
                checkBarrierMatches();
            }
            
            updateProgress();
            
            // If all activities completed, show results
            if (moduleState.activitiesCompleted >= 4) {
                showFinalResults();
            }
        }

        function showFinalResults() {
            // Calculate final score
            let totalScore = 0;
            let totalPossible = 0;
            
            Object.values(moduleState).forEach(activity => {
                if (activity.score !== undefined && activity.total) {
                    totalScore += activity.score;
                    totalPossible += activity.total;
                }
            });
            
            const finalScore = totalPossible > 0 ? Math.round((totalScore / totalPossible) * 100) : 0;
            
            // Animate score counter
            const scoreElement = document.getElementById('scoreValue');
            animateCounter(scoreElement, 0, finalScore, 1500);
            
            // Set score text
            const scoreText = document.getElementById('scoreText');
            let performance = '';
            
            if (finalScore >= 90) performance = 'Outstanding!';
            else if (finalScore >= 80) performance = 'Excellent!';
            else if (finalScore >= 70) performance = 'Good!';
            else performance = 'Keep practicing!';
            
            scoreText.textContent = `${performance} Your overall score`;
            
            // Show results panel
            document.getElementById('resultsPanel').classList.add('show');
            
            // Scroll to results
            setTimeout(() => {
                document.getElementById('resultsPanel').scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest'
                });
            }, 100);
        }

        function animateCounter(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const value = Math.floor(progress * (end - start) + start);
                element.textContent = `${value}%`;
                
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function resetAllActivities() {
            if (!confirm("Are you sure you want to reset all activities? All progress will be lost.")) return;
            
            // Reset module state
            moduleState = {
                techniqueMatching: { completed: false, score: 0, total: 4 },
                nonverbalCues: { completed: false, score: 0, total: 5 },
                interviewSequence: { completed: false, score: 0, total: 7 },
                barrierMatching: { completed: false, score: 0, total: 4 },
                startTime: new Date(),
                activitiesCompleted: 0
            };
            
            // Reset activity 1
            document.querySelectorAll('.technique-tag').forEach(tag => {
                tag.classList.remove('dragging', 'placed');
                tag.style.visibility = 'visible';
                tag.style.opacity = '1';
                tag.draggable = true;
                tag.style.cursor = 'grab';
                tag.style.width = 'auto';
                tag.style.margin = '0';
            });
            
            // Reset drop zones for activity 1
            const zoneData = {
                'zone-anxious': { title: 'Anxious Patient', instruction: 'Patient says: "I\'m just so worried about these test results..."' },
                'zone-vague': { title: 'Vague Symptoms', instruction: 'Patient says: "I haven\'t been feeling well lately."' },
                'zone-confusing': { title: 'Confusing Information', instruction: 'Patient says: "The pain comes and goes, sometimes here, sometimes there..."' },
                'zone-lengthy': { title: 'Lengthy History', instruction: 'Patient has described multiple symptoms over the past 10 minutes.' }
            };
            
            for (const [zoneId, data] of Object.entries(zoneData)) {
                const zone = document.getElementById(zoneId);
                zone.innerHTML = `
                    <div class="zone-title">${data.title}</div>
                    <div class="zone-instruction">${data.instruction}</div>
                `;
                zone.classList.remove('correct-drop', 'incorrect-drop');
                zone.style.borderColor = '#ddd';
                zone.style.backgroundColor = 'white';
            }
            
            // Reset feedback section for activity 1
            const feedbackList = document.getElementById('techniqueFeedbackList');
            feedbackList.innerHTML = '';
            
            const feedbackTitle = document.querySelector('#techniqueFeedbackDetails .feedback-title');
            feedbackTitle.innerHTML = `<span>üìã Communication Technique Feedback:</span>`;
            
            // Reset activity 2
            document.querySelectorAll('.cue-option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
            });
            
            // Reset activity 3
            document.querySelectorAll('.interview-step').forEach(step => {
                step.classList.remove('active');
                const numberSpan = step.querySelector('.interview-number');
                numberSpan.textContent = '?';
                numberSpan.style.background = 'var(--color-primary)';
                numberSpan.title = '';
            });
            
            // Reset activity 4
            document.querySelectorAll('.match-item').forEach(item => {
                item.classList.remove('matched', 'incorrect-match', 'dragging');
                item.draggable = true;
                item.style.cursor = 'grab';
                item.style.margin = '0';
            });
            
            // Clear drop zones for activity 4
            document.getElementById('drop-barriers').innerHTML = 
                '<div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">Drag Barrier Cards Here</div>';
            document.getElementById('drop-responses').innerHTML = 
                '<div style="width: 100%; text-align: center; color: var(--color-muted); padding: 10px;">Drag Response Cards Here</div>';
            
            // Clear feedback messages
            document.querySelectorAll('.feedback-message').forEach(feedback => {
                feedback.textContent = '';
                feedback.className = 'feedback-message';
                feedback.style.display = 'none';
            });
            
            // Hide results panel
            document.getElementById('resultsPanel').classList.remove('show');
            
            // Reset buttons
            document.getElementById('checkBtn').style.display = 'flex';
            document.getElementById('viewResultsBtn').style.display = 'none';
            
            // Reset progress tracker
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('completed');
                if (index === 0) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
            
            // Update progress display
            updateProgress();
            
            // Show reset confirmation
            showFeedback('techniqueFeedback', '‚úì All activities have been reset. Ready to start again!', 'correct');
        }
    </script>
</body>
</html>
