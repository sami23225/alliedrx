<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AlliedRx -- Module 3: Gastroenterology Procedure Lab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* === ALLIEDRx BRANDING EXACT MATCH === */
        :root {
            --color-primary: #af4bef; /* Purple - main brand color */
            --color-primary-soft: #d492ff; /* Light purple */
            --color-accent: #8380f0; /* Blue-purple accent */
            --color-success: #00b894; /* Green for correct/success */
            --color-warning: #fdcb6e;
            --color-error: #e17055; /* Red/Orange for errors */
            --color-bg: #f7f5fb; /* Light background */
            --color-text: #2b2b2b; /* Dark text */
            --color-muted: #6c6880; /* Muted text */
            --color-dark: #0c0a18; /* Dark panel background */
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --shadow-soft: 0 18px 45px rgba(23, 10, 61, 0.18);
            --shadow-medium: 0 12px 30px rgba(23, 10, 61, 0.12);
            --shadow-hover: 0 25px 50px rgba(175, 75, 239, 0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            scroll-behavior: smooth;
        }

        body {
            padding: 24px;
            background: radial-gradient(
                circle at top left,
                #ffffff 0,
                #f1ecff 40%,
                var(--color-bg) 100%
            );
            color: var(--color-text);
            -webkit-text-size-adjust: 100%;
            line-height: 1.5;
        }

        @media (max-width: 600px) {
            body {
                padding: 12px;
            }
        }

        /* === ANIMATIONS === */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes checkmarkPop {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes scoreCountUp {
            from { width: 0%; }
            to { width: var(--target-width); }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* === MAIN PAGE CONTAINER === */
        .page {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 28px 30px 32px;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out;
        }

        @media (max-width: 900px) {
            .page {
                padding: 22px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
            }
            .page {
                border-radius: 0;
                box-shadow: none;
                padding: 18px 14px 22px;
            }
        }

        /* === ALLIEDRx HEADER/BRANDING === */
        .brand-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 14px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 40px;
            width: auto;
            max-width: 100%;
            filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
        }

        .brand-logo:hover {
            transform: scale(1.05);
        }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--color-muted);
            white-space: normal;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(175, 75, 239, 0.08);
            font-size: 0.76rem;
            color: var(--color-primary);
            white-space: normal;
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-success);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        .badge-mode {
            padding: 5px 10px;
            border-radius: 999px;
            background: rgba(12, 10, 24, 0.06);
            border: 1px solid rgba(12, 10, 24, 0.08);
            font-size: 0.74rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--color-muted);
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .badge-mode:hover {
            background: rgba(175, 75, 239, 0.1);
            border-color: var(--color-primary-soft);
            color: var(--color-primary);
        }

        @media (max-width: 480px) {
            .brand-row {
                flex-direction: column;
                align-items: flex-start;
            }
            .badge-mode {
                margin-top: 6px;
            }
        }

        /* === MODULE HEADER === */
        .module-header {
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        h1 {
            font-size: clamp(1.8rem, 3vw, 2.2rem);
            line-height: 1.1;
            color: var(--color-primary);
            margin-bottom: 6px;
        }

        .module-subtitle {
            font-size: 0.98rem;
            color: var(--color-muted);
            max-width: 600px;
            margin-bottom: 24px;
        }

        /* === CLINICAL TIP === */
        .clinical-tip {
            background: rgba(253, 203, 110, 0.1);
            border-left: 4px solid var(--color-warning);
            padding: 15px;
            margin-top: 15px;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        .clinical-tip-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-warning);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .clinical-tip-content {
            font-size: 0.85rem;
            color: var(--color-text);
        }

        /* === PROGRESS TRACKER === */
        .progress-tracker {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            padding: 0 20px;
        }

        .progress-tracker::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: rgba(12, 10, 24, 0.08);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(12, 10, 24, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-muted);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
            transform: scale(1.1);
        }

        .progress-step.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
            font-weight: 500;
        }

        .progress-step.active .step-label {
            color: var(--color-primary);
            font-weight: 600;
        }

        /* === PROGRESS SUMMARY === */
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease-out 0.5s both;
        }

        .summary-card {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-md);
            padding: 16px;
            border: 1px solid rgba(12, 10, 24, 0.06);
            text-align: center;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
            border-color: var(--color-primary-soft);
        }

        .summary-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--color-primary);
            display: block;
            line-height: 1;
            margin-bottom: 4px;
        }

        .summary-label {
            font-size: 0.8rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* === ACTIVITY GRID === */
        .activity-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        /* === ACTIVITY CARDS === */
        .activity-card {
            background: white;
            border-radius: var(--radius-md);
            border: 1px solid rgba(12, 10, 24, 0.08);
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out;
        }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--color-primary-soft);
        }

        .activity-card:hover::before {
            opacity: 1;
        }

        .activity-card.completed {
            border-color: var(--color-success);
        }

        .activity-card.completed::before {
            background: var(--color-success);
            opacity: 1;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .activity-number {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--color-primary);
            background: rgba(175, 75, 239, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
        }

        .activity-status {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 12px;
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-muted);
        }

        .activity-card.completed .activity-status {
            background: rgba(0, 184, 148, 0.1);
            color: var(--color-success);
        }

        .activity-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-icon {
            font-size: 1.5rem;
        }

        .activity-description {
            font-size: 0.95rem;
            color: var(--color-muted);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* === ACTIVITY 1: COLONOSCOPY ASSIST SIMULATION === */
        .procedure-game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .procedure-game-container {
                grid-template-columns: 1fr;
            }
        }

        .equipment-pool {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .equipment-pool-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 15px;
            text-align: center;
        }

        .equipment-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        @media (max-width: 480px) {
            .equipment-items {
                grid-template-columns: 1fr;
            }
        }

        .equipment-item {
            background: white;
            border: 2px solid var(--color-accent);
            border-radius: var(--radius-sm);
            padding: 12px 15px;
            font-size: 0.85rem;
            cursor: grab;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            user-select: none;
            text-align: left;
        }

        .equipment-item:hover {
            background: rgba(131, 128, 240, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(131, 128, 240, 0.2);
        }

        .equipment-item.dragging {
            opacity: 0.7;
            transform: scale(0.95);
        }

        .equipment-item.placed {
            opacity: 0.5;
            cursor: default;
            background: rgba(0, 184, 148, 0.1);
            border-color: var(--color-success);
        }

        .equipment-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .procedure-tray {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px dashed rgba(12, 10, 24, 0.1);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .tray-slot {
            background: white;
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            min-height: 60px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .tray-slot.filled {
            border: 2px solid var(--color-success);
            background: rgba(0, 184, 148, 0.1);
        }

        .tray-slot.wrong {
            border: 2px solid var(--color-error);
            background: rgba(225, 112, 85, 0.1);
            animation: shake 0.5s ease;
        }

        .slot-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--color-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .tray-slot.filled .slot-number {
            background: var(--color-success);
        }

        .slot-content {
            flex: 1;
            font-size: 0.85rem;
            color: var(--color-text);
            font-weight: 600;
        }

        .tray-slot:not(.filled) .slot-content {
            color: var(--color-muted);
            font-weight: normal;
            font-style: italic;
        }

        /* === ACTIVITY 2: FECAL SPECIMEN COLLECTION === */
        .specimen-game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .specimen-game-container {
                grid-template-columns: 1fr;
            }
        }

        .steps-pool {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .steps-pool-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 15px;
            text-align: center;
        }

        .step-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .step-item {
            background: white;
            border: 2px solid var(--color-accent);
            border-radius: var(--radius-sm);
            padding: 12px 15px;
            font-size: 0.85rem;
            cursor: grab;
            transition: all 0.3s ease;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            user-select: none;
            text-align: left;
        }

        .step-item:hover {
            background: rgba(131, 128, 240, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(131, 128, 240, 0.2);
        }

        .step-item.dragging {
            opacity: 0.7;
            transform: scale(0.95);
        }

        .step-item.placed {
            opacity: 0.5;
            cursor: default;
            background: rgba(0, 184, 148, 0.1);
            border-color: var(--color-success);
        }

        .step-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .sequence-tray {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px dashed rgba(12, 10, 24, 0.1);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sequence-slot {
            background: white;
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 1px solid rgba(12, 10, 24, 0.08);
            min-height: 60px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .sequence-slot.filled {
            border: 2px solid var(--color-success);
            background: rgba(0, 184, 148, 0.1);
        }

        .sequence-slot.wrong {
            border: 2px solid var(--color-error);
            background: rgba(225, 112, 85, 0.1);
            animation: shake 0.5s ease;
        }

        .sequence-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--color-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .sequence-slot.filled .sequence-number {
            background: var(--color-success);
        }

        .sequence-content {
            flex: 1;
            font-size: 0.85rem;
            color: var(--color-text);
            font-weight: 600;
        }

        .sequence-slot:not(.filled) .sequence-content {
            color: var(--color-muted);
            font-weight: normal;
            font-style: italic;
        }

        /* === ACTIVITY 3: PROCTOLOGIC EXAM ASSISTANCE === */
        .exam-scenario {
            background: rgba(12, 10, 24, 0.02);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(12, 10, 24, 0.08);
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .patient-info {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-primary);
        }

        .patient-demographics {
            font-size: 0.85rem;
            color: var(--color-muted);
            margin-bottom: 10px;
        }

        .position-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .position-options {
                grid-template-columns: 1fr;
            }
        }

        .position-option {
            background: rgba(12, 10, 24, 0.03);
            border-radius: var(--radius-sm);
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }

        .position-option:hover {
            background: rgba(175, 75, 239, 0.08);
            border-color: var(--color-primary-soft);
            transform: translateY(-2px);
        }

        .position-option.selected {
            background: rgba(0, 184, 148, 0.1);
            border-color: var(--color-success);
        }

        .position-option.wrong {
            background: rgba(225, 112, 85, 0.1);
            border-color: var(--color-error);
            animation: shake 0.5s ease;
        }

        .position-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 10px;
        }

        .position-description {
            font-size: 0.85rem;
            color: var(--color-text);
            line-height: 1.4;
        }

        .sensitivity-note {
            background: rgba(175, 75, 239, 0.05);
            border-left: 4px solid var(--color-accent);
            padding: 15px;
            margin-top: 15px;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        .sensitivity-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-accent);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* === ACTIVITY 4: PATIENT EDUCATION SCENARIOS === */
        .education-scenarios {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .scenario-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }

        .nav-btn {
            background: rgba(175, 75, 239, 0.1);
            border: 2px solid var(--color-primary-soft);
            border-radius: var(--radius-sm);
            padding: 8px 16px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--color-primary);
            font-weight: 600;
        }

        .nav-btn:hover:not(:disabled) {
            background: var(--color-primary);
            color: white;
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: var(--color-muted);
            color: var(--color-muted);
        }

        .scenario-counter {
            font-size: 0.9rem;
            color: var(--color-muted);
            font-weight: 600;
        }

        .ethical-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .ethical-option {
            background: rgba(12, 10, 24, 0.03);
            border-radius: var(--radius-sm);
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .ethical-option:hover {
            background: rgba(175, 75, 239, 0.08);
            border-color: var(--color-primary-soft);
            transform: translateY(-2px);
        }

        .ethical-option.selected {
            background: rgba(0, 184, 148, 0.1);
            border-color: var(--color-success);
        }

        .ethical-option.wrong {
            background: rgba(225, 112, 85, 0.1);
            border-color: var(--color-error);
            animation: shake 0.5s ease;
        }

        .option-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .option-content {
            font-size: 0.8rem;
            color: var(--color-text);
            line-height: 1.4;
        }

        /* === FEEDBACK SECTION === */
        .feedback-details {
            margin-top: 20px;
            padding: 20px;
            background: rgba(175, 75, 239, 0.03);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--color-accent);
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .feedback-title {
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 12px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feedback-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .feedback-item {
            margin-bottom: 8px;
            padding-left: 24px;
            position: relative;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .feedback-item:before {
            content: "";
            position: absolute;
            left: 0;
            top: 2px;
        }

        .feedback-item.correct:before {
            content: "‚úì";
            color: var(--color-success);
            font-weight: bold;
        }

        .feedback-item.incorrect:before {
            content: "‚úó";
            color: var(--color-error);
            font-weight: bold;
        }

        .feedback-item.tip:before {
            content: "üí°";
        }

        /* === ACTION BUTTONS === */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #9a3bd6;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(175, 75, 239, 0.3);
        }

        .btn-secondary {
            background: rgba(12, 10, 24, 0.06);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(12, 10, 24, 0.1);
            transform: translateY(-2px);
        }

        .btn-icon {
            font-size: 1.1em;
        }

        /* === RESULTS PANEL === */
        .results-panel {
            background: var(--color-dark);
            color: white;
            border-radius: var(--radius-md);
            padding: 30px;
            margin-top: 30px;
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .results-panel.show {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
        }

        .score-display {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--color-primary-soft);
            text-align: center;
            margin: 20px 0;
        }

        .score-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary), var(--color-success));
            border-radius: 6px;
            width: 0%;
            animation: scoreCountUp 1.5s ease-in-out forwards;
        }

        .clinical-insights {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-top: 20px;
        }

        .insights-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-primary-soft);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insights-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .insights-list li {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            font-size: 0.9rem;
            color: #e5e7eb;
        }

        .insight-dot {
            width: 6px;
            height: 6px;
            margin-top: 6px;
            border-radius: 999px;
            background: var(--color-accent);
            flex-shrink: 0;
        }

        .performance-rating {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--color-primary-soft);
        }

        /* === RESPONSIVE ADJUSTMENTS === */
        @media (max-width: 768px) {
            .activity-grid {
                gap: 20px;
            }
            .activity-card {
                padding: 20px;
            }
            .action-buttons {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
            .position-options {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .progress-tracker {
                flex-wrap: wrap;
            }
            .procedure-game-container,
            .specimen-game-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://cdn.prod.website-files.com/64d0ccc1558d601cbfb09021/64e9d2f719b1e5258e5d57f5_IMG_1512-p-500.png"
                    alt="AlliedRx logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">Clinical Medical Assistant ‚Ä¢ Kinn's Chapter 15</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Interactive Module 3: Gastroenterology Procedure Lab</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Campus & Online</span>
        </header>

        <!-- Module Header -->
        <section class="module-header">
            <h1 id="module-heading">Gastroenterology Procedure Lab</h1>
            <p class="module-subtitle">Master hands-on GI procedures, specimen collection, proctologic exams, and ethical patient education scenarios</p>
        </section>

        <!-- Clinical Tip -->
        <div class="clinical-tip">
            <div class="clinical-tip-title">üí° Clinical Insight</div>
            <div class="clinical-tip-content">
                <strong>"Bowel sounds are like ocean waves - listen for at least 2 minutes per quadrant."</strong>‚ÄîProper auscultation timing prevents false negatives. When patients are embarrassed about GI symptoms, normalize: "Many people experience this." Patient education for colonoscopy prep is 50% of the procedure's success.
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">Colonoscopy Assist</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Specimen Collection</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">Proctologic Exam</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-circle">4</div>
                <div class="step-label">Ethical Education</div>
            </div>
        </div>

        <!-- Progress Summary -->
        <div class="progress-summary">
            <div class="summary-card">
                <span class="summary-number" id="completed-count">0</span>
                <span class="summary-label">Activities Completed</span>
            </div>
            <div class="summary-card">
                <span class="summary-number" id="accuracy-rate">0%</span>
                <span class="summary-label">Current Accuracy</span>
            </div>
            <div class="summary-card">
                <span class="summary-number" id="time-spent">0:00</span>
                <span class="summary-label">Time Spent</span>
            </div>
        </div>

        <!-- Activity Grid -->
        <div class="activity-grid">
            <!-- Activity 1: Colonoscopy Assist Simulation - UPDATED WITH SEPARATE LIGHT SOURCE SLOT -->
            <section class="activity-card" id="activity-1" data-activity="1">
                <div class="activity-header">
                    <span class="activity-number">Activity 1</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">
                    <span class="activity-icon">üî¨</span>
                    Colonoscopy Assist Simulation
                </h3>
                <p class="activity-description">
                    Set up colonoscopy equipment in correct order. Drag equipment items to the procedure tray in proper sequence for patient safety.
                </p>
                
                <div class="procedure-game-container">
                    <!-- Equipment Pool -->
                    <div class="equipment-pool">
                        <div class="equipment-pool-title">Available Equipment</div>
                        <div class="equipment-items">
                            <div class="equipment-item" data-equipment="monitor" data-step="2" draggable="true">
                                <span class="equipment-icon">üì∫</span> Monitoring Equipment
                            </div>
                            <div class="equipment-item" data-equipment="scope" data-step="3" draggable="true">
                                <span class="equipment-icon">üìπ</span> Colonoscope
                            </div>
                            <div class="equipment-item" data-equipment="light" data-step="4" draggable="true">
                                <span class="equipment-icon">üí°</span> Light Source
                            </div>
                            <div class="equipment-item" data-equipment="suction" data-step="5" draggable="true">
                                <span class="equipment-icon">üåÄ</span> Suction Unit
                            </div>
                            <div class="equipment-item" data-equipment="forceps" data-step="6" draggable="true">
                                <span class="equipment-icon">üîß</span> Biopsy Forceps
                            </div>
                        </div>
                    </div>
                    
                    <!-- Procedure Tray - UPDATED WITH SEPARATE LIGHT SOURCE SLOT -->
                    <div class="procedure-tray">
                        <div class="tray-slot" data-step="1">
                            <div class="slot-number">1</div>
                            <div class="slot-content">Time-out & Consent Verification (Fixed Step)</div>
                        </div>
                        <div class="tray-slot" data-step="2">
                            <div class="slot-number">2</div>
                            <div class="slot-content">Drag equipment here</div>
                        </div>
                        <div class="tray-slot" data-step="3">
                            <div class="slot-number">3</div>
                            <div class="slot-content">Drag equipment here</div>
                        </div>
                        <div class="tray-slot" data-step="4">
                            <div class="slot-number">4</div>
                            <div class="slot-content">Drag equipment here</div>
                        </div>
                        <div class="tray-slot" data-step="5">
                            <div class="slot-number">5</div>
                            <div class="slot-content">Drag equipment here</div>
                        </div>
                        <div class="tray-slot" data-step="6">
                            <div class="slot-number">6</div>
                            <div class="slot-content">Drag equipment here</div>
                        </div>
                    </div>
                </div>
                
                <!-- Clinical Tip -->
                <div class="clinical-tip">
                    <div class="clinical-tip-title">üí° Patient Safety Protocol</div>
                    <div class="clinical-tip-content">
                        <strong>Correct Setup Order:</strong> 1. Time-out ‚Üí 2. Monitoring Equipment ‚Üí 3. Colonoscope ‚Üí 4. Light Source ‚Üí 5. Suction Unit ‚Üí 6. Biopsy Forceps. <strong>Time-out procedure</strong> must always come first to verify patient identity, procedure site, and consent.
                    </div>
                </div>
                
                <!-- Feedback -->
                <div class="feedback-details" id="feedback-1">
                    <div class="feedback-title">Colonoscopy Setup Guide</div>
                    <ul class="feedback-list">
                        <li class="feedback-item tip"><strong>Drag equipment to the tray in correct order:</strong> Monitoring ‚Üí Colonoscope ‚Üí Light Source ‚Üí Suction ‚Üí Biopsy</li>
                        <li class="feedback-item tip"><strong>Step 1 (Time-out)</strong> is fixed - always comes first for patient safety</li>
                        <li class="feedback-item tip"><strong>Light Source</strong> has its own slot (Step 4) after the colonoscope</li>
                        <li class="feedback-item tip"><strong>Each slot shows what equipment should be placed there</strong></li>
                    </ul>
                </div>
            </section>

            <!-- Activity 2: Fecal Specimen Collection -->
            <section class="activity-card" id="activity-2" data-activity="2">
                <div class="activity-header">
                    <span class="activity-number">Activity 2</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">
                    <span class="activity-icon">üß™</span>
                    Fecal Specimen Collection
                </h3>
                <p class="activity-description">
                    Sequence the steps for proper fecal specimen collection. Drag steps from the pool to the sequence tray in correct order.
                </p>
                
                <div class="specimen-game-container">
                    <!-- Steps Pool -->
                    <div class="steps-pool">
                        <div class="steps-pool-title">Available Steps</div>
                        <div class="step-items">
                            <div class="step-item" data-step="3" draggable="true">
                                <span class="step-icon">üè∑Ô∏è</span> Label container with patient name, DOB, date/time BEFORE collection
                            </div>
                            <div class="step-item" data-step="7" draggable="true">
                                <span class="step-icon">üöö</span> Deliver to lab with chain of custody form
                            </div>
                            <div class="step-item" data-step="2" draggable="true">
                                <span class="step-icon">üß´</span> Collect pea-sized amount from different areas if abnormal
                            </div>
                            <div class="step-item" data-step="5" draggable="true">
                                <span class="step-icon">‚ùÑÔ∏è</span> Refrigerate if not processed within 1 hour
                            </div>
                            <div class="step-item" data-step="1" draggable="true">
                                <span class="step-icon">üó£Ô∏è</span> Explain procedure, provide container, emphasize no contamination
                            </div>
                            <div class="step-item" data-step="6" draggable="true">
                                <span class="step-icon">üìã</span> Document collection time, appearance, any issues in chart
                            </div>
                            <div class="step-item" data-step="4" draggable="true">
                                <span class="step-icon">‚ö†Ô∏è</span> Place in biohazard bag with completed requisition
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sequence Tray -->
                    <div class="sequence-tray">
                        <div class="sequence-slot" data-step="1">
                            <div class="sequence-number">1</div>
                            <div class="sequence-content">Drag step here</div>
                        </div>
                        <div class="sequence-slot" data-step="2">
                            <div class="sequence-number">2</div>
                            <div class="sequence-content">Drag step here</div>
                        </div>
                        <div class="sequence-slot" data-step="3">
                            <div class="sequence-number">3</div>
                            <div class="sequence-content">Drag step here</div>
                        </div>
                        <div class="sequence-slot" data-step="4">
                            <div class="sequence-number">4</div>
                            <div class="sequence-content">Drag step here</div>
                        </div>
                        <div class="sequence-slot" data-step="5">
                            <div class="sequence-number">5</div>
                            <div class="sequence-content">Drag step here</div>
                        </div>
                        <div class="sequence-slot" data-step="6">
                            <div class="sequence-number">6</div>
                            <div class="sequence-content">Drag step here</div>
                        </div>
                        <div class="sequence-slot" data-step="7">
                            <div class="sequence-number">7</div>
                            <div class="sequence-content">Drag step here</div>
                        </div>
                    </div>
                </div>
                
                <!-- Legal Warning -->
                <div class="clinical-tip" style="background: rgba(225, 112, 85, 0.1); border-left-color: var(--color-error);">
                    <div class="clinical-tip-title" style="color: var(--color-error);">‚ö†Ô∏è Critical Legal Requirement</div>
                    <div class="clinical-tip-content">
                        <strong>Label container BEFORE collection</strong> to prevent specimen mix-up. This is a critical patient safety step that prevents 90% of specimen errors. Proper fecal specimen handling prevents collection errors.
                    </div>
                </div>
                
                <!-- Feedback -->
                <div class="feedback-details" id="feedback-2">
                    <div class="feedback-title">Specimen Collection Protocol</div>
                    <ul class="feedback-list">
                        <li class="feedback-item tip"><strong>Drag steps to sequence tray in correct order</strong></li>
                        <li class="feedback-item tip"><strong>Correct order:</strong> 1. Patient instruction ‚Üí 2. Collection ‚Üí 3. Labeling ‚Üí 4. Biohazard ‚Üí 5. Storage ‚Üí 6. Documentation ‚Üí 7. Lab delivery</li>
                        <li class="feedback-item tip"><strong>Critical step:</strong> Labeling BEFORE collection prevents specimen mix-up</li>
                    </ul>
                </div>
            </section>

            <!-- Activity 3: Proctologic Exam Assistance -->
            <section class="activity-card" id="activity-3" data-activity="3">
                <div class="activity-header">
                    <span class="activity-number">Activity 3</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">
                    <span class="activity-icon">üë®‚Äç‚öïÔ∏è</span>
                    Proctologic Exam Assistance
                </h3>
                <p class="activity-description">
                    Select appropriate positioning and actions for sigmoidoscopy preparation while maintaining patient dignity during embarrassing procedures.
                </p>
                
                <div class="exam-scenario">
                    <div class="scenario-header">
                        <div class="patient-info">Patient Scenario</div>
                        <div class="patient-demographics">62-year-old male, first sigmoidoscopy for rectal bleeding screening</div>
                    </div>
                    
                    <p class="activity-description" style="margin-bottom: 20px;">
                        <strong>Task:</strong> Select the correct patient positioning and appropriate clinical actions for this procedure.
                    </p>
                    
                    <!-- Positioning Options -->
                    <div class="position-options">
                        <div class="position-option" data-position="sims" data-correct="true">
                            <div class="position-title">Sims Position</div>
                            <div class="position-description">Left lateral with right knee flexed, left leg extended. Provides access while maintaining dignity with drape.</div>
                        </div>
                        <div class="position-option" data-position="knee-chest" data-correct="false">
                            <div class="position-title">Knee-Chest Position</div>
                            <div class="position-description">Patient on knees, chest down. Best visualization but most embarrassing position.</div>
                        </div>
                        <div class="position-option" data-position="lithotomy" data-correct="false">
                            <div class="position-title">Lithotomy Position</div>
                            <div class="position-description">On back with legs in stirrups. Used for gynecological exams, not optimal for sigmoidoscopy.</div>
                        </div>
                        <div class="position-option" data-position="prone" data-correct="false">
                            <div class="position-title">Prone Position</div>
                            <div class="position-description">Flat on stomach. Poor access for sigmoidoscopy, increases patient anxiety.</div>
                        </div>
                    </div>
                </div>
                
                <!-- Sensitivity Note -->
                <div class="sensitivity-note">
                    <div class="sensitivity-title">ü§ù Maintaining Dignity</div>
                    <div class="clinical-tip-content">
                        <strong>Key Principles:</strong> Use drapes to expose only necessary area, explain each step before doing it, maintain professional demeanor, avoid unnecessary comments, provide privacy during positioning changes, use warm lubricant, keep conversation clinical but reassuring.
                    </div>
                </div>
                
                <!-- Clinical Actions Selection -->
                <div class="position-options" style="margin-top: 20px;">
                    <div class="position-option" data-action="explain" data-correct="true">
                        <div class="position-title">Explain Procedure Steps</div>
                        <div class="position-description">"You'll feel pressure, then the scope, then possibly cramping as we advance."</div>
                    </div>
                    <div class="position-option" data-action="minimal" data-correct="false">
                        <div class="position-title">Minimal Explanation</div>
                        <div class="position-description">"Just relax, this will be over soon." No detailed explanation provided.</div>
                    </div>
                    <div class="position-option" data-action="joke" data-correct="false">
                        <div class="position-title">Use Humor</div>
                        <div class="position-description">"Don't worry, I've seen it all before!" Attempt to lighten mood with humor.</div>
                    </div>
                    <div class="position-option" data-action="technical" data-correct="false">
                        <div class="position-title">Technical Language Only</div>
                        <div class="position-description">"Initiating sigmoidoscopy with 60cm flexible scope. Preparing for insufflation."</div>
                    </div>
                </div>
                
                <!-- Feedback -->
                <div class="feedback-details" id="feedback-3">
                    <div class="feedback-title">Proctologic Exam Best Practices</div>
                    <ul class="feedback-list">
                        <li class="feedback-item tip"><strong>Sims position</strong> balances access with patient dignity</li>
                        <li class="feedback-item tip">Explain each step BEFORE doing it: "You'll feel my touch, then pressure, then the scope"</li>
                        <li class="feedback-item tip">Use warm lubricant to reduce discomfort</li>
                        <li class="feedback-item tip">Keep drape positioned to minimize exposure</li>
                        <li class="feedback-item tip">Maintain professional conversation about non-procedure topics to reduce anxiety</li>
                    </ul>
                </div>
            </section>

            <!-- Activity 4: Patient Education Scenarios -->
            <section class="activity-card" id="activity-4" data-activity="4">
                <div class="activity-header">
                    <span class="activity-number">Activity 4</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">
                    <span class="activity-icon">‚öñÔ∏è</span>
                    Patient Education Scenarios
                </h3>
                <p class="activity-description">
                    Navigate ethical and legal considerations in three challenging patient education scenarios involving non-compliance, disclosure, and abnormal results.
                </p>
                
                <div class="education-scenarios">
                    <!-- Scenario 1 (Visible) -->
                    <div class="exam-scenario" id="scenario-1" style="display: block;">
                        <div class="scenario-header">
                            <div class="patient-info">Scenario 1: Colonoscopy Prep Non-Compliance</div>
                            <div class="patient-demographics">55-year-old male admits he didn't complete bowel prep properly</div>
                        </div>
                        
                        <p class="activity-description" style="margin-bottom: 20px;">
                            <strong>Task:</strong> Select the legally and ethically appropriate response
                        </p>
                        
                        <div class="ethical-options">
                            <div class="ethical-option" data-scenario="1" data-option="1">
                                <div class="option-title">Reschedule with Detailed Education</div>
                                <div class="option-content">Document non-compliance, reschedule procedure, provide written and verbal prep instructions, schedule nurse follow-up call day before.</div>
                            </div>
                            <div class="ethical-option" data-scenario="1" data-option="2">
                                <div class="option-title">Proceed Anyway</div>
                                <div class="option-content">"We'll try anyway and do our best. The prep might be good enough."</div>
                            </div>
                            <div class="ethical-option" data-scenario="1" data-option="3">
                                <div class="option-title">Bill for Cancellation</div>
                                <div class="option-content">Cancel procedure, charge cancellation fee, document "patient non-compliant" in chart.</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scenario 2 (Hidden) -->
                    <div class="exam-scenario" id="scenario-2" style="display: none;">
                        <div class="scenario-header">
                            <div class="patient-info">Scenario 2: Hepatitis Disclosure</div>
                            <div class="patient-demographics">Newly diagnosed Hepatitis B patient asks you not to tell his wife</div>
                        </div>
                        
                        <p class="activity-description" style="margin-bottom: 20px;">
                            <strong>Task:</strong> Select the HIPAA-compliant and ethical response
                        </p>
                        
                        <div class="ethical-options">
                            <div class="ethical-option" data-scenario="2" data-option="1">
                                <div class="option-title">Counsel on Disclosure Importance</div>
                                <div class="option-content">Explain transmission risks to spouse, offer to help facilitate disclosure, document counseling, maintain confidentiality unless imminent harm.</div>
                            </div>
                            <div class="ethical-option" data-scenario="2" data-option="2">
                                <div class="option-title">Promise Confidentiality</div>
                                <div class="option-content">"Your secret is safe with me. HIPAA protects your privacy completely."</div>
                            </div>
                            <div class="ethical-option" data-scenario="2" data-option="3">
                                <div class="option-title">Notify Public Health</div>
                                <div class="option-content">Contact public health department and spouse immediately due to public health risk.</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scenario 3 (Hidden) -->
                    <div class="exam-scenario" id="scenario-3" style="display: none;">
                        <div class="scenario-header">
                            <div class="patient-info">Scenario 3: Abnormal Result Follow-up</div>
                            <div class="patient-demographics">Positive fecal occult blood test, patient misses follow-up calls</div>
                        </div>
                        
                        <p class="activity-description" style="margin-bottom: 20px;">
                            <strong>Task:</strong> Select appropriate actions for non-responsive patient with abnormal results
                        </p>
                        
                        <div class="ethical-options">
                            <div class="ethical-option" data-scenario="3" data-option="1">
                                <div class="option-title">Documented Follow-up Protocol</div>
                                <div class="option-content">Document all contact attempts, send certified letter, involve supervisor, attempt emergency contact if policy allows.</div>
                            </div>
                            <div class="ethical-option" data-scenario="3" data-option="2">
                                <div class="option-title">Assume No Concern</div>
                                <div class="option-content">"If they're not calling back, they must not be worried. Document 'patient non-responsive' and close chart."</div>
                            </div>
                            <div class="ethical-option" data-scenario="3" data-option="3">
                                <div class="option-title">Contact Family Member</div>
                                <div class="option-content">Call patient's adult daughter from emergency contact to deliver test results.</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navigation -->
                    <div class="scenario-nav">
                        <button class="nav-btn" id="prev-scenario" disabled>
                            <span>‚Üê</span> Previous
                        </button>
                        <div class="scenario-counter">Scenario <span id="scenario-number">1</span> of 3</div>
                        <button class="nav-btn" id="next-scenario">
                            Next <span>‚Üí</span>
                        </button>
                    </div>
                </div>
                
                <!-- Legal Tip -->
                <div class="clinical-tip">
                    <div class="clinical-tip-title">‚öñÔ∏è Legal & Ethical Principles</div>
                    <div class="clinical-tip-content">
                        <strong>HIPAA:</strong> Protects privacy but allows disclosure for treatment, payment, operations, and specific public health purposes. <strong>ADA:</strong> Requires reasonable accommodations for disabilities. <strong>Documentation:</strong> "If it wasn't documented, it wasn't done" - courts rely on medical records.
                    </div>
                </div>
                
                <!-- Feedback -->
                <div class="feedback-details" id="feedback-4">
                    <div class="feedback-title">Ethical Decision Making</div>
                    <ul class="feedback-list">
                        <li class="feedback-item tip"><strong>Scenario 1:</strong> Patient safety requires adequate prep - reschedule with education</li>
                        <li class="feedback-item tip"><strong>Documentation:</strong> Record all patient education, refusals, and follow-up attempts</li>
                        <li class="feedback-item tip"><strong>Legal protection:</strong> Follow established protocols, involve supervisors for difficult cases</li>
                    </ul>
                </div>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="reset-all-btn">
                <span class="btn-icon">‚Üª</span>
                Reset All Activities
            </button>
            <button class="btn btn-secondary" id="check-answers-btn">
                <span class="btn-icon">‚úì</span>
                Check All Answers
            </button>
            <button class="btn btn-primary" id="view-results-btn">
                <span class="btn-icon">üìä</span>
                View Final Results
            </button>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="results-panel">
            <div class="results-header">
                <h2 class="results-title">Gastroenterology Procedure Lab Results</h2>
                <div class="score-display" id="final-score">0%</div>
            </div>
            
            <div class="score-bar">
                <div class="score-fill" id="score-fill"></div>
            </div>
            
            <div class="performance-rating" id="performance-rating">Keep Practicing</div>
            
            <div class="clinical-insights">
                <h3 class="insights-title">
                    <span>ü©∫</span> Clinical Proficiency Insights
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Colonoscopy Setup:</strong> Time-out procedure prevents 80% of wrong-site/side/procedure errors. Document all team members present and verbal confirmation.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Specimen Collection:</strong> Proper fecal specimen handling prevents 90% of collection errors. Label BEFORE collection, refrigerate within 1 hour, document appearance.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Proctologic Sensitivity:</strong> Maintaining dignity during embarrassing procedures increases patient compliance for future screenings by 60%.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Legal Documentation:</strong> "If it wasn't documented, it wasn't done" - courts rely on complete, timely, legible medical records.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Patient Education:</strong> Tailor education to literacy level, use teach-back method, provide written materials, schedule follow-up reinforcement.</span>
                    </li>
                </ul>
            </div>
            
            <div class="clinical-insights" style="margin-top: 20px;">
                <h3 class="insights-title">
                    <span>üìã</span> Legal Documentation Requirements
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Informed Consent:</strong> Document discussion of procedure, risks, benefits, alternatives, and patient questions answered.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Time-out:</strong> Document patient identity verified, correct procedure/site, equipment available, allergies confirmed.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Specimen Chain of Custody:</strong> Document collection time, who collected, who received, storage conditions, transportation method.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Abnormal Results:</strong> Document all attempts to contact patient, methods used (phone, letter), responses, and supervisor involvement if needed.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Patient Refusals:</strong> Document what was refused, education provided, risks of refusal explained, patient understanding confirmed.</span>
                    </li>
                </ul>
            </div>
            
            <div class="clinical-insights" style="margin-top: 20px;">
                <h3 class="insights-title">
                    <span>üö®</span> Red Flags Requiring Immediate Action
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Inadequate Bowel Prep:</strong> Cancel/reschedule - poor visualization misses 30% of polyps, increases perforation risk.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Positive FOBT with No Follow-up:</strong> Escalate to supervisor, attempt emergency contact, consider certified mail - colon cancer risk 5-10%.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Procedure Complications:</strong> Bleeding, perforation, sedation issues - document vitals, interventions, notifications, follow-up plan.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Biohazard Exposure:</strong> Needlestick, splash to mucous membranes - immediate first aid, incident report, supervisor notification, follow-up testing.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Patient Distress During Procedure:</strong> Stop procedure, assess pain/anxiety, consider sedation adjustment, document response.</span>
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State Management
            const state = {
                activities: {
                    1: { completed: false, correct: 0, total: 6, score: 0 }, // 6 equipment setup steps (including separate light source)
                    2: { completed: false, correct: 0, total: 7, score: 0 }, // 7 specimen steps
                    3: { completed: false, correct: 0, total: 2, score: 0 }, // 2 position/action selections
                    4: { completed: false, correct: 0, total: 3, score: 0 }  // 3 ethical scenarios
                },
                startedAt: new Date(),
                timeSpent: 0,
                currentScenario: 1,
                scenarioAnswers: {}
            };

            // DOM Elements
            const progressSteps = document.querySelectorAll('.progress-step');
            const activityCards = document.querySelectorAll('.activity-card');
            const completedCount = document.getElementById('completed-count');
            const accuracyRate = document.getElementById('accuracy-rate');
            const timeSpent = document.getElementById('time-spent');
            const resetBtn = document.getElementById('reset-all-btn');
            const checkBtn = document.getElementById('check-answers-btn');
            const resultsBtn = document.getElementById('view-results-btn');
            const resultsPanel = document.getElementById('results-panel');
            const finalScore = document.getElementById('final-score');
            const scoreFill = document.getElementById('score-fill');
            const performanceRating = document.getElementById('performance-rating');

            // Timer for time spent
            function updateTimer() {
                const now = new Date();
                const diff = Math.floor((now - state.startedAt) / 1000);
                state.timeSpent = diff;
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                timeSpent.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            setInterval(updateTimer, 1000);

            // Update Progress Summary
            function updateProgressSummary() {
                let completed = 0;
                let totalCorrect = 0;
                let totalItems = 0;

                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) completed++;
                    totalCorrect += activity.correct;
                    totalItems += activity.total;
                });

                completedCount.textContent = completed;
                const accuracy = totalItems > 0 ? Math.round((totalCorrect / totalItems) * 100) : 0;
                accuracyRate.textContent = `${accuracy}%`;

                // Update progress steps
                progressSteps.forEach((step, index) => {
                    if (index < completed) {
                        step.classList.add('completed');
                        step.classList.remove('active');
                    } else if (index === completed) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });

                // Update activity cards
                activityCards.forEach((card, index) => {
                    const activityNum = index + 1;
                    const activity = state.activities[activityNum];
                    const status = card.querySelector('.activity-status');
                    
                    if (activity.completed) {
                        card.classList.add('completed');
                        status.textContent = 'Completed';
                        status.style.color = '#00b894';
                    } else {
                        card.classList.remove('completed');
                        status.textContent = 'Not Started';
                        status.style.color = '';
                    }
                });
            }

            // Activity 1: Colonoscopy Assist Simulation - UPDATED WITH SEPARATE LIGHT SOURCE SLOT
            function initActivity1() {
                const equipmentItems = document.querySelectorAll('#activity-1 .equipment-item');
                const traySlots = document.querySelectorAll('#activity-1 .tray-slot');
                const feedback = document.getElementById('feedback-1');
                const status = document.querySelector('#activity-1 .activity-status');
                
                // Correct equipment to slot mapping - UPDATED WITH SEPARATE LIGHT SOURCE
                const correctMapping = {
                    'monitor': 2,  // Step 2: Monitoring Equipment
                    'scope': 3,    // Step 3: Colonoscope
                    'light': 4,    // Step 4: Light Source (separate slot)
                    'suction': 5,  // Step 5: Suction Unit
                    'forceps': 6   // Step 6: Biopsy Forceps
                };
                
                let placedItems = 0;
                let correctPlacements = 0;

                // Set up drag for equipment items
                equipmentItems.forEach(item => {
                    item.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', JSON.stringify({
                            equipment: this.dataset.equipment,
                            step: this.dataset.step,
                            text: this.textContent.trim()
                        }));
                        this.classList.add('dragging');
                    });

                    item.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });

                // Set up drop for tray slots
                traySlots.forEach(slot => {
                    const stepNum = parseInt(slot.dataset.step);
                    if (stepNum === 1) return; // Skip step 1 (fixed time-out step)
                    
                    slot.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        if (!this.classList.contains('filled')) {
                            this.style.borderColor = 'var(--color-primary)';
                            this.style.backgroundColor = 'rgba(175, 75, 239, 0.1)';
                        }
                    });

                    slot.addEventListener('dragleave', function() {
                        this.style.borderColor = '';
                        this.style.backgroundColor = '';
                    });

                    slot.addEventListener('drop', function(e) {
                        e.preventDefault();
                        this.style.borderColor = '';
                        this.style.backgroundColor = '';
                        
                        if (this.classList.contains('filled')) return;
                        
                        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                        const slotStep = parseInt(this.dataset.step);
                        const correctStep = correctMapping[data.equipment];
                        
                        // Check if this is correct step for this equipment
                        const isCorrect = slotStep === correctStep;
                        
                        // Fill slot
                        this.querySelector('.slot-content').textContent = data.text;
                        this.classList.add('filled');
                        
                        if (isCorrect) {
                            this.classList.add('filled');
                            correctPlacements++;
                        } else {
                            this.classList.add('wrong');
                            setTimeout(() => this.classList.remove('wrong'), 1000);
                        }
                        
                        // Mark original item as placed
                        const originalItem = document.querySelector(`#activity-1 .equipment-item[data-equipment="${data.equipment}"]`);
                        if (originalItem) {
                            originalItem.classList.add('placed');
                            originalItem.style.opacity = '0.5';
                            originalItem.style.cursor = 'default';
                            originalItem.draggable = false;
                        }
                        
                        placedItems++;
                        
                        // Check completion (now 5 items to place + 1 fixed step = 6 total)
                        if (placedItems === 5) {
                            state.activities[1].completed = true;
                            state.activities[1].correct = correctPlacements;
                            state.activities[1].score = Math.round((correctPlacements / 5) * 100);
                            status.textContent = 'Completed';
                            status.style.color = '#00b894';
                            document.querySelector('#activity-1').classList.add('completed');
                            updateProgressSummary();
                        }
                    });
                });
            }

            // Activity 2: Fecal Specimen Collection
            function initActivity2() {
                const stepItems = document.querySelectorAll('#activity-2 .step-item');
                const sequenceSlots = document.querySelectorAll('#activity-2 .sequence-slot');
                const feedback = document.getElementById('feedback-2');
                const status = document.querySelector('#activity-2 .activity-status');
                
                // Correct step order mapping
                const correctOrder = {
                    1: 'Explain procedure',
                    2: 'Collect pea-sized amount',
                    3: 'Label container',
                    4: 'Place in biohazard bag',
                    5: 'Refrigerate if not processed',
                    6: 'Document collection time',
                    7: 'Deliver to lab'
                };
                
                let placedSteps = 0;
                let correctPlacements = 0;

                // Set up drag for step items
                stepItems.forEach(item => {
                    item.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', JSON.stringify({
                            step: this.dataset.step,
                            text: this.textContent.trim()
                        }));
                        this.classList.add('dragging');
                    });

                    item.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });

                // Set up drop for sequence slots
                sequenceSlots.forEach(slot => {
                    slot.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        if (!this.classList.contains('filled')) {
                            this.style.borderColor = 'var(--color-primary)';
                            this.style.backgroundColor = 'rgba(175, 75, 239, 0.1)';
                        }
                    });

                    slot.addEventListener('dragleave', function() {
                        this.style.borderColor = '';
                        this.style.backgroundColor = '';
                    });

                    slot.addEventListener('drop', function(e) {
                        e.preventDefault();
                        this.style.borderColor = '';
                        this.style.backgroundColor = '';
                        
                        if (this.classList.contains('filled')) return;
                        
                        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                        const slotStep = parseInt(this.dataset.step);
                        const itemStep = parseInt(data.step);
                        
                        // Check if this is correct step
                        const isCorrect = slotStep === itemStep;
                        
                        // Fill slot
                        this.querySelector('.sequence-content').textContent = data.text;
                        
                        if (isCorrect) {
                            this.classList.add('filled');
                            correctPlacements++;
                        } else {
                            this.classList.add('wrong');
                            setTimeout(() => {
                                this.classList.remove('wrong');
                                this.querySelector('.sequence-content').textContent = 'Drag step here';
                            }, 1000);
                        }
                        
                        // Mark original item as placed if correct
                        if (isCorrect) {
                            const originalItem = document.querySelector(`#activity-2 .step-item[data-step="${itemStep}"]`);
                            if (originalItem) {
                                originalItem.classList.add('placed');
                                originalItem.style.opacity = '0.5';
                                originalItem.style.cursor = 'default';
                                originalItem.draggable = false;
                            }
                        }
                        
                        placedSteps++;
                        
                        // Check completion
                        if (placedSteps === 7) {
                            state.activities[2].completed = true;
                            state.activities[2].correct = correctPlacements;
                            state.activities[2].score = Math.round((correctPlacements / 7) * 100);
                            status.textContent = 'Completed';
                            status.style.color = '#00b894';
                            document.querySelector('#activity-2').classList.add('completed');
                            updateProgressSummary();
                        }
                    });
                });
            }

            // Activity 3: Proctologic Exam Assistance
            function initActivity3() {
                const positionOptions = document.querySelectorAll('#activity-3 .position-option');
                const feedback = document.getElementById('feedback-3');
                const status = document.querySelector('#activity-3 .activity-status');
                
                let positionSelected = false;
                let actionSelected = false;
                let positionCorrect = false;
                let actionCorrect = false;

                // Position options (first set)
                positionOptions.forEach(option => {
                    if (option.dataset.position) {
                        option.addEventListener('click', function() {
                            if (positionSelected || state.activities[3].completed) return;
                            
                            const isCorrect = this.dataset.correct === 'true';
                            
                            // Remove previous selections
                            document.querySelectorAll('#activity-3 .position-option[data-position]').forEach(opt => {
                                opt.classList.remove('selected', 'wrong');
                            });
                            
                            // Mark selected
                            if (isCorrect) {
                                this.classList.add('selected');
                                positionCorrect = true;
                            } else {
                                this.classList.add('wrong');
                                positionCorrect = false;
                            }
                            
                            positionSelected = true;
                            checkActivity3Completion();
                        });
                    }
                });

                // Action options (second set)
                positionOptions.forEach(option => {
                    if (option.dataset.action) {
                        option.addEventListener('click', function() {
                            if (actionSelected || state.activities[3].completed) return;
                            
                            const isCorrect = this.dataset.correct === 'true';
                            
                            // Remove previous selections
                            document.querySelectorAll('#activity-3 .position-option[data-action]').forEach(opt => {
                                opt.classList.remove('selected', 'wrong');
                            });
                            
                            // Mark selected
                            if (isCorrect) {
                                this.classList.add('selected');
                                actionCorrect = true;
                            } else {
                                this.classList.add('wrong');
                                actionCorrect = false;
                            }
                            
                            actionSelected = true;
                            checkActivity3Completion();
                        });
                    }
                });

                function checkActivity3Completion() {
                    if (positionSelected && actionSelected) {
                        state.activities[3].completed = true;
                        state.activities[3].correct = (positionCorrect ? 1 : 0) + (actionCorrect ? 1 : 0);
                        state.activities[3].score = Math.round((state.activities[3].correct / 2) * 100);
                        status.textContent = 'Completed';
                        status.style.color = '#00b894';
                        document.querySelector('#activity-3').classList.add('completed');
                        updateProgressSummary();
                    }
                }
            }

            // Activity 4: Patient Education Scenarios
            function initActivity4() {
                const prevBtn = document.getElementById('prev-scenario');
                const nextBtn = document.getElementById('next-scenario');
                const scenarioNumber = document.getElementById('scenario-number');
                const ethicalOptions = document.querySelectorAll('#activity-4 .ethical-option');
                const feedback = document.getElementById('feedback-4');
                const status = document.querySelector('#activity-4 .activity-status');
                
                // Correct answers for each scenario
                const correctAnswers = {
                    1: '1', // Scenario 1: Option 1 (Reschedule with Detailed Education)
                    2: '1', // Scenario 2: Option 1 (Counsel on Disclosure Importance)
                    3: '1'  // Scenario 3: Option 1 (Documented Follow-up Protocol)
                };
                
                // Initialize first scenario
                updateScenarioDisplay();

                // Navigation buttons
                prevBtn.addEventListener('click', function() {
                    if (state.currentScenario > 1) {
                        state.currentScenario--;
                        updateScenarioDisplay();
                    }
                });

                nextBtn.addEventListener('click', function() {
                    if (state.currentScenario < 3) {
                        state.currentScenario++;
                        updateScenarioDisplay();
                    }
                });

                // Ethical option clicks
                ethicalOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        if (state.activities[4].completed) return;
                        
                        const scenarioId = parseInt(this.dataset.scenario);
                        const optionId = this.dataset.option;
                        
                        // Only process if this is the current scenario
                        if (scenarioId !== state.currentScenario) return;
                        
                        // Clear other selections for this scenario
                        document.querySelectorAll(`#activity-4 .ethical-option[data-scenario="${scenarioId}"]`).forEach(opt => {
                            opt.classList.remove('selected', 'wrong');
                        });
                        
                        // Mark selected option
                        const isCorrect = optionId === correctAnswers[scenarioId];
                        
                        if (isCorrect) {
                            this.classList.add('selected');
                            state.scenarioAnswers[scenarioId] = true;
                            
                            // Move to next scenario after delay
                            setTimeout(() => {
                                if (state.currentScenario < 3) {
                                    state.currentScenario++;
                                    updateScenarioDisplay();
                                } else {
                                    checkActivity4Completion();
                                }
                            }, 1000);
                        } else {
                            this.classList.add('wrong');
                        }
                    });
                });

                function updateScenarioDisplay() {
                    // Hide all scenarios
                    document.querySelectorAll('#activity-4 .exam-scenario').forEach(scenario => {
                        scenario.style.display = 'none';
                    });
                    
                    // Show current scenario
                    document.getElementById(`scenario-${state.currentScenario}`).style.display = 'block';
                    
                    // Update scenario number
                    scenarioNumber.textContent = state.currentScenario;
                    
                    // Update navigation buttons
                    prevBtn.disabled = state.currentScenario === 1;
                    nextBtn.disabled = state.currentScenario === 3;
                    
                    // Clear any selections for this scenario (unless already answered)
                    if (!state.scenarioAnswers[state.currentScenario]) {
                        document.querySelectorAll(`#activity-4 .ethical-option[data-scenario="${state.currentScenario}"]`).forEach(opt => {
                            opt.classList.remove('selected', 'wrong');
                        });
                    }
                }

                function checkActivity4Completion() {
                    // Check if all scenarios answered correctly
                    const allAnswered = [1, 2, 3].every(id => state.scenarioAnswers[id]);
                    
                    if (allAnswered) {
                        state.activities[4].completed = true;
                        state.activities[4].correct = 3;
                        state.activities[4].score = 100;
                        status.textContent = 'Completed';
                        status.style.color = '#00b894';
                        document.querySelector('#activity-4').classList.add('completed');
                        updateProgressSummary();
                    }
                }
            }

            // Reset All Activities
            function resetAllActivities() {
                // Reset state
                Object.keys(state.activities).forEach(key => {
                    state.activities[key] = {
                        completed: false,
                        correct: 0,
                        total: parseInt(key) === 1 ? 6 : parseInt(key) === 2 ? 7 : parseInt(key) === 3 ? 2 : 3,
                        score: 0
                    };
                });
                
                state.currentScenario = 1;
                state.scenarioAnswers = {};
                
                // Reset UI
                activityCards.forEach(card => {
                    card.classList.remove('completed');
                    const status = card.querySelector('.activity-status');
                    status.textContent = 'Not Started';
                    status.style.color = '';
                });
                
                // Reset Activity 1
                document.querySelectorAll('#activity-1 .tray-slot').forEach((slot, index) => {
                    if (index === 0) {
                        // Keep step 1 as is (time-out step)
                        slot.querySelector('.slot-content').textContent = 'Time-out & Consent Verification (Fixed Step)';
                    } else {
                        slot.classList.remove('filled', 'wrong');
                        slot.querySelector('.slot-content').textContent = 'Drag equipment here';
                    }
                });
                
                document.querySelectorAll('#activity-1 .equipment-item').forEach(item => {
                    item.classList.remove('placed', 'dragging');
                    item.style.opacity = '1';
                    item.style.cursor = 'grab';
                    item.draggable = true;
                });
                
                // Reset Activity 2
                document.querySelectorAll('#activity-2 .sequence-slot').forEach(slot => {
                    slot.classList.remove('filled', 'wrong');
                    slot.querySelector('.sequence-content').textContent = 'Drag step here';
                });
                
                document.querySelectorAll('#activity-2 .step-item').forEach(item => {
                    item.classList.remove('placed', 'dragging');
                    item.style.opacity = '1';
                    item.style.cursor = 'grab';
                    item.draggable = true;
                });
                
                // Reset Activity 3
                document.querySelectorAll('#activity-3 .position-option').forEach(option => {
                    option.classList.remove('selected', 'wrong');
                });
                
                // Reset Activity 4
                document.querySelectorAll('#activity-4 .ethical-option').forEach(option => {
                    option.classList.remove('selected', 'wrong');
                });
                
                // Reset scenario display
                state.currentScenario = 1;
                document.querySelectorAll('#activity-4 .exam-scenario').forEach((scenario, index) => {
                    scenario.style.display = index === 0 ? 'block' : 'none';
                });
                document.getElementById('scenario-number').textContent = '1';
                document.getElementById('prev-scenario').disabled = true;
                document.getElementById('next-scenario').disabled = false;
                
                // Reset results
                resultsPanel.classList.remove('show');
                
                // Update progress
                updateProgressSummary();
            }

            // Check All Answers
            function checkAllAnswers() {
                // Complete Activity 1 with perfect score
                if (!state.activities[1].completed) {
                    const status = document.querySelector('#activity-1 .activity-status');
                    
                    // Fill all slots correctly - UPDATED WITH SEPARATE LIGHT SOURCE
                    const correctMapping = {
                        'monitor': 2,
                        'scope': 3,
                        'light': 4,
                        'suction': 5,
                        'forceps': 6
                    };
                    
                    Object.keys(correctMapping).forEach(equipment => {
                        const slot = document.querySelector(`#activity-1 .tray-slot[data-step="${correctMapping[equipment]}"]`);
                        const item = document.querySelector(`#activity-1 .equipment-item[data-equipment="${equipment}"]`);
                        
                        if (slot && item) {
                            slot.querySelector('.slot-content').textContent = item.textContent.trim();
                            slot.classList.add('filled');
                            
                            item.classList.add('placed');
                            item.style.opacity = '0.5';
                            item.style.cursor = 'default';
                            item.draggable = false;
                        }
                    });
                    
                    state.activities[1].completed = true;
                    state.activities[1].correct = 5;
                    state.activities[1].score = 100;
                    status.textContent = 'Completed';
                    status.style.color = '#00b894';
                    document.querySelector('#activity-1').classList.add('completed');
                }
                
                // Complete Activity 2 with perfect score
                if (!state.activities[2].completed) {
                    const status = document.querySelector('#activity-2 .activity-status');
                    
                    // Fill all slots in correct order
                    const steps = [
                        'Explain procedure, provide container, emphasize no contamination',
                        'Collect pea-sized amount from different areas if abnormal',
                        'Label container with patient name, DOB, date/time BEFORE collection',
                        'Place in biohazard bag with completed requisition',
                        'Refrigerate if not processed within 1 hour',
                        'Document collection time, appearance, any issues in chart',
                        'Deliver to lab with chain of custody form'
                    ];
                    
                    steps.forEach((text, index) => {
                        const slot = document.querySelector(`#activity-2 .sequence-slot[data-step="${index + 1}"]`);
                        const item = document.querySelectorAll('#activity-2 .step-item')[index];
                        
                        if (slot && item) {
                            slot.querySelector('.sequence-content').textContent = text;
                            slot.classList.add('filled');
                            
                            item.classList.add('placed');
                            item.style.opacity = '0.5';
                            item.style.cursor = 'default';
                            item.draggable = false;
                        }
                    });
                    
                    state.activities[2].completed = true;
                    state.activities[2].correct = 7;
                    state.activities[2].score = 100;
                    status.textContent = 'Completed';
                    status.style.color = '#00b894';
                    document.querySelector('#activity-2').classList.add('completed');
                }
                
                // Complete Activity 3 with perfect score
                if (!state.activities[3].completed) {
                    const status = document.querySelector('#activity-3 .activity-status');
                    
                    // Select correct positions and actions
                    document.querySelector('#activity-3 .position-option[data-position="sims"]').classList.add('selected');
                    document.querySelector('#activity-3 .position-option[data-action="explain"]').classList.add('selected');
                    
                    state.activities[3].completed = true;
                    state.activities[3].correct = 2;
                    state.activities[3].score = 100;
                    status.textContent = 'Completed';
                    status.style.color = '#00b894';
                    document.querySelector('#activity-3').classList.add('completed');
                }
                
                // Complete Activity 4 with perfect score
                if (!state.activities[4].completed) {
                    const status = document.querySelector('#activity-4 .activity-status');
                    
                    // Answer all scenarios correctly
                    for (let i = 1; i <= 3; i++) {
                        const option = document.querySelector(`#activity-4 .ethical-option[data-scenario="${i}"][data-option="1"]`);
                        if (option) option.classList.add('selected');
                        state.scenarioAnswers[i] = true;
                    }
                    
                    state.activities[4].completed = true;
                    state.activities[4].correct = 3;
                    state.activities[4].score = 100;
                    status.textContent = 'Completed';
                    status.style.color = '#00b894';
                    document.querySelector('#activity-4').classList.add('completed');
                }
                
                updateProgressSummary();
            }

            // View Final Results
            function viewFinalResults() {
                let totalScore = 0;
                let activityCount = 0;
                
                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) {
                        totalScore += activity.score;
                        activityCount++;
                    }
                });
                
                const averageScore = activityCount > 0 ? Math.round(totalScore / activityCount) : 0;
                finalScore.textContent = `${averageScore}%`;
                
                // Set animated score bar
                scoreFill.style.setProperty('--target-width', `${averageScore}%`);
                scoreFill.style.width = `${averageScore}%`;
                
                // Set performance rating
                let rating = 'Keep Practicing';
                if (averageScore >= 90) rating = 'Outstanding';
                else if (averageScore >= 80) rating = 'Excellent';
                else if (averageScore >= 70) rating = 'Good';
                performanceRating.textContent = rating;
                
                resultsPanel.classList.add('show');
                resultsPanel.scrollIntoView({ behavior: 'smooth' });
            }

            // Initialize all activities
            initActivity1();
            initActivity2();
            initActivity3();
            initActivity4();

            // Event listeners
            resetBtn.addEventListener('click', resetAllActivities);
            checkBtn.addEventListener('click', checkAllAnswers);
            resultsBtn.addEventListener('click', viewFinalResults);

            // Initial progress update
            updateProgressSummary();
        });
    </script>
</body>
</html>
