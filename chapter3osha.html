<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AlliedRx ‚Äì Module 2: OSHA Safety Compliance Simulator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --color-primary: #af4bef;
      --color-primary-soft: #d492ff;
      --color-accent: #8380f0;
      --color-success: #00b894;
      --color-error: #e17055;
      --color-warning: #fdcb6e;
      --color-bg: #f7f5fb;
      --color-text: #2b2b2b;
      --color-muted: #6c6880;
      --color-dark: #0c0a18;
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-sm: 12px;
      --shadow-soft: 0 18px 45px rgba(23, 10, 61, 0.18);
      --shadow-hover: 0 25px 50px rgba(175, 75, 239, 0.15);
      --shadow-card: 0 12px 30px rgba(15, 23, 42, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      width: 100%;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 24px;
      background: radial-gradient(
        circle at top left,
        #ffffff 0,
        #f1ecff 40%,
        var(--color-bg) 100%
      );
      color: var(--color-text);
      -webkit-text-size-adjust: 100%;
      line-height: 1.5;
    }

    @media (max-width: 600px) {
      body {
        padding: 12px;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes checkmarkPop {
      0% { transform: scale(0); opacity: 0; }
      70% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    @keyframes biohazardPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .page {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 28px 30px 32px;
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.8s ease-out;
    }

    @media (max-width: 900px) {
      .page {
        padding: 22px;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 0;
      }
      .page {
        border-radius: 0;
        box-shadow: none;
        padding: 18px 14px 22px;
      }
    }

    /* Header */
    .brand-row {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 14px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      width: 100%;
      animation: fadeIn 0.6s ease-out 0.2s both;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .brand-logo {
      height: 40px;
      width: auto;
      max-width: 100%;
      filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.2));
      transition: transform 0.3s ease;
    }

    .brand-logo:hover {
      transform: scale(1.05);
    }

    .course-meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
      max-width: 100%;
    }

    .course-name {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--color-muted);
      white-space: normal;
    }

    .week-label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(175, 75, 239, 0.08);
      font-size: 0.76rem;
      color: var(--color-primary);
      white-space: normal;
    }

    .week-label-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--color-success);
      flex-shrink: 0;
    }

    .badge-mode {
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(12, 10, 24, 0.06);
      border: 1px solid rgba(12, 10, 24, 0.08);
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--color-muted);
      white-space: nowrap;
      transition: all 0.3s ease;
    }

    .badge-mode:hover {
      background: rgba(175, 75, 239, 0.1);
      border-color: var(--color-primary-soft);
      color: var(--color-primary);
    }

    @media (max-width: 480px) {
      .brand-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .badge-mode {
        margin-top: 6px;
      }
    }

    h1 {
      font-size: clamp(1.8rem, 3vw, 2.2rem);
      line-height: 1.1;
      color: var(--color-primary);
      margin-bottom: 6px;
      animation: fadeInUp 0.6s ease-out 0.3s both;
    }

    .module-subtitle {
      font-size: 0.98rem;
      color: var(--color-muted);
      max-width: 600px;
      margin-bottom: 24px;
      animation: fadeInUp 0.6s ease-out 0.4s both;
    }

    /* Progress Tracker */
    .progress-tracker {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      position: relative;
      padding: 0 20px;
    }

    .progress-tracker::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 50px;
      right: 50px;
      height: 3px;
      background: rgba(12, 10, 24, 0.08);
      z-index: 1;
    }

    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
      flex: 1;
    }

    .step-circle {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: white;
      border: 2px solid rgba(12, 10, 24, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--color-muted);
      margin-bottom: 8px;
      transition: all 0.3s ease;
    }

    .progress-step.active .step-circle {
      background: var(--color-primary);
      border-color: var(--color-primary);
      color: white;
      transform: scale(1.1);
    }

    .progress-step.completed .step-circle {
      background: var(--color-success);
      border-color: var(--color-success);
      color: white;
    }

    .step-label {
      font-size: 0.75rem;
      color: var(--color-muted);
      text-align: center;
      font-weight: 500;
    }

    .progress-step.active .step-label {
      color: var(--color-primary);
      font-weight: 600;
    }

    /* Progress Summary */
    .progress-summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 30px;
      animation: fadeInUp 0.6s ease-out 0.5s both;
    }

    .summary-card {
      background: rgba(12, 10, 24, 0.02);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(12, 10, 24, 0.06);
      text-align: center;
      transition: all 0.3s ease;
    }

    .summary-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-card);
      border-color: var(--color-primary-soft);
    }

    .summary-number {
      font-size: 2rem;
      font-weight: 800;
      color: var(--color-primary);
      display: block;
      line-height: 1;
      margin-bottom: 4px;
    }

    .summary-label {
      font-size: 0.8rem;
      color: var(--color-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* Activity Grid */
    .activity-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    @media (max-width: 900px) {
      .activity-grid {
        grid-template-columns: 1fr;
      }
    }

    .activity-card {
      background: white;
      border-radius: var(--radius-md);
      border: 1px solid rgba(12, 10, 24, 0.08);
      padding: 20px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .activity-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--color-primary);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .activity-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
      border-color: var(--color-primary-soft);
    }

    .activity-card:hover::before {
      opacity: 1;
    }

    .activity-card.completed {
      border-color: var(--color-success);
    }

    .activity-card.completed::before {
      background: var(--color-success);
      opacity: 1;
    }

    .activity-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .activity-number {
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--color-primary);
      background: rgba(175, 75, 239, 0.1);
      padding: 4px 10px;
      border-radius: 20px;
    }

    .activity-status {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 12px;
      background: rgba(12, 10, 24, 0.06);
      color: var(--color-muted);
    }

    .activity-card.completed .activity-status {
      background: rgba(0, 184, 148, 0.1);
      color: var(--color-success);
    }

    .activity-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--color-text);
      margin-bottom: 8px;
    }

    .activity-description {
      font-size: 0.9rem;
      color: var(--color-muted);
      margin-bottom: 20px;
      line-height: 1.5;
    }

    /* Activity 1: Biohazard Body Fluid Identifier */
    .body-fluid-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      .body-fluid-container {
        grid-template-columns: 1fr;
      }
    }

    .body-fluid-item {
      background: rgba(12, 10, 24, 0.03);
      border-radius: var(--radius-sm);
      padding: 15px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .body-fluid-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .body-fluid-item.selected {
      border-color: var(--color-primary);
      background: rgba(175, 75, 239, 0.08);
    }

    .body-fluid-item.required {
      border-color: var(--color-success);
      background: rgba(0, 184, 148, 0.08);
    }

    .body-fluid-item.not-required {
      border-color: var(--color-muted);
      background: rgba(108, 104, 128, 0.08);
      opacity: 0.7;
    }

    .body-fluid-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(12, 10, 24, 0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .body-fluid-content {
      flex: 1;
    }

    .body-fluid-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 3px;
    }

    .body-fluid-desc {
      font-size: 0.8rem;
      color: var(--color-muted);
    }

    /* Activity 2: Exposure Control Plan Builder */
    .plan-categories {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      .plan-categories {
        grid-template-columns: 1fr;
      }
    }

    .plan-category {
      background: rgba(12, 10, 24, 0.02);
      border-radius: var(--radius-sm);
      padding: 15px;
      border: 2px dashed rgba(12, 10, 24, 0.1);
      min-height: 180px;
      transition: all 0.3s ease;
    }

    .plan-category.hover {
      border-color: var(--color-primary);
      background: rgba(175, 75, 239, 0.05);
    }

    .plan-category-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--color-primary);
      margin-bottom: 10px;
      text-align: center;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(12, 10, 24, 0.08);
    }

    .plan-items {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
    }

    .plan-item {
      background: rgba(12, 10, 24, 0.05);
      border-radius: 20px;
      padding: 8px 15px;
      font-size: 0.85rem;
      cursor: grab;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .plan-item:hover {
      background: rgba(175, 75, 239, 0.1);
      border-color: var(--color-primary-soft);
      transform: translateY(-2px);
    }

    .plan-item.dragging {
      opacity: 0.7;
      transform: scale(0.95);
    }

    /* Activity 3: PPE Selection Scenarios */
    .scenario-container {
      background: rgba(12, 10, 24, 0.02);
      border-radius: var(--radius-sm);
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(12, 10, 24, 0.08);
    }

    .scenario-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--color-primary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .scenario-number {
      background: var(--color-primary);
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .scenario-description {
      font-size: 0.9rem;
      color: var(--color-text);
      margin-bottom: 15px;
      line-height: 1.5;
    }

    .ppe-mannequin {
      background: rgba(12, 10, 24, 0.02);
      border-radius: var(--radius-sm);
      padding: 20px;
      border: 2px dashed rgba(12, 10, 24, 0.1);
      min-height: 200px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      position: relative;
      margin-bottom: 20px;
      gap: 10px;
    }

    .ppe-mannequin.hover {
      border-color: var(--color-primary);
      background: rgba(175, 75, 239, 0.05);
    }

    .ppe-items {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .ppe-item {
      background: rgba(12, 10, 24, 0.05);
      border-radius: var(--radius-sm);
      padding: 10px 15px;
      font-size: 0.85rem;
      cursor: grab;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ppe-item:hover {
      background: rgba(175, 75, 239, 0.1);
      border-color: var(--color-primary-soft);
      transform: translateY(-2px);
    }

    .ppe-item.dragging {
      opacity: 0.7;
      transform: scale(0.95);
    }

    .ppe-icon {
      font-size: 1.1rem;
    }

    /* Activity 4: Waste Disposal Sorting */
    .waste-containers {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      .waste-containers {
        grid-template-columns: 1fr;
      }
    }

    .waste-container {
      background: rgba(12, 10, 24, 0.02);
      border-radius: var(--radius-sm);
      padding: 15px;
      border: 2px dashed rgba(12, 10, 24, 0.1);
      min-height: 150px;
      transition: all 0.3s ease;
      position: relative;
    }

    .waste-container.hover {
      border-color: var(--color-primary);
      background: rgba(175, 75, 239, 0.05);
    }

    .waste-container.regular-trash {
      border-color: #6b7280;
    }

    .waste-container.biohazard {
      border-color: #dc2626;
    }

    .waste-container.sharps {
      border-color: #f59e0b;
    }

    .waste-container.pharmaceutical {
      border-color: #8b5cf6;
    }

    .waste-container.chemical {
      border-color: #10b981;
    }

    .waste-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 10px;
      text-align: center;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(12, 10, 24, 0.08);
    }

    .waste-items {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
    }

    .waste-item {
      background: rgba(12, 10, 24, 0.05);
      border-radius: 20px;
      padding: 8px 15px;
      font-size: 0.85rem;
      cursor: grab;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .waste-item:hover {
      background: rgba(175, 75, 239, 0.1);
      border-color: var(--color-primary-soft);
      transform: translateY(-2px);
    }

    .waste-item.dragging {
      opacity: 0.7;
      transform: scale(0.95);
    }

    /* Feedback */
    .feedback-container {
      background: rgba(12, 10, 24, 0.02);
      border-radius: var(--radius-sm);
      padding: 15px;
      border: 1px solid rgba(12, 10, 24, 0.08);
      margin-top: 20px;
      display: none;
    }

    .feedback-container.show {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    .feedback-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--color-primary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .feedback-icon {
      font-size: 1.2rem;
    }

    .feedback-icon.correct {
      color: var(--color-success);
    }

    .feedback-icon.incorrect {
      color: var(--color-error);
    }

    .feedback-content {
      font-size: 0.85rem;
      color: var(--color-text);
      line-height: 1.5;
    }

    .feedback-content strong {
      color: var(--color-primary);
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      border-radius: var(--radius-md);
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--color-primary);
      color: white;
    }

    .btn-primary:hover {
      background: #9a3bd6;
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(175, 75, 239, 0.3);
    }

    .btn-secondary {
      background: rgba(12, 10, 24, 0.06);
      color: var(--color-text);
    }

    .btn-secondary:hover {
      background: rgba(12, 10, 24, 0.1);
      transform: translateY(-2px);
    }

    .btn-icon {
      font-size: 1.1em;
    }

    /* Results Panel */
    .results-panel {
      background: var(--color-dark);
      color: white;
      border-radius: var(--radius-md);
      padding: 30px;
      margin-top: 30px;
      display: none;
      animation: fadeInUp 0.6s ease;
    }

    .results-panel.show {
      display: block;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .results-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: white;
    }

    .score-display {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--color-primary-soft);
      text-align: center;
      margin: 20px 0;
    }

    .clinical-insights {
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-sm);
      padding: 20px;
      margin-top: 20px;
    }

    .insights-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-primary-soft);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .insights-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .insights-list li {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      font-size: 0.9rem;
      color: #e5e7eb;
    }

    .insight-dot {
      width: 6px;
      height: 6px;
      margin-top: 6px;
      border-radius: 999px;
      background: var(--color-accent);
      flex-shrink: 0;
    }

    /* OSHA Violation Warning */
    .violation-warning {
      background: rgba(225, 112, 85, 0.1);
      border: 2px solid var(--color-error);
      border-radius: var(--radius-sm);
      padding: 15px;
      margin-top: 15px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      animation: biohazardPulse 2s infinite;
    }

    .warning-icon {
      font-size: 1.5rem;
      color: var(--color-error);
      flex-shrink: 0;
    }

    .warning-content {
      flex: 1;
    }

    .warning-title {
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--color-error);
      margin-bottom: 5px;
    }

    .warning-text {
      font-size: 0.85rem;
      color: var(--color-text);
    }

    /* Scenario Navigation */
    .scenario-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }

    .nav-btn {
      padding: 8px 16px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(12, 10, 24, 0.1);
      background: white;
      color: var(--color-text);
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .nav-btn:hover:not(:disabled) {
      background: rgba(175, 75, 239, 0.1);
      border-color: var(--color-primary-soft);
      color: var(--color-primary);
    }

    .nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .scenario-indicator {
      font-size: 0.85rem;
      color: var(--color-muted);
      font-weight: 600;
    }
  </style>
</head>

<body>
  <main class="page" aria-labelledby="module-heading">
    <!-- Header -->
    <header class="brand-row">
      <div class="brand">
        <img
          src="https://cdn.prod.website-files.com/64d0ccc1558d601cbfb09021/64e9d2f719b1e5258e5d57f5_IMG_1512-p-500.png"
          alt="AlliedRx logo"
          class="brand-logo"
        />
        <div class="course-meta">
          <span class="course-name">Clinical Medical Assistant ‚Ä¢ Week 3</span>
          <div class="week-label">
            <span class="week-label-dot"></span>
            <span>Chapter 3: Infection Control</span>
          </div>
        </div>
      </div>
      <span class="badge-mode">Campus &amp; Online</span>
    </header>

    <h1 id="module-heading">OSHA Safety Compliance Simulator</h1>
    <p class="module-subtitle">
      Master OSHA bloodborne pathogen standards through interactive identification of infectious fluids, 
      building exposure control plans, selecting appropriate PPE, and properly disposing of biohazard waste.
    </p>

    <!-- Progress Tracker -->
    <div class="progress-tracker">
      <div class="progress-step active" data-step="1">
        <div class="step-circle">1</div>
        <div class="step-label">Body Fluids</div>
      </div>
      <div class="progress-step" data-step="2">
        <div class="step-circle">2</div>
        <div class="step-label">Control Plan</div>
      </div>
      <div class="progress-step" data-step="3">
        <div class="step-circle">3</div>
        <div class="step-label">PPE Selection</div>
      </div>
      <div class="progress-step" data-step="4">
        <div class="step-circle">4</div>
        <div class="step-label">Waste Disposal</div>
      </div>
    </div>

    <!-- Progress Summary -->
    <div class="progress-summary">
      <div class="summary-card">
        <span class="summary-number" id="completed-count">0</span>
        <span class="summary-label">Activities Completed</span>
      </div>
      <div class="summary-card">
        <span class="summary-number" id="accuracy-rate">0%</span>
        <span class="summary-label">Current Accuracy</span>
      </div>
      <div class="summary-card">
        <span class="summary-number" id="time-spent">0:00</span>
        <span class="summary-label">Time Spent</span>
      </div>
    </div>

    <!-- Activity Grid -->
    <div class="activity-grid">
      <!-- Activity 1: Biohazard Body Fluid Identifier -->
      <section class="activity-card" id="activity-1" data-activity="1">
        <div class="activity-header">
          <span class="activity-number">Activity 1</span>
          <span class="activity-status">Not Started</span>
        </div>
        <h3 class="activity-title">Biohazard Body Fluid Identifier</h3>
        <p class="activity-description">
          Click to identify which body fluids require Standard Precautions according to OSHA's 
          Bloodborne Pathogens Standard. Select all that apply.
        </p>

        <!-- Body Fluid Items -->
        <div class="body-fluid-container">
          <div class="body-fluid-item" data-fluid="blood" data-required="true">
            <div class="body-fluid-icon">ü©∏</div>
            <div class="body-fluid-content">
              <div class="body-fluid-name">Blood</div>
              <div class="body-fluid-desc">Any human blood, components, or products</div>
            </div>
          </div>
          <div class="body-fluid-item" data-fluid="semen" data-required="true">
            <div class="body-fluid-icon">üíß</div>
            <div class="body-fluid-content">
              <div class="body-fluid-name">Semen</div>
              <div class="body-fluid-desc">Semen and vaginal secretions</div>
            </div>
          </div>
          <div class="body-fluid-item" data-fluid="saliva-dental" data-required="true">
            <div class="body-fluid-icon">ü¶∑</div>
            <div class="body-fluid-content">
              <div class="body-fluid-name">Saliva (Dental)</div>
              <div class="body-fluid-desc">Saliva in dental procedures with blood</div>
            </div>
          </div>
          <div class="body-fluid-item" data-fluid="saliva-regular" data-required="false">
            <div class="body-fluid-icon">üëÖ</div>
            <div class="body-fluid-content">
              <div class="body-fluid-name">Saliva (Regular)</div>
              <div class="body-fluid-desc">Saliva without visible blood</div>
            </div>
          </div>
          <div class="body-fluid-item" data-fluid="csf" data-required="true">
            <div class="body-fluid-icon">üß†</div>
            <div class="body-fluid-content">
              <div class="body-fluid-name">Cerebrospinal Fluid</div>
              <div class="body-fluid-desc">CSF, synovial, pleural fluid</div>
            </div>
          </div>
          <div class="body-fluid-item" data-fluid="urine-clean" data-required="false">
            <div class="body-fluid-icon">üöΩ</div>
            <div class="body-fluid-content">
              <div class="body-fluid-name">Urine (Clean)</div>
              <div class="body-fluid-desc">Urine without visible blood</div>
            </div>
          </div>
          <div class="body-fluid-item" data-fluid="amniotic" data-required="true">
            <div class="body-fluid-icon">üë∂</div>
            <div class="body-fluid-content">
              <div class="body-fluid-name">Amniotic Fluid</div>
              <div class="body-fluid-desc">Fluid surrounding fetus</div>
            </div>
          </div>
          <div class="body-fluid-item" data-fluid="sweat" data-required="false">
            <div class="body-fluid-icon">üí¶</div>
            <div class="body-fluid-content">
              <div class="body-fluid-name">Sweat</div>
              <div class="body-fluid-desc">Perspiration without blood</div>
            </div>
          </div>
        </div>

        <!-- OSHA Violation Warning -->
        <div class="violation-warning" id="violation-warning-1" style="display: none;">
          <div class="warning-icon">‚ö†Ô∏è</div>
          <div class="warning-content">
            <div class="warning-title">OSHA Violation Warning</div>
            <div class="warning-text">
              Failing to use Standard Precautions with infectious body fluids can result in OSHA fines, 
              disease transmission, and loss of clinical privileges. Always err on the side of caution.
            </div>
          </div>
        </div>

        <!-- Feedback -->
        <div class="feedback-container" id="feedback-1">
          <div class="feedback-title">
            <span class="feedback-icon correct">‚úì</span>
            Fluids Identified!
          </div>
          <div class="feedback-content">
            <strong>OSHA Requires Standard Precautions for:</strong> Blood, Semen/Vaginal secretions, 
            Saliva (dental procedures), Cerebrospinal/Synovial/Pleural/Pericardial/Peritoneal fluids, 
            Amniotic fluid, Any body fluid visibly contaminated with blood.<br><br>
            <strong>Key Exception:</strong> Saliva without visible blood, urine/stool without visible blood, 
            sweat, tears, and vomitus without blood do NOT require Standard Precautions unless they contain 
            visible blood.
          </div>
        </div>
      </section>

      <!-- Activity 2: Exposure Control Plan Builder -->
      <section class="activity-card" id="activity-2" data-activity="2">
        <div class="activity-header">
          <span class="activity-number">Activity 2</span>
          <span class="activity-status">Not Started</span>
        </div>
        <h3 class="activity-title">Exposure Control Plan Builder</h3>
        <p class="activity-description">
          Drag elements to build a site-based Exposure Control Plan according to OSHA requirements. 
          Each facility must have this written plan.
        </p>

        <!-- Plan Categories -->
        <div class="plan-categories">
          <div class="plan-category" data-category="engineering" id="engineering-category">
            <div class="plan-category-title">Engineering Controls</div>
            <div class="plan-content"></div>
          </div>
          <div class="plan-category" data-category="work-practice" id="workpractice-category">
            <div class="plan-category-title">Work Practice Controls</div>
            <div class="plan-content"></div>
          </div>
        </div>

        <!-- Plan Items -->
        <div class="plan-items">
          <div class="plan-item draggable" data-category="engineering" draggable="true">Sharps Containers</div>
          <div class="plan-item draggable" data-category="engineering" draggable="true">Safety-Engineered Needles</div>
          <div class="plan-item draggable" data-category="engineering" draggable="true">Biosafety Cabinets</div>
          <div class="plan-item draggable" data-category="work-practice" draggable="true">No Needle Recapping</div>
          <div class="plan-item draggable" data-category="work-practice" draggable="true">Hand Hygiene Protocol</div>
          <div class="plan-item draggable" data-category="work-practice" draggable="true">Safe Specimen Handling</div>
          <div class="plan-item draggable" data-category="both" draggable="true">PPE Availability</div>
          <div class="plan-item draggable" data-category="both" draggable="true">Hepatitis B Vaccination</div>
        </div>

        <!-- Missing Element Check -->
        <div class="violation-warning" id="missing-element-warning" style="display: none;">
          <div class="warning-icon">üîç</div>
          <div class="warning-content">
            <div class="warning-title">Missing Required Element</div>
            <div class="warning-text">
              OSHA requires ALL elements to be included in an Exposure Control Plan. Missing elements 
              can result in failed inspections and citations.
            </div>
          </div>
        </div>

        <!-- Feedback -->
        <div class="feedback-container" id="feedback-2">
          <div class="feedback-title">
            <span class="feedback-icon correct">‚úì</span>
            Plan Complete!
          </div>
          <div class="feedback-content">
            <strong>Complete OSHA Exposure Control Plan Includes:</strong><br>
            1. <strong>Engineering Controls:</strong> Sharps containers, safety-engineered devices, biosafety equipment<br>
            2. <strong>Work Practice Controls:</strong> No needle recapping, hand hygiene, safe handling<br>
            3. <strong>PPE:</strong> Availability and proper use training<br>
            4. <strong>Hepatitis B Vaccination:</strong> Offered within 10 days of employment<br>
            5. <strong>Post-Exposure Evaluation:</strong> Follow-up after exposure incidents<br>
            6. <strong>Communication:</strong> Labels, signs, and employee training<br><br>
            <strong>Documentation:</strong> Plan must be reviewed annually and available to all employees.
          </div>
        </div>
      </section>

      <!-- Activity 3: PPE Selection Scenarios -->
      <section class="activity-card" id="activity-3" data-activity="3">
        <div class="activity-header">
          <span class="activity-number">Activity 3</span>
          <span class="activity-status">Not Started</span>
        </div>
        <h3 class="activity-title">PPE Selection Scenarios</h3>
        <p class="activity-description">
          Select appropriate Personal Protective Equipment for each clinical scenario. 
          Drag PPE items to the mannequin based on anticipated exposure risks.
        </p>

        <!-- Current Scenario -->
        <div class="scenario-container" id="current-scenario">
          <div class="scenario-title">
            <span class="scenario-number">1</span>
            Drawing blood from patient with HIV
          </div>
          <div class="scenario-description">
            You need to perform venipuncture on a patient who is HIV-positive. 
            The patient has no visible bleeding but you anticipate potential blood exposure.
          </div>
        </div>

        <!-- PPE Mannequin -->
        <div class="ppe-mannequin" id="ppe-mannequin">
          <div style="color: var(--color-muted); font-size: 0.9rem;">Drag appropriate PPE here</div>
        </div>

        <!-- PPE Items -->
        <div class="ppe-items">
          <div class="ppe-item draggable" data-ppe="gloves" draggable="true">
            <span class="ppe-icon">üß§</span>
            Exam Gloves
          </div>
          <div class="ppe-item draggable" data-ppe="gown" draggable="true">
            <span class="ppe-icon">ü•º</span>
            Impervious Gown
          </div>
          <div class="ppe-item draggable" data-ppe="mask" draggable="true">
            <span class="ppe-icon">üò∑</span>
            Surgical Mask
          </div>
          <div class="ppe-item draggable" data-ppe="goggles" draggable="true">
            <span class="ppe-icon">ü•Ω</span>
            Goggles/Face Shield
          </div>
          <div class="ppe-item draggable" data-ppe="n95" draggable="true">
            <span class="ppe-icon">ü¶∫</span>
            N95 Respirator
          </div>
          <div class="ppe-item draggable" data-ppe="boots" draggable="true">
            <span class="ppe-icon">üë¢</span>
            Shoe Covers
          </div>
        </div>

        <!-- Scenario Navigation -->
        <div class="scenario-nav">
          <button class="nav-btn" id="prev-scenario" disabled>
            ‚Üê Previous
          </button>
          <span class="scenario-indicator">Scenario <span id="scenario-current">1</span>/4</span>
          <button class="nav-btn" id="next-scenario">
            Next ‚Üí
          </button>
        </div>

        <!-- Feedback -->
        <div class="feedback-container" id="feedback-3">
          <div class="feedback-title">
            <span class="feedback-icon correct">‚úì</span>
            Scenarios Complete!
          </div>
          <div class="feedback-content">
            <strong>Scenario 1 (HIV Blood Draw):</strong> Exam gloves ¬± face shield if splash risk<br>
            <strong>Scenario 2 (C. diff Cleaning):</strong> Gloves + gown (contact precautions)<br>
            <strong>Scenario 3 (Laceration Repair):</strong> Sterile gloves + mask + goggles (sterile field + splash risk)<br>
            <strong>Scenario 4 (Lab Specimens):</strong> Gloves + lab coat<br><br>
            <strong>PPE Hierarchy:</strong> Always use gloves for anticipated contact with body fluids. 
            Add gown for contact precautions, mask/goggles for splash risks, and N95 for airborne precautions.
          </div>
        </div>
      </section>

      <!-- Activity 4: Waste Disposal Sorting -->
      <section class="activity-card" id="activity-4" data-activity="4">
        <div class="activity-header">
          <span class="activity-number">Activity 4</span>
          <span class="activity-status">Not Started</span>
        </div>
        <h3 class="activity-title">Waste Disposal Sorting</h3>
        <p class="activity-description">
          Sort medical waste items into the correct disposal containers. Proper segregation 
          prevents contamination and regulatory violations.
        </p>

        <!-- Waste Containers -->
        <div class="waste-containers">
          <div class="waste-container regular-trash" data-container="regular" id="regular-trash">
            <div class="waste-title">Regular Trash</div>
            <div class="waste-content"></div>
          </div>
          <div class="waste-container biohazard" data-container="biohazard" id="biohazard-container">
            <div class="waste-title">Biohazard (Red Bag)</div>
            <div class="waste-content"></div>
          </div>
          <div class="waste-container sharps" data-container="sharps" id="sharps-container">
            <div class="waste-title">Sharps Container</div>
            <div class="waste-content"></div>
          </div>
          <div class="waste-container pharmaceutical" data-container="pharmaceutical" id="pharma-container">
            <div class="waste-title">Pharmaceutical Waste</div>
            <div class="waste-content"></div>
          </div>
        </div>

        <!-- Waste Items -->
        <div class="waste-items">
          <div class="waste-item draggable" data-container="regular" draggable="true">Paper Towels (Clean)</div>
          <div class="waste-item draggable" data-container="biohazard" draggable="true">Blood-soaked Gauze</div>
          <div class="waste-item draggable" data-container="sharps" draggable="true">Used Syringe</div>
          <div class="waste-item draggable" data-container="biohazard" draggable="true">Used Culture Plate</div>
          <div class="waste-item draggable" data-container="regular" draggable="true">Empty IV Bag (No Fluid)</div>
          <div class="waste-item draggable" data-container="sharps" draggable="true">Broken Glass Slide</div>
          <div class="waste-item draggable" data-container="pharmaceutical" draggable="true">Expired Medication</div>
          <div class="waste-item draggable" data-container="biohazard" draggable="true">Used PPE with Blood</div>
        </div>

        <!-- Contamination Warning -->
        <div class="violation-warning" id="contamination-warning" style="display: none;">
          <div class="warning-icon">‚ò£Ô∏è</div>
          <div class="warning-content">
            <div class="warning-title">Contamination Risk</div>
            <div class="warning-text">
              Placing biohazard waste in regular trash can lead to disease transmission, 
              environmental contamination, and significant OSHA/EPA fines.
            </div>
          </div>
        </div>

        <!-- Feedback -->
        <div class="feedback-container" id="feedback-4">
          <div class="feedback-title">
            <span class="feedback-icon correct">‚úì</span>
            Waste Sorted!
          </div>
          <div class="feedback-content">
            <strong>Proper Waste Segregation:</strong><br>
            ‚Ä¢ <strong>Regular Trash:</strong> Dry, non-contaminated items (paper, packaging, empty containers)<br>
            ‚Ä¢ <strong>Biohazard (Red):</strong> Blood/body fluid saturated items, cultures, contaminated PPE<br>
            ‚Ä¢ <strong>Sharps:</strong> Needles, syringes, blades, broken glass<br>
            ‚Ä¢ <strong>Pharmaceutical:</strong> Expired/ unused medications, chemotherapy drugs<br>
            ‚Ä¢ <strong>Chemical:</strong> Formalin, xylene, other hazardous chemicals<br><br>
            <strong>Regulations:</strong> Mixing waste streams violates OSHA, EPA, and DOT regulations.
          </div>
        </div>
      </section>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn btn-secondary" id="reset-all-btn">
        <span class="btn-icon">‚Üª</span>
        Reset All Activities
      </button>
      <button class="btn btn-secondary" id="check-answers-btn">
        <span class="btn-icon">‚úì</span>
        Check All Answers
      </button>
      <button class="btn btn-primary" id="view-results-btn">
        <span class="btn-icon">üìä</span>
        View Final Results
      </button>
    </div>

    <!-- Results Panel -->
    <div class="results-panel" id="results-panel">
      <div class="results-header">
        <h2 class="results-title">OSHA Compliance Results</h2>
        <div class="score-display" id="final-score">0%</div>
      </div>
      
      <div class="clinical-insights">
        <h3 class="insights-title">
          <span>‚öñÔ∏è</span> OSHA Compliance Insights
        </h3>
        <ul class="insights-list">
          <li>
            <span class="insight-dot"></span>
            <span><strong>Documentation is Critical:</strong> OSHA inspectors review written Exposure Control Plans first. Missing or outdated plans result in immediate citations.</span>
          </li>
          <li>
            <span class="insight-dot"></span>
            <span><strong>Training Records:</strong> Maintain annual training documentation for ALL employees. Undocumented training = no training in OSHA's eyes.</span>
          </li>
          <li>
            <span class="insight-dot"></span>
            <span><strong>Sharps Safety:</strong> Safety-engineered devices are now required by OSHA's Needlestick Safety Act. Using conventional needles without engineering controls is a violation.</span>
          </li>
          <li>
            <span class="insight-dot"></span>
            <span><strong>Hepatitis B Declination:</strong> Employees who decline the Hepatitis B vaccine must sign a declination form. This protects the facility from liability.</span>
          </li>
          <li>
            <span class="insight-dot"></span>
            <span><strong>Post-Exposure Protocols:</strong> Immediate documentation and follow-up after exposure incidents are legally required. Delays can increase liability.</span>
          </li>
        </ul>
      </div>

      <div class="clinical-insights" style="margin-top: 20px;">
        <h3 class="insights-title">
          <span>üíº</span> Real-World Application
        </h3>
        <ul class="insights-list">
          <li>
            <span class="insight-dot"></span>
            <span><strong>Inspection Preparedness:</strong> Keep all OSHA-required documents (plan, training records, exposure logs) in one accessible binder for inspections.</span>
          </li>
          <li>
            <span class="insight-dot"></span>
            <span><strong>Employee Rights:</strong> Employees have the right to see their exposure records and request PPE without retaliation.</span>
          </li>
          <li>
            <span class="insight-dot"></span>
            <span><strong>Cost of Non-Compliance:</strong> OSHA fines start at $15,625 per violation and can reach $156,259 for willful/repeated violations.</span>
          </li>
          <li>
            <span class="insight-dot"></span>
            <span><strong>State Regulations:</strong> Some states (CA, MI, NC) have stricter requirements than federal OSHA. Always follow the most protective standard.</span>
          </li>
        </ul>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // State Management
      const state = {
        activities: {
          1: { completed: false, correct: 0, total: 5, score: 0 },
          2: { completed: false, correct: 0, total: 8, score: 0 },
          3: { completed: false, correct: 0, total: 4, score: 0 },
          4: { completed: false, correct: 0, total: 8, score: 0 }
        },
        startedAt: new Date(),
        timeSpent: 0,
        currentScenario: 1,
        scenarios: [
          {
            id: 1,
            title: "Drawing blood from patient with HIV",
            description: "You need to perform venipuncture on a patient who is HIV-positive. The patient has no visible bleeding but you anticipate potential blood exposure.",
            correctPPE: ["gloves", "goggles"]
          },
          {
            id: 2,
            title: "Cleaning room after C. diff patient",
            description: "You're assigned to clean and disinfect a room after a patient with C. difficile diarrhea. C. diff spores are resistant to many disinfectants.",
            correctPPE: ["gloves", "gown"]
          },
          {
            id: 3,
            title: "Assisting with laceration repair",
            description: "The provider is suturing a deep laceration that is bleeding significantly. There's risk of blood splatter during irrigation.",
            correctPPE: ["gloves", "gown", "goggles", "mask"]
          },
          {
            id: 4,
            title: "Handling laboratory specimens",
            description: "You're processing urine and stool specimens in the lab. The specimens are in sealed containers but may leak during handling.",
            correctPPE: ["gloves"]
          }
        ],
        scenarioSelections: [[], [], [], []] // Store PPE selections for each scenario
      };

      // DOM Elements
      const progressSteps = document.querySelectorAll('.progress-step');
      const activityCards = document.querySelectorAll('.activity-card');
      const completedCount = document.getElementById('completed-count');
      const accuracyRate = document.getElementById('accuracy-rate');
      const timeSpent = document.getElementById('time-spent');
      const resetBtn = document.getElementById('reset-all-btn');
      const checkBtn = document.getElementById('check-answers-btn');
      const resultsBtn = document.getElementById('view-results-btn');
      const resultsPanel = document.getElementById('results-panel');
      const finalScore = document.getElementById('final-score');
      const prevScenarioBtn = document.getElementById('prev-scenario');
      const nextScenarioBtn = document.getElementById('next-scenario');
      const scenarioCurrent = document.getElementById('scenario-current');
      const currentScenarioEl = document.getElementById('current-scenario');

      // Timer
      function updateTimer() {
        const now = new Date();
        const diff = Math.floor((now - state.startedAt) / 1000);
        state.timeSpent = diff;
        
        const minutes = Math.floor(diff / 60);
        const seconds = diff % 60;
        timeSpent.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      }
      setInterval(updateTimer, 1000);

      // Update Progress Summary
      function updateProgressSummary() {
        let completed = 0;
        let totalCorrect = 0;
        let totalItems = 0;
        
        Object.values(state.activities).forEach(activity => {
          if (activity.completed) completed++;
          totalCorrect += activity.correct;
          totalItems += activity.total;
        });
        
        completedCount.textContent = completed;
        const accuracy = totalItems > 0 ? Math.round((totalCorrect / totalItems) * 100) : 0;
        accuracyRate.textContent = `${accuracy}%`;
        
        // Update progress steps
        progressSteps.forEach((step, index) => {
          if (index < completed) {
            step.classList.add('completed');
            step.classList.remove('active');
          } else if (index === completed) {
            step.classList.add('active');
            step.classList.remove('completed');
          } else {
            step.classList.remove('active', 'completed');
          }
        });
      }

      // Activity 1: Biohazard Body Fluid Identifier
      function initActivity1() {
        const fluidItems = document.querySelectorAll('#activity-1 .body-fluid-item');
        const warning = document.getElementById('violation-warning-1');
        const feedback = document.getElementById('feedback-1');
        const status = document.querySelector('#activity-1 .activity-status');
        
        let selectedItems = [];
        let requiredFluids = [];
        
        // Get all required fluids
        fluidItems.forEach(item => {
          if (item.dataset.required === 'true') {
            requiredFluids.push(item.dataset.fluid);
          }
        });
        
        fluidItems.forEach(item => {
          item.addEventListener('click', function() {
            if (state.activities[1].completed) return;
            
            const fluidType = this.dataset.fluid;
            const isRequired = this.dataset.required === 'true';
            
            if (this.classList.contains('selected')) {
              // Deselect
              this.classList.remove('selected');
              selectedItems = selectedItems.filter(f => f !== fluidType);
            } else {
              // Select
              this.classList.add('selected');
              selectedItems.push(fluidType);
              
              // Show warning for incorrect selections
              if (!isRequired) {
                warning.style.display = 'flex';
                setTimeout(() => {
                  warning.style.display = 'none';
                }, 3000);
              }
            }
            
            // Check if all required items are selected
            const allRequiredSelected = requiredFluids.every(fluid => 
              selectedItems.includes(fluid)
            );
            
            const noIncorrectSelected = selectedItems.every(fluid => {
              const item = Array.from(fluidItems).find(i => i.dataset.fluid === fluid);
              return item.dataset.required === 'true';
            });
            
            if (allRequiredSelected && noIncorrectSelected && selectedItems.length === requiredFluids.length) {
              // Update state
              state.activities[1].completed = true;
              state.activities[1].correct = requiredFluids.length;
              state.activities[1].score = 100;
              
              // Update UI
              status.textContent = 'Completed';
              status.style.color = '#00b894';
              document.querySelector('#activity-1').classList.add('completed');
              feedback.classList.add('show');
              
              // Mark items with correct/incorrect status
              fluidItems.forEach(item => {
                if (item.dataset.required === 'true') {
                  item.classList.add('required');
                } else {
                  item.classList.add('not-required');
                }
                item.style.cursor = 'default';
              });
              
              updateProgressSummary();
            }
          });
        });
      }

      // Activity 2: Exposure Control Plan Builder
      function initActivity2() {
        const planItems = document.querySelectorAll('#activity-2 .plan-item');
        const planCategories = document.querySelectorAll('#activity-2 .plan-category');
        const warning = document.getElementById('missing-element-warning');
        const feedback = document.getElementById('feedback-2');
        const status = document.querySelector('#activity-2 .activity-status');
        
        let placedItems = 0;
        
        // Setup drag and drop
        planItems.forEach(item => {
          item.addEventListener('dragstart', function(e) {
            e.dataTransfer.setData('text/plain', JSON.stringify({
              category: this.dataset.category,
              text: this.textContent,
              id: this.textContent
            }));
            this.classList.add('dragging');
          });
          
          item.addEventListener('dragend', function() {
            this.classList.remove('dragging');
          });
        });
        
        planCategories.forEach(category => {
          category.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('hover');
          });
          
          category.addEventListener('dragleave', function() {
            this.classList.remove('hover');
          });
          
          category.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('hover');
            
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const targetCategory = this.dataset.category;
            
            // Check if item can be placed here
            if (data.category === targetCategory || data.category === 'both') {
              // Check if item already placed
              const existingItems = Array.from(this.querySelectorAll('.plan-content div'));
              const alreadyPlaced = existingItems.some(div => div.textContent === data.text);
              
              if (!alreadyPlaced) {
                const div = document.createElement('div');
                div.textContent = data.text;
                div.style.padding = '6px 10px';
                div.style.margin = '4px 0';
                div.style.background = 'rgba(175, 75, 239, 0.1)';
                div.style.borderRadius = '8px';
                div.style.fontSize = '0.8rem';
                this.querySelector('.plan-content').appendChild(div);
                
                // Hide the dragged item
                const draggedItem = Array.from(planItems).find(item => 
                  item.textContent === data.text && item.style.display !== 'none'
                );
                if (draggedItem) {
                  draggedItem.style.display = 'none';
                  placedItems++;
                }
                
                // Check completion
                checkActivity2Completion();
              }
            } else {
              warning.style.display = 'flex';
              setTimeout(() => {
                warning.style.display = 'none';
              }, 2000);
            }
          });
        });
        
        function checkActivity2Completion() {
          if (placedItems === 8) {
            // Simplified scoring for demo
            state.activities[2].completed = true;
            state.activities[2].correct = 7; // Demo value
            state.activities[2].score = Math.round((7 / 8) * 100);
            
            // Update UI
            status.textContent = 'Completed';
            status.style.color = '#00b894';
            document.querySelector('#activity-2').classList.add('completed');
            feedback.classList.add('show');
            
            updateProgressSummary();
          }
        }
      }

      // Activity 3: PPE Selection Scenarios
      function initActivity3() {
        const ppeItems = document.querySelectorAll('#activity-3 .ppe-item');
        const ppeMannequin = document.getElementById('ppe-mannequin');
        const feedback = document.getElementById('feedback-3');
        const status = document.querySelector('#activity-3 .activity-status');
        
        // Update scenario display
        function updateScenario() {
          const scenario = state.scenarios[state.currentScenario - 1];
          
          currentScenarioEl.innerHTML = `
            <div class="scenario-title">
              <span class="scenario-number">${scenario.id}</span>
              ${scenario.title}
            </div>
            <div class="scenario-description">
              ${scenario.description}
            </div>
          `;
          
          scenarioCurrent.textContent = scenario.id;
          
          // Clear and restore PPE items
          ppeMannequin.innerHTML = '<div style="color: var(--color-muted); font-size: 0.9rem;">Drag appropriate PPE here</div>';
          
          // Show all PPE items
          ppeItems.forEach(item => {
            item.style.display = 'flex';
          });
          
          // Enable/disable navigation buttons
          prevScenarioBtn.disabled = state.currentScenario === 1;
          nextScenarioBtn.disabled = state.currentScenario === state.scenarios.length;
        }
        
        // Setup drag and drop
        ppeItems.forEach(item => {
          item.addEventListener('dragstart', function(e) {
            e.dataTransfer.setData('text/plain', this.dataset.ppe);
            this.classList.add('dragging');
          });
          
          item.addEventListener('dragend', function() {
            this.classList.remove('dragging');
          });
        });
        
        ppeMannequin.addEventListener('dragover', function(e) {
          e.preventDefault();
          this.classList.add('hover');
        });
        
        ppeMannequin.addEventListener('dragleave', function() {
          this.classList.remove('hover');
        });
        
        ppeMannequin.addEventListener('drop', function(e) {
          e.preventDefault();
          this.classList.remove('hover');
          
          const ppeType = e.dataTransfer.getData('text/plain');
          const scenarioIndex = state.currentScenario - 1;
          
          // Check if this PPE is already selected for this scenario
          if (!state.scenarioSelections[scenarioIndex].includes(ppeType)) {
            state.scenarioSelections[scenarioIndex].push(ppeType);
            
            // Update mannequin display
            updateMannequinDisplay();
            
            // Hide from available items
            const ppeItem = document.querySelector(`.ppe-item[data-ppe="${ppeType}"]`);
            if (ppeItem) {
              ppeItem.style.display = 'none';
            }
            
            // Check if we should auto-advance
            const scenario = state.scenarios[scenarioIndex];
            if (state.scenarioSelections[scenarioIndex].length === scenario.correctPPE.length) {
              // Wait a moment then auto-advance
              setTimeout(() => {
                if (state.currentScenario < state.scenarios.length) {
                  nextScenarioBtn.click();
                } else {
                  // All scenarios complete
                  checkActivity3Completion();
                }
              }, 1000);
            }
          }
        });
        
        function updateMannequinDisplay() {
          const scenarioIndex = state.currentScenario - 1;
          const selections = state.scenarioSelections[scenarioIndex];
          
          ppeMannequin.innerHTML = '';
          
          if (selections.length === 0) {
            ppeMannequin.innerHTML = '<div style="color: var(--color-muted); font-size: 0.9rem;">Drag appropriate PPE here</div>';
          } else {
            selections.forEach(ppeType => {
              const ppeItem = document.querySelector(`.ppe-item[data-ppe="${ppeType}"]`);
              if (ppeItem) {
                const clone = ppeItem.cloneNode(true);
                clone.classList.remove('dragging');
                clone.draggable = false;
                clone.style.cursor = 'default';
                clone.style.margin = '5px';
                ppeMannequin.appendChild(clone);
              }
            });
          }
        }
        
        // Navigation buttons
        prevScenarioBtn.addEventListener('click', function() {
          if (state.currentScenario > 1) {
            state.currentScenario--;
            updateScenario();
            updateMannequinDisplay();
          }
        });
        
        nextScenarioBtn.addEventListener('click', function() {
          if (state.currentScenario < state.scenarios.length) {
            state.currentScenario++;
            updateScenario();
            updateMannequinDisplay();
          } else {
            // If we're on the last scenario and click next, check completion
            checkActivity3Completion();
          }
        });
        
        function checkActivity3Completion() {
          // Check if all scenarios have selections
          let allScenariosComplete = true;
          let totalCorrect = 0;
          
          state.scenarios.forEach((scenario, index) => {
            const selections = state.scenarioSelections[index];
            if (selections.length === 0) {
              allScenariosComplete = false;
            } else {
              // Count correct selections (simplified for demo)
              totalCorrect += selections.length;
            }
          });
          
          if (allScenariosComplete) {
            state.activities[3].completed = true;
            state.activities[3].correct = totalCorrect;
            state.activities[3].score = Math.round((totalCorrect / 10) * 100); // Max 10 points
            
            status.textContent = 'Completed';
            status.style.color = '#00b894';
            document.querySelector('#activity-3').classList.add('completed');
            feedback.classList.add('show');
            
            updateProgressSummary();
          }
        }
        
        // Initialize first scenario
        updateScenario();
      }

      // Activity 4: Waste Disposal Sorting
      function initActivity4() {
        const wasteItems = document.querySelectorAll('#activity-4 .waste-item');
        const wasteContainers = document.querySelectorAll('#activity-4 .waste-container');
        const warning = document.getElementById('contamination-warning');
        const feedback = document.getElementById('feedback-4');
        const status = document.querySelector('#activity-4 .activity-status');
        
        let placedItems = 0;
        const correctPlacements = {
          'Paper Towels (Clean)': 'regular',
          'Blood-soaked Gauze': 'biohazard',
          'Used Syringe': 'sharps',
          'Used Culture Plate': 'biohazard',
          'Empty IV Bag (No Fluid)': 'regular',
          'Broken Glass Slide': 'sharps',
          'Expired Medication': 'pharmaceutical',
          'Used PPE with Blood': 'biohazard'
        };
        
        // Setup drag and drop
        wasteItems.forEach(item => {
          item.addEventListener('dragstart', function(e) {
            e.dataTransfer.setData('text/plain', JSON.stringify({
              container: this.dataset.container,
              text: this.textContent
            }));
            this.classList.add('dragging');
          });
          
          item.addEventListener('dragend', function() {
            this.classList.remove('dragging');
          });
        });
        
        wasteContainers.forEach(container => {
          container.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('hover');
          });
          
          container.addEventListener('dragleave', function() {
            this.classList.remove('hover');
          });
          
          container.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('hover');
            
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const targetContainer = this.dataset.container;
            
            // Check if item is already in a container
            const allContainers = document.querySelectorAll('#activity-4 .waste-content');
            let alreadyPlaced = false;
            allContainers.forEach(cont => {
              const items = cont.querySelectorAll('div');
              items.forEach(item => {
                if (item.textContent === data.text) {
                  alreadyPlaced = true;
                }
              });
            });
            
            if (alreadyPlaced) return;
            
            // Check if placement is correct
            const isCorrect = correctPlacements[data.text] === targetContainer;
            
            if (isCorrect) {
              // Correct placement
              const div = document.createElement('div');
              div.textContent = data.text;
              div.style.padding = '6px 10px';
              div.style.margin = '4px 0';
              div.style.background = this.classList.contains('biohazard') ? 'rgba(220, 38, 38, 0.1)' :
                                    this.classList.contains('sharps') ? 'rgba(245, 158, 11, 0.1)' :
                                    this.classList.contains('pharmaceutical') ? 'rgba(139, 92, 246, 0.1)' :
                                    'rgba(107, 114, 128, 0.1)';
              div.style.borderRadius = '8px';
              div.style.fontSize = '0.8rem';
              this.querySelector('.waste-content').appendChild(div);
              
              // Hide the dragged item
              const draggedItem = Array.from(wasteItems).find(item => 
                item.textContent === data.text && item.style.display !== 'none'
              );
              if (draggedItem) {
                draggedItem.style.display = 'none';
                placedItems++;
              }
              
              // Check completion
              if (placedItems === 8) {
                state.activities[4].completed = true;
                state.activities[4].correct = 8; // All correct for perfect placement
                state.activities[4].score = 100;
                
                status.textContent = 'Completed';
                status.style.color = '#00b894';
                document.querySelector('#activity-4').classList.add('completed');
                feedback.classList.add('show');
                
                updateProgressSummary();
              }
            } else {
              // Incorrect placement - show warning
              warning.style.display = 'flex';
              setTimeout(() => {
                warning.style.display = 'none';
              }, 2000);
            }
          });
        });
      }

      // Reset All Activities
      function resetAllActivities() {
        // Reset state
        Object.keys(state.activities).forEach(key => {
          state.activities[key] = { 
            completed: false, 
            correct: 0, 
            total: parseInt(key) === 1 ? 5 : parseInt(key) === 2 ? 8 : parseInt(key) === 3 ? 4 : 8, 
            score: 0 
          };
        });
        
        state.currentScenario = 1;
        state.scenarioSelections = [[], [], [], []];
        
        // Reset UI
        activityCards.forEach(card => {
          card.classList.remove('completed');
          const status = card.querySelector('.activity-status');
          status.textContent = 'Not Started';
          status.style.color = '';
          
          const feedback = card.querySelector('.feedback-container');
          feedback.classList.remove('show');
        });
        
        // Reset Activity 1
        document.querySelectorAll('#activity-1 .body-fluid-item').forEach(item => {
          item.classList.remove('selected', 'required', 'not-required');
          item.style.cursor = 'pointer';
        });
        
        // Reset Activity 2
        document.querySelectorAll('#activity-2 .plan-content').forEach(content => {
          content.innerHTML = '';
        });
        document.querySelectorAll('#activity-2 .plan-item').forEach(item => {
          item.style.display = '';
        });
        
        // Reset Activity 3
        document.querySelectorAll('#activity-3 .ppe-item').forEach(item => {
          item.style.display = 'flex';
        });
        document.getElementById('ppe-mannequin').innerHTML = 
          '<div style="color: var(--color-muted); font-size: 0.9rem;">Drag appropriate PPE here</div>';
        
        // Reset Activity 4
        document.querySelectorAll('#activity-4 .waste-content').forEach(content => {
          content.innerHTML = '';
        });
        document.querySelectorAll('#activity-4 .waste-item').forEach(item => {
          item.style.display = '';
        });
        
        // Reset scenario
        updateScenario();
        
        // Reset results
        resultsPanel.classList.remove('show');
        
        // Update progress
        updateProgressSummary();
      }

      // Check All Answers
      function checkAllAnswers() {
        // Trigger completion for all activities
        if (!state.activities[1].completed) {
          const feedback = document.getElementById('feedback-1');
          const status = document.querySelector('#activity-1 .activity-status');
          
          state.activities[1].completed = true;
          state.activities[1].correct = 5;
          state.activities[1].score = 100;
          
          status.textContent = 'Completed';
          status.style.color = '#00b894';
          document.querySelector('#activity-1').classList.add('completed');
          feedback.classList.add('show');
          
          // Mark items
          document.querySelectorAll('#activity-1 .body-fluid-item').forEach(item => {
            if (item.dataset.required === 'true') {
              item.classList.add('required');
            } else {
              item.classList.add('not-required');
            }
            item.style.cursor = 'default';
          });
        }
        
        if (!state.activities[2].completed) {
          const feedback = document.getElementById('feedback-2');
          const status = document.querySelector('#activity-2 .activity-status');
          
          state.activities[2].completed = true;
          state.activities[2].correct = 7;
          state.activities[2].score = 88;
          
          status.textContent = 'Completed';
          status.style.color = '#00b894';
          document.querySelector('#activity-2').classList.add('completed');
          feedback.classList.add('show');
        }
        
        if (!state.activities[3].completed) {
          const feedback = document.getElementById('feedback-3');
          const status = document.querySelector('#activity-3 .activity-status');
          
          // Complete all scenarios
          state.scenarios.forEach((scenario, index) => {
            state.scenarioSelections[index] = scenario.correctPPE;
          });
          
          state.activities[3].completed = true;
          state.activities[3].correct = 10;
          state.activities[3].score = 100;
          
          status.textContent = 'Completed';
          status.style.color = '#00b894';
          document.querySelector('#activity-3').classList.add('completed');
          feedback.classList.add('show');
        }
        
        if (!state.activities[4].completed) {
          const feedback = document.getElementById('feedback-4');
          const status = document.querySelector('#activity-4 .activity-status');
          
          state.activities[4].completed = true;
          state.activities[4].correct = 8;
          state.activities[4].score = 100;
          
          status.textContent = 'Completed';
          status.style.color = '#00b894';
          document.querySelector('#activity-4').classList.add('completed');
          feedback.classList.add('show');
        }
        
        updateProgressSummary();
      }

      // View Final Results
      function viewFinalResults() {
        let totalScore = 0;
        let activityCount = 0;
        
        Object.values(state.activities).forEach(activity => {
          if (activity.completed) {
            totalScore += activity.score;
            activityCount++;
          }
        });
        
        const averageScore = activityCount > 0 ? Math.round(totalScore / activityCount) : 0;
        finalScore.textContent = `${averageScore}%`;
        resultsPanel.classList.add('show');
        
        // Scroll to results
        resultsPanel.scrollIntoView({ behavior: 'smooth' });
      }

      // Initialize
      initActivity1();
      initActivity2();
      initActivity3();
      initActivity4();
      
      resetBtn.addEventListener('click', resetAllActivities);
      checkBtn.addEventListener('click', checkAllAnswers);
      resultsBtn.addEventListener('click', viewFinalResults);
      
      // Initial progress update
      updateProgressSummary();
    });
  </script>
</body>
</html>
